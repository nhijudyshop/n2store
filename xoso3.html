<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>üèÅ ƒêua Thua Online</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
                min-height: 100vh;
                overflow-x: hidden;
            }

            .container {
                max-width: 100%;
                margin: 0 auto;
                padding: 10px;
            }

            /* Login Screen */
            .login-screen {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                padding: 20px;
            }

            .login-card {
                background: white;
                border-radius: 20px;
                padding: 30px 20px;
                width: 100%;
                max-width: 400px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: slideUp 0.5s ease;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(50px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .login-title {
                font-size: 2rem;
                font-weight: bold;
                text-align: center;
                margin-bottom: 10px;
                background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }

            .login-subtitle {
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 0.9rem;
            }

            .login-input {
                width: 100%;
                padding: 15px;
                font-size: 1rem;
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                margin-bottom: 15px;
                transition: all 0.3s ease;
            }

            .login-input:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }

            .button-group {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }

            .btn {
                flex: 1;
                padding: 15px;
                font-size: 1rem;
                font-weight: bold;
                border: none;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-primary {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                color: white;
            }

            .btn-secondary {
                background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                color: white;
            }

            .btn:active {
                transform: scale(0.95);
            }

            /* Game Screen */
            .game-screen {
                display: none;
            }

            .header {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                padding: 15px;
                border-radius: 15px;
                margin-bottom: 15px;
            }

            .header-top {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
            }

            .game-title {
                font-size: 1.5rem;
                font-weight: bold;
                color: white;
            }

            .room-code {
                background: rgba(255, 255, 255, 0.2);
                padding: 8px 15px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                font-size: 0.9rem;
            }

            .player-info {
                display: flex;
                align-items: center;
                justify-content: space-between;
                color: white;
            }

            .player-left {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .player-avatar {
                font-size: 1.8rem;
            }

            .player-name {
                font-weight: bold;
                font-size: 1rem;
            }

            .player-id {
                font-size: 0.7rem;
                opacity: 0.7;
            }

            .money-display {
                background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
                padding: 8px 15px;
                border-radius: 10px;
                font-weight: bold;
                font-size: 1.1rem;
                box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
            }

            /* Controls */
            .controls-card {
                background: white;
                border-radius: 15px;
                padding: 15px;
                margin-bottom: 15px;
            }

            .speed-control {
                padding: 15px;
            }

            .speed-label {
                font-size: 0.9rem;
                font-weight: bold;
                color: #333;
                margin-bottom: 8px;
                display: block;
            }

            .speed-slider {
                width: 100%;
                height: 40px;
                -webkit-appearance: none;
                background: transparent;
            }

            .speed-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                background: #3b82f6;
                cursor: pointer;
            }

            .speed-slider::-webkit-slider-runnable-track {
                width: 100%;
                height: 6px;
                background: #e5e7eb;
                border-radius: 3px;
            }

            /* Admin Controls */
            .admin-controls {
                background: rgba(251, 191, 36, 0.1);
                border: 2px solid rgba(251, 191, 36, 0.3);
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
            }

            .admin-title {
                color: #f59e0b;
                font-weight: bold;
                margin-bottom: 10px;
                font-size: 0.9rem;
            }

            .admin-btn {
                width: 100%;
                padding: 12px;
                background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
                color: white;
                border: none;
                border-radius: 10px;
                font-weight: bold;
                margin-bottom: 8px;
            }

            /* Players List */
            .players-card {
                background: white;
                border-radius: 15px;
                padding: 15px;
                margin-bottom: 15px;
            }

            .card-title {
                font-size: 1.1rem;
                font-weight: bold;
                color: #333;
                margin-bottom: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .player-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px;
                margin-bottom: 8px;
                background: linear-gradient(135deg, #dbeafe 0%, #e9d5ff 100%);
                border-radius: 12px;
            }

            .player-item-left {
                display: flex;
                align-items: center;
                gap: 10px;
                flex: 1;
            }

            .player-icon {
                font-size: 1.8rem;
            }

            .player-details {
                flex: 1;
            }

            .player-name-text {
                font-weight: bold;
                color: #333;
                font-size: 0.95rem;
            }

            .player-money {
                font-size: 0.75rem;
                color: #f59e0b;
                font-weight: bold;
            }

            .player-item-badge {
                font-size: 0.7rem;
                padding: 2px 6px;
                border-radius: 4px;
                font-weight: bold;
                margin-top: 2px;
                display: inline-block;
            }

            .player-buttons {
                display: flex;
                gap: 5px;
            }

            .item-btn {
                padding: 8px 12px;
                background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1.2rem;
                cursor: pointer;
            }

            .money-btn {
                padding: 8px 12px;
                background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                cursor: pointer;
                font-weight: bold;
            }

            .remove-btn {
                padding: 8px 12px;
                background: #ef4444;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 0.9rem;
            }

            /* Race Button */
            .race-btn {
                width: 100%;
                padding: 18px;
                font-size: 1.3rem;
                font-weight: bold;
                color: white;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                border: none;
                border-radius: 15px;
                margin-bottom: 15px;
                box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
            }

            .race-btn:disabled {
                background: #9ca3af;
                box-shadow: none;
            }

            /* Race Track */
            .race-container {
                background: white;
                border-radius: 15px;
                padding: 15px;
                margin-bottom: 15px;
            }

            .status-text {
                text-align: center;
                font-size: 1.2rem;
                font-weight: bold;
                color: #333;
                margin-bottom: 15px;
            }

            .track-line {
                position: relative;
                height: 60px;
                margin-bottom: 10px;
                background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
                border-radius: 10px;
                overflow: visible;
                border: 2px solid rgba(59, 130, 246, 0.2);
            }

            .finish-line {
                position: absolute;
                right: 0;
                top: 0;
                bottom: 0;
                width: 30px;
                background: repeating-linear-gradient(45deg, #000, #000 8px, #fff 8px, #fff 16px);
                opacity: 0.5;
                border-radius: 0 8px 8px 0;
            }

            .racer {
                position: absolute;
                left: 0;
                top: 50%;
                transform: translateY(-50%);
                display: flex;
                align-items: center;
                gap: 8px;
                transition: left 0.1s linear;
                z-index: 10;
            }

            .racer-icon {
                font-size: 2rem;
                filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
                animation: racerBounce 0.5s infinite;
            }

            @keyframes racerBounce {
                0%, 100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-3px);
                }
            }

            .racer.boosted .racer-icon {
                animation: superBoost 0.3s infinite;
                filter: drop-shadow(0 0 15px #fbbf24) drop-shadow(0 0 10px #f59e0b);
            }

            @keyframes superBoost {
                0%, 100% {
                    transform: translateY(0) scale(1);
                }
                50% {
                    transform: translateY(-8px) scale(1.2);
                }
            }

            .racer.slowed .racer-icon {
                animation: slowShake 0.6s infinite;
                filter: drop-shadow(0 0 10px #3b82f6);
            }

            @keyframes slowShake {
                0%, 100% {
                    transform: translateX(0) rotate(0deg);
                }
                25% {
                    transform: translateX(-4px) rotate(-5deg);
                }
                75% {
                    transform: translateX(4px) rotate(5deg);
                }
            }

            .racer.attacked .racer-icon {
                animation: hitShake 0.5s;
                filter: drop-shadow(0 0 15px #ef4444);
            }

            @keyframes hitShake {
                0%, 100% {
                    transform: translateX(0);
                }
                10%, 30%, 50%, 70%, 90% {
                    transform: translateX(-5px);
                }
                20%, 40%, 60%, 80% {
                    transform: translateX(5px);
                }
            }

            .racer-name {
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 4px 8px;
                border-radius: 8px;
                font-weight: bold;
                font-size: 0.8rem;
                white-space: nowrap;
            }

            /* Modal */
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.8);
            }

            .modal.show {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .modal-content {
                background: white;
                padding: 20px;
                border-radius: 20px;
                width: 90%;
                max-width: 500px;
                max-height: 80vh;
                overflow-y: auto;
            }

            .modal-header {
                font-size: 1.3rem;
                font-weight: bold;
                margin-bottom: 10px;
                color: #333;
            }

            .modal-subheader {
                font-size: 0.9rem;
                color: #666;
                margin-bottom: 15px;
            }

            .item-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-bottom: 15px;
            }

            .item-card {
                padding: 12px;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 3px solid transparent;
                text-align: center;
                position: relative;
            }

            .item-card.selected {
                border-color: white;
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
                transform: scale(1.05);
            }

            .item-card.locked {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .item-icon {
                font-size: 2rem;
                margin-bottom: 5px;
            }

            .item-name {
                font-weight: bold;
                font-size: 0.85rem;
                margin-bottom: 3px;
            }

            .item-type {
                font-size: 0.7rem;
                opacity: 0.9;
                margin-bottom: 3px;
            }

            .item-price {
                font-size: 0.8rem;
                font-weight: bold;
                background: rgba(0, 0, 0, 0.2);
                padding: 3px 8px;
                border-radius: 6px;
                display: inline-block;
                margin-top: 3px;
            }

            .item-effect {
                font-size: 0.65rem;
                opacity: 0.85;
            }

            .lock-icon {
                position: absolute;
                top: 5px;
                right: 5px;
                font-size: 1.2rem;
            }

            .item-common { background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%); color: white; }
            .item-magic { background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); color: white; }
            .item-rare { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; }
            .item-epic { background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%); color: white; }
            .item-legend { background: linear-gradient(135deg, #fb923c 0%, #ea580c 100%); color: white; }
            .item-mythic { background: linear-gradient(135deg, #ec4899 0%, #be185d 100%); color: white; }

            .modal-footer {
                display: flex;
                gap: 10px;
            }

            .modal-btn {
                flex: 1;
                padding: 12px;
                border: none;
                border-radius: 10px;
                font-weight: bold;
                cursor: pointer;
            }

            .modal-btn-confirm {
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
            }

            .modal-btn-cancel {
                background: #e5e7eb;
                color: #333;
            }

            /* Money Modal */
            .money-input {
                width: 100%;
                padding: 15px;
                font-size: 1.2rem;
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                margin-bottom: 15px;
                text-align: center;
                font-weight: bold;
            }

            .quick-amount {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
                margin-bottom: 15px;
            }

            .quick-btn {
                padding: 12px;
                background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
                color: white;
                border: none;
                border-radius: 10px;
                font-weight: bold;
                cursor: pointer;
            }

            /* Results */
            .results-container {
                display: none;
                padding: 20px;
                background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
                border-radius: 15px;
                margin-top: 15px;
            }

            .results-container.show {
                display: block;
            }

            .results-title {
                font-size: 1.5rem;
                font-weight: bold;
                color: white;
                text-align: center;
                margin-bottom: 20px;
            }

            .podium {
                display: flex;
                justify-content: center;
                align-items: flex-end;
                gap: 10px;
                margin-bottom: 20px;
            }

            .podium-place {
                text-align: center;
                flex-shrink: 0;
            }

            .podium-place.first { order: 2; }
            .podium-place.second { order: 1; }
            .podium-place.third { order: 3; }

            .podium-box {
                width: 90px;
                border-radius: 10px 10px 0 0;
                padding: 10px 5px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .podium-box.first {
                height: 130px;
                background: linear-gradient(to top, #fbbf24, #fcd34d);
                border: 2px solid #fff;
            }

            .podium-box.second {
                height: 100px;
                background: linear-gradient(to top, #94a3b8, #cbd5e1);
                border: 2px solid #fff;
            }

            .podium-box.third {
                height: 80px;
                background: linear-gradient(to top, #d97706, #f59e0b);
                border: 2px solid #fff;
            }

            .podium-medal {
                font-size: 2rem;
            }

            .podium-icon {
                font-size: 1.5rem;
                margin: 5px 0;
            }

            .podium-name {
                font-size: 0.75rem;
                font-weight: bold;
                color: white;
                max-width: 80px;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* Attack Effect */
            .attack-effect {
                position: absolute;
                font-size: 2rem;
                animation: attackMove 1s ease-out forwards;
                pointer-events: none;
                z-index: 100;
                filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
            }

            @keyframes attackMove {
                0% {
                    opacity: 1;
                    transform: translate(0, 0) scale(1) rotate(0deg);
                }
                50% {
                    transform: translate(calc(var(--tx) * 0.5), calc(var(--ty) * 0.5)) scale(1.3) rotate(180deg);
                }
                100% {
                    opacity: 0;
                    transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(360deg);
                }
            }

            .hit-effect {
                position: absolute;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle, rgba(239, 68, 68, 0.6) 0%, transparent 70%);
                border-radius: 50%;
                animation: hitPulse 0.6s ease-out;
                pointer-events: none;
            }

            @keyframes hitPulse {
                0% {
                    transform: scale(0);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.5);
                    opacity: 0.8;
                }
                100% {
                    transform: scale(3);
                    opacity: 0;
                }
            }

            .buff-effect {
                position: absolute;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle, rgba(251, 191, 36, 0.6) 0%, transparent 70%);
                border-radius: 50%;
                animation: buffPulse 0.6s ease-out;
                pointer-events: none;
            }

            @keyframes buffPulse {
                0% {
                    transform: scale(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.5) rotate(180deg);
                    opacity: 0.8;
                }
                100% {
                    transform: scale(3) rotate(360deg);
                    opacity: 0;
                }
            }

            .speed-particles {
                position: absolute;
                width: 100%;
                height: 100%;
                pointer-events: none;
                overflow: visible;
            }

            .speed-particle {
                position: absolute;
                width: 8px;
                height: 8px;
                background: linear-gradient(135deg, #fbbf24, #f59e0b);
                border-radius: 50%;
                animation: particleTrail 0.8s ease-out forwards;
                box-shadow: 0 0 10px #fbbf24;
            }

            @keyframes particleTrail {
                0% {
                    opacity: 1;
                    transform: translateX(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateX(-50px) scale(0);
                }
            }

            /* Floating Text */
            .floating-text {
                position: absolute;
                font-weight: bold;
                font-size: 1.2rem;
                pointer-events: none;
                z-index: 200;
                animation: floatUp 1.5s ease-out forwards;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            }

            @keyframes floatUp {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(0.8);
                }
                20% {
                    transform: translateY(-10px) scale(1.2);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-60px) scale(0.8);
                }
            }

            .floating-text.boost {
                color: #fbbf24;
                text-shadow: 
                    0 0 10px #fbbf24,
                    0 0 20px #f59e0b,
                    2px 2px 4px rgba(0, 0, 0, 0.8);
            }

            .floating-text.attack {
                color: #ef4444;
                text-shadow: 
                    0 0 10px #ef4444,
                    0 0 20px #dc2626,
                    2px 2px 4px rgba(0, 0, 0, 0.8);
            }

            .floating-text.buff {
                color: #10b981;
                text-shadow: 
                    0 0 10px #10b981,
                    0 0 20px #059669,
                    2px 2px 4px rgba(0, 0, 0, 0.8);
            }

            .floating-text.slow {
                color: #3b82f6;
                text-shadow: 
                    0 0 10px #3b82f6,
                    0 0 20px #2563eb,
                    2px 2px 4px rgba(0, 0, 0, 0.8);
            }

            /* Lightning Effect */
            .lightning-effect {
                position: absolute;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, 
                    transparent 0%, 
                    rgba(251, 191, 36, 0.8) 50%, 
                    transparent 100%);
                animation: lightningFlash 0.3s ease-out;
                pointer-events: none;
                z-index: 50;
            }

            @keyframes lightningFlash {
                0%, 100% {
                    opacity: 0;
                }
                50% {
                    opacity: 1;
                }
            }

            /* Shockwave Effect */
            .shockwave {
                position: absolute;
                width: 80px;
                height: 80px;
                border: 4px solid rgba(251, 191, 36, 0.8);
                border-radius: 50%;
                animation: shockwaveExpand 0.8s ease-out forwards;
                pointer-events: none;
            }

            @keyframes shockwaveExpand {
                0% {
                    transform: scale(0);
                    opacity: 1;
                }
                100% {
                    transform: scale(3);
                    opacity: 0;
                }
            }

            /* Trail Effect */
            .speed-trail {
                position: absolute;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, 
                    rgba(251, 191, 36, 0.6) 0%, 
                    rgba(251, 191, 36, 0.3) 50%, 
                    transparent 100%);
                border-radius: 10px;
                animation: trailFade 0.5s ease-out forwards;
                pointer-events: none;
            }

            @keyframes trailFade {
                0% {
                    opacity: 1;
                    transform: scaleX(1);
                }
                100% {
                    opacity: 0;
                    transform: scaleX(0.5);
                }
            }

            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                animation: slideInRight 0.3s ease;
                max-width: 300px;
            }

            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            .notification-success {
                border-left: 4px solid #10b981;
            }

            .notification-title {
                font-weight: bold;
                margin-bottom: 5px;
                color: #333;
            }

            .notification-message {
                font-size: 0.9rem;
                color: #666;
            }

            @media (min-width: 768px) {
                .container {
                    max-width: 600px;
                    padding: 20px;
                }
            }
        </style>
    </head>
    <body>
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <div class="login-card">
                <div class="login-title">üèÅ ƒêUA THUA ONLINE</div>
                <div class="login-subtitle">Nh·∫≠p t√™n ƒë·ªÉ tham gia!</div>
                <input type="text" id="playerNameInput" class="login-input" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." maxlength="20" />
                <div class="button-group">
                    <button class="btn btn-primary" onclick="joinGame()">üéÆ Tham Gia</button>
                    <button class="btn btn-secondary" onclick="randomName()">üé≤ Random</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen">
            <div class="container">
                <div class="header">
                    <div class="header-top">
                        <div class="game-title">üèÅ ƒêua Thua</div>
                        <div class="room-code" id="roomCode">ROOM-001</div>
                    </div>
                    <div class="player-info">
                        <div class="player-left">
                            <div class="player-avatar" id="myAvatar">üêÜ</div>
                            <div>
                                <div class="player-name" id="myName">Player</div>
                                <div class="player-id" id="myId">ID: 12345</div>
                            </div>
                        </div>
                        <div class="money-display" id="myMoney">üí∞ 1000</div>
                    </div>
                </div>

                <!-- Speed Control -->
                <div class="controls-card">
                    <div class="speed-control">
                        <div class="speed-label">‚ö° T·ªëc ƒë·ªô ƒëua: <span id="speedValue">5s</span></div>
                        <input type="range" class="speed-slider" id="speedSlider" min="3" max="60" value="5" step="1" oninput="updateSpeed(this.value)" />
                    </div>
                </div>

                <!-- Admin Controls -->
                <div id="adminControls" class="admin-controls" style="display: none;">
                    <div class="admin-title">‚öôÔ∏è QU·∫¢N TR·ªä VI√äN</div>
                    <button class="admin-btn" onclick="addBot()">ü§ñ Th√™m Bot</button>
                    <button class="admin-btn" onclick="openShop()">üè™ M·ªü Shop (T·∫•t c·∫£)</button>
                </div>

                <!-- Players List -->
                <div class="players-card">
                    <div class="card-title">
                        <span>üë• Ng∆∞·ªùi ch∆°i</span>
                        <span id="totalPlayers">2</span>
                    </div>
                    <div id="playersList"></div>
                </div>

                <!-- Race Button -->
                <button id="raceBtn" class="race-btn" onclick="startRace()">üèÅ B·∫ÆT ƒê·∫¶U ƒêUA</button>

                <!-- Race Track -->
                <div class="race-container">
                    <div class="status-text" id="statusText">S·∫µn s√†ng!</div>
                    <div id="raceTrack"></div>
                    <div id="resultsContainer" class="results-container"></div>
                </div>
            </div>
        </div>

        <!-- Item Shop Modal -->
        <div id="itemModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">üéÅ Shop Item</div>
                <div class="modal-subheader">
                    <span id="shopPlayerName"></span> | üí∞ <span id="shopPlayerMoney">0</span>
                </div>
                <div class="item-grid" id="itemGrid"></div>
                <div class="modal-footer">
                    <button class="modal-btn modal-btn-cancel" onclick="closeModal()">‚úï ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <!-- Add Money Modal -->
        <div id="moneyModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">üí∞ N·∫°p Ti·ªÅn</div>
                <div class="modal-subheader">Cho: <span id="moneyPlayerName"></span></div>
                <input type="number" id="moneyInput" class="money-input" placeholder="Nh·∫≠p s·ªë ti·ªÅn..." min="0" step="100" />
                <div class="quick-amount">
                    <button class="quick-btn" onclick="setAmount(1000)">+1,000</button>
                    <button class="quick-btn" onclick="setAmount(5000)">+5,000</button>
                    <button class="quick-btn" onclick="setAmount(10000)">+10,000</button>
                    <button class="quick-btn" onclick="setAmount(50000)">+50,000</button>
                    <button class="quick-btn" onclick="setAmount(100000)">+100K</button>
                    <button class="quick-btn" onclick="setAmount(500000)">+500K</button>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn modal-btn-confirm" onclick="confirmAddMoney()">‚úì N·∫°p Ti·ªÅn</button>
                    <button class="modal-btn modal-btn-cancel" onclick="closeMoneyModal()">‚úï H·ªßy</button>
                </div>
            </div>
        </div>

        <script>
            const animalIcons = ["üêÜ","ü¶Å","üêé","ü¶Ö","üêï","ü¶ò","üêÖ","üêÉ","üêÇ","üêÑ","ü¶å","ü¶í","ü¶è","ü¶õ","üêò","ü¶ô","ü¶¨","üê™","üê´","ü¶ì","üêñ","üêó","üêè","üêë","üêê","ü¶¶","ü¶®","ü¶°","üêª","üêº","üê®","üêØ","ü¶ä","üê∫","üê∂","üê±","üê≠","üêπ","üê∞","ü¶ù","üêøÔ∏è","ü¶î","ü¶á","ü¶à","üêä","ü¶ñ","ü¶ï","üêâ","üê≤","ü¶é"];
            
            const randomNames = ["Th·ªè Nhanh","R√πa Ch·∫≠m","B√°o ƒê·ªëm","S∆∞ T·ª≠","ƒê·∫°i B√†ng","Ng·ª±a Hoang","C√°o Sly","S√≥i X√°m","G·∫•u Tr√∫c","H·ªï V·∫±n","Voi Kh·ªïng L·ªì","H∆∞∆°u Cao","T√™ Gi√°c","H√† M√£","Kangaroo","R·ªìng L·ª≠a","Ph∆∞·ª£ng Ho√†ng","K·ª≥ L√¢n","Pegasus","Minotaur"];

            const items = [
                // BUFF - Common (100-500)
                { id: 1, name: "Gi√†y Th·ªÉ Thao", icon: "üëü", rarity: "common", type: "buff", boost: 0.05, price: 100 },
                { id: 2, name: "N∆∞·ªõc TƒÉng L·ª±c", icon: "ü•§", rarity: "common", type: "buff", boost: 0.07, price: 200 },
                { id: 3, name: "C√† Ph√™", icon: "‚òï", rarity: "common", type: "buff", boost: 0.08, price: 300 },
                { id: 4, name: "B√°nh M√¨", icon: "üçû", rarity: "common", type: "buff", boost: 0.10, price: 500 },
                
                // ATTACK - Common (100-500)
                { id: 5, name: "ƒê√° Nh·ªè", icon: "ü™®", rarity: "common", type: "attack", debuff: 0.05, price: 150 },
                { id: 6, name: "Qu·∫£ Chu·ªëi", icon: "üçå", rarity: "common", type: "attack", debuff: 0.08, price: 400 },
                
                // BUFF - Magic (800-2000)
                { id: 7, name: "C√°nh Chim", icon: "ü™∂", rarity: "magic", type: "buff", boost: 0.12, price: 800 },
                { id: 8, name: "L√° B√πa", icon: "üçÄ", rarity: "magic", type: "buff", boost: 0.15, price: 1200 },
                { id: 9, name: "Ki·∫øm S·∫Øc", icon: "‚öîÔ∏è", rarity: "magic", type: "buff", boost: 0.18, price: 2000 },
                
                // ATTACK - Magic (800-2000)
                { id: 10, name: "Bom Kh√≥i", icon: "üí®", rarity: "magic", type: "attack", debuff: 0.10, price: 1000 },
                { id: 11, name: "L∆∞·ªõi B·∫Øt", icon: "üï∏Ô∏è", rarity: "magic", type: "attack", debuff: 0.15, price: 1800 },
                
                // BUFF - Rare (3000-8000)
                { id: 12, name: "R·ªìng L·ª≠a", icon: "üê≤", rarity: "rare", type: "buff", boost: 0.20, price: 3000 },
                { id: 13, name: "Tia Ch·ªõp", icon: "‚ö°", rarity: "rare", type: "buff", boost: 0.25, price: 5000 },
                { id: 14, name: "L·ªëc Xo√°y", icon: "üå™Ô∏è", rarity: "rare", type: "buff", boost: 0.30, price: 8000 },
                
                // ATTACK - Rare (3000-8000)
                { id: 15, name: "BƒÉng ƒê√°", icon: "‚ùÑÔ∏è", rarity: "rare", type: "attack", debuff: 0.18, price: 4000 },
                { id: 16, name: "D√¢y Leo", icon: "üåø", rarity: "rare", type: "attack", debuff: 0.25, price: 7000 },
                
                // BUFF - Epic (10000-25000)
                { id: 17, name: "Ph∆∞·ª£ng Ho√†ng", icon: "üî•", rarity: "epic", type: "buff", boost: 0.35, price: 10000 },
                { id: 18, name: "V∆∞∆°ng Mi·ªán", icon: "üëë", rarity: "epic", type: "buff", boost: 0.42, price: 18000 },
                { id: 19, name: "Ma Ph√°p", icon: "‚ú®", rarity: "epic", type: "buff", boost: 0.50, price: 25000 },
                
                // ATTACK - Epic (10000-25000)
                { id: 20, name: "B√∫a S·∫•m", icon: "üî®", rarity: "epic", type: "attack", debuff: 0.30, price: 12000 },
                { id: 21, name: "H·ªë ƒêen", icon: "üï≥Ô∏è", rarity: "epic", type: "attack", debuff: 0.40, price: 22000 },
                
                // BUFF - Legend (30000-80000)
                { id: 22, name: "Th·∫ßn T·ªëc", icon: "üí®", rarity: "legend", type: "buff", boost: 0.55, price: 30000 },
                { id: 23, name: "H·ªèa Ti·ªÖn", icon: "üöÄ", rarity: "legend", type: "buff", boost: 0.65, price: 50000 },
                { id: 24, name: "NƒÉng L∆∞·ª£ng V≈© Tr·ª•", icon: "üåå", rarity: "legend", type: "buff", boost: 0.70, price: 80000 },
                
                // ATTACK - Legend (30000-80000)
                { id: 25, name: "Thi√™n Th·∫°ch", icon: "‚òÑÔ∏è", rarity: "legend", type: "attack", debuff: 0.45, price: 40000 },
                { id: 26, name: "S√≥ng Th·∫ßn", icon: "üåä", rarity: "legend", type: "attack", debuff: 0.60, price: 70000 },
                
                // BUFF - Mythic (100000-500000)
                { id: 27, name: "Th·∫ßn Linh", icon: "üëº", rarity: "mythic", type: "buff", boost: 0.80, price: 100000 },
                { id: 28, name: "S·ª©c M·∫°nh T·ªëi Th∆∞·ª£ng", icon: "üíé", rarity: "mythic", type: "buff", boost: 1.00, price: 500000 },
                
                // ATTACK - Mythic (100000-500000)
                { id: 29, name: "L·ªó ƒêen", icon: "üåë", rarity: "mythic", type: "attack", debuff: 0.70, price: 200000 },
                { id: 30, name: "T·∫≠n Th·∫ø", icon: "üí•", rarity: "mythic", type: "attack", debuff: 0.90, price: 400000 },
            ];

            let gameState = {
                players: [],
                myPlayer: null,
                isAdmin: false,
                raceSpeed: 5,
                isRacing: false,
                roomCode: "ROOM-" + Math.floor(Math.random() * 9000 + 1000),
            };

            let currentShoppingPlayer = null;
            let currentMoneyPlayer = null;

            // Simulate realtime updates
            function syncGameState() {
                // In real app, this would sync with backend/Firebase
                localStorage.setItem('gameState', JSON.stringify(gameState));
                updateGameUI();
            }

            function loadGameState() {
                const saved = localStorage.getItem('gameState');
                if (saved) {
                    const loaded = JSON.parse(saved);
                    // Only load other players, not overwrite current player
                    gameState.players = loaded.players;
                    updateGameUI();
                }
            }

            // Check for updates every second
            setInterval(() => {
                if (document.getElementById('gameScreen').style.display !== 'none') {
                    loadGameState();
                }
            }, 1000);

            function generatePlayerId() {
                return 'P' + Math.floor(Math.random() * 90000 + 10000);
            }

            function randomName() {
                const name = randomNames[Math.floor(Math.random() * randomNames.length)];
                document.getElementById('playerNameInput').value = name;
            }

            function joinGame() {
                const nameInput = document.getElementById('playerNameInput').value.trim();
                if (!nameInput) {
                    alert("Vui l√≤ng nh·∫≠p t√™n!");
                    return;
                }

                const isAdmin = nameInput.endsWith('##');
                const cleanName = nameInput.replace('##', '');
                const avatar = animalIcons[Math.floor(Math.random() * animalIcons.length)];
                const playerId = generatePlayerId();

                gameState.myPlayer = {
                    id: playerId,
                    name: cleanName,
                    avatar: avatar,
                    money: 1000,
                    item: null,
                    isMe: true
                };
                gameState.isAdmin = isAdmin;
                
                // Load existing players
                loadGameState();
                
                // Add current player
                gameState.players = gameState.players.filter(p => p.id !== playerId);
                gameState.players.push(gameState.myPlayer);

                // Add a bot if first player
                if (gameState.players.length === 1) {
                    addBot();
                }

                syncGameState();

                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'block';
            }

            function addBot() {
                const botName = randomNames[Math.floor(Math.random() * randomNames.length)] + " (Bot)";
                const botAvatar = animalIcons[Math.floor(Math.random() * animalIcons.length)];
                const botId = 'BOT' + Math.floor(Math.random() * 90000 + 10000);
                
                gameState.players.push({
                    id: botId,
                    name: botName,
                    avatar: botAvatar,
                    money: 5000,
                    item: items[Math.floor(Math.random() * 6)], // Random common item
                    isBot: true
                });

                syncGameState();
            }

            function updateSpeed(value) {
                gameState.raceSpeed = parseInt(value);
                document.getElementById('speedValue').textContent = value + 's';
            }

            function updateGameUI() {
                if (!gameState.myPlayer) return;

                document.getElementById('myAvatar').textContent = gameState.myPlayer.avatar;
                document.getElementById('myName').textContent = gameState.myPlayer.name;
                document.getElementById('myId').textContent = 'ID: ' + gameState.myPlayer.id;
                document.getElementById('myMoney').textContent = 'üí∞ ' + formatMoney(gameState.myPlayer.money);
                document.getElementById('totalPlayers').textContent = gameState.players.length;
                document.getElementById('roomCode').textContent = gameState.roomCode;

                if (gameState.isAdmin) {
                    document.getElementById('adminControls').style.display = 'block';
                }

                const playersList = document.getElementById('playersList');
                playersList.innerHTML = gameState.players.map(player => {
                    const item = player.item;
                    const itemBadge = item ? 
                        `<div class="player-item-badge item-${item.rarity}">${item.icon} ${item.name}</div>` : 
                        '<div style="font-size: 0.7rem; color: #999;">Ch∆∞a c√≥ item</div>';
                    
                    let buttons = '';
                    if (player.isMe) {
                        buttons = `<button class="item-btn" onclick="openItemModal('${player.id}')">üè™</button>`;
                    } else if (gameState.isAdmin) {
                        buttons = `
                            <button class="money-btn" onclick="openMoneyModal('${player.id}')">üí∞</button>
                            ${player.isBot ? `<button class="remove-btn" onclick="removePlayer('${player.id}')">‚úï</button>` : ''}
                        `;
                    }

                    return `
                        <div class="player-item">
                            <div class="player-item-left">
                                <div class="player-icon">${player.avatar}</div>
                                <div class="player-details">
                                    <div class="player-name-text">${player.name}${player.isMe ? ' (B·∫°n)' : ''}</div>
                                    <div class="player-money">üí∞ ${formatMoney(player.money)}</div>
                                    ${itemBadge}
                                </div>
                            </div>
                            <div class="player-buttons">${buttons}</div>
                        </div>
                    `;
                }).join('');
            }

            function formatMoney(amount) {
                return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            function removePlayer(playerId) {
                gameState.players = gameState.players.filter(p => p.id !== playerId);
                syncGameState();
            }

            function openItemModal(playerId) {
                currentShoppingPlayer = gameState.players.find(p => p.id === playerId);
                document.getElementById('shopPlayerName').textContent = currentShoppingPlayer.name;
                document.getElementById('shopPlayerMoney').textContent = formatMoney(currentShoppingPlayer.money);
                
                const itemGrid = document.getElementById('itemGrid');
                itemGrid.innerHTML = items.map(item => {
                    const canBuy = currentShoppingPlayer.money >= item.price;
                    const isSelected = currentShoppingPlayer.item?.id === item.id;
                    const typeIcon = item.type === 'buff' ? 'üõ°Ô∏è' : '‚öîÔ∏è';
                    const typeText = item.type === 'buff' ? 'BUFF' : 'ATTACK';
                    const effect = item.type === 'buff' ? `+${item.boost * 100}%` : `-${item.debuff * 100}%`;
                    
                    return `
                        <div class="item-card item-${item.rarity} ${isSelected ? 'selected' : ''} ${!canBuy ? 'locked' : ''}" 
                             onclick="${canBuy ? `buyItem(${item.id})` : ''}">
                            ${!canBuy ? '<div class="lock-icon">üîí</div>' : ''}
                            <div class="item-icon">${item.icon}</div>
                            <div class="item-name">${item.name}</div>
                            <div class="item-type">${typeIcon} ${typeText}</div>
                            <div class="item-price">üí∞ ${formatMoney(item.price)}</div>
                            <div class="item-effect">${effect}</div>
                        </div>
                    `;
                }).join('');

                document.getElementById('itemModal').classList.add('show');
            }

            function buyItem(itemId) {
                const item = items.find(i => i.id === itemId);
                if (!item || !currentShoppingPlayer) return;

                if (currentShoppingPlayer.money >= item.price) {
                    currentShoppingPlayer.money -= item.price;
                    currentShoppingPlayer.item = item;
                    
                    // Update my player reference
                    if (currentShoppingPlayer.isMe) {
                        gameState.myPlayer = currentShoppingPlayer;
                    }
                    
                    syncGameState();
                    showNotification('Mua th√†nh c√¥ng!', `${item.icon} ${item.name} ƒë√£ ƒë∆∞·ª£c mua!`);
                    openItemModal(currentShoppingPlayer.id); // Refresh modal
                } else {
                    alert('Kh√¥ng ƒë·ªß ti·ªÅn!');
                }
            }

            function openMoneyModal(playerId) {
                currentMoneyPlayer = gameState.players.find(p => p.id === playerId);
                document.getElementById('moneyPlayerName').textContent = currentMoneyPlayer.name;
                document.getElementById('moneyInput').value = '';
                document.getElementById('moneyModal').classList.add('show');
            }

            function setAmount(amount) {
                const currentValue = parseInt(document.getElementById('moneyInput').value) || 0;
                document.getElementById('moneyInput').value = currentValue + amount;
            }

            function confirmAddMoney() {
                const amount = parseInt(document.getElementById('moneyInput').value);
                if (!amount || amount <= 0) {
                    alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!');
                    return;
                }

                currentMoneyPlayer.money += amount;
                syncGameState();
                showNotification('N·∫°p ti·ªÅn th√†nh c√¥ng!', `+${formatMoney(amount)} cho ${currentMoneyPlayer.name}`);
                closeMoneyModal();
            }

            function openShop() {
                // Open shop for all players
                alert('Ch·ª©c nƒÉng n√†y s·∫Ω m·ªü shop cho t·∫•t c·∫£ ng∆∞·ªùi ch∆°i online!');
            }

            function closeModal() {
                document.getElementById('itemModal').classList.remove('show');
                currentShoppingPlayer = null;
            }

            function closeMoneyModal() {
                document.getElementById('moneyModal').classList.remove('show');
                currentMoneyPlayer = null;
            }

            function showNotification(title, message) {
                const notification = document.createElement('div');
                notification.className = 'notification notification-success';
                notification.innerHTML = `
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            async function startRace() {
                if (gameState.isRacing) return;
                
                gameState.isRacing = true;
                document.getElementById('raceBtn').disabled = true;
                document.getElementById('resultsContainer').classList.remove('show');

                setupRaceTrack();

                for (let i = 3; i > 0; i--) {
                    document.getElementById('statusText').textContent = `ƒê·∫øm ng∆∞·ª£c: ${i}...`;
                    await sleep(1000);
                }

                document.getElementById('statusText').textContent = "XU·∫§T PH√ÅT! üèÅ";
                const results = await runRace();

                await sleep(500);
                displayResults(results);

                document.getElementById('raceBtn').disabled = false;
                gameState.isRacing = false;
            }

            function setupRaceTrack() {
                const trackDiv = document.getElementById('raceTrack');
                trackDiv.innerHTML = gameState.players.map(player => `
                    <div class="track-line" id="track-${player.id}">
                        <div class="finish-line"></div>
                        <div class="racer" id="racer-${player.id}">
                            <span class="racer-icon">${player.avatar}</span>
                            <span class="racer-name">${player.name}</span>
                        </div>
                    </div>
                `).join('');
            }

            async function runRace() {
                const trackWidth = document.querySelector('.track-line').offsetWidth - 100;
                const finishLine = trackWidth;
                const baseFrameTime = 50;
                const totalRaceTime = gameState.raceSpeed * 1000;
                const results = [];

                const racers = gameState.players.map(player => {
                    const baseSpeed = finishLine / (totalRaceTime / baseFrameTime);
                    let speed = baseSpeed * (0.7 + Math.random() * 0.6);
                    
                    if (player.item && player.item.type === 'buff') {
                        speed *= (1 + player.item.boost);
                        // Show buff effect at start
                        setTimeout(() => {
                            const element = document.getElementById(`racer-${player.id}`);
                            if (element) {
                                showBuffEffect(element);
                                showFloatingText(element, 'BUFF ACTIVE!', 'buff');
                            }
                        }, 100);
                    }

                    return {
                        ...player,
                        element: document.getElementById(`racer-${player.id}`),
                        trackLine: document.getElementById(`track-${player.id}`),
                        position: 0,
                        speed: speed,
                        finished: false
                    };
                });

                return new Promise((resolve) => {
                    const interval = setInterval(() => {
                        let allFinished = true;

                        racers.forEach((racer, index) => {
                            if (!racer.finished) {
                                allFinished = false;
                                
                                let currentSpeed = racer.speed * (0.9 + Math.random() * 0.2);
                                let speedChanged = false;

                                // Random speed boost (3% chance)
                                if (Math.random() < 0.03) {
                                    const boost = 1.5 + Math.random() * 0.5;
                                    currentSpeed *= boost;
                                    speedChanged = true;
                                    racer.element.classList.add('boosted');
                                    createSpeedTrail(racer.trackLine, racer.position);
                                    createSpeedParticles(racer.element);
                                    createShockwave(racer.element);
                                    createLightning(racer.trackLine);
                                    showFloatingText(racer.element, '‚ö° TƒÇNG T√îC! ‚ö°', 'boost');
                                    setTimeout(() => racer.element.classList.remove('boosted'), 500);
                                }

                                // Random slow down (5% chance)
                                if (Math.random() < 0.05) {
                                    currentSpeed *= -0.3;
                                    speedChanged = true;
                                    racer.element.classList.add('slowed');
                                    showFloatingText(racer.element, '‚ùÑÔ∏è CH·∫¨M L·∫†I!', 'slow');
                                    setTimeout(() => racer.element.classList.remove('slowed'), 600);
                                }

                                // Attack items
                                racers.forEach((target, targetIndex) => {
                                    if (targetIndex !== index && !target.finished && Math.random() < 0.02) {
                                        const attacker = racers[index];
                                        if (attacker.item && attacker.item.type === 'attack') {
                                            createAttackEffect(attacker.element, target.element, attacker.item.icon);
                                            
                                            setTimeout(() => {
                                                target.element.classList.add('attacked');
                                                const debuff = attacker.item.debuff;
                                                target.speed *= (1 - debuff);
                                                
                                                showFloatingText(target.element, `‚öîÔ∏è -${Math.round(debuff * 100)}% T·ªêC ƒê·ªò!`, 'attack');
                                                createHitEffect(target.trackLine);
                                                
                                                setTimeout(() => {
                                                    target.element.classList.remove('attacked');
                                                    target.speed /= (1 - debuff);
                                                }, 1200);
                                            }, 1000);
                                        }
                                    }
                                });

                                racer.position += currentSpeed;
                                
                                if (racer.position >= finishLine) {
                                    racer.position = finishLine;
                                    racer.finished = true;
                                    results.push({
                                        name: racer.name,
                                        avatar: racer.avatar,
                                        rank: results.length + 1
                                    });
                                    showFloatingText(racer.element, 'üèÅ HO√ÄN TH√ÄNH!', 'buff');
                                    createFinishEffect(racer.trackLine);
                                }

                                if (racer.position < 0) racer.position = 0;
                                racer.element.style.left = racer.position + 'px';
                            }
                        });

                        if (allFinished) {
                            clearInterval(interval);
                            resolve(results);
                        }
                    }, baseFrameTime);
                });
            }

            function showFloatingText(element, text, type) {
                const rect = element.getBoundingClientRect();
                const floatingText = document.createElement('div');
                floatingText.className = `floating-text ${type}`;
                floatingText.textContent = text;
                floatingText.style.left = rect.left + rect.width / 2 + 'px';
                floatingText.style.top = rect.top - 10 + 'px';
                floatingText.style.position = 'fixed';
                floatingText.style.transform = 'translateX(-50%)';
                document.body.appendChild(floatingText);
                setTimeout(() => floatingText.remove(), 1500);
            }

            function showBuffEffect(element) {
                const buffEffect = document.createElement('div');
                buffEffect.className = 'buff-effect';
                element.parentElement.appendChild(buffEffect);
                setTimeout(() => buffEffect.remove(), 600);
            }

            function createSpeedTrail(trackLine, position) {
                const trail = document.createElement('div');
                trail.className = 'speed-trail';
                trail.style.left = position + 'px';
                trackLine.appendChild(trail);
                setTimeout(() => trail.remove(), 500);
            }

            function createSpeedParticles(element) {
                const container = document.createElement('div');
                container.className = 'speed-particles';
                element.appendChild(container);
                
                for (let i = 0; i < 8; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'speed-particle';
                    particle.style.top = (Math.random() * 40 - 20) + 'px';
                    particle.style.animationDelay = (i * 0.1) + 's';
                    container.appendChild(particle);
                }
                
                setTimeout(() => container.remove(), 800);
            }

            function createShockwave(element) {
                const rect = element.getBoundingClientRect();
                const shockwave = document.createElement('div');
                shockwave.className = 'shockwave';
                shockwave.style.left = rect.left + rect.width / 2 - 40 + 'px';
                shockwave.style.top = rect.top + rect.height / 2 - 40 + 'px';
                shockwave.style.position = 'fixed';
                document.body.appendChild(shockwave);
                setTimeout(() => shockwave.remove(), 800);
            }

            function createLightning(trackLine) {
                const lightning = document.createElement('div');
                lightning.className = 'lightning-effect';
                trackLine.appendChild(lightning);
                setTimeout(() => lightning.remove(), 300);
            }

            function createHitEffect(trackLine) {
                const hitEffect = document.createElement('div');
                hitEffect.className = 'hit-effect';
                trackLine.appendChild(hitEffect);
                setTimeout(() => hitEffect.remove(), 600);
            }

            function createFinishEffect(trackLine) {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const effect = document.createElement('div');
                        effect.className = 'buff-effect';
                        trackLine.appendChild(effect);
                        setTimeout(() => effect.remove(), 600);
                    }, i * 200);
                }
            }

            function createAttackEffect(fromElement, toElement, icon) {
                const fromRect = fromElement.getBoundingClientRect();
                const toRect = toElement.getBoundingClientRect();
                
                const effect = document.createElement('div');
                effect.className = 'attack-effect';
                effect.textContent = icon;
                effect.style.left = fromRect.left + fromRect.width / 2 + 'px';
                effect.style.top = fromRect.top + fromRect.height / 2 + 'px';
                effect.style.position = 'fixed';
                
                const dx = toRect.left - fromRect.left;
                const dy = toRect.top - fromRect.top;
                effect.style.setProperty('--tx', dx + 'px');
                effect.style.setProperty('--ty', dy + 'px');
                
                document.body.appendChild(effect);
                
                // Create trail particles during flight
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = 'attack-effect';
                        particle.textContent = 'üí•';
                        particle.style.left = fromRect.left + fromRect.width / 2 + (dx * i / 5) + 'px';
                        particle.style.top = fromRect.top + fromRect.height / 2 + (dy * i / 5) + 'px';
                        particle.style.position = 'fixed';
                        particle.style.fontSize = '1rem';
                        particle.style.animation = 'floatUp 0.5s ease-out forwards';
                        document.body.appendChild(particle);
                        setTimeout(() => particle.remove(), 500);
                    }, i * 150);
                }
                
                setTimeout(() => effect.remove(), 1000);
            }

            function displayResults(results) {
                const container = document.getElementById('resultsContainer');
                
                let html = '<div class="results-title">üèÜ K·∫æT QU·∫¢ üèÜ</div>';
                
                if (results.length >= 3) {
                    html += '<div class="podium">';
                    [1, 0, 2].forEach(i => {
                        if (results[i]) {
                            const medals = ['ü•á', 'ü•à', 'ü•â'];
                            const classes = ['first', 'second', 'third'];
                            html += `
                                <div class="podium-place ${classes[results[i].rank - 1]}">
                                    <div class="podium-box ${classes[results[i].rank - 1]}">
                                        <div class="podium-medal">${medals[results[i].rank - 1]}</div>
                                        <div class="podium-icon">${results[i].avatar}</div>
                                        <div class="podium-name">${results[i].name}</div>
                                    </div>
                                </div>
                            `;
                        }
                    });
                    html += '</div>';
                }

                container.innerHTML = html;
                container.classList.add('show');
            }

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        </script>
    </body>
</html>

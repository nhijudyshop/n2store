<!--
  üìñ GHI CH√ö CHO L·∫¨P TR√åNH VI√äN:
  Khi code ph·∫£i ƒë·ªçc th∆∞ m·ª•c https://github.com/nhijudyshop/n2store/tree/main/docs tr∆∞·ªõc!
  ƒê·ªçc c√°c file SHARED_*.md ƒë·ªÉ hi·ªÉu c√°ch s·ª≠ d·ª•ng shared modules.
-->
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìí S·ªï Order Live - N2Store</title>
    <!-- Core Loader -->
    <!-- ES Module: Shared utilities -->
        <script type="module" src="../shared/esm/compat.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-left">
            <button class="btn-toggle-sidebar d-md-none" onclick="toggleSidebar()">
                <i class="bi bi-list"></i>
            </button>
            <div class="logo">
                <span class="logo-icon">üìí</span>
                <span class="logo-text">S·ªï Order Live</span>
            </div>
        </div>
        <div class="header-right">
            <div class="sync-status" id="syncStatus">
                <i class="bi bi-cloud-check"></i>
                <span>ƒê√£ ƒë·ªìng b·ªô</span>
            </div>
            <button class="btn-history" onclick="toggleHistoryPanel()">
                <i class="bi bi-clock-history"></i>
                <span class="d-none d-md-inline">L·ªãch s·ª≠</span>
            </button>
        </div>
    </header>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>üìÑ Danh s√°ch trang</h3>
                <button class="btn-add-sheet" onclick="createNewSheet()">
                    <i class="bi bi-plus-lg"></i> T·∫°o m·ªõi
                </button>
            </div>
            <div class="sheets-list" id="sheetsList">
                <!-- Sheets will be rendered here -->
                <div class="empty-state" id="emptySheets">
                    <i class="bi bi-journal-plus"></i>
                    <p>Ch∆∞a c√≥ trang n√†o</p>
                    <button class="btn btn-primary btn-sm" onclick="createNewSheet()">
                        T·∫°o trang ƒë·∫ßu ti√™n
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Empty State when no sheet selected -->
            <div class="no-sheet-selected" id="noSheetSelected">
                <div class="empty-illustration">
                    <i class="bi bi-journal-bookmark"></i>
                </div>
                <h2>Ch·ªçn ho·∫∑c t·∫°o trang m·ªõi</h2>
                <p>Ch·ªçn m·ªôt trang t·ª´ danh s√°ch b√™n tr√°i ho·∫∑c t·∫°o trang m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                <button class="btn btn-primary" onclick="createNewSheet()">
                    <i class="bi bi-plus-lg"></i> T·∫°o trang m·ªõi
                </button>
            </div>

            <!-- Sheet Content -->
            <div class="sheet-content" id="sheetContent" style="display: none;">
                <!-- Product Search -->
                <div class="product-search-section">
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <i class="bi bi-search"></i>
                            <input type="text" id="productSearch" class="search-input"
                                placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m (nh·∫≠p m√£ ho·∫∑c t√™n)..." autocomplete="off">
                            <div class="search-loading" id="searchLoading" style="display: none;">
                                <div class="spinner-border spinner-border-sm"></div>
                            </div>
                        </div>
                        <div class="suggestions-dropdown" id="suggestionsDropdown"></div>
                    </div>
                </div>

                <!-- Products Table -->
                <div class="table-container">
                    <table class="products-table" id="productsTable">
                        <thead>
                            <tr>
                                <th class="col-product">üì¶ S·∫£n ph·∫©m</th>
                                <th class="col-qty">üì∫ SL Live</th>
                                <th class="col-qty">üì• SL Inbox</th>
                                <th class="col-qty">üì§ G·ª≠i NCC</th>
                                <th class="col-qty">‚úÖ Nh·∫≠n IB</th>
                                <th class="col-qty">üë• Team IB</th>
                                <th class="col-actions">üîß</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be rendered here -->
                        </tbody>
                        <tfoot id="tableFoot" style="display: none;">
                            <tr class="total-row">
                                <td class="total-label">üìä T·ªïng c·ªông</td>
                                <td class="total-value" id="totalLive">0</td>
                                <td class="total-value" id="totalInbox">0</td>
                                <td class="total-value" id="totalSentNCC">0</td>
                                <td class="total-value" id="totalReceivedIB">0</td>
                                <td class="total-value" id="totalTeamIB">0</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Empty Table State -->
                    <div class="empty-table" id="emptyTable">
                        <i class="bi bi-inbox"></i>
                        <p>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</p>
                        <span>T√¨m ki·∫øm v√† th√™m s·∫£n ph·∫©m ·ªü √¥ ph√≠a tr√™n</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- History Panel -->
        <aside class="history-panel" id="historyPanel">
            <div class="history-header">
                <h3><i class="bi bi-clock-history"></i> L·ªãch s·ª≠ thay ƒë·ªïi</h3>
                <button class="btn-close-panel" onclick="toggleHistoryPanel()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="history-list" id="historyList">
                <!-- History items will be rendered here -->
                <div class="empty-history" id="emptyHistory">
                    <i class="bi bi-clock"></i>
                    <p>Ch∆∞a c√≥ l·ªãch s·ª≠</p>
                </div>
            </div>
        </aside>
    </div>

    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay" onclick="closePanels()"></div>

    <!-- Modal: Create/Edit Sheet -->
    <div class="modal fade" id="sheetModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sheetModalTitle">
                        <i class="bi bi-journal-plus"></i> T·∫°o trang m·ªõi
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="sheetNameInput">T√™n trang</label>
                        <input type="text" id="sheetNameInput" class="form-control"
                            placeholder="VD: Live 6/12, ƒê·ª£t 1..." maxlength="50">
                        <small class="text-muted">T·ªëi ƒëa 50 k√Ω t·ª±</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="sheetModalSaveBtn" onclick="saveSheet()">
                        <i class="bi bi-check-lg"></i> L∆∞u
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Confirm Delete -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle"></i> X√°c nh·∫≠n x√≥a
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a trang <strong id="deleteSheetName"></strong>?</p>
                    <p class="text-danger"><small>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteSheet()">
                        <i class="bi bi-trash"></i> X√≥a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- XLSX for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <!-- Shared modules -->
    <script src="../orders-report/js/core/config.js"></script>
    <script>
        const authManager = new AuthManager({ redirectUrl: '../index.html' });
        window.authManager = authManager;
        function getAuthState() { return authManager.getAuthData(); }
        function isAuthenticated() { return authManager.isAuthenticated(); }
    </script>
    <script src="../orders-report/js/core/api-config.js"></script>
    <!-- Main app -->
    <script src="js/app.js"></script>
</body>

</html>
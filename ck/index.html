<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <title>Th√¥ng Tin Chuy·ªÉn Kho·∫£n</title>
        <meta http-equiv="Cache-Control" content="public, max-age=31536000" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="preconnect" href="https://fonts.googleapis.com/" />
        <link
            rel="preconnect"
            href="https://fonts.gstatic.com/"
            crossorigin=""
        />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" href="../logo.jpg" />

        <!-- Only table CSS - Priority styling -->
        <style>
            /* Enhanced totalAmount styling */
            #totalAmount {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                margin: 20px 0;
                font-size: 24px;
                font-weight: 700;
                text-align: center;
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
                border: 2px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                position: relative;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                transform: translateZ(0); /* Enable hardware acceleration */
            }

            #totalAmount:hover {
                transform: translateY(-2px) scale(1.02);
                box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
                background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            }

            #totalAmount::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.3),
                    transparent
                );
                transition: left 0.5s;
            }

            #totalAmount:hover::before {
                left: 100%;
            }

            #totalAmount::after {
                position: absolute;
                top: 10px;
                right: 15px;
                font-size: 20px;
                opacity: 0.7;
                animation: float 3s ease-in-out infinite;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px);
                }
                50% {
                    transform: translateY(-5px);
                }
            }

            /* Enhanced table scrolling and animations */
            .table-container {
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                background: white;
                position: relative;
            }

            .ck {
                overflow-x: auto;
                overflow-y: auto;
                max-height: 600px;
                scroll-behavior: smooth;
                scrollbar-width: thin;
                scrollbar-color: #667eea #f1f1f1;
            }

            /* Webkit scrollbar styling */
            .ck::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }

            .ck::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 4px;
            }

            .ck::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, #667eea, #764ba2);
                border-radius: 4px;
                transition: background 0.3s ease;
            }

            .ck::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(135deg, #764ba2, #667eea);
            }

            /* Enhanced table styling with smooth interactions */
            table {
                width: 100%;
                border-collapse: collapse;
                background: white;
                position: relative;
            }

            table thead {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                position: sticky;
                top: 0;
                z-index: 10;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            table thead th {
                padding: 15px 12px;
                font-weight: 600;
                text-align: left;
                border-right: 1px solid rgba(255, 255, 255, 0.2);
                transition: background-color 0.3s ease;
            }

            table thead th:hover {
                background-color: rgba(255, 255, 255, 0.1);
            }

            /* Enhanced row animations and interactions */
            table tbody tr {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border-bottom: 1px solid #e9ecef;
                position: relative;
                transform: translateZ(0); /* Enable hardware acceleration */
            }

            table tbody tr:hover {
                background: linear-gradient(135deg, #f8f9ff, #fff);
                transform: translateX(2px);
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
                z-index: 2;
            }

            table tbody tr:nth-child(even) {
                background-color: #f8f9fa;
            }

            table tbody tr:nth-child(even):hover {
                background: linear-gradient(135deg, #f0f2ff, #f8f9fa);
            }

            table tbody td {
                padding: 12px;
                border-right: 1px solid #dee2e6;
                transition: all 0.2s ease;
                position: relative;
            }

            /* Smooth loading animation for table rows */
            @keyframes slideInRow {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            table tbody tr {
                animation: slideInRow 0.4s ease-out;
            }

            /* Staggered animation for multiple rows */
            table tbody tr:nth-child(1) {
                animation-delay: 0.05s;
            }
            table tbody tr:nth-child(2) {
                animation-delay: 0.1s;
            }
            table tbody tr:nth-child(3) {
                animation-delay: 0.15s;
            }
            table tbody tr:nth-child(4) {
                animation-delay: 0.2s;
            }
            table tbody tr:nth-child(5) {
                animation-delay: 0.25s;
            }

            /* Enhanced checkbox styling */
            input[type="checkbox"] {
                appearance: none;
                width: 20px;
                height: 20px;
                border: 2px solid #667eea;
                border-radius: 6px;
                background: white;
                cursor: pointer;
                position: relative;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            input[type="checkbox"]:checked {
                background: linear-gradient(135deg, #667eea, #764ba2);
                border-color: #667eea;
                transform: scale(1.1);
            }

            input[type="checkbox"]:checked::after {
                content: "‚úì";
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 12px;
                font-weight: bold;
            }

            input[type="checkbox"]:hover {
                border-color: #764ba2;
                box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
            }

            /* Smooth scrolling momentum for mobile */
            .ck {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
            }

            /* Loading states with smooth transitions */
            .table-loading {
                position: relative;
                opacity: 0.7;
                pointer-events: none;
            }

            .table-loading::after {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(255, 255, 255, 0.8);
                backdrop-filter: blur(2px);
                z-index: 100;
            }

            .table-loading::before {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 40px;
                height: 40px;
                margin: -20px 0 0 -20px;
                border: 4px solid #f3f3f3;
                border-top: 4px solid #667eea;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                z-index: 101;
            }

            /* Responsive design for smooth scrolling */
            @media (max-width: 768px) {
                #totalAmount {
                    font-size: 20px;
                    padding: 15px 20px;
                    margin: 15px 0;
                }

                .ck {
                    max-height: 400px;
                }

                table tbody td {
                    padding: 8px 6px;
                    font-size: 14px;
                }

                .edit-button,
                .delete-button {
                    padding: 6px 8px;
                    font-size: 11px;
                }
            }

            /* Enhanced performance for virtual scrolling */
            .virtual-row {
                contain: layout style paint;
                will-change: transform;
                transform: translateZ(0);
            }

            /* Smooth fade-in for filtered results */
            @keyframes fadeInResults {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .filter-results-enter {
                animation: fadeInResults 0.5s ease-out;
            }
        </style>

        <!-- Preload critical resources -->
        <link
            rel="preload"
            href="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"
            as="script"
        />
        <link rel="preload" href="config-constants.js" as="script" />
        <link rel="preload" href="utils-helpers.js" as="script" />

        <!-- Firebase SDKs - Load early -->
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

        <!-- External libraries -->
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    </head>

    <body>
        <!-- Performance Indicators -->
        <div class="security-indicator" id="securityIndicator">üîí Secure</div>
        <div class="performance-indicator" id="performanceIndicator">
            ‚ö° Fast Load
        </div>

        <!-- Top buttons -->
        <div class="top-buttons">
            <button data-icon="‚ûï" id="toggleFormButton">
                üìù Hi·ªán bi·ªÉu m·∫´u
            </button>
            <button data-icon="üì§" onclick="exportToExcel()">
                üìä Xu·∫•t Excel
            </button>
            <button data-icon="üö™" id="toggleLogoutButton">üö™ ƒêƒÉng xu·∫•t</button>
        </div>

        <!-- Main content -->
        <div class="main-content">
            <div class="header">
                <div id="parentContainer">
                    <p class="page-title">TH√îNG TIN CHUY·ªÇN KHO·∫¢N</p>
                </div>
            </div>

            <!-- Data Form -->
            <div id="dataForm" class="form-section" style="display: none">
                <h1>‚ûï Th√™m Th√¥ng tin</h1>
                <form id="moneyTransferForm">
                    <div class="form-group">
                        <label for="ngayck">üìÖ Ng√†y chuy·ªÉn kho·∫£n:</label>
                        <input type="date" id="ngayck" />
                    </div>

                    <div class="form-group">
                        <label for="transferNote"
                            >üìù Ghi ch√∫ chuy·ªÉn kho·∫£n:</label
                        >
                        <input
                            type="text"
                            id="transferNote"
                            list="suggestionsNote"
                            required
                            placeholder="Nh·∫≠p ghi ch√∫..."
                        />
                        <datalist id="suggestionsNote"></datalist>
                    </div>

                    <div class="form-group">
                        <label for="transferAmount">üíµ S·ªë ti·ªÅn chuy·ªÉn:</label>
                        <input
                            type="text"
                            id="transferAmount"
                            required
                            placeholder="Nh·∫≠p s·ªë ti·ªÅn..."
                        />
                    </div>

                    <div class="form-group">
                        <label for="bank">üè¶ Ng√¢n h√†ng:</label>
                        <select id="bank" required>
                            <option value="ACB">ACB</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="customerInfo">üë§ T√™n FB + SƒêT:</label>
                        <input
                            type="text"
                            id="customerInfo"
                            list="suggestionsInfo"
                            required
                            placeholder="Nh·∫≠p t√™n Facebook + s·ªë ƒëi·ªán tho·∫°i..."
                        />
                        <datalist id="suggestionsInfo"></datalist>
                    </div>

                    <div class="center-button">
                        <button type="submit" id="addButton">‚úÖ Th√™m</button>
                        <button type="button" id="clearDataButton">
                            üîÑ Reset
                        </button>
                    </div>
                </form>
            </div>

            <!-- Total Amount Display -->
            <div id="totalAmount">üí∞ T·ªïng Ti·ªÅn: 0</div>

            <!-- Filter System will be inserted here dynamically -->

            <!-- Table - Priority Element -->
            <div class="table-container">
                <div class="ck">
                    <table>
                        <thead>
                            <tr>
                                <th>üìÖ Ng√†y</th>
                                <th>üìù Ghi ch√∫ chuy·ªÉn kho·∫£n</th>
                                <th>üíµ S·ªë ti·ªÅn chuy·ªÉn</th>
                                <th>üè¶ Ng√¢n h√†ng</th>
                                <th>‚úÖ ƒêi ƒë∆°n</th>
                                <th>üë§ T√™n FB + SƒêT</th>
                                <th>‚úèÔ∏è S·ª≠a th√¥ng tin</th>
                                <th>üóëÔ∏è X√≥a</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Dynamic content will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Modal for editing -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <span
                    class="close"
                    onclick="closeModal()"
                    style="
                        position: sticky;
                        top: 0;
                        right: 0;
                        float: right;
                        font-size: 28px;
                        cursor: pointer;
                        background: white;
                        z-index: 10;
                        padding: 10px;
                        border-radius: 50%;
                        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                    "
                >
                    ‚ùå
                </span>
                <h2 style="margin-bottom: 20px; color: #667eea">
                    ‚úèÔ∏è Ch·ªânh s·ª≠a th√¥ng tin
                </h2>

                <div class="form-group">
                    <label for="editDate">üìÖ Ng√†y:</label>
                    <input type="text" id="editDate" />
                </div>
                <div class="form-group">
                    <label for="editNote">üìù Ghi ch√∫:</label>
                    <input type="text" id="editNote" />
                </div>
                <div class="form-group">
                    <label for="editAmount">üíµ S·ªë ti·ªÅn:</label>
                    <input type="text" id="editAmount" />
                </div>
                <div class="form-group">
                    <label for="editBank">üè¶ Ng√¢n h√†ng:</label>
                    <input type="text" id="editBank" />
                </div>
                <div class="form-group">
                    <label for="editInfo">üë§ FB+SƒêT:</label>
                    <input type="text" id="editInfo" />
                </div>
                <div class="center-button">
                    <button onclick="saveChanges()">üíæ L∆∞u</button>
                </div>
            </div>
        </div>

        <!-- Enhanced Floating Alert -->
        <div
            id="floatingAlert"
            style="
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                display: none;
                text-align: center;
                min-width: 300px;
                max-width: 500px;
            "
        >
            <div class="alert-content">
                <div
                    class="loading-spinner"
                    style="display: none; margin: 0 auto 15px"
                >
                    <div
                        style="
                            width: 40px;
                            height: 40px;
                            border: 4px solid #f3f3f3;
                            border-top: 4px solid #667eea;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                            margin: 0 auto;
                        "
                    ></div>
                </div>
                <div
                    class="alert-text"
                    style="font-size: 16px; font-weight: 600; color: #333"
                >
                    Th√¥ng b√°o hi·ªÉn th·ªã!
                </div>
            </div>
        </div>

        <!-- Add spinner animation -->
        <style>
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>

        <!-- Tooltip -->
        <div
            id="tooltip"
            class="tooltip"
            style="
                position: absolute;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                z-index: 1500;
                display: none;
                pointer-events: none;
            "
        ></div>

        <!-- Load optimization scripts in order -->
        <script>
            // Performance timing
            window.loadStartTime = performance.now();

            // Show loading indicator
            document.addEventListener("DOMContentLoaded", function () {
                const indicator = document.getElementById(
                    "performanceIndicator",
                );
                if (indicator) {
                    indicator.textContent = "‚è≥ Loading...";
                }
            });
        </script>

        <!-- Load core modules -->
        <script src="config-constants.js"></script>
        <script src="utils-helpers.js"></script>
        <script src="virtual-scrolling.js"></script>
        <script src="filter-system.js"></script>

        <!-- CSS script -->
        <script src="../js/device-detector.js"></script>

        <!-- Navigation Manager - Load tr∆∞·ªõc khi load page scripts -->
        <script src="../js/navigation.js"></script>
        <script src="../js/common-utils.js"></script>

        <!-- Main application -->
        <script src="main-optimized.js"></script>

        <!-- Performance completion tracking -->
        <script>
            window.addEventListener("load", function () {
                const loadTime = performance.now() - window.loadStartTime;
                console.log(`Total page load time: ${loadTime.toFixed(0)}ms`);

                // Update performance indicator
                setTimeout(() => {
                    const indicator = document.getElementById(
                        "performanceIndicator",
                    );
                    if (indicator) {
                        indicator.textContent = `‚ö° ${loadTime.toFixed(0)}ms`;
                    }
                }, 1000);

                // Show security status
                const securityIndicator =
                    document.getElementById("securityIndicator");
                if (securityIndicator && location.protocol === "https:") {
                    securityIndicator.textContent = "üîí Secure HTTPS";
                }
            });

            // Legacy support functions for floating alerts
            function showFloatingAlert(
                message,
                showLoading = false,
                duration = null,
            ) {
                const alert = document.getElementById("floatingAlert");
                const spinner = alert.querySelector(".loading-spinner");
                const text = alert.querySelector(".alert-text");

                if (showLoading) {
                    spinner.style.display = "block";
                } else {
                    spinner.style.display = "none";
                }

                text.textContent = message;
                alert.style.display = "block";

                if (duration && !showLoading) {
                    setTimeout(() => {
                        hideFloatingAlert();
                    }, duration);
                }
            }

            function hideFloatingAlert() {
                const alert = document.getElementById("floatingAlert");
                alert.style.display = "none";
            }

            function showLoading(message = "ƒêang x·ª≠ l√Ω...") {
                showFloatingAlert(message, true);
            }

            function showSuccess(message = "Th√†nh c√¥ng!", duration = 2000) {
                hideFloatingAlert();
                setTimeout(() => {
                    showFloatingAlert(message, false, duration);
                }, 100);
            }

            function showError(message = "C√≥ l·ªói x·∫£y ra!", duration = 3000) {
                hideFloatingAlert();
                setTimeout(() => {
                    showFloatingAlert(message, false, duration);
                }, 100);
            }

            function showOperationLoading(message, operationType) {
                showFloatingAlert(message, true);
            }

            function hideOperationLoading(successMessage = null) {
                hideFloatingAlert();
                if (successMessage) {
                    setTimeout(() => {
                        showSuccess(successMessage);
                    }, 100);
                }
            }

            // Make functions globally available
            window.showFloatingAlert = showFloatingAlert;
            window.hideFloatingAlert = hideFloatingAlert;
            window.showLoading = showLoading;
            window.showSuccess = showSuccess;
            window.showError = showError;
            window.showOperationLoading = showOperationLoading;
            window.hideOperationLoading = hideOperationLoading;
        </script>

        <!-- Initialize Lucide Icons -->
        <script>
            lucide.createIcons();
        </script>
    </body>
</html>

<!--
  üìñ GHI CH√ö CHO L·∫¨P TR√åNH VI√äN:
  Khi code ph·∫£i ƒë·ªçc th∆∞ m·ª•c https://github.com/nhijudyshop/n2store/tree/main/docs tr∆∞·ªõc!
  ƒê·ªçc c√°c file SHARED_*.md ƒë·ªÉ hi·ªÉu c√°ch s·ª≠ d·ª•ng shared modules.
-->
<!doctype html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <title>Th√¥ng Tin Chuy·ªÉn Kho·∫£n - N2Shop</title>
    <meta http-equiv="Cache-Control" content="public, max-age=31536000" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="../index/logo.jpg" />

    <!-- Modern CSS -->
    <link rel="stylesheet" href="modern.css" />
    <link rel="stylesheet" href="transfer-modern.css" />

    <!-- Lucide Icons -->
    <!-- N2Store Optimization: Core Utilities Loader -->
    <script src="../shared/js/core-loader.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <!-- External libraries -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
</head>

<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i data-lucide="zap"></i>
                <span>N2Shop</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i data-lucide="panel-left-close"></i>
            </button>
        </div>

        <nav class="sidebar-nav" id="sidebarNav">
            <!-- Menu items will be auto-generated by navigation-modern.js -->
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i data-lucide="user-circle"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Admin</div>
                    <div class="user-role">Qu·∫£n tr·ªã vi√™n</div>
                </div>
            </div>
            <button class="btn-permissions" id="btnPermissions">
                <i data-lucide="shield-check"></i>
                <span>Xem Quy·ªÅn C·ªßa T√¥i</span>
            </button>
            <button class="btn-logout" id="btnLogout">
                <i data-lucide="log-out"></i>
                <span>ƒêƒÉng xu·∫•t</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Fixed Toggle Button (shows when sidebar is hidden) -->
        <button class="sidebar-toggle-fixed" onclick="window.navigationManager?.showSidebar()">
            <i data-lucide="panel-left-open"></i>
        </button>

        <!-- Top Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <button class="btn-icon" id="menuToggle">
                    <i data-lucide="menu"></i>
                </button>
                <div class="breadcrumb">
                    <i data-lucide="home"></i>
                    <span>Qu·∫£n l√Ω Chuy·ªÉn Kho·∫£n</span>
                </div>
            </div>
            <div class="top-bar-right">
                <button class="btn btn-primary" id="toggleFormButton">
                    <i data-lucide="plus"></i>
                    <span>Th√™m Giao D·ªãch</span>
                </button>
                <button class="btn-icon" onclick="exportToExcel()" title="Xu·∫•t Excel">
                    <i data-lucide="download"></i>
                </button>
                <button class="btn-icon" id="btnRefresh" title="L√†m m·ªõi d·ªØ li·ªáu">
                    <i data-lucide="refresh-cw"></i>
                </button>
            </div>
        </header>

        <!-- Stats Cards -->
        <section class="stats-section">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <i data-lucide="credit-card"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="statTotalTransactions">
                        0
                    </div>
                    <div class="stat-label">T·ªïng Giao D·ªãch</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">
                    <i data-lucide="dollar-sign"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="totalAmount">0</div>
                    <div class="stat-label">T·ªïng Ti·ªÅn</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange">
                    <i data-lucide="check-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="statCompleted">0</div>
                    <div class="stat-label">ƒê√£ ƒêi ƒê∆°n</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">
                    <i data-lucide="clock"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="statPending">0</div>
                    <div class="stat-label">Ch∆∞a ƒêi ƒê∆°n</div>
                </div>
            </div>
        </section>

        <!-- Add Transaction Form -->
        <section class="card" id="dataForm" style="display: none">
            <div class="card-header">
                <div class="card-title">
                    <i data-lucide="file-plus"></i>
                    <h2>Th√™m Giao D·ªãch M·ªõi</h2>
                </div>
                <button class="btn-icon" id="closeFormBtn">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="card-body">
                <form id="moneyTransferForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <i data-lucide="calendar"></i>
                                Ng√†y chuy·ªÉn kho·∫£n
                            </label>
                            <input type="date" id="ngayck" required />
                        </div>
                        <div class="form-group">
                            <label>
                                <i data-lucide="building-2"></i>
                                Ng√¢n h√†ng
                            </label>
                            <select id="bank" required>
                                <option value="ACB">ACB</option>
                                <option value="VCB">VCB</option>
                                <option value="TCB">TCB</option>
                                <option value="MB">MB</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="file-text"></i>
                            Ghi ch√∫ chuy·ªÉn kho·∫£n
                        </label>
                        <input type="text" id="transferNote" list="suggestionsNote" required
                            placeholder="Nh·∫≠p ghi ch√∫..." />
                        <datalist id="suggestionsNote"></datalist>
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="dollar-sign"></i>
                            S·ªë ti·ªÅn chuy·ªÉn (ngh√¨n ƒë·ªìng)
                        </label>
                        <input type="text" id="transferAmount" required placeholder="Nh·∫≠p s·ªë ti·ªÅn..." />
                    </div>

                    <div class="form-group">
                        <label>
                            <i data-lucide="user"></i>
                            T√™n FB + SƒêT
                        </label>
                        <input type="text" id="customerInfo" list="suggestionsInfo" required
                            placeholder="Nh·∫≠p t√™n Facebook + s·ªë ƒëi·ªán tho·∫°i..." />
                        <datalist id="suggestionsInfo"></datalist>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="clearDataButton">
                            <i data-lucide="rotate-ccw"></i>
                            L√†m M·ªõi
                        </button>
                        <button type="submit" class="btn btn-primary" id="addButton">
                            <i data-lucide="check"></i>
                            Th√™m Giao D·ªãch
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Filter System will be inserted here by filter-system.js -->

        <!-- Transactions Table -->
        <section class="card">
            <div class="card-header">
                <div class="card-title">
                    <i data-lucide="list"></i>
                    <h2>Danh S√°ch Giao D·ªãch</h2>
                </div>
                <div class="card-actions">
                    <div class="search-container">
                        <i data-lucide="search"
                            style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; color: #6c757d;"></i>
                        <input type="text" id="contentSearchInput" placeholder="T√¨m ki·∫øm...">
                    </div>
                    <button class="btn-icon" onclick="exportToExcel()" title="Xu·∫•t Excel">
                        <i data-lucide="download"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th><i data-lucide="calendar"></i> Ng√†y</th>
                                <th>
                                    <i data-lucide="file-text"></i> Ghi ch√∫
                                </th>
                                <th>
                                    <i data-lucide="dollar-sign"></i> S·ªë
                                    ti·ªÅn
                                </th>
                                <th>
                                    <i data-lucide="building-2"></i> Ng√¢n
                                    h√†ng
                                </th>
                                <th>
                                    <i data-lucide="check-square"></i> ƒêi
                                    ƒë∆°n
                                </th>
                                <th><i data-lucide="user"></i> FB + SƒêT</th>
                                <th><i data-lucide="edit"></i> S·ª≠a</th>
                                <th><i data-lucide="trash-2"></i> X√≥a</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <i data-lucide="edit"></i>
                    Ch·ªânh s·ª≠a th√¥ng tin
                </h2>
                <button class="btn-icon" onclick="closeModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label><i data-lucide="calendar"></i> Ng√†y:</label>
                    <input type="text" id="editDate" />
                </div>
                <div class="form-group">
                    <label><i data-lucide="file-text"></i> Ghi ch√∫:</label>
                    <input type="text" id="editNote" />
                </div>
                <div class="form-group">
                    <label><i data-lucide="dollar-sign"></i> S·ªë ti·ªÅn:</label>
                    <input type="text" id="editAmount" />
                </div>
                <div class="form-group">
                    <label><i data-lucide="building-2"></i> Ng√¢n h√†ng:</label>
                    <input type="text" id="editBank" />
                </div>
                <div class="form-group">
                    <label><i data-lucide="user"></i> FB+SƒêT:</label>
                    <input type="text" id="editInfo" />
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeModal()">
                        <i data-lucide="x"></i>
                        H·ªßy
                    </button>
                    <button class="btn btn-primary" onclick="saveChanges()">
                        <i data-lucide="save"></i>
                        L∆∞u Thay ƒê·ªïi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="config-constants.js"></script>
    <script src="auth.js"></script>
    <script src="utils-helpers.js"></script>
    <script src="virtual-scrolling.js"></script>
    <script src="date-slider.js"></script>
    <script src="filter-system.js"></script>
    <script src="search-system.js"></script>
    <script src="../shared/js/common-utils.js"></script>
    <script src="../shared/js/navigation-modern.js"></script>
    <script src="notification-system.js"></script>
    <script src="main-optimized.js"></script>

    <!-- Initialize Lucide Icons -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Initialize Lucide icons
            if (typeof lucide !== "undefined") {
                lucide.createIcons();
            }

            // Close form button
            const closeFormBtn = document.getElementById("closeFormBtn");
            const dataForm = document.getElementById("dataForm");
            const toggleFormButton =
                document.getElementById("toggleFormButton");

            if (closeFormBtn && dataForm) {
                closeFormBtn.addEventListener("click", () => {
                    dataForm.style.display = "none";
                    if (toggleFormButton) {
                        toggleFormButton.querySelector("span").textContent =
                            "Th√™m Giao D·ªãch";
                    }
                });
            }

            // Update stats when data changes
            document.addEventListener("filterChanged", (e) => {
                updateStatCards(e.detail);
            });

            // Refresh button
            const btnRefresh = document.getElementById("btnRefresh");
            if (btnRefresh) {
                btnRefresh.addEventListener("click", () => {
                    location.reload();
                });
            }
        });

        // Update stat cards
        function updateStatCards(data) {
            const total = data?.totalCount || APP_STATE.arrayData.length;
            const filtered =
                data?.filteredCount || APP_STATE.filteredData.length;

            const completed = APP_STATE.arrayData.filter(
                (item) => item.completed,
            ).length;
            const pending = total - completed;

            document.getElementById("statTotalTransactions").textContent =
                total.toLocaleString();
            document.getElementById("statCompleted").textContent =
                completed.toLocaleString();
            document.getElementById("statPending").textContent =
                pending.toLocaleString();
        }

        // Global functions
        window.exportToExcel = function () {
            if (window.moneyTransferApp) {
                window.moneyTransferApp.exportToExcel();
            }
        };

        window.closeModal = function () {
            if (window.moneyTransferApp) {
                window.moneyTransferApp.closeModal();
            }
        };

        window.saveChanges = function () {
            if (window.moneyTransferApp) {
                window.moneyTransferApp.saveChanges();
            }
        };
    </script>
</body>

</html>
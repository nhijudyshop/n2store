<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Qu·∫£n L√Ω T√†i Kho·∫£n - N2 Shop</title>
        <!-- Firebase Scripts -->
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
        <!-- Crypto Libraries -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/3.0.1/bcrypt.min.js"></script>

        <!-- User-Management CSS -->
        <link rel="stylesheet" href="user-management.css" />
        <!-- CSS script -->
        <script src="../js/device-detector.js"></script>

        <!-- Navigation -->
        <script src="../js/navigation.js"></script>
        <script src="../js/common-utils.js"></script>
    </head>

    <body>
        <!-- Th√¥ng b√°o truy c·∫≠p b·ªã t·ª´ ch·ªëi -->
        <div id="accessDenied" class="access-denied" style="display: none">
            <h1>üö´ Truy c·∫≠p b·ªã t·ª´ ch·ªëi</h1>
            <p>
                B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p v√†o trang n√†y.<br />Ch·ªâ c√≥ Admin m·ªõi
                c√≥ th·ªÉ qu·∫£n l√Ω t√†i kho·∫£n.
            </p>
            <a href="../live/index.html" class="back-btn"
                >‚Üê Quay v·ªÅ trang ch√≠nh</a
            >
        </div>

        <!-- N·ªôi dung ch√≠nh - Ch·ªâ hi·ªán v·ªõi Admin -->
        <div id="mainContainer" class="container">
            <div class="header">
                <h1>üîê Qu·∫£n L√Ω T√†i Kho·∫£n N2 Shop</h1>
                <div class="admin-badge">üëë ADMIN PANEL</div>
                <div style="margin-top: 10px; color: #666; font-size: 14px">
                    ƒêƒÉng nh·∫≠p: <span id="currentUser">Loading...</span>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('manage')">
                    üë• Qu·∫£n L√Ω Users
                </button>
                <button class="tab" onclick="showTab('create')">
                    ‚ûï T·∫°o M·ªõi
                </button>
                <button class="tab" onclick="showTab('permissions')">
                    üîë Quy·ªÅn Truy C·∫≠p
                </button>
                <button class="tab" onclick="showTab('tools')">üîß Tools</button>
            </div>

            <!-- Tab 1: Qu·∫£n L√Ω Users -->
            <div id="manage" class="tab-content active">
                <div class="section">
                    <h2>K·∫øt N·ªëi Firebase</h2>
                    <div id="firebaseStatus" class="output">
                        ƒêang k·∫øt n·ªëi Firebase...
                    </div>
                    <button onclick="connectFirebase()" style="display: none">
                        K·∫øt N·ªëi L·∫°i
                    </button>
                </div>

                <div class="section">
                    <h2>üìã Danh S√°ch T√†i Kho·∫£n</h2>
                    <button onclick="loadUsers()">üîÑ T·∫£i Danh S√°ch</button>
                    <button onclick="exportUsers()" class="success">
                        üì§ Xu·∫•t Excel
                    </button>
                    <div id="userList" class="user-list">
                        <div style="padding: 20px; text-align: center">
                            Nh·∫•n "T·∫£i Danh S√°ch" ƒë·ªÉ xem users
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>‚úèÔ∏è Ch·ªânh S·ª≠a T√†i Kho·∫£n</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editUsername">Username:</label>
                            <input
                                type="text"
                                id="editUsername"
                                placeholder="Ch·ªçn user t·ª´ danh s√°ch"
                                readonly
                            />
                        </div>
                        <div class="form-group">
                            <label for="editDisplayName">T√™n hi·ªÉn th·ªã:</label>
                            <input
                                type="text"
                                id="editDisplayName"
                                placeholder="T√™n hi·ªÉn th·ªã m·ªõi"
                            />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCheckLogin">Quy·ªÅn h·∫°n:</label>
                            <select id="editCheckLogin">
                                <option value="0">üëë Admin (0)</option>
                                <option value="1">üë§ User (1)</option>
                                <option value="2">üîí Limited (2)</option>
                                <option value="3">üí° Basic (3)</option>
                                <option value="777">üë• Guest (777)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editNewPassword"
                                >Password m·ªõi (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi):</label
                            >
                            <input
                                type="password"
                                id="editNewPassword"
                                placeholder="Password m·ªõi"
                            />
                        </div>
                    </div>

                    <!-- Ph·∫ßn quy·ªÅn truy c·∫≠p trang -->
                    <div class="permissions-section">
                        <h3>üîë Quy·ªÅn Truy C·∫≠p C√°c Trang</h3>
                        <p
                            style="
                                color: #6c757d;
                                font-size: 13px;
                                margin-bottom: 15px;
                            "
                        >
                            Ch·ªçn c√°c trang m√† user n√†y c√≥ th·ªÉ truy c·∫≠p. Admin
                            lu√¥n c√≥ to√†n quy·ªÅn.
                        </p>

                        <div class="role-template">
                            <h4>üìã Template theo vai tr√≤:</h4>
                            <div class="template-buttons">
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('admin')"
                                >
                                    üëë Admin - To√†n quy·ªÅn
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('manager')"
                                >
                                    üë®‚Äçüíº Manager - Qu·∫£n l√Ω c∆° b·∫£n
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('staff')"
                                >
                                    üë§ Staff - Nh√¢n vi√™n
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('viewer')"
                                >
                                    üëÅÔ∏è Viewer - Ch·ªâ xem
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('clear')"
                                >
                                    üö´ X√≥a t·∫•t c·∫£
                                </button>
                            </div>
                        </div>

                        <div
                            class="permissions-summary"
                            id="permissionsSummary"
                        >
                            <span class="permissions-count"
                                >0/11 trang ƒë∆∞·ª£c ch·ªçn</span
                            >
                        </div>

                        <div class="permissions-grid" id="editPermissionsGrid">
                            <!-- Permissions s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                        </div>
                    </div>

                    <button class="success" onclick="updateUser()">
                        üíæ C·∫≠p Nh·∫≠t
                    </button>
                    <button onclick="clearEditForm()">üóëÔ∏è X√≥a Form</button>
                    <div
                        id="editOutput"
                        class="output"
                        style="display: none"
                    ></div>
                </div>
            </div>

            <!-- Tab 2: T·∫°o User M·ªõi -->
            <div id="create" class="tab-content">
                <div class="section">
                    <h2>‚ûï T·∫°o T√†i Kho·∫£n M·ªõi</h2>
                    <div class="info">
                        <strong>‚ÑπÔ∏è L∆∞u √Ω:</strong> Password s·∫Ω ƒë∆∞·ª£c hash t·ª± ƒë·ªông
                        b·∫±ng Crypto-JS ƒë·ªÉ ƒë·∫£m b·∫£o b·∫£o m·∫≠t.
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUsername">Username:</label>
                            <input
                                type="text"
                                id="newUsername"
                                placeholder="Username (kh√¥ng d·∫•u, kh√¥ng kho·∫£ng tr·∫Øng)"
                            />
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Password:</label>
                            <input
                                type="password"
                                id="newPassword"
                                placeholder="Password m·∫°nh"
                            />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newDisplayName">T√™n hi·ªÉn th·ªã:</label>
                            <input
                                type="text"
                                id="newDisplayName"
                                placeholder="T√™n hi·ªÉn th·ªã (t·ª± ƒë·ªông ƒëi·ªÅn)"
                            />
                        </div>
                        <div class="form-group">
                            <label for="newCheckLogin">Quy·ªÅn h·∫°n:</label>
                            <select id="newCheckLogin">
                                <option value="0">üëë Admin (0)</option>
                                <option value="1" selected>üë§ User (1)</option>
                                <option value="2">üîí Limited (2)</option>
                                <option value="3">üí° Basic (3)</option>
                                <option value="777">üë• Guest (777)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Ph·∫ßn quy·ªÅn truy c·∫≠p trang cho user m·ªõi -->
                    <div class="permissions-section">
                        <h3>üîë Quy·ªÅn Truy C·∫≠p C√°c Trang</h3>
                        <p
                            style="
                                color: #6c757d;
                                font-size: 13px;
                                margin-bottom: 15px;
                            "
                        >
                            Ch·ªçn c√°c trang m√† user m·ªõi n√†y c√≥ th·ªÉ truy c·∫≠p.
                        </p>

                        <div class="role-template">
                            <h4>üìã Template theo vai tr√≤:</h4>
                            <div class="template-buttons">
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('admin', 'new')"
                                >
                                    üëë Admin - To√†n quy·ªÅn
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('manager', 'new')"
                                >
                                    üë®‚Äçüíº Manager - Qu·∫£n l√Ω c∆° b·∫£n
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('staff', 'new')"
                                >
                                    üë§ Staff - Nh√¢n vi√™n
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('viewer', 'new')"
                                >
                                    üëÅÔ∏è Viewer - Ch·ªâ xem
                                </button>
                                <button
                                    class="template-btn"
                                    onclick="applyPermissionTemplate('clear', 'new')"
                                >
                                    üö´ X√≥a t·∫•t c·∫£
                                </button>
                            </div>
                        </div>

                        <div
                            class="permissions-summary"
                            id="newPermissionsSummary"
                        >
                            <span class="permissions-count"
                                >0/11 trang ƒë∆∞·ª£c ch·ªçn</span
                            >
                        </div>

                        <div class="permissions-grid" id="newPermissionsGrid">
                            <!-- Permissions s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                        </div>
                    </div>

                    <button class="success" onclick="createUser()">
                        ‚úÖ T·∫°o T√†i Kho·∫£n
                    </button>
                    <button onclick="clearCreateForm()">üóëÔ∏è X√≥a Form</button>
                    <div
                        id="createOutput"
                        class="output"
                        style="display: none"
                    ></div>
                </div>
            </div>

            <!-- Tab 3: Permissions Management -->
            <div id="permissions" class="tab-content">
                <div class="section">
                    <h2>üîë Qu·∫£n L√Ω Quy·ªÅn Truy C·∫≠p</h2>
                    <div class="info">
                        <strong>‚ÑπÔ∏è Th√¥ng tin:</strong> Trang n√†y cho ph√©p xem v√†
                        qu·∫£n l√Ω quy·ªÅn truy c·∫≠p c·ªßa t·∫•t c·∫£ users.
                    </div>

                    <button onclick="loadPermissionsOverview()">
                        üîÑ T·∫£i Th·ªëng K√™ Quy·ªÅn
                    </button>
                    <button onclick="exportPermissions()" class="success">
                        üì§ Xu·∫•t B√°o C√°o
                    </button>

                    <div id="permissionsOverview" class="permissions-overview">
                        <div
                            style="
                                padding: 20px;
                                text-align: center;
                                color: #6c757d;
                            "
                        >
                            Nh·∫•n "T·∫£i Th·ªëng K√™ Quy·ªÅn" ƒë·ªÉ xem b√°o c√°o
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Tools -->
            <div id="tools" class="tab-content">
                <div class="section">
                    <h2>üîê T·∫°o Hash Password</h2>
                    <div class="method-selector">
                        <label
                            ><input
                                type="radio"
                                name="method"
                                value="cryptojs"
                                checked
                            />
                            Crypto-JS (Nhanh)</label
                        >
                        <label
                            ><input type="radio" name="method" value="bcrypt" />
                            bcrypt (An to√†n h∆°n)</label
                        >
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="username">Username:</label>
                            <input
                                type="text"
                                id="username"
                                placeholder="Nh·∫≠p username"
                            />
                        </div>
                        <div class="form-group">
                            <label for="password">Password:</label>
                            <input
                                type="password"
                                id="password"
                                placeholder="Nh·∫≠p password"
                            />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="displayName">T√™n hi·ªÉn th·ªã:</label>
                            <input
                                type="text"
                                id="displayName"
                                placeholder="T√™n hi·ªÉn th·ªã"
                            />
                        </div>
                        <div class="form-group">
                            <label for="checkLogin">Quy·ªÅn h·∫°n:</label>
                            <select id="checkLogin">
                                <option value="0">üëë Admin (0)</option>
                                <option value="1" selected>üë§ User (1)</option>
                                <option value="2">üîí Limited (2)</option>
                                <option value="3">üí° Basic (3)</option>
                                <option value="777">üë• Guest (777)</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="generateHash()">üîê T·∫°o Hash</button>
                    <button onclick="clearHashForm()">üóëÔ∏è X√≥a Form</button>
                    <div
                        id="hashOutput"
                        class="output"
                        style="display: none"
                    ></div>
                </div>

                <div class="section">
                    <h2>üîç Ki·ªÉm Tra Password</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="testPassword">Test Password:</label>
                            <input
                                type="password"
                                id="testPassword"
                                placeholder="Nh·∫≠p password ƒë·ªÉ test"
                            />
                        </div>
                        <div class="form-group">
                            <label for="testSalt">Salt (Crypto-JS):</label>
                            <input
                                type="text"
                                id="testSalt"
                                placeholder="Salt t·ª´ hash output"
                            />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="testHash">Hash ƒë·ªÉ so s√°nh:</label>
                        <textarea
                            id="testHash"
                            rows="3"
                            placeholder="Paste hash ƒë·ªÉ ki·ªÉm tra"
                        ></textarea>
                    </div>
                    <button onclick="verifyPassword()">‚úÖ Ki·ªÉm Tra</button>
                    <div
                        id="verifyOutput"
                        class="output"
                        style="display: none"
                    ></div>
                </div>
            </div>
        </div>

        <!-- Enhanced Floating Alert -->
        <div id="floatingAlert">
            <div class="alert-content">
                <div class="loading-spinner" style="display: none">
                    <div class="spinner"></div>
                </div>
                <div class="alert-text">Th√¥ng b√°o hi·ªÉn th·ªã!</div>
            </div>
        </div>

        <!-- Tooltip -->
        <div id="tooltip" class="tooltip"></div>

        <script src="user-permission-page.js"></script>
    </body>
</html>

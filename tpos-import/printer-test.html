<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>XC80 Printer Simulator & Bridge Config</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: #f0f2f5;
                color: #333;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
            }

            .header {
                text-align: center;
                margin-bottom: 30px;
                padding: 20px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .main-grid {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }

            .panel {
                background: white;
                border-radius: 10px;
                padding: 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .panel h3 {
                margin-bottom: 15px;
                color: #2c3e50;
                border-bottom: 2px solid #3498db;
                padding-bottom: 10px;
            }

            /* Print Bridge Configuration */
            .bridge-config {
                background: #e8f5e8;
                border-left: 4px solid #27ae60;
            }

            .config-item {
                margin-bottom: 15px;
            }

            .config-item label {
                display: block;
                margin-bottom: 5px;
                font-weight: 600;
            }

            .config-item input,
            .config-item select {
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 14px;
            }

            .status-indicator {
                display: inline-block;
                width: 12px;
                height: 12px;
                border-radius: 50%;
                margin-right: 8px;
            }

            .status-offline {
                background: #e74c3c;
            }
            .status-online {
                background: #27ae60;
            }
            .status-connecting {
                background: #f39c12;
                animation: pulse 1s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            /* Receipt Editor */
            .receipt-editor {
                background: #fff8e1;
                border-left: 4px solid #ff9800;
            }

            .editor-textarea {
                width: 100%;
                height: 200px;
                border: 1px solid #ddd;
                border-radius: 5px;
                padding: 10px;
                font-family: "Courier New", monospace;
                font-size: 12px;
                line-height: 1.4;
                resize: vertical;
            }

            .quick-templates {
                margin-top: 10px;
            }

            .template-btn {
                background: #ff9800;
                color: white;
                border: none;
                padding: 5px 10px;
                border-radius: 3px;
                margin: 2px;
                cursor: pointer;
                font-size: 12px;
            }

            .template-btn:hover {
                background: #e68900;
            }

            /* XC80 Simulator */
            .printer-simulator {
                background: #f0f7ff;
                border-left: 4px solid #3498db;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .printer-frame {
                width: 120mm;
                background: #2c3e50;
                border-radius: 15px;
                padding: 15px;
                margin: 10px 0;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

            .printer-display {
                background: #34495e;
                color: #2ecc71;
                padding: 8px;
                border-radius: 5px;
                font-family: "Courier New", monospace;
                font-size: 12px;
                margin-bottom: 10px;
                text-align: center;
            }

            .paper-slot {
                width: 85mm;
                height: 10mm;
                background: #34495e;
                border-radius: 5px;
                margin: 0 auto 10px;
                position: relative;
                overflow: hidden;
            }

            .paper-indicator {
                height: 100%;
                background: linear-gradient(90deg, #95a5a6, white);
                width: 80%;
                border-radius: 3px;
                transition: all 0.3s;
            }

            .receipt-paper {
                width: 80mm;
                background: white;
                border: 1px solid #bdc3c7;
                border-radius: 5px 5px 0 0;
                padding: 5mm;
                margin: 0 auto;
                font-family: "Courier New", monospace;
                font-size: 10px;
                line-height: 1.2;
                min-height: 50mm;
                max-height: 200mm;
                overflow: auto;
                position: relative;
                box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            }

            .receipt-paper::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2mm,
                    #ddd 2mm,
                    #ddd 2.5mm
                );
            }

            /* Print Progress Animation */
            .printing-line {
                position: absolute;
                left: 0;
                right: 0;
                height: 2px;
                background: #3498db;
                opacity: 0;
                animation: printProgress 2s ease-in-out;
            }

            @keyframes printProgress {
                0% {
                    top: 0;
                    opacity: 1;
                }
                100% {
                    top: 100%;
                    opacity: 0;
                }
            }

            /* Control Buttons */
            .control-panel {
                grid-column: 1 / -1;
                text-align: center;
                padding: 20px;
            }

            .btn {
                background: #3498db;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                margin: 0 10px;
                transition: all 0.3s;
            }

            .btn:hover {
                background: #2980b9;
                transform: translateY(-2px);
            }

            .btn-success {
                background: #27ae60;
            }
            .btn-success:hover {
                background: #229954;
            }

            .btn-warning {
                background: #f39c12;
            }
            .btn-warning:hover {
                background: #e67e22;
            }

            .btn-danger {
                background: #e74c3c;
            }
            .btn-danger:hover {
                background: #c0392b;
            }

            /* Logs Panel */
            .logs-panel {
                grid-column: 1 / -1;
                background: #2c3e50;
                color: #ecf0f1;
                border-radius: 10px;
                padding: 20px;
                max-height: 200px;
                overflow-y: auto;
            }

            .log-entry {
                margin-bottom: 5px;
                font-family: "Courier New", monospace;
                font-size: 12px;
            }

            .log-time {
                color: #95a5a6;
            }

            .log-info {
                color: #3498db;
            }
            .log-success {
                color: #27ae60;
            }
            .log-warning {
                color: #f39c12;
            }
            .log-error {
                color: #e74c3c;
            }

            /* Responsive */
            @media (max-width: 1200px) {
                .main-grid {
                    grid-template-columns: 1fr 1fr;
                }
                .printer-simulator {
                    grid-column: 1 / -1;
                }
            }

            @media (max-width: 768px) {
                .main-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>
                    üñ®Ô∏è XC80 Thermal Printer Simulator & Bridge Configuration
                </h1>
                <p>
                    M√¥ ph·ªèng m√°y in nhi·ªát XC80 v√† c·∫•u h√¨nh Print Bridge cho
                    development
                </p>
            </div>

            <div class="main-grid">
                <!-- Print Bridge Configuration -->
                <div class="panel bridge-config">
                    <h3>üîß Print Bridge Configuration</h3>

                    <div class="config-item">
                        <label>Bridge Status:</label>
                        <div>
                            <span
                                class="status-indicator status-offline"
                                id="bridgeStatus"
                            ></span>
                            <span id="bridgeStatusText">Offline</span>
                        </div>
                    </div>

                    <div class="config-item">
                        <label for="bridgeUrl">Bridge URL:</label>
                        <input
                            type="text"
                            id="bridgeUrl"
                            value="http://localhost:9100"
                        />
                    </div>

                    <div class="config-item">
                        <label for="printerName">Printer Name:</label>
                        <select id="printerName">
                            <option value="">-- Ch·ªçn m√°y in --</option>
                            <option value="XC-80">XC-80 Thermal Printer</option>
                            <option value="Generic">
                                Generic Text Printer
                            </option>
                            <option value="POS-80">POS-80</option>
                        </select>
                    </div>

                    <div class="config-item">
                        <label for="encoding">Text Encoding:</label>
                        <select id="encoding">
                            <option value="utf8">UTF-8</option>
                            <option value="cp1252">Windows-1252</option>
                            <option value="ascii">ASCII</option>
                        </select>
                    </div>

                    <div class="config-item">
                        <label for="paperWidth">Paper Width (mm):</label>
                        <input
                            type="number"
                            id="paperWidth"
                            value="80"
                            min="58"
                            max="80"
                        />
                    </div>

                    <button class="btn btn-success" onclick="connectBridge()">
                        Connect Bridge
                    </button>
                    <button class="btn btn-warning" onclick="testConnection()">
                        Test Connection
                    </button>
                </div>

                <!-- Receipt Editor -->
                <div class="panel receipt-editor">
                    <h3>üìù Receipt Content Editor</h3>

                    <textarea
                        class="editor-textarea"
                        id="receiptContent"
                        placeholder="Nh·∫≠p n·ªôi dung h√≥a ƒë∆°n..."
                    >
        C·ª¨A H√ÄNG ABC
    123 ƒê∆∞·ªùng Nguy·ªÖn Hu·ªá, Q.1
    ƒêT: 0123.456.789
================================
Ng√†y: 12/10/2025    15:30
H√≥a ƒë∆°n: HD001
Kh√°ch h√†ng: Nguy·ªÖn VƒÉn A
================================
Caf√© ƒêen ƒê√°           25,000ƒë
B√°nh M√¨ Th·ªãt          15,000ƒë
N∆∞·ªõc Cam              20,000ƒë
--------------------------------
T·ªîNG C·ªòNG:            60,000ƒë
Ti·ªÅn m·∫∑t:             100,000ƒë
Ti·ªÅn th·ª´a:            40,000ƒë
================================
    C·∫¢M ∆°N QU√ù KH√ÅCH!
   H·∫πn g·∫∑p l·∫°i!
</textarea
                    >

                    <div class="quick-templates">
                        <button
                            class="template-btn"
                            onclick="loadTemplate('invoice')"
                        >
                            H√≥a ƒë∆°n
                        </button>
                        <button
                            class="template-btn"
                            onclick="loadTemplate('receipt')"
                        >
                            Phi·∫øu thu
                        </button>
                        <button
                            class="template-btn"
                            onclick="loadTemplate('ticket')"
                        >
                            V√© s·ªë
                        </button>
                        <button
                            class="template-btn"
                            onclick="loadTemplate('barcode')"
                        >
                            Barcode
                        </button>
                    </div>

                    <div style="margin-top: 15px">
                        <button class="btn" onclick="formatReceipt()">
                            Format Text
                        </button>
                        <button
                            class="btn btn-success"
                            onclick="previewReceipt()"
                        >
                            Preview
                        </button>
                    </div>
                </div>

                <!-- XC80 Printer Simulator -->
                <div class="panel printer-simulator">
                    <h3>üñ®Ô∏è XC80 Printer Simulator</h3>

                    <div class="printer-frame">
                        <div class="printer-display" id="printerDisplay">
                            XC-80 READY
                        </div>

                        <div class="paper-slot">
                            <div
                                class="paper-indicator"
                                id="paperIndicator"
                            ></div>
                        </div>

                        <div class="receipt-paper" id="receiptPaper">
                            <div
                                style="
                                    text-align: center;
                                    color: #bdc3c7;
                                    margin-top: 20px;
                                "
                            >
                                S·∫µn s√†ng in...
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 15px">
                        <button
                            class="btn btn-success"
                            onclick="printReceipt()"
                        >
                            üñ®Ô∏è Print
                        </button>
                        <button class="btn btn-warning" onclick="clearPaper()">
                            üóëÔ∏è Clear
                        </button>
                        <button class="btn" onclick="cutPaper()">‚úÇÔ∏è Cut</button>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="panel control-panel">
                <h3>üéÆ Control Panel</h3>
                <button class="btn btn-success" onclick="startPrintBridge()">
                    Start Print Bridge
                </button>
                <button class="btn btn-danger" onclick="stopPrintBridge()">
                    Stop Print Bridge
                </button>
                <button class="btn" onclick="refreshPrinters()">
                    Refresh Printers
                </button>
                <button class="btn btn-warning" onclick="downloadBridgeCode()">
                    Download Bridge Code
                </button>
            </div>

            <!-- Logs -->
            <div class="logs-panel">
                <h3>üìã System Logs</h3>
                <div id="logContainer">
                    <div class="log-entry">
                        <span class="log-time">[12:00:00]</span>
                        <span class="log-info">System initialized</span>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Global variables
            let bridgeConnected = false;
            let isPrinting = false;
            let printBridgeProcess = null;

            // Templates
            const templates = {
                invoice: `        H√ìA ƒê∆†N B√ÅN H√ÄNG
    C√îNG TY ABC
    123 ƒê∆∞·ªùng XYZ, Qu·∫≠n 1, TP.HCM
    M√£ s·ªë thu·∫ø: 0123456789
================================
Ng√†y: ${new Date().toLocaleDateString("vi-VN")}
S·ªë Hƒê: HD${Math.floor(Math.random() * 10000)}
Kh√°ch h√†ng: C√¥ng ty DEF
================================
S·∫£n ph·∫©m A    SL:2   1,000,000ƒë
S·∫£n ph·∫©m B    SL:1     500,000ƒë
--------------------------------
T·ªïng ti·ªÅn h√†ng:      1,500,000ƒë
VAT (10%):             150,000ƒë
T·ªîNG C·ªòNG:           1,650,000ƒë
================================
    CH·ªÆ K√ù KH√ÅCH H√ÄNG`,

                receipt: `        PHI·∫æU THU TI·ªÄN
    C·ª¨A H√ÄNG XYZ
    456 ƒê∆∞·ªùng ABC, Qu·∫≠n 2
    ƒêT: 0987.654.321
================================
Ng√†y: ${new Date().toLocaleDateString("vi-VN")}
Phi·∫øu: PT${Math.floor(Math.random() * 1000)}
================================
Ng∆∞·ªùi n·ªôp: Nguy·ªÖn VƒÉn B
L√Ω do: Thanh to√°n h√≥a ƒë∆°n
S·ªë ti·ªÅn: 2,000,000ƒë
B·∫±ng ch·ªØ: Hai tri·ªáu ƒë·ªìng
================================
    Ng∆∞·ªùi n·ªôp       Ng∆∞·ªùi nh·∫≠n`,

                ticket: `================================
        V√â S·ªê MAY M·∫ÆN
================================
Ng√†y: ${new Date().toLocaleDateString("vi-VN")}
S·ªë v√©: ${Math.floor(Math.random() * 100000)
                    .toString()
                    .padStart(6, "0")}
================================
    üéØ GI·∫¢I NH·∫§T: 10,000,000ƒë
    üéØ GI·∫¢I NH√å:   5,000,000ƒë  
    üéØ GI·∫¢I BA:    1,000,000ƒë
================================
Quay s·ªë: 20:00 h√†ng ng√†y
Hotline: 1900.xxx.xxx
================================
    CH√öC B·∫†N MAY M·∫ÆN!`,

                barcode: `        S·∫¢N PH·∫®M
    M√£ SP: SP${Math.floor(Math.random() * 10000)}
    T√™n: S·∫£n ph·∫©m m·∫´u
    Gi√°: 50,000ƒë
================================
    ||| || ||| | || ||||| | |||
    ||| |  ||  | |  ||| | | | |
    ||| || ||| | || ||||| | |||
================================
    Barcode: ${Math.floor(Math.random() * 1000000000000)}
================================`,
            };

            // Utility functions
            function log(message, type = "info") {
                const timestamp = new Date().toLocaleTimeString();
                const logContainer = document.getElementById("logContainer");
                const logEntry = document.createElement("div");
                logEntry.className = "log-entry";
                logEntry.innerHTML = `
                <span class="log-time">[${timestamp}]</span> 
                <span class="log-${type}">${message}</span>
            `;
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            function updateBridgeStatus(status, text) {
                const indicator = document.getElementById("bridgeStatus");
                const statusText = document.getElementById("bridgeStatusText");

                indicator.className = `status-indicator status-${status}`;
                statusText.textContent = text;
                bridgeConnected = status === "online";
            }

            function updatePrinterDisplay(text) {
                document.getElementById("printerDisplay").textContent = text;
            }

            // Template functions
            function loadTemplate(type) {
                if (templates[type]) {
                    document.getElementById("receiptContent").value =
                        templates[type];
                    log(`Loaded ${type} template`, "info");
                }
            }

            function formatReceipt() {
                const content = document.getElementById("receiptContent").value;
                const paperWidth = parseInt(
                    document.getElementById("paperWidth").value,
                );
                const charWidth = Math.floor(paperWidth / 2.5); // ∆Ø·ªõc t√≠nh k√Ω t·ª±/d√≤ng

                // Basic formatting
                const lines = content.split("\n");
                const formatted = lines
                    .map((line) => {
                        if (line.length > charWidth) {
                            return line.substring(0, charWidth);
                        }
                        return line;
                    })
                    .join("\n");

                document.getElementById("receiptContent").value = formatted;
                log("Receipt formatted for XC80", "success");
            }

            function previewReceipt() {
                const content = document.getElementById("receiptContent").value;
                const paper = document.getElementById("receiptPaper");

                // Convert newlines to <br> and preserve spaces
                const htmlContent = content
                    .replace(/\n/g, "<br>")
                    .replace(/ /g, "&nbsp;");

                paper.innerHTML = htmlContent;
                log("Preview updated", "info");
            }

            // Print Bridge functions
            async function connectBridge() {
                updateBridgeStatus("connecting", "Connecting...");
                updatePrinterDisplay("CONNECTING...");

                try {
                    const bridgeUrl =
                        document.getElementById("bridgeUrl").value;

                    // Simulate connection attempt
                    await new Promise((resolve) => setTimeout(resolve, 2000));

                    // Simulate success/failure
                    if (Math.random() > 0.3) {
                        updateBridgeStatus("online", "Connected");
                        updatePrinterDisplay("XC-80 ONLINE");
                        log(
                            "Connected to print bridge successfully",
                            "success",
                        );

                        // Load printers
                        setTimeout(refreshPrinters, 500);
                    } else {
                        throw new Error("Connection failed");
                    }
                } catch (error) {
                    updateBridgeStatus("offline", "Connection Failed");
                    updatePrinterDisplay("ERROR: NO BRIDGE");
                    log(`Bridge connection failed: ${error.message}`, "error");
                }
            }

            async function testConnection() {
                if (!bridgeConnected) {
                    log("Bridge not connected", "warning");
                    return;
                }

                updatePrinterDisplay("TESTING...");
                log("Testing printer connection...", "info");

                try {
                    // Simulate test print
                    await new Promise((resolve) => setTimeout(resolve, 1500));

                    const paper = document.getElementById("receiptPaper");
                    paper.innerHTML = `
                    <div style="text-align: center;">
                        <strong>XC-80 TEST PAGE</strong><br>
                        Date: ${new Date().toLocaleString()}<br>
                        Status: OK<br>
                        ========================<br>
                        Test completed successfully
                    </div>
                `;

                    updatePrinterDisplay("TEST OK");
                    log("Printer test completed successfully", "success");
                } catch (error) {
                    updatePrinterDisplay("TEST FAILED");
                    log(`Printer test failed: ${error.message}`, "error");
                }
            }

            function refreshPrinters() {
                log("Refreshing printer list...", "info");

                // Simulate printer discovery
                setTimeout(() => {
                    const printerSelect =
                        document.getElementById("printerName");
                    const selectedValue = printerSelect.value;

                    printerSelect.innerHTML = `
                    <option value="">-- Ch·ªçn m√°y in --</option>
                    <option value="XC-80">XC-80 Thermal Printer</option>
                    <option value="Generic">Generic Text Printer</option>
                    <option value="POS-80">POS-80</option>
                    <option value="Simulated">Simulated Printer</option>
                `;

                    if (selectedValue) {
                        printerSelect.value = selectedValue;
                    }

                    log("Printer list refreshed", "success");
                }, 1000);
            }

            // Printing functions
            async function printReceipt() {
                if (isPrinting) {
                    log("Already printing...", "warning");
                    return;
                }

                const content = document.getElementById("receiptContent").value;
                if (!content.trim()) {
                    log("No content to print", "warning");
                    return;
                }

                isPrinting = true;
                updatePrinterDisplay("PRINTING...");
                log("Starting print job...", "info");

                try {
                    // Simulate printing process
                    const paper = document.getElementById("receiptPaper");

                    // Add printing animation
                    const printLine = document.createElement("div");
                    printLine.className = "printing-line";
                    paper.appendChild(printLine);

                    // Update content gradually
                    const lines = content.split("\n");
                    paper.innerHTML = "";

                    for (let i = 0; i < lines.length; i++) {
                        await new Promise((resolve) =>
                            setTimeout(resolve, 100),
                        );
                        paper.innerHTML +=
                            (i > 0 ? "<br>" : "") +
                            lines[i].replace(/ /g, "&nbsp;");
                        paper.scrollTop = paper.scrollHeight;
                    }

                    updatePrinterDisplay("PRINT DONE");
                    log("Print job completed successfully", "success");

                    // Auto cut after 2 seconds
                    setTimeout(() => {
                        updatePrinterDisplay("XC-80 READY");
                    }, 2000);
                } catch (error) {
                    updatePrinterDisplay("PRINT ERROR");
                    log(`Print job failed: ${error.message}`, "error");
                } finally {
                    isPrinting = false;
                }
            }

            function clearPaper() {
                const paper = document.getElementById("receiptPaper");
                paper.innerHTML =
                    '<div style="text-align: center; color: #bdc3c7; margin-top: 20px;">S·∫µn s√†ng in...</div>';
                updatePrinterDisplay("PAPER CLEARED");
                log("Paper cleared", "info");

                setTimeout(() => {
                    updatePrinterDisplay("XC-80 READY");
                }, 1000);
            }

            function cutPaper() {
                updatePrinterDisplay("CUTTING...");
                log("Paper cut initiated", "info");

                // Visual cut effect
                const paper = document.getElementById("receiptPaper");
                paper.style.borderBottom = "3px dashed #e74c3c";

                setTimeout(() => {
                    paper.style.borderBottom = "1px solid #bdc3c7";
                    updatePrinterDisplay("XC-80 READY");
                    log("Paper cut completed", "success");
                }, 1500);
            }

            // Bridge management
            function startPrintBridge() {
                if (printBridgeProcess) {
                    log("Print bridge already running", "warning");
                    return;
                }

                log("Starting print bridge server...", "info");
                updatePrinterDisplay("STARTING...");

                // Simulate starting bridge
                setTimeout(() => {
                    printBridgeProcess = true;
                    updateBridgeStatus("online", "Bridge Running");
                    updatePrinterDisplay("BRIDGE READY");
                    log("Print bridge started on port 9100", "success");
                }, 2000);
            }

            function stopPrintBridge() {
                if (!printBridgeProcess) {
                    log("Print bridge not running", "warning");
                    return;
                }

                log("Stopping print bridge...", "info");
                updatePrinterDisplay("STOPPING...");

                setTimeout(() => {
                    printBridgeProcess = null;
                    updateBridgeStatus("offline", "Bridge Stopped");
                    updatePrinterDisplay("BRIDGE OFF");
                    log("Print bridge stopped", "info");
                }, 1000);
            }

            function downloadBridgeCode() {
                const bridgeCode = `// XC80 Print Bridge Server
const express = require('express');
const printer = require('printer');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

// Get available printers
app.get('/printers', (req, res) => {
    try {
        const printers = printer.getPrinters();
        res.json({ success: true, printers });
    } catch (error) {
        res.status(500).json({ success: false, error: error.message });
    }
});

// Print document
app.post('/print', (req, res) => {
    const { printerName, content, options = {} } = req.body;
    
    if (!printerName || !content) {
        return res.status(400).json({ 
            success: false, 
            error: 'Printer name and content required' 
        });
    }
    
    try {
        printer.printDirect({
            data: content,
            printer: printerName,
            type: 'TEXT',
            options: {
                media: 'Custom.80x200mm',
                'fit-to-page': true,
                ...options
            },
            success: (jobID) => {
                console.log('Print job sent successfully:', jobID);
                res.json({ success: true, jobID });
            },
            error: (error) => {
                console.error('Print error:', error);
                res.status(500).json({ success: false, error });
            }
        });
    } catch (error) {
        res.status(500).json({ success: false, error: error.message });
    }
});

// Health check
app.get('/health', (req, res) => {
    res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

const PORT = process.env.PORT || 9100;
app.listen(PORT, () => {
    console.log(\`XC80 Print Bridge running on port \${PORT}\`);
    console.log(\`Access at: http://localhost:\${PORT}\`);
});

// Package.json dependencies:
/*
{
  "name": "xc80-print-bridge",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.2",
    "printer": "^0.4.0",
    "cors": "^2.8.5"
  }
}
*/`;

                const blob = new Blob([bridgeCode], {
                    type: "text/javascript",
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "xc80-print-bridge.js";
                a.click();
                URL.revokeObjectURL(url);

                log("Bridge code downloaded", "success");
            }

            // Initialize
            document.addEventListener("DOMContentLoaded", function () {
                log("XC80 Printer Simulator initialized", "success");
                previewReceipt();
            });
        </script>
    </body>
</html>

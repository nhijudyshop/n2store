<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XC80 Print Bridge v7.0 - H∆∞·ªõng D·∫´n ƒê·∫ßy ƒê·ªß</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .header .version {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .nav-tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 3px solid #667eea;
      overflow-x: auto;
    }

    .nav-tab {
      flex: 1;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      border: none;
      background: none;
      font-size: 16px;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .nav-tab:hover {
      background: #e9ecef;
    }

    .nav-tab.active {
      background: white;
      color: #667eea;
      border-bottom: 3px solid #667eea;
      margin-bottom: -3px;
    }

    .content {
      padding: 40px;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      color: #667eea;
      font-size: 2em;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }

    h3 {
      color: #764ba2;
      font-size: 1.5em;
      margin-top: 30px;
      margin-bottom: 15px;
    }

    .card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      border-left: 5px solid #667eea;
    }

    .card.warning {
      border-left-color: #ffc107;
      background: #fff9e6;
    }

    .card.success {
      border-left-color: #28a745;
      background: #e8f5e9;
    }

    .card.error {
      border-left-color: #dc3545;
      background: #ffebee;
    }

    .code-block {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
    }

    .code-inline {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      color: #d63384;
      font-size: 0.9em;
    }

    .demo-section {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 30px;
      margin: 20px 0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #495057;
    }

    .form-control {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .form-control:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-block {
      width: 100%;
      display: block;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }

    .result.show {
      display: block;
      animation: fadeIn 0.3s;
    }

    .result.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .result.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    table th,
    table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #dee2e6;
    }

    table th {
      background: #667eea;
      color: white;
      font-weight: 600;
    }

    table tr:hover {
      background: #f8f9fa;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .feature-card {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      border-color: #667eea;
    }

    .feature-icon {
      font-size: 3em;
      margin-bottom: 15px;
    }

    .feature-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
    }

    .feature-desc {
      color: #666;
      line-height: 1.5;
    }

    .steps {
      counter-reset: step-counter;
      list-style: none;
    }

    .steps li {
      counter-increment: step-counter;
      position: relative;
      padding: 20px 20px 20px 60px;
      margin: 15px 0;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 5px solid #667eea;
    }

    .steps li::before {
      content: counter(step-counter);
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      width: 35px;
      height: 35px;
      background: #667eea;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .footer {
      background: #2d3748;
      color: white;
      text-align: center;
      padding: 30px;
    }

    .footer a {
      color: #667eea;
      text-decoration: none;
    }

    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 5px solid;
    }

    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border-left-color: #17a2b8;
    }

    .alert-warning {
      background: #fff3cd;
      color: #856404;
      border-left-color: #ffc107;
    }

    @media (max-width: 768px) {
      .content {
        padding: 20px;
      }

      .header h1 {
        font-size: 1.8em;
      }

      .nav-tab {
        padding: 15px 10px;
        font-size: 14px;
      }

      h2 {
        font-size: 1.5em;
      }
    }

    .spinner {
      display: none;
      margin: 20px auto;
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .spinner.show {
      display: block;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üñ®Ô∏è XC80 Print Bridge</h1>
      <p class="version">Version 7.0 - PDF Support</p>
      <p>H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t v√† s·ª≠ d·ª•ng ƒë·∫ßy ƒë·ªß</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="showTab('overview')">üìñ T·ªïng Quan</button>
      <button class="nav-tab" onclick="showTab('install')">‚öôÔ∏è C√†i ƒê·∫∑t</button>
      <button class="nav-tab" onclick="showTab('usage')">üöÄ S·ª≠ D·ª•ng</button>
      <button class="nav-tab" onclick="showTab('demo')">üé® Demo</button>
      <button class="nav-tab" onclick="showTab('api')">üì° API</button>
      <button class="nav-tab" onclick="showTab('troubleshoot')">üîß Kh·∫Øc Ph·ª•c</button>
    </div>

    <!-- Content -->
    <div class="content">
      <!-- Tab 1: T·ªïng Quan -->
      <div id="overview" class="tab-content active">
        <h2>üìñ T·ªïng Quan</h2>
        
        <p style="font-size: 1.1em; margin-bottom: 30px;">
          <strong>XC80 Print Bridge</strong> l√† m·ªôt bridge server cho ph√©p in ·∫•n t·ª´ web app ƒë·∫øn m√°y in nhi·ªát ESC/POS qua m·∫°ng LAN. H·ªó tr·ª£ ƒë·∫ßy ƒë·ªß ti·∫øng Vi·ªát c√≥ d·∫•u v√† in tr·ª±c ti·∫øp file PDF.
        </p>

        <h3>‚ú® T√≠nh NƒÉng Ch√≠nh</h3>
        <div class="features">
          <div class="feature-card">
            <div class="feature-icon">üìÑ</div>
            <div class="feature-title">In PDF Tr·∫Øng ƒêen</div>
            <div class="feature-desc">Convert PDF sang bitmap ESC/POS t·ª± ƒë·ªông, in tr·ª±c ti·∫øp l√™n m√°y in nhi·ªát</div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üáªüá≥</div>
            <div class="feature-title">Ti·∫øng Vi·ªát C√≥ D·∫•u</div>
            <div class="feature-desc">H·ªó tr·ª£ CP1258 encoding, in ti·∫øng Vi·ªát ho√†n h·∫£o kh√¥ng l·ªói font</div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üñºÔ∏è</div>
            <div class="feature-title">In Bitmap/Canvas</div>
            <div class="feature-desc">In h√¨nh ·∫£nh, QR code, logo t·ª´ canvas HTML5 tr·ª±c ti·∫øp</div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üåê</div>
            <div class="feature-title">API REST</div>
            <div class="feature-desc">T√≠ch h·ª£p d·ªÖ d√†ng qua HTTP API v·ªõi b·∫•t k·ª≥ web app n√†o</div>
          </div>
        </div>

        <div class="card success">
          <h3 style="margin-top: 0;">‚úÖ T∆∞∆°ng th√≠ch</h3>
          <ul>
            <li>‚úì M√°y in nhi·ªát 80mm/58mm ESC/POS</li>
            <li>‚úì XPrinter XP-K200L, XP-80C</li>
            <li>‚úì Xprinter XC-80, XC-58</li>
            <li>‚úì C√°c d√≤ng m√°y in t∆∞∆°ng th√≠ch ESC/POS kh√°c</li>
          </ul>
        </div>

        <div class="card warning">
          <h3 style="margin-top: 0;">‚ö†Ô∏è Y√™u c·∫ßu</h3>
          <ul>
            <li>Node.js >= 14.0.0</li>
            <li>Poppler-utils (cho PDF processing)</li>
            <li>M√°y in v√† server c√πng m·∫°ng LAN</li>
            <li>Port 9100 ch∆∞a b·ªã s·ª≠ d·ª•ng</li>
          </ul>
        </div>

        <h3>üéØ Khi n√†o d√πng?</h3>
        <ul style="margin-left: 20px;">
          <li><strong>Web POS:</strong> In h√≥a ƒë∆°n, receipt t·ª´ web app</li>
          <li><strong>E-commerce:</strong> In phi·∫øu giao h√†ng, nh√£n s·∫£n ph·∫©m</li>
          <li><strong>Restaurant:</strong> In order, bill, kitchen tickets</li>
          <li><strong>Warehouse:</strong> In shipping labels, barcodes</li>
          <li><strong>Clinic/Hospital:</strong> In prescription, patient info</li>
        </ul>
      </div>

      <!-- Tab 2: C√†i ƒê·∫∑t -->
      <div id="install" class="tab-content">
        <h2>‚öôÔ∏è H∆∞·ªõng D·∫´n C√†i ƒê·∫∑t</h2>

        <h3>B∆∞·ªõc 1: C√†i ƒë·∫∑t Node.js</h3>
        <p>Download v√† c√†i ƒë·∫∑t Node.js t·ª´ <a href="https://nodejs.org" target="_blank">https://nodejs.org</a> (khuy·∫øn ngh·ªã LTS version)</p>
        <p>Ki·ªÉm tra c√†i ƒë·∫∑t:</p>
        <div class="code-block">node --version  # Ph·∫£i >= 14.0.0
npm --version</div>

        <h3>B∆∞·ªõc 2: C√†i ƒë·∫∑t Poppler (cho PDF)</h3>
        
        <div class="card">
          <strong>Ubuntu/Debian:</strong>
          <div class="code-block">sudo apt-get update
sudo apt-get install poppler-utils</div>
        </div>

        <div class="card">
          <strong>macOS:</strong>
          <div class="code-block">brew install poppler</div>
        </div>

        <div class="card">
          <strong>Windows:</strong>
          <ol style="margin-left: 20px;">
            <li>Download t·ª´: <a href="https://blog.alivate.com.au/poppler-windows/" target="_blank">Poppler for Windows</a></li>
            <li>Gi·∫£i n√©n v√†o <code class="code-inline">C:\poppler</code></li>
            <li>Th√™m <code class="code-inline">C:\poppler\Library\bin</code> v√†o PATH</li>
          </ol>
        </div>

        <p>Ki·ªÉm tra c√†i ƒë·∫∑t Poppler:</p>
        <div class="code-block">pdftoppm -v</div>

        <h3>B∆∞·ªõc 3: T·∫£i v√† c√†i ƒë·∫∑t Bridge Server</h3>
        
        <ol class="steps">
          <li>
            <strong>T·∫°o th∆∞ m·ª•c project:</strong>
            <div class="code-block">mkdir xc80-bridge
cd xc80-bridge</div>
          </li>
          <li>
            <strong>Copy c√°c file:</strong>
            <ul style="margin-top: 10px;">
              <li><code class="code-inline">xc80-bridge-pdf-support.js</code> - Server ch√≠nh</li>
              <li><code class="code-inline">package.json</code> - Dependencies</li>
              <li><code class="code-inline">config-xc80-cp1258.js</code> - Config script</li>
              <li><code class="code-inline">test-pdf-print.js</code> - Test script</li>
            </ul>
          </li>
          <li>
            <strong>C√†i ƒë·∫∑t dependencies:</strong>
            <div class="code-block">npm install</div>
          </li>
          <li>
            <strong>Kh·ªüi ƒë·ªông server:</strong>
            <div class="code-block">npm start</div>
            <p style="margin-top: 10px;">Server s·∫Ω ch·∫°y tr√™n <code class="code-inline">http://localhost:9100</code></p>
          </li>
          <li>
            <strong>Ki·ªÉm tra health:</strong>
            <div class="code-block">curl http://localhost:9100/health</div>
            <p style="margin-top: 10px;">K·∫øt qu·∫£ mong ƒë·ª£i:</p>
            <div class="code-block">{
  "status": "OK",
  "version": "7.0",
  "features": ["text", "bitmap", "pdf"]
}</div>
          </li>
        </ol>

        <div class="alert alert-info">
          <strong>üí° L∆∞u √Ω:</strong> Server s·∫Ω t·ª± ƒë·ªông t·∫°o th∆∞ m·ª•c <code class="code-inline">temp/</code> ƒë·ªÉ x·ª≠ l√Ω file PDF t·∫°m th·ªùi. Th∆∞ m·ª•c n√†y s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông d·ªçn d·∫πp.
        </div>

        <h3>B∆∞·ªõc 4: C·∫•u h√¨nh m√°y in (Optional)</h3>
        <p>N·∫øu m√°y in c·ªßa b·∫°n h·ªó tr·ª£ CP1258 (ti·∫øng Vi·ªát c√≥ d·∫•u), ch·∫°y script config:</p>
        <div class="code-block">node config-xc80-cp1258.js 192.168.1.100 9100</div>
        <p>Thay <code class="code-inline">192.168.1.100</code> b·∫±ng IP m√°y in c·ªßa b·∫°n.</p>

        <div class="card success">
          <h3 style="margin-top: 0;">‚úÖ Ho√†n t·∫•t!</h3>
          <p>Bridge server ƒë√£ s·∫µn s√†ng. Chuy·ªÉn sang tab <strong>Demo</strong> ƒë·ªÉ test th·ª≠!</p>
        </div>
      </div>

      <!-- Tab 3: S·ª≠ D·ª•ng -->
      <div id="usage" class="tab-content">
        <h2>üöÄ H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng</h2>

        <h3>1. In PDF Tr·∫Øng ƒêen</h3>
        
        <h4>C√°ch 1: D√πng Test Script</h4>
        <div class="code-block">node test-pdf-print.js invoice.pdf 192.168.1.100 9100</div>

        <h4>C√°ch 2: D√πng JavaScript/Fetch</h4>
        <div class="code-block">// ƒê·ªçc file PDF
const fileInput = document.getElementById('pdfFile');
const file = fileInput.files[0];

// Convert sang base64
const reader = new FileReader();
reader.onload = async (e) => {
  const base64Pdf = e.target.result.split(',')[1];

  // G·ª≠i request
  const response = await fetch('http://localhost:9100/print/pdf', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      printerIp: '192.168.1.100',
      printerPort: 9100,
      pdf: base64Pdf,
      width: 576,      // 80mm = 576px @ 203dpi
      dpi: 203,        // Resolution
      threshold: 128   // 0-255, black/white threshold
    })
  });

  const result = await response.json();
  console.log(result);
};

reader.readAsDataURL(file);</div>

        <h4>Tham s·ªë PDF Print:</h4>
        <table>
          <thead>
            <tr>
              <th>Tham s·ªë</th>
              <th>Ki·ªÉu</th>
              <th>M·∫∑c ƒë·ªãnh</th>
              <th>M√¥ t·∫£</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code class="code-inline">printerIp</code></td>
              <td>string</td>
              <td><em>b·∫Øt bu·ªôc</em></td>
              <td>IP m√°y in (vd: 192.168.1.100)</td>
            </tr>
            <tr>
              <td><code class="code-inline">printerPort</code></td>
              <td>number</td>
              <td>9100</td>
              <td>Port m√°y in</td>
            </tr>
            <tr>
              <td><code class="code-inline">pdf</code></td>
              <td>string</td>
              <td><em>b·∫Øt bu·ªôc</em></td>
              <td>Base64 encoded PDF data</td>
            </tr>
            <tr>
              <td><code class="code-inline">width</code></td>
              <td>number</td>
              <td>576</td>
              <td>576px = 80mm, 384px = 58mm</td>
            </tr>
            <tr>
              <td><code class="code-inline">dpi</code></td>
              <td>number</td>
              <td>203</td>
              <td>DPI cho conversion (203 ho·∫∑c 300)</td>
            </tr>
            <tr>
              <td><code class="code-inline">threshold</code></td>
              <td>number</td>
              <td>128</td>
              <td>0-255, ng∆∞·ª°ng ƒëen/tr·∫Øng</td>
            </tr>
          </tbody>
        </table>

        <div class="alert alert-info">
          <strong>üí° M·∫πo ƒëi·ªÅu ch·ªânh Threshold:</strong>
          <ul style="margin-left: 20px; margin-top: 10px;">
            <li><strong>Qu√° tr·∫Øng/nh·∫°t?</strong> ‚Üí Gi·∫£m threshold xu·ªëng 100-120</li>
            <li><strong>Qu√° ƒëen?</strong> ‚Üí TƒÉng threshold l√™n 150-180</li>
            <li><strong>Text m·ªù?</strong> ‚Üí Gi·∫£m xu·ªëng 90-100 ƒë·ªÉ in ƒë·∫≠m</li>
            <li><strong>·∫¢nh ƒë·∫≠m?</strong> ‚Üí TƒÉng l√™n 160-180 ƒë·ªÉ gi·∫£m m·ª±c</li>
          </ul>
        </div>

        <h3>2. In Text Ti·∫øng Vi·ªát</h3>
        <div class="code-block">fetch('http://localhost:9100/print/text', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    printerIp: '192.168.1.100',
    printerPort: 9100,
    text: 'Xin ch√†o Vi·ªát Nam!\nGi√°: 150,000 VNƒê\nC·∫£m ∆°n qu√Ω kh√°ch!',
    encoding: 'cp1258'  // Ho·∫∑c 'utf8' n·∫øu kh√¥ng d√πng d·∫•u
  })
});</div>

        <h3>3. In Bitmap t·ª´ Canvas</h3>
        <div class="code-block">// L·∫•y canvas element
const canvas = document.getElementById('myCanvas');

// Convert canvas sang base64
const dataUrl = canvas.toDataURL('image/png');
const base64Image = dataUrl.split(',')[1];

// G·ª≠i request
fetch('http://localhost:9100/print/bitmap', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    printerIp: '192.168.1.100',
    printerPort: 9100,
    bitmap: base64Image,
    width: canvas.width,
    height: canvas.height,
    threshold: 128
  })
});</div>

        <h3>4. T√≠ch h·ª£p v√†o Web App</h3>
        <div class="code-block">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;POS System&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;input type="file" id="pdfFile" accept=".pdf"&gt;
  &lt;button onclick="printPdf()"&gt;In PDF&lt;/button&gt;

  &lt;script&gt;
    async function printPdf() {
      const file = document.getElementById('pdfFile').files[0];
      if (!file) return alert('Ch·ªçn file PDF');

      const reader = new FileReader();
      reader.onload = async (e) => {
        const base64 = e.target.result.split(',')[1];

        try {
          const response = await fetch('http://localhost:9100/print/pdf', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              printerIp: '192.168.1.100',
              printerPort: 9100,
              pdf: base64,
              width: 576,
              dpi: 203,
              threshold: 128
            })
          });

          const result = await response.json();
          if (result.success) {
            alert('‚úÖ In th√†nh c√¥ng!');
          } else {
            alert('‚ùå L·ªói: ' + result.error);
          }
        } catch (error) {
          alert('‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi bridge server');
        }
      };

      reader.readAsDataURL(file);
    }
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</div>
      </div>

      <!-- Tab 4: Demo -->
      <div id="demo" class="tab-content">
        <h2>üé® Demo Tr·ª±c Ti·∫øp</h2>
        
        <div class="alert alert-warning">
          <strong>‚ö†Ô∏è L∆∞u √Ω:</strong> ƒê·∫£m b·∫£o bridge server ƒë√£ ch·∫°y tr√™n <code class="code-inline">http://localhost:9100</code> tr∆∞·ªõc khi test!
        </div>

        <!-- PDF Print Demo -->
        <div class="demo-section">
          <h3>üìÑ Demo In PDF</h3>
          
          <div class="form-group">
            <label>IP M√°y In:</label>
            <input type="text" class="form-control" id="pdfPrinterIp" value="192.168.1.100" placeholder="192.168.1.100">
          </div>

          <div class="form-group">
            <label>Port:</label>
            <input type="number" class="form-control" id="pdfPrinterPort" value="9100">
          </div>

          <div class="form-group">
            <label>Ch·ªçn File PDF:</label>
            <input type="file" class="form-control" id="pdfFile" accept=".pdf">
          </div>

          <div class="form-group">
            <label>Width (px):</label>
            <input type="number" class="form-control" id="pdfWidth" value="576">
            <small style="color: #666;">576px = 80mm, 384px = 58mm</small>
          </div>

          <div class="form-group">
            <label>DPI:</label>
            <input type="number" class="form-control" id="pdfDpi" value="203">
            <small style="color: #666;">203 = standard, 300 = high quality</small>
          </div>

          <div class="form-group">
            <label>Threshold (0-255):</label>
            <input type="number" class="form-control" id="pdfThreshold" value="128" min="0" max="255">
            <small style="color: #666;">Th·∫•p h∆°n = ƒë·∫≠m h∆°n, cao h∆°n = nh·∫°t h∆°n</small>
          </div>

          <button class="btn btn-primary btn-block" onclick="demoPrintPdf()">
            üñ®Ô∏è In PDF
          </button>

          <div class="spinner" id="pdfSpinner"></div>
          <div class="result" id="pdfResult"></div>
        </div>

        <!-- Text Print Demo -->
        <div class="demo-section">
          <h3>üìù Demo In Text Ti·∫øng Vi·ªát</h3>
          
          <div class="form-group">
            <label>IP M√°y In:</label>
            <input type="text" class="form-control" id="textPrinterIp" value="192.168.1.100">
          </div>

          <div class="form-group">
            <label>Port:</label>
            <input type="number" class="form-control" id="textPrinterPort" value="9100">
          </div>

          <div class="form-group">
            <label>N·ªôi dung:</label>
            <textarea class="form-control" id="textContent" rows="6" placeholder="Nh·∫≠p n·ªôi dung c·∫ßn in...">================================
      H√ìA ƒê∆†N B√ÅN H√ÄNG
================================
C·ª≠a h√†ng: Shop ABC
ƒê·ªãa ch·ªâ: 123 Nguy·ªÖn Hu·ªá, Q1, TP.HCM
ƒêT: 0123456789

--------------------------------
S·∫£n ph·∫©m           SL    Gi√°
--------------------------------
√Åo thun nam        2     150,000ƒë
Qu·∫ßn jean          1     350,000ƒë
--------------------------------
T·ªïng c·ªông:               650,000ƒë
Gi·∫£m gi√°:                 50,000ƒë
--------------------------------
THANH TO√ÅN:              600,000ƒë
================================
C·∫£m ∆°n qu√Ω kh√°ch!
H·∫πn g·∫∑p l·∫°i!</textarea>
          </div>

          <div class="form-group">
            <label>Encoding:</label>
            <select class="form-control" id="textEncoding">
              <option value="cp1258">CP1258 (Ti·∫øng Vi·ªát c√≥ d·∫•u)</option>
              <option value="utf8">UTF-8 (Kh√¥ng d·∫•u)</option>
            </select>
          </div>

          <button class="btn btn-primary btn-block" onclick="demoPrintText()">
            üñ®Ô∏è In Text
          </button>

          <div class="spinner" id="textSpinner"></div>
          <div class="result" id="textResult"></div>
        </div>

        <!-- Health Check -->
        <div class="demo-section">
          <h3>üè• Ki·ªÉm Tra Bridge Server</h3>
          
          <button class="btn btn-success btn-block" onclick="checkHealth()">
            ‚úì Check Server Status
          </button>

          <div class="spinner" id="healthSpinner"></div>
          <div class="result" id="healthResult"></div>
        </div>
      </div>

      <!-- Tab 5: API -->
      <div id="api" class="tab-content">
        <h2>üì° API Documentation</h2>

        <h3>Base URL</h3>
        <div class="code-block">http://localhost:9100</div>

        <h3>Endpoints</h3>

        <!-- GET /health -->
        <div class="card">
          <h4>GET /health</h4>
          <p>Ki·ªÉm tra tr·∫°ng th√°i server</p>
          
          <strong>Request:</strong>
          <div class="code-block">GET http://localhost:9100/health</div>

          <strong>Response:</strong>
          <div class="code-block">{
  "status": "OK",
  "version": "7.0",
  "features": ["text", "bitmap", "pdf"],
  "timestamp": "2025-10-16T10:30:00.000Z"
}</div>
        </div>

        <!-- POST /print/pdf -->
        <div class="card">
          <h4>POST /print/pdf</h4>
          <p>In file PDF tr·∫Øng ƒëen</p>
          
          <strong>Request:</strong>
          <div class="code-block">{
  "printerIp": "192.168.1.100",
  "printerPort": 9100,
  "pdf": "base64_encoded_pdf_data",
  "width": 576,
  "dpi": 203,
  "threshold": 128
}</div>

          <strong>Response (Success):</strong>
          <div class="code-block">{
  "success": true,
  "message": "PDF printed successfully",
  "details": {
    "imageSize": "576x1200",
    "dataSize": 86400
  }
}</div>

          <strong>Response (Error):</strong>
          <div class="code-block">{
  "error": "Error message here"
}</div>
        </div>

        <!-- POST /print/text -->
        <div class="card">
          <h4>POST /print/text</h4>
          <p>In text v·ªõi CP1258 encoding</p>
          
          <strong>Request:</strong>
          <div class="code-block">{
  "printerIp": "192.168.1.100",
  "printerPort": 9100,
  "text": "Xin ch√†o Vi·ªát Nam!",
  "encoding": "cp1258"
}</div>

          <strong>Response:</strong>
          <div class="code-block">{
  "success": true,
  "message": "Text printed successfully"
}</div>
        </div>

        <!-- POST /print/bitmap -->
        <div class="card">
          <h4>POST /print/bitmap</h4>
          <p>In bitmap t·ª´ canvas/image</p>
          
          <strong>Request:</strong>
          <div class="code-block">{
  "printerIp": "192.168.1.100",
  "printerPort": 9100,
  "bitmap": "base64_encoded_image",
  "width": 576,
  "height": 800,
  "threshold": 128
}</div>

          <strong>Response:</strong>
          <div class="code-block">{
  "success": true,
  "message": "Bitmap printed successfully"
}</div>
        </div>

        <h3>Error Codes</h3>
        <table>
          <thead>
            <tr>
              <th>Code</th>
              <th>M√¥ t·∫£</th>
              <th>Gi·∫£i ph√°p</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>400</td>
              <td>Bad Request</td>
              <td>Ki·ªÉm tra l·∫°i tham s·ªë request</td>
            </tr>
            <tr>
              <td>500</td>
              <td>Internal Server Error</td>
              <td>Xem log server ƒë·ªÉ bi·∫øt chi ti·∫øt</td>
            </tr>
            <tr>
              <td>ECONNREFUSED</td>
              <td>Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c m√°y in</td>
              <td>Ki·ªÉm tra IP, port, m·∫°ng LAN</td>
            </tr>
            <tr>
              <td>ETIMEDOUT</td>
              <td>Timeout</td>
              <td>M√°y in c√≥ th·ªÉ b·ªã treo, t·∫Øt b·∫≠t l·∫°i</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Tab 6: Troubleshooting -->
      <div id="troubleshoot" class="tab-content">
        <h2>üîß Kh·∫Øc Ph·ª•c S·ª± C·ªë</h2>

        <h3>‚ùå Server kh√¥ng kh·ªüi ƒë·ªông ƒë∆∞·ª£c</h3>
        <div class="card error">
          <strong>L·ªói: Port 9100 already in use</strong>
          <p><strong>Gi·∫£i ph√°p:</strong></p>
          <ul>
            <li>ƒê√≥ng process ƒëang d√πng port 9100</li>
            <li>Ho·∫∑c ƒë·ªïi port trong code: <code class="code-inline">const PORT = 9101;</code></li>
            <li>Check port: <code class="code-inline">netstat -ano | findstr 9100</code> (Windows)</li>
            <li>Check port: <code class="code-inline">lsof -i :9100</code> (Mac/Linux)</li>
          </ul>
        </div>

        <div class="card error">
          <strong>L·ªói: Cannot find module 'sharp'</strong>
          <p><strong>Gi·∫£i ph√°p:</strong></p>
          <div class="code-block">npm install sharp</div>
        </div>

        <h3>‚ùå Kh√¥ng in ƒë∆∞·ª£c PDF</h3>
        <div class="card error">
          <strong>L·ªói: pdftoppm: command not found</strong>
          <p><strong>Gi·∫£i ph√°p:</strong> Ch∆∞a c√†i Poppler. Xem tab <strong>C√†i ƒê·∫∑t</strong> ƒë·ªÉ c√†i Poppler-utils</p>
        </div>

        <div class="card error">
          <strong>PDF in ra tr·∫Øng/ƒëen ho√†n to√†n</strong>
          <p><strong>Gi·∫£i ph√°p:</strong> ƒêi·ªÅu ch·ªânh threshold:</p>
          <ul>
            <li>N·∫øu to√†n tr·∫Øng: Gi·∫£m threshold xu·ªëng 80-100</li>
            <li>N·∫øu to√†n ƒëen: TƒÉng threshold l√™n 160-200</li>
            <li>Th·ª≠ nhi·ªÅu gi√° tr·ªã kh√°c nhau ƒë·ªÉ t√¨m gi√° tr·ªã t·ªëi ∆∞u</li>
          </ul>
        </div>

        <h3>‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c m√°y in</h3>
        <div class="card error">
          <strong>L·ªói: ECONNREFUSED</strong>
          <p><strong>Gi·∫£i ph√°p:</strong></p>
          <ol style="margin-left: 20px;">
            <li>Ping ki·ªÉm tra m√°y in: <code class="code-inline">ping 192.168.1.100</code></li>
            <li>Ki·ªÉm tra IP c√≥ ƒë√∫ng kh√¥ng (xem tr√™n m√°y in)</li>
            <li>Ki·ªÉm tra port (th∆∞·ªùng l√† 9100 ho·∫∑c 9101)</li>
            <li>ƒê·∫£m b·∫£o m√°y in ƒë√£ b·∫≠t v√† k·∫øt n·ªëi m·∫°ng</li>
            <li>Th·ª≠ in test page t·ª´ m√°y in ƒë·ªÉ ƒë·∫£m b·∫£o m√°y ho·∫°t ƒë·ªông</li>
          </ol>
        </div>

        <div class="card error">
          <strong>L·ªói: ETIMEDOUT</strong>
          <p><strong>Gi·∫£i ph√°p:</strong></p>
          <ul>
            <li>M√°y in c√≥ th·ªÉ b·ªã treo ‚Üí T·∫Øt v√† b·∫≠t l·∫°i</li>
            <li>Ki·ªÉm tra firewall c√≥ block k·∫øt n·ªëi kh√¥ng</li>
            <li>Th·ª≠ telnet: <code class="code-inline">telnet 192.168.1.100 9100</code></li>
          </ul>
        </div>

        <h3>‚ùå Ti·∫øng Vi·ªát b·ªã l·ªói font</h3>
        <div class="card error">
          <strong>In ra k√Ω t·ª± l·∫° ho·∫∑c vu√¥ng (‚ñØ)</strong>
          <p><strong>Gi·∫£i ph√°p:</strong></p>
          <ol style="margin-left: 20px;">
            <li>Ch·∫°y config script:
              <div class="code-block">node config-xc80-cp1258.js 192.168.1.100 9100</div>
            </li>
            <li>N·∫øu v·∫´n l·ªói, m√°y in kh√¥ng h·ªó tr·ª£ CP1258 ‚Üí D√πng mode kh√¥ng d·∫•u:
              <div class="code-block">{
  "encoding": "utf8"  // Thay v√¨ "cp1258"
}</div>
            </li>
            <li>Ho·∫∑c b·ªè d·∫•u ti·∫øng Vi·ªát tr∆∞·ªõc khi in</li>
          </ol>
        </div>

        <h3>‚ùå Ch·∫•t l∆∞·ª£ng in k√©m</h3>
        <div class="card warning">
          <strong>H√¨nh ·∫£nh/text b·ªã m·ªù, v·ª°</strong>
          <p><strong>Gi·∫£i ph√°p:</strong></p>
          <ul>
            <li>TƒÉng DPI l√™n 300 ƒë·ªÉ chi ti·∫øt h∆°n</li>
            <li>ƒêi·ªÅu ch·ªânh threshold cho ph√π h·ª£p (th·ª≠ 100-150)</li>
            <li>ƒê·∫£m b·∫£o gi·∫•y in kh√¥ng b·ªã ·∫©m</li>
            <li>V·ªá sinh ƒë·∫ßu in n·∫øu l√¢u kh√¥ng d√πng</li>
            <li>Ki·ªÉm tra ƒë·ªô ƒë·∫≠m tr√™n m√°y in (n·∫øu c√≥)</li>
          </ul>
        </div>

        <h3>‚ùå File qu√° l·ªõn</h3>
        <div class="card warning">
          <strong>L·ªói: Request Entity Too Large</strong>
          <p><strong>Gi·∫£i ph√°p:</strong></p>
          <ul>
            <li>Gi·ªõi h·∫°n hi·ªán t·∫°i: 50MB</li>
            <li>N√©n PDF tr∆∞·ªõc khi in</li>
            <li>Gi·∫£m DPI xu·ªëng 150 ho·∫∑c 100</li>
            <li>T√°ch th√†nh nhi·ªÅu page nh·ªè h∆°n</li>
            <li>Ho·∫∑c tƒÉng limit trong code: <code class="code-inline">limit: "100mb"</code></li>
          </ul>
        </div>

        <div class="alert alert-info">
          <strong>üí° Debug Tips:</strong>
          <ul style="margin-left: 20px; margin-top: 10px;">
            <li>Xem log c·ªßa bridge server ƒë·ªÉ bi·∫øt l·ªói chi ti·∫øt</li>
            <li>Test t·ª´ng b∆∞·ªõc: health check ‚Üí text ‚Üí bitmap ‚Üí PDF</li>
            <li>D√πng Postman ho·∫∑c curl ƒë·ªÉ test API tr·ª±c ti·∫øp</li>
            <li>Ki·ªÉm tra network v·ªõi Wireshark n·∫øu c·∫ßn</li>
          </ul>
        </div>

        <h3>üÜò V·∫´n kh√¥ng gi·∫£i quy·∫øt ƒë∆∞·ª£c?</h3>
        <div class="card">
          <p>Cung c·∫•p th√¥ng tin sau khi b√°o l·ªói:</p>
          <ul>
            <li>‚úì Log t·ª´ bridge server (copy to√†n b·ªô terminal output)</li>
            <li>‚úì H·ªá ƒëi·ªÅu h√†nh (Windows/Mac/Linux + phi√™n b·∫£n)</li>
            <li>‚úì Node.js version: <code class="code-inline">node --version</code></li>
            <li>‚úì Poppler version: <code class="code-inline">pdftoppm -v</code></li>
            <li>‚úì Model m√°y in</li>
            <li>‚úì File PDF m·∫´u (n·∫øu l·ªói in PDF)</li>
            <li>‚úì C√°c tham s·ªë ƒë√£ th·ª≠ (width, dpi, threshold)</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>XC80 Print Bridge v7.0 - Made with ‚ù§Ô∏è for Vietnamese Developers</p>
      <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
        Open Source ‚Ä¢ MIT License ‚Ä¢ <a href="https://github.com" target="_blank">GitHub</a>
      </p>
    </div>
  </div>

  <script>
    // Tab switching
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });

      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Health Check
    async function checkHealth() {
      const spinner = document.getElementById('healthSpinner');
      const result = document.getElementById('healthResult');
      
      spinner.classList.add('show');
      result.classList.remove('show');

      try {
        const response = await fetch('http://localhost:9100/health');
        const data = await response.json();

        spinner.classList.remove('show');
        result.className = 'result show success';
        result.innerHTML = `
          <strong>‚úÖ Server ƒëang ho·∫°t ƒë·ªông!</strong><br>
          Version: ${data.version}<br>
          Features: ${data.features.join(', ')}<br>
          Status: ${data.status}
        `;
      } catch (error) {
        spinner.classList.remove('show');
        result.className = 'result show error';
        result.innerHTML = `
          <strong>‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi server!</strong><br>
          Error: ${error.message}<br><br>
          ƒê·∫£m b·∫£o bridge server ƒë√£ ch·∫°y:<br>
          <code>npm start</code>
        `;
      }
    }

    // Demo Print PDF
    async function demoPrintPdf() {
      const fileInput = document.getElementById('pdfFile');
      const file = fileInput.files[0];

      if (!file) {
        alert('Vui l√≤ng ch·ªçn file PDF');
        return;
      }

      const printerIp = document.getElementById('pdfPrinterIp').value;
      const printerPort = parseInt(document.getElementById('pdfPrinterPort').value);
      const width = parseInt(document.getElementById('pdfWidth').value);
      const dpi = parseInt(document.getElementById('pdfDpi').value);
      const threshold = parseInt(document.getElementById('pdfThreshold').value);

      const spinner = document.getElementById('pdfSpinner');
      const result = document.getElementById('pdfResult');

      spinner.classList.add('show');
      result.classList.remove('show');

      try {
        // Read file as base64
        const reader = new FileReader();
        reader.onload = async (e) => {
          const base64Pdf = e.target.result.split(',')[1];

          try {
            const response = await fetch('http://localhost:9100/print/pdf', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                printerIp,
                printerPort,
                pdf: base64Pdf,
                width,
                dpi,
                threshold
              })
            });

            const data = await response.json();

            spinner.classList.remove('show');

            if (data.success) {
              result.className = 'result show success';
              result.innerHTML = `
                <strong>‚úÖ In PDF th√†nh c√¥ng!</strong><br>
                Image size: ${data.details.imageSize}<br>
                Data sent: ${(data.details.dataSize / 1024).toFixed(2)} KB
              `;
            } else {
              result.className = 'result show error';
              result.innerHTML = `
                <strong>‚ùå L·ªói in PDF!</strong><br>
                ${data.error}
              `;
            }
          } catch (error) {
            spinner.classList.remove('show');
            result.className = 'result show error';
            result.innerHTML = `
              <strong>‚ùå Kh√¥ng th·ªÉ g·ª≠i request!</strong><br>
              Error: ${error.message}<br><br>
              Ki·ªÉm tra bridge server ƒë√£ ch·∫°y ch∆∞a.
            `;
          }
        };

        reader.readAsDataURL(file);
      } catch (error) {
        spinner.classList.remove('show');
        result.className = 'result show error';
        result.innerHTML = `
          <strong>‚ùå L·ªói ƒë·ªçc file!</strong><br>
          ${error.message}
        `;
      }
    }

    // Demo Print Text
    async function demoPrintText() {
      const printerIp = document.getElementById('textPrinterIp').value;
      const printerPort = parseInt(document.getElementById('textPrinterPort').value);
      const text = document.getElementById('textContent').value;
      const encoding = document.getElementById('textEncoding').value;

      if (!text.trim()) {
        alert('Vui l√≤ng nh·∫≠p n·ªôi dung');
        return;
      }

      const spinner = document.getElementById('textSpinner');
      const result = document.getElementById('textResult');

      spinner.classList.add('show');
      result.classList.remove('show');

      try {
        const response = await fetch('http://localhost:9100/print/text', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            printerIp,
            printerPort,
            text,
            encoding
          })
        });

        const data = await response.json();

        spinner.classList.remove('show');

        if (data.success) {
          result.className = 'result show success';
          result.innerHTML = `
            <strong>‚úÖ In text th√†nh c√¥ng!</strong><br>
            Encoding: ${encoding}<br>
            Printer: ${printerIp}:${printerPort}
          `;
        } else {
          result.className = 'result show error';
          result.innerHTML = `
            <strong>‚ùå L·ªói in text!</strong><br>
            ${data.error}
          `;
        }
      } catch (error) {
        spinner.classList.remove('show');
        result.className = 'result show error';
        result.innerHTML = `
          <strong>‚ùå Kh√¥ng th·ªÉ g·ª≠i request!</strong><br>
          Error: ${error.message}<br><br>
          Ki·ªÉm tra bridge server ƒë√£ ch·∫°y ch∆∞a.
        `;
      }
    }
  </script>
</body>
</html>

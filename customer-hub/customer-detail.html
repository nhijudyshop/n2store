<!--
  üìñ GHI CH√ö CHO L·∫¨P TR√åNH VI√äN:
  Khi code ph·∫£i ƒë·ªçc th∆∞ m·ª•c https://github.com/nhijudyshop/n2store/tree/main/docs tr∆∞·ªõc!
  ƒê·ªçc c√°c file SHARED_*.md ƒë·ªÉ hi·ªÉu c√°ch s·ª≠ d·ª•ng shared modules.
-->
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer 360¬∞ - Chi ti·∫øt kh√°ch h√†ng</title>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/customer-detail.css">
</head>

<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i data-lucide="zap"></i>
                <span>N2Shop</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i data-lucide="panel-left-close"></i>
            </button>
        </div>

        <nav class="sidebar-nav" id="sidebarNav">
            <!-- Menu items auto-generated by navigation-modern.js -->
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i data-lucide="user-circle"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Admin</div>
                    <div class="user-role">Qu·∫£n tr·ªã vi√™n</div>
                </div>
            </div>
            <button class="btn-logout" id="btnLogout">
                <i data-lucide="log-out"></i>
                <span>ƒêƒÉng xu·∫•t</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <!-- Header with Back Button -->
            <header class="header">
                <div class="header-content">
                    <div class="header-left">
                        <a href="index.html" class="btn-back">
                            <i data-lucide="arrow-left"></i>
                        </a>
                        <h1><i data-lucide="user-circle"></i> Customer 360¬∞ View</h1>
                    </div>
                    <div class="header-actions">
                        <button id="editCustomerBtn" class="btn btn-primary">
                            <i data-lucide="edit"></i> Ch·ªânh s·ª≠a
                        </button>
                        <button id="refreshBtn" class="btn btn-secondary">
                            <i data-lucide="refresh-cw"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading" style="display: none;">
                <i data-lucide="loader-2" class="animate-spin"></i> ƒêang t·∫£i th√¥ng tin kh√°ch h√†ng...
            </div>

            <!-- Customer Profile Section -->
            <div class="customer-profile" id="customerProfile">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <i data-lucide="user"></i>
                        <span class="status-badge" id="customerStatusBadge">B√¨nh th∆∞·ªùng</span>
                    </div>
                    <div class="profile-info">
                        <h2 id="customerName">-</h2>
                        <div class="profile-contact">
                            <span class="contact-item">
                                <i data-lucide="phone"></i>
                                <span id="customerPhone">-</span>
                            </span>
                            <span class="contact-item">
                                <i data-lucide="mail"></i>
                                <span id="customerEmail">-</span>
                            </span>
                            <span class="contact-item">
                                <i data-lucide="map-pin"></i>
                                <span id="customerAddress">-</span>
                            </span>
                        </div>
                        <div class="profile-tags" id="customerTags">
                            <!-- Tags will be inserted here -->
                        </div>
                    </div>
                    <div class="profile-tier">
                        <div class="tier-badge" id="customerTier">
                            <i data-lucide="award"></i>
                            <span>Bronze</span>
                        </div>
                        <div class="rfm-score">
                            <span class="rfm-label">RFM Score</span>
                            <span class="rfm-value" id="customerRFM">-</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="quick-stat">
                        <i data-lucide="shopping-bag"></i>
                        <div class="stat-content">
                            <span class="stat-value" id="statTotalOrders">0</span>
                            <span class="stat-label">ƒê∆°n h√†ng</span>
                        </div>
                    </div>
                    <div class="quick-stat">
                        <i data-lucide="banknote"></i>
                        <div class="stat-content">
                            <span class="stat-value" id="statTotalSpent">0ƒë</span>
                            <span class="stat-label">T·ªïng chi ti√™u</span>
                        </div>
                    </div>
                    <div class="quick-stat">
                        <i data-lucide="wallet"></i>
                        <div class="stat-content">
                            <span class="stat-value" id="statWalletBalance">0ƒë</span>
                            <span class="stat-label">S·ªë d∆∞ v√≠</span>
                        </div>
                    </div>
                    <div class="quick-stat">
                        <i data-lucide="credit-card"></i>
                        <div class="stat-content">
                            <span class="stat-value" id="statDebt">0ƒë</span>
                            <span class="stat-label">C√¥ng n·ª£</span>
                        </div>
                    </div>
                    <div class="quick-stat">
                        <i data-lucide="undo-2"></i>
                        <div class="stat-content">
                            <span class="stat-value" id="statReturnRate">0%</span>
                            <span class="stat-label">T·ª∑ l·ªá ho√†n</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab active" data-tab="wallet">
                        <i data-lucide="wallet"></i> V√≠ & Giao d·ªãch
                    </button>
                    <button class="tab" data-tab="tickets">
                        <i data-lucide="ticket"></i> S·ª± v·ª•
                    </button>
                    <button class="tab" data-tab="activities">
                        <i data-lucide="activity"></i> Ho·∫°t ƒë·ªông
                    </button>
                    <button class="tab" data-tab="notes">
                        <i data-lucide="sticky-note"></i> Ghi ch√∫
                    </button>
                    <button class="tab" data-tab="orders">
                        <i data-lucide="shopping-cart"></i> ƒê∆°n h√†ng
                    </button>
                </div>

                <!-- Tab Content: Wallet -->
                <div class="tab-content active" id="tabWallet">
                    <div class="wallet-panel">
                        <div class="wallet-summary">
                            <div class="wallet-balance">
                                <h3>S·ªë d∆∞ kh·∫£ d·ª•ng</h3>
                                <div class="balance-amount" id="walletBalance">0ƒë</div>
                                <div class="balance-breakdown">
                                    <span class="real-balance">
                                        <i data-lucide="banknote"></i> Ti·ªÅn th·∫≠t: <strong id="realBalance">0ƒë</strong>
                                    </span>
                                    <span class="virtual-balance">
                                        <i data-lucide="gift"></i> C√¥ng n·ª£ ·∫£o: <strong id="virtualBalance">0ƒë</strong>
                                    </span>
                                </div>
                            </div>
                            <div class="wallet-actions">
                                <button class="btn btn-success" id="depositBtn">
                                    <i data-lucide="plus-circle"></i> N·∫°p ti·ªÅn
                                </button>
                                <button class="btn btn-warning" id="withdrawBtn">
                                    <i data-lucide="minus-circle"></i> Tr·ª´ ti·ªÅn
                                </button>
                                <button class="btn btn-info" id="addCreditBtn">
                                    <i data-lucide="gift"></i> Th√™m c√¥ng n·ª£ ·∫£o
                                </button>
                            </div>
                        </div>

                        <!-- Virtual Credits List -->
                        <div class="virtual-credits-section">
                            <h4><i data-lucide="gift"></i> C√¥ng n·ª£ ·∫£o ƒëang c√≥ hi·ªáu l·ª±c</h4>
                            <div class="virtual-credits-list" id="virtualCreditsList">
                                <!-- Virtual credits will be inserted here -->
                                <div class="empty-state-small">
                                    <i data-lucide="inbox"></i>
                                    <p>Ch∆∞a c√≥ c√¥ng n·ª£ ·∫£o</p>
                                </div>
                            </div>
                        </div>

                        <!-- Transaction History -->
                        <div class="transaction-history">
                            <h4><i data-lucide="history"></i> L·ªãch s·ª≠ giao d·ªãch v√≠</h4>
                            <div class="transaction-list" id="transactionList">
                                <!-- Transactions will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Tickets -->
                <div class="tab-content" id="tabTickets">
                    <div class="tickets-panel">
                        <div class="panel-header">
                            <h4><i data-lucide="ticket"></i> Danh s√°ch s·ª± v·ª•</h4>
                            <button class="btn btn-success btn-sm" id="createTicketBtn">
                                <i data-lucide="plus"></i> T·∫°o s·ª± v·ª•
                            </button>
                        </div>
                        <div class="tickets-list" id="ticketsList">
                            <!-- Tickets will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Activities -->
                <div class="tab-content" id="tabActivities">
                    <div class="activities-panel">
                        <h4><i data-lucide="activity"></i> Timeline ho·∫°t ƒë·ªông</h4>
                        <div class="activity-timeline" id="activityTimeline">
                            <!-- Activities will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Notes -->
                <div class="tab-content" id="tabNotes">
                    <div class="notes-panel">
                        <div class="panel-header">
                            <h4><i data-lucide="sticky-note"></i> Ghi ch√∫ n·ªôi b·ªô</h4>
                            <button class="btn btn-success btn-sm" id="addNoteBtn">
                                <i data-lucide="plus"></i> Th√™m ghi ch√∫
                            </button>
                        </div>
                        <div class="notes-form" id="noteFormContainer" style="display: none;">
                            <textarea id="noteContent" rows="3" placeholder="Nh·∫≠p ghi ch√∫..."></textarea>
                            <div class="note-form-actions">
                                <button class="btn btn-primary btn-sm" id="saveNoteBtn">
                                    <i data-lucide="save"></i> L∆∞u
                                </button>
                                <button class="btn btn-secondary btn-sm" id="cancelNoteBtn">
                                    <i data-lucide="x"></i> H·ªßy
                                </button>
                            </div>
                        </div>
                        <div class="notes-list" id="notesList">
                            <!-- Notes will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Orders -->
                <div class="tab-content" id="tabOrders">
                    <div class="orders-panel">
                        <h4><i data-lucide="shopping-cart"></i> L·ªãch s·ª≠ ƒë∆°n h√†ng (t·ª´ TPOS)</h4>
                        <div class="orders-list" id="ordersList">
                            <!-- Orders will be inserted here -->
                            <div class="empty-state-small">
                                <i data-lucide="shopping-cart"></i>
                                <p>T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn - s·∫Ω t√≠ch h·ª£p v·ªõi TPOS</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div id="depositModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2><i data-lucide="plus-circle"></i> N·∫°p ti·ªÅn v√†o v√≠</h2>
                <button class="modal-close" id="closeDepositModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="depositForm">
                    <div class="form-group">
                        <label for="depositAmount">
                            <i data-lucide="banknote"></i> S·ªë ti·ªÅn n·∫°p
                        </label>
                        <input type="text" id="depositAmount" required placeholder="100,000">
                        <span class="input-hint">Nh·∫≠p s·ªë ti·ªÅn c·∫ßn n·∫°p v√†o v√≠</span>
                    </div>
                    <div class="form-group">
                        <label for="depositNote">
                            <i data-lucide="file-text"></i> Ghi ch√∫
                        </label>
                        <input type="text" id="depositNote" placeholder="N·∫°p ti·ªÅn t·ª´ chuy·ªÉn kho·∫£n...">
                    </div>
                    <div class="form-group">
                        <label for="depositReference">
                            <i data-lucide="hash"></i> M√£ tham chi·∫øu (n·∫øu c√≥)
                        </label>
                        <input type="text" id="depositReference" placeholder="M√£ giao d·ªãch ng√¢n h√†ng...">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <i data-lucide="check"></i> X√°c nh·∫≠n n·∫°p ti·ªÅn
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2><i data-lucide="minus-circle"></i> Tr·ª´ ti·ªÅn t·ª´ v√≠</h2>
                <button class="modal-close" id="closeWithdrawModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="withdrawForm">
                    <div class="form-group">
                        <label for="withdrawAmount">
                            <i data-lucide="banknote"></i> S·ªë ti·ªÅn tr·ª´
                        </label>
                        <input type="text" id="withdrawAmount" required placeholder="100,000">
                        <span class="input-hint">S·ªë d∆∞ kh·∫£ d·ª•ng: <strong id="availableBalance">0ƒë</strong></span>
                    </div>
                    <div class="form-group">
                        <label for="withdrawNote">
                            <i data-lucide="file-text"></i> L√Ω do tr·ª´ ti·ªÅn
                        </label>
                        <input type="text" id="withdrawNote" required placeholder="Thanh to√°n ƒë∆°n h√†ng #123...">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-warning">
                            <i data-lucide="check"></i> X√°c nh·∫≠n tr·ª´ ti·ªÅn
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Virtual Credit Modal -->
    <div id="creditModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2><i data-lucide="gift"></i> Th√™m c√¥ng n·ª£ ·∫£o</h2>
                <button class="modal-close" id="closeCreditModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="creditForm">
                    <div class="info-box">
                        <i data-lucide="info"></i>
                        <p>C√¥ng n·ª£ ·∫£o l√† kho·∫£n ti·ªÅn shop "n·ª£" kh√°ch h√†ng (v√≠ d·ª•: ƒë·ªÅn b√π, ho√†n ti·ªÅn ch∆∞a chuy·ªÉn). C√¥ng n·ª£ ·∫£o s·∫Ω ƒë∆∞·ª£c tr·ª´ tr∆∞·ªõc khi tr·ª´ ti·ªÅn th·∫≠t (FIFO).</p>
                    </div>
                    <div class="form-group">
                        <label for="creditAmount">
                            <i data-lucide="banknote"></i> S·ªë ti·ªÅn
                        </label>
                        <input type="text" id="creditAmount" required placeholder="50,000">
                    </div>
                    <div class="form-group">
                        <label for="creditReason">
                            <i data-lucide="file-text"></i> L√Ω do
                        </label>
                        <input type="text" id="creditReason" required placeholder="ƒê·ªÅn b√π ƒë∆°n h√†ng #123 b·ªã l·ªói">
                    </div>
                    <div class="form-group">
                        <label for="creditExpiry">
                            <i data-lucide="calendar"></i> Ng√†y h·∫øt h·∫°n
                        </label>
                        <input type="date" id="creditExpiry">
                        <span class="input-hint">ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng c√≥ h·∫°n</span>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-info">
                            <i data-lucide="check"></i> X√°c nh·∫≠n th√™m c√¥ng n·ª£ ·∫£o
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Ticket Modal -->
    <div id="ticketModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i data-lucide="ticket"></i> T·∫°o s·ª± v·ª• m·ªõi</h2>
                <button class="modal-close" id="closeTicketModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="ticketForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ticketType">
                                <i data-lucide="tag"></i> Lo·∫°i s·ª± v·ª•
                            </label>
                            <select id="ticketType" required>
                                <option value="">-- Ch·ªçn lo·∫°i --</option>
                                <option value="complaint">Khi·∫øu n·∫°i</option>
                                <option value="return">ƒê·ªïi/Tr·∫£ h√†ng</option>
                                <option value="refund">Ho√†n ti·ªÅn</option>
                                <option value="support">H·ªó tr·ª£</option>
                                <option value="other">Kh√°c</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ticketPriority">
                                <i data-lucide="alert-circle"></i> M·ª©c ƒë·ªô ∆∞u ti√™n
                            </label>
                            <select id="ticketPriority">
                                <option value="low">Th·∫•p</option>
                                <option value="medium" selected>Trung b√¨nh</option>
                                <option value="high">Cao</option>
                                <option value="urgent">Kh·∫©n c·∫•p</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ticketSubject">
                            <i data-lucide="text"></i> Ti√™u ƒë·ªÅ
                        </label>
                        <input type="text" id="ticketSubject" required placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·∫•n ƒë·ªÅ...">
                    </div>
                    <div class="form-group">
                        <label for="ticketDescription">
                            <i data-lucide="file-text"></i> M√¥ t·∫£ chi ti·∫øt
                        </label>
                        <textarea id="ticketDescription" rows="4" placeholder="M√¥ t·∫£ chi ti·∫øt v·∫•n ƒë·ªÅ..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="ticketOrderId">
                            <i data-lucide="shopping-bag"></i> M√£ ƒë∆°n h√†ng li√™n quan (n·∫øu c√≥)
                        </label>
                        <input type="text" id="ticketOrderId" placeholder="ORD-12345">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <i data-lucide="check"></i> T·∫°o s·ª± v·ª•
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="../js/firebase-config.js"></script>

    <!-- Navigation & Auth -->
    <script src="../js/navigation-modern.js"></script>

    <!-- Page Scripts -->
    <script src="js/config.js"></script>
    <script src="js/customer-service.js"></script>
    <script src="js/wallet-panel.js"></script>
    <script src="js/ticket-panel.js"></script>
    <script src="js/activity-timeline.js"></script>
    <script src="js/customer-detail.js"></script>

    <!-- Initialize Lucide Icons -->
    <script>
        lucide.createIcons();
    </script>
</body>

</html>

<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Qu·∫£n l√Ω ƒë∆°n h√†ng</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link rel="stylesheet" href="tab1-orders.css" />
        <link rel="stylesheet" href="message-template-modal.css" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    </head>

    <body>
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div
                style="
                    background: white;
                    padding: 32px;
                    border-radius: 12px;
                    text-align: center;
                "
            >
                <div class="loading-spinner" style="margin: 0 auto 16px"></div>
                <div
                    class="loading-text"
                    style="font-size: 14px; color: #6b7280"
                >
                    ƒêang t·∫£i d·ªØ li·ªáu...
                </div>
            </div>
        </div>
        <!-- Scroll to Top Button -->
        <button class="scroll-to-top" id="scrollToTopBtn">
            <i class="fas fa-arrow-up"></i>
        </button>
        <!-- Main Content -->
        <div class="main-content">
            <!-- Filter Section -->
            <div class="filter-section">
                <label>Kho·∫£ng t·∫£i:</label>
                <select id="skipRangeFilter" style="min-width: 150px">
                    <option value="0" selected>3000 ƒë·∫ßu ti√™n</option>
                    <option value="3000">3000 ti·∫øp theo</option>
                    <option value="6000">3000 th·ª© 3</option>
                    <option value="9000">3000 th·ª© 4</option>
                    <option value="12000">3000 th·ª© 5</option>
                </select>
                <button class="btn-primary" id="loadCampaignsBtn" style="background: #8b5cf6">
                    <i class="fas fa-sync-alt"></i>
                    T·∫£i Chi·∫øn D·ªãch
                </button>
                <label>Chi·∫øn d·ªãch Live:</label>
                <select id="campaignFilter" style="min-width: 300px">
                    <option value="">ƒêang t·∫£i...</option>
                </select>
                <label>T·ª´ ng√†y:</label>
                <input type="datetime-local" id="startDate" />
                <label>ƒê·∫øn ng√†y:</label>
                <input type="datetime-local" id="endDate" />
                <button class="btn-primary" id="searchBtn">
                    <i class="fas fa-search"></i>
                    T√¨m ki·∫øm
                </button>
                <button
                    class="btn-primary"
                    id="clearCacheBtn"
                    style="background: #ef4444"
                >
                    <i class="fas fa-trash"></i>
                    X√≥a Cache
                </button>
            </div>

            <!-- Action Buttons Section (New) -->
            <div class="action-buttons-section" style="padding: 16px 24px; display: none; gap: 12px; flex-wrap: wrap;" id="actionButtonsSection">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <span style="color: #6b7280; font-size: 13px; font-weight: 500;">
                        <span id="selectedOrdersCount">0</span> ƒë∆°n ƒë∆∞·ª£c ch·ªçn
                    </span>
                </div>
                <button
                    class="btn-message-action"
                    id="assignEmptyCartTagBtn"
                    style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    "
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(245, 158, 11, 0.3)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
                >
                    <i class="fas fa-tags"></i>
                    G√°n tag "GI·ªé TR·ªêNG"
                </button>
                <button
                    class="btn-message-action"
                    id="sendMessageBtn"
                    onclick="openMessageTemplateModal()"
                    style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    "
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
                >
                    <i class="fab fa-facebook-messenger"></i>
                    G·ª≠i tin nh·∫Øn
                </button>
                <button
                    class="btn-message-action"
                    id="sendOrderConfirmBtn"
                    style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    "
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
                >
                    <i class="fas fa-paper-plane"></i>
                    G·ª≠i l·∫°i tin ch·ªët ƒë∆°n
                </button>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar" id="statsBar" style="display: none">
                <div class="stats-item">
                    <div class="stats-value" id="totalOrdersCount">0</div>
                    <div class="stats-label">T·ªïng ƒë∆°n h√†ng</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="displayedOrdersCount">0</div>
                    <div class="stats-label">ƒêang hi·ªÉn th·ªã</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="totalAmountSum">0ƒë</div>
                    <div class="stats-label">T·ªïng gi√° tr·ªã</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="loadingProgress">0%</div>
                    <div class="stats-label">Ti·∫øn ƒë·ªô</div>
                </div>
            </div>
            <!-- Info Banner -->
            <div class="info-banner" id="infoBanner" style="display: none">
                <i class="fas fa-info-circle"></i>
                <span id="infoText"></span>
            </div>
            <!-- Search Section -->
            <div class="search-section" id="searchSection">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input
                        type="text"
                        class="search-input"
                        id="tableSearchInput"
                        placeholder="T√¨m ki·∫øm theo m√£ ƒêH, t√™n kh√°ch h√†ng, SƒêT, ƒë·ªãa ch·ªâ, ghi ch√∫, tr·∫°ng th√°i..."
                        autocomplete="off"
                    />
                    <button class="search-clear" id="searchClearBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="search-info">
                    <div>
                        <span class="search-result-count" id="searchResultCount"
                            >0</span
                        >
                        <span> k·∫øt qu·∫£</span>
                    </div>
                    <div class="search-tips">üí° G√µ ƒë·ªÉ t√¨m ki·∫øm nhanh</div>
                </div>
            </div>
            <!-- Table Container -->
            <div
                class="table-container"
                id="tableContainer"
                style="display: none"
            >
                <div class="table-wrapper" id="tableWrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" />
                                </th>
                                <th>STT</th>
                                <th>M√£ ƒêH</th>
                                <th>Kh√°ch h√†ng</th>
                                <th>Tin nh·∫Øn</th>
                                <th>SƒêT</th>
                                <th>ƒê·ªãa ch·ªâ</th>
                                <th>Ghi ch√∫</th>
                                <th>T·ªïng ti·ªÅn</th>
                                <th>SL</th>
                                <th>Ng√†y t·∫°o</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td
                                    colspan="13"
                                    style="text-align: center; padding: 40px"
                                >
                                    Vui l√≤ng ch·ªçn chi·∫øn d·ªãch v√† b·∫•m T√¨m ki·∫øm
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pagination Info -->
                <div class="pagination-wrapper">
                    <div id="pageInfo">Hi·ªÉn th·ªã 0 - 0 c·ªßa 0</div>
                    <div
                        style="color: #6b7280; font-size: 12px"
                        id="scrollHint"
                    ></div>
                </div>
            </div>
        </div>
        <!-- Tag Management Modal -->
        <div class="tag-modal" id="tagModal">
            <div class="tag-modal-content">
                <div class="tag-modal-header">
                    <h3><i class="fas fa-tags"></i> Qu·∫£n l√Ω Tag</h3>
                    <button class="tag-modal-close" onclick="closeTagModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="tag-modal-body">
                    <!-- Search -->
                    <div class="tag-search">
                        <div class="tag-search-wrapper">
                            <input
                                type="text"
                                id="tagSearchInput"
                                placeholder="T√¨m ki·∫øm tag..."
                                oninput="filterTags()"
                            />
                            <i class="fas fa-search tag-search-icon"></i>
                        </div>
                    </div>
                    <!-- Selected Tags -->
                    <div class="selected-tags">
                        <span class="selected-tags-label">ƒê√£ ch·ªçn:</span>
                        <div class="selected-tags-list" id="selectedTagsList">
                            <span style="color: #9ca3af; font-size: 12px">
                                Ch∆∞a c√≥ tag n√†o ƒë∆∞·ª£c ch·ªçn
                            </span>
                        </div>
                    </div>
                    <!-- Tag List -->
                    <div class="tag-list" id="tagList">
                        <div class="no-tags-message">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>ƒêang t·∫£i danh s√°ch tag...</p>
                        </div>
                    </div>
                </div>
                <div class="tag-modal-footer">
                    <button class="tag-btn-cancel" onclick="closeTagModal()">
                        H·ªßy
                    </button>
                    <button class="tag-btn-save" onclick="saveOrderTags()">
                        <i class="fas fa-save"></i> L∆∞u
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Messages Modal -->
        <div class="chat-modal" id="chatModal">
            <div class="chat-modal-content">
                <div class="chat-modal-header">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <i class="fab fa-facebook-messenger" style="color: #0084ff; font-size: 24px;"></i>
                        <div>
                            <h3 id="chatModalTitle">Tin nh·∫Øn</h3>
                            <p id="chatModalSubtitle" style="margin: 0; font-size: 12px; color: #6b7280;"></p>
                        </div>
                    </div>
                    <button class="chat-modal-close" onclick="closeChatModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="chat-modal-body" id="chatModalBody">
                    <div class="chat-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>ƒêang t·∫£i tin nh·∫Øn...</p>
                    </div>
                </div>
                <div class="chat-modal-footer">
                    <button class="chat-btn-close" onclick="closeChatModal()">
                        <i class="fas fa-times"></i> ƒê√≥ng
                    </button>
                    <button class="chat-btn-mark-read" id="chatMarkReadBtn" onclick="markChatAsRead()" style="display: none;">
                        <i class="fas fa-check"></i> ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc
                    </button>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="token-manager.js"></script>
        <script src="cache.js"></script>
        <script src="auth.js"></script>
        <script src="notification-system.js"></script>
        <script src="chat-data-manager.js"></script>
        <script src="message-template-manager.js"></script>
        <script src="product-search-manager.js"></script>
        <script src="search-functions.js"></script>
        <script src="tab1-orders.js"></script>
        
        <!-- Additional Script for Checkbox Handling -->
        <script>
            // Handle checkbox selection
            document.addEventListener('DOMContentLoaded', function() {
                const selectAllCheckbox = document.getElementById('selectAll');

                // Individual checkbox change
                document.addEventListener('change', function(e) {
                    if (e.target.matches('tbody input[type="checkbox"]')) {
                        // Call global updateActionButtons from tab1-orders.js
                        if (typeof updateActionButtons === 'function') {
                            updateActionButtons();
                        }

                        // Update select all checkbox state
                        const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
                        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                        const someChecked = Array.from(checkboxes).some(cb => cb.checked);

                        if (selectAllCheckbox) {
                            selectAllCheckbox.checked = allChecked;
                            selectAllCheckbox.indeterminate = someChecked && !allChecked;
                        }
                    }
                });
            });
        </script>

        <!-- Save Indicator -->
        <div class="save-indicator" id="saveIndicator">
            <i class="fas fa-check-circle"></i>
            <span id="saveIndicatorText">ƒê√£ l∆∞u th√†nh c√¥ng</span>
        </div>
    </body>
</html>

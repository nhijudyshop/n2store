<!--
  üìñ GHI CH√ö CHO L·∫¨P TR√åNH VI√äN:
  Khi code ph·∫£i ƒë·ªçc th∆∞ m·ª•c https://github.com/nhijudyshop/n2store/tree/main/docs tr∆∞·ªõc!
  ƒê·ªçc c√°c file SHARED_*.md ƒë·ªÉ hi·ªÉu c√°ch s·ª≠ d·ª•ng shared modules.
-->
<!doctype html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω ƒë∆°n h√†ng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="css/tab1-orders.css" />
    <link rel="stylesheet" href="css/message-template-modal.css" />
    <link rel="stylesheet" href="css/quick-reply-modal.css" />
    <!-- Extracted CSS files -->
    <link rel="stylesheet" href="css/tab1-filters.css" />
    <link rel="stylesheet" href="css/tab1-chat-modal.css" />
    <link rel="stylesheet" href="css/tab1-sale-modal.css" />
    <link rel="stylesheet" href="css/tab1-bill-settings.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="js/utils/decoding-utility.js"></script>
    <script src="js/core/api-handler.js"></script>
</head>

<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div style="
                    background: white;
                    padding: 32px;
                    border-radius: 12px;
                    text-align: center;
                ">
            <div class="loading-spinner" style="margin: 0 auto 16px"></div>
            <div class="loading-text" style="font-size: 14px; color: #6b7280">
                ƒêang t·∫£i d·ªØ li·ªáu...
            </div>
        </div>
    </div>
    <!-- Partner Status Modal -->
    <div id="partnerStatusModal" class="tag-modal">
        <div class="tag-modal-content" style="max-width: 400px;">
            <div class="tag-modal-header">
                <h3 style="margin: 0; font-size: 16px;">C·∫≠p nh·∫≠t tr·∫°ng th√°i</h3>
                <button class="tag-modal-close" onclick="closePartnerStatusModal()">√ó</button>
            </div>
            <div class="tag-modal-body">
                <div id="partnerStatusOptions" class="status-grid">
                    <!-- Options populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Order Status Modal -->
    <div id="orderStatusModal" class="tag-modal">
        <div class="tag-modal-content" style="max-width: 400px;">
            <div class="tag-modal-header">
                <h3 style="margin: 0; font-size: 16px;">C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng</h3>
                <button class="tag-modal-close" onclick="closeOrderStatusModal()">√ó</button>
            </div>
            <div class="tag-modal-body">
                <div id="orderStatusOptions" class="status-grid">
                    <!-- Options populated by JS -->
                </div>
            </div>
        </div>
    </div>
    <!-- Scroll to Top Button -->
    <button class="scroll-to-top" id="scrollToTopBtn">
        <i class="fas fa-arrow-up"></i>
    </button>
    <!-- Main Content -->
    <div class="main-content">
        <!-- Filter Toggle Button -->
        <div style="padding: 10px 20px 0 20px;">
            <button id="toggleControlBarBtn" class="btn-primary" onclick="toggleControlBar()"
                style="background: #6b7280; padding: 6px 12px; font-size: 13px;">
                <i class="fas fa-sliders-h"></i> Hi·ªÉn th·ªã b·ªô l·ªçc
            </button>
        </div>

        <!-- Filter Section -->
        <div class="filter-section" id="controlBar" style="display: none;">
            <!-- Stats Bar -->
            <div class="stats-bar" id="statsBar" style="display: flex; flex-basis: 100%; width: 100%; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e5e7eb;">
                <div class="stats-item" style="flex: 1; max-width: 300px;">
                    <div class="stats-label" style="margin-bottom: 8px; color: #667eea; font-weight: 600;">
                        <i class="fas fa-bullhorn"></i> Chi·∫øn D·ªãch
                    </div>
                    <div id="activeCampaignLabel"
                        style="width: 100%; padding: 8px 12px; border: 2px solid #8b5cf6; border-radius: 8px; font-size: 14px; font-weight: 600; text-align: center; background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); color: #7c3aed; cursor: pointer; transition: all 0.2s;"
                        onclick="openCampaignSettingsModal()"
                        title="Nh·∫•n ƒë·ªÉ thay ƒë·ªïi chi·∫øn d·ªãch">
                        <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...
                    </div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="totalOrdersCount">0</div>
                    <div class="stats-label">T·ªïng ƒë∆°n h√†ng</div>
                    <div class="stats-sublabel" id="mergedOrdersInfo"
                        style="font-size: 11px; color: #9ca3af; margin-top: 4px;">-</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="displayedOrdersCount">0</div>
                    <div class="stats-label">ƒêang hi·ªÉn th·ªã</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="totalAmountSum">0ƒë</div>
                    <div class="stats-label">T·ªïng gi√° tr·ªã</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="loadingProgress">0%</div>
                    <div class="stats-label">Ti·∫øn ƒë·ªô</div>
                </div>
            </div>

            <button class="btn-primary" id="employeeSettingsBtn" onclick="toggleEmployeeDrawer()"
                style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)"
                title="C√†i ƒë·∫∑t ph√¢n chia nh√¢n vi√™n">
                <i class="fas fa-users-cog"></i>
                C√†i ƒë·∫∑t ph√¢n chia nh√¢n vi√™n
            </button>
            <button class="btn-primary" id="campaignSettingsBtn" onclick="openCampaignSettingsModal()"
                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)"
                title="C√†i ƒë·∫∑t chi·∫øn d·ªãch, ng√†y t·∫£i, realtime, Pancake API">
                <i class="fas fa-bullhorn"></i>
                C√†i ƒê·∫∑t Chi·∫øn D·ªãch
            </button>
            <button class="btn-primary" id="clearCacheBtn" style="background: #ef4444">
                <i class="fas fa-trash"></i>
                X√≥a Cache
            </button>
            <button class="btn-primary" id="mergeProductsBtn" onclick="showMergeDuplicateOrdersModal()"
                style="background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)"
                title="G·ªôp s·∫£n ph·∫©m t·ª´ c√°c ƒë∆°n c√≥ c√πng SƒêT v√†o ƒë∆°n STT l·ªõn nh·∫•t">
                <i class="fas fa-compress-arrows-alt"></i>
                G·ªôp s·∫£n ph·∫©m ƒë∆°n tr√πng SƒêT
            </button>
            <button class="btn-primary" id="bulkTagModalBtn" onclick="showBulkTagModal()"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%)"
                title="G√°n tag h√†ng lo·∫°t cho nhi·ªÅu ƒë∆°n h√†ng">
                <i class="fas fa-tags"></i>
                G√°n Tag H√†ng Lo·∫°t
            </button>
            <button class="btn-primary" id="bulkTagDeleteModalBtn" onclick="showBulkTagDeleteModal()"
                style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"
                title="X√≥a tag h√†ng lo·∫°t kh·ªèi nhi·ªÅu ƒë∆°n h√†ng">
                <i class="fas fa-tags"></i>
                X√≥a Tag H√†ng Lo·∫°t
            </button>
            <button class="btn-primary" id="billTemplateSettingsBtn" onclick="openBillTemplateSettings()"
                style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"
                title="C√†i ƒë·∫∑t m·∫´u h√≥a ƒë∆°n/bill">
                <i class="fas fa-file-invoice"></i>
                C√†i ƒê·∫∑t Bill
            </button>

            <!-- Hidden elements - moved to Campaign Settings Modal -->
            <div style="display: none;">
                <select id="skipRangeFilter" style="min-width: 150px">
                    <option value="0" selected>3000 ƒë·∫ßu ti√™n</option>
                    <option value="3000">3000 ti·∫øp theo</option>
                    <option value="6000">3000 th·ª© 3</option>
                    <option value="9000">3000 th·ª© 4</option>
                    <option value="12000">3000 th·ª© 5</option>
                </select>
                <!-- Load Campaigns Button (event listener attached in JS) -->
                <button id="loadCampaignsBtn">T·∫£i Chi·∫øn D·ªãch</button>
                <select id="campaignFilter" style="min-width: 300px">
                    <option value="">ƒêang t·∫£i...</option>
                </select>
                <!-- Custom Date Filter Container (referenced in JS) -->
                <div id="customDateFilterContainer">
                    <input type="datetime-local" id="customStartDate" />
                    <input type="datetime-local" id="customEndDate" />
                </div>
                <input type="datetime-local" id="startDate" />
                <input type="datetime-local" id="endDate" />
                <!-- Realtime controls (hidden, controlled via modal) -->
                <input type="checkbox" id="realtimeToggleCheckbox" checked>
                <select id="realtimeModeSelect">
                    <option value="browser">Browser (Direct)</option>
                    <option value="server" selected>Server (24/7)</option>
                    <option value="localhost">Server (Localhost)</option>
                </select>
                <!-- Realtime mode container (referenced in JS) -->
                <div id="realtimeModeContainer"></div>
                <!-- Chat API toggle (hidden, controlled via modal) -->
                <button id="chatApiToggleBtn"></button>
                <span id="chatApiSourceLabel">Pancake API</span>
            </div>

        </div>

        <!-- Action Buttons Section (New) -->
        <div class="action-buttons-section" style="padding: 16px 24px; display: none; gap: 12px; flex-wrap: wrap;"
            id="actionButtonsSection">
            <div style="display: flex; gap: 8px; align-items: center;">
                <span style="color: #6b7280; font-size: 13px; font-weight: 500;">
                    <span id="selectedOrdersCount">0</span> ƒë∆°n ƒë∆∞·ª£c ch·ªçn
                </span>
            </div>

            <button class="btn-message-action" id="sendMessageBtn" onclick="openMessageTemplateModal()" style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    "
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                <i class="fab fa-facebook-messenger"></i>
                G·ª≠i tin nh·∫Øn
            </button>
            <button class="btn-message-action" id="sendOrderConfirmBtn" style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    "
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                <i class="fas fa-paper-plane"></i>
                G·ª≠i l·∫°i tin ch·ªët ƒë∆°n
            </button>
            <button class="btn-message-action" id="createSaleButtonBtn" onclick="openSaleButtonModal()" style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        display: none;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    "
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(245, 158, 11, 0.3)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                <i class="fas fa-shopping-cart"></i>
                T·∫°o n√∫t b√°n h√†ng
            </button>
            <button class="btn-message-action" id="createFastSaleBtn" onclick="showFastSaleModal()" style="
                        padding: 10px 20px;
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        display: none;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    "
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
                title="T·∫°o nhanh phi·∫øu b√°n h√†ng t·ª´ c√°c ƒë∆°n ƒë√£ ch·ªçn">
                <i class="fas fa-file-invoice-dollar"></i>
                T·∫°o nhanh PBH (F9)
            </button>
        </div>

        <!-- Info Banner -->
        <div class="info-banner" id="infoBanner" style="display: none">
            <i class="fas fa-info-circle"></i>
            <span id="infoText"></span>
        </div>
        <!-- Search Section -->
        <div class="search-section" id="searchSection">
            <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <div class="search-wrapper" style="flex: 1; max-width: 300px;">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="tableSearchInput"
                        placeholder="T√¨m ki·∫øm..."
                        autocomplete="off" />
                    <button class="search-clear" id="searchClearBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- TAG Filter with Search -->
                <div class="search-filter-dropdown" style="display: flex; align-items: center; gap: 6px; position: relative;">
                    <label style="font-size: 12px; font-weight: 500; color: #6b7280;">TAG:</label>
                    <div class="tag-filter-dropdown" id="tagFilterDropdown">
                        <div class="tag-filter-selected" onclick="toggleTagFilterDropdown()" id="tagFilterSelected">
                            <span id="tagFilterText">T·∫•t c·∫£</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="tag-filter-menu" id="tagFilterMenu">
                            <div class="tag-filter-search">
                                <i class="fas fa-search"></i>
                                <input type="text" id="tagFilterSearchInput" placeholder="T√¨m tag..." oninput="filterTagOptions()">
                            </div>
                            <div class="tag-filter-options" id="tagFilterOptions">
                                <!-- Options populated by JS -->
                            </div>
                        </div>
                        <input type="hidden" id="tagFilter" value="all">
                    </div>
                </div>

                <!-- Messages Filter -->
                <div class="search-filter-dropdown" style="display: flex; align-items: center; gap: 6px;">
                    <label style="font-size: 12px; font-weight: 500; color: #6b7280;">Tin nh·∫Øn:</label>
                    <select id="conversationFilter" onchange="performTableSearch()" class="search-filter-select">
                        <option value="all" selected>T·∫•t c·∫£</option>
                        <option value="unread">Ch∆∞a ƒë·ªçc</option>
                        <option value="read">ƒê√£ ƒë·ªçc</option>
                    </select>
                </div>

                <!-- Status Filter -->
                <div class="search-filter-dropdown" style="display: flex; align-items: center; gap: 6px;">
                    <label style="font-size: 12px; font-weight: 500; color: #6b7280;">Tr·∫°ng th√°i:</label>
                    <select id="statusFilter" onchange="performTableSearch()" class="search-filter-select">
                        <option value="all" selected>T·∫•t c·∫£</option>
                        <option value="Draft">Nh√°p</option>
                        <option value="Confirmed">ƒê∆°n h√†ng</option>
                    </select>
                </div>
            </div>
            <div class="search-info">
                <div>
                    <span class="search-result-count" id="searchResultCount">0</span>
                    <span> k·∫øt qu·∫£</span>
                </div>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="search-tips">üí° G√µ ƒë·ªÉ t√¨m ki·∫øm nhanh</div>
                    <button class="btn-primary" id="reloadTableBtn" onclick="reloadTableData()"
                        style="background: #10b981; padding: 6px 12px; font-size: 13px;">
                        <i class="fas fa-sync"></i> T·∫£i l·∫°i
                    </button>
                    <button class="btn-column-settings" id="columnSettingsBtn" onclick="openColumnSettingsModal()">
                        <i class="fas fa-columns"></i> C√†i ƒë·∫∑t c·ªôt
                    </button>
                </div>
            </div>
            <!-- Excluded Tags Display -->
            <div id="excludedTagsDisplay" style="display: none; padding: 8px 0; border-top: 1px solid #e5e7eb; margin-top: 8px;">
                <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                    <span style="font-size: 12px; color: #6b7280;">
                        <i class="fas fa-eye-slash" style="color: #ef4444;"></i> ƒêang ·∫©n:
                    </span>
                    <div id="excludedTagsDisplayList" style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <!-- Excluded tag names will be shown here -->
                    </div>
                    <button onclick="openColumnSettingsModal()" style="padding: 2px 8px; font-size: 11px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; cursor: pointer; color: #6b7280;">
                        <i class="fas fa-edit"></i> S·ª≠a
                    </button>
                </div>
            </div>
        </div>
        <!-- Table Container -->
        <div class="table-container" id="tableContainer" style="display: none">
            <div class="table-wrapper" id="tableWrapper">
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAll" />
                            </th>
                            <th data-column="actions">Thao t√°c</th>
                            <th data-column="stt">STT</th>
                            <th data-column="employee" style="width: 90px;">Nh√¢n vi√™n</th>
                            <th data-column="tag">TAG</th>
                            <th data-column="order-code">M√£ ƒêH</th>
                            <th data-column="customer">Kh√°ch h√†ng</th>
                            <th data-column="phone">SƒêT</th>
                            <th data-column="messages">Tin nh·∫Øn</th>
                            <th data-column="comments">B√¨nh lu·∫≠n</th>
                            <th data-column="qr" style="width: 50px; text-align: center;">QR</th>
                            <th data-column="address">ƒê·ªãa ch·ªâ</th>
                            <th data-column="notes">Ghi ch√∫</th>
                            <th data-column="total">T·ªïng ti·ªÅn</th>
                            <th data-column="quantity">SL</th>
                            <th data-column="created-date">Ng√†y t·∫°o</th>
                            <th data-column="status">Tr·∫°ng th√°i</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="17" style="text-align: center; padding: 40px">
                                Vui l√≤ng ch·ªçn chi·∫øn d·ªãch v√† b·∫•m T√¨m ki·∫øm
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Pagination Info -->
            <div class="pagination-wrapper">
                <div id="pageInfo">Hi·ªÉn th·ªã 0 - 0 c·ªßa 0</div>
                <div style="color: #6b7280; font-size: 12px" id="scrollHint"></div>
            </div>
        </div>
    </div>
    <!-- Tag Management Modal -->
    <div class="tag-modal" id="tagModal">
        <div class="tag-modal-content">
            <div class="tag-modal-header">
                <button class="tag-btn-save-header" onclick="saveOrderTags()">
                    L∆∞u (Ctrl + Enter)
                </button>
                <button class="tag-btn-refresh" onclick="openCreateTagModal()" title="T·∫°o tag m·ªõi"
                    style="margin-left: 8px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="tag-btn-refresh" onclick="refreshTags()" title="T·∫£i l·∫°i t·ª´ TPOS"
                    style="margin-left: 8px; padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    <i class="fas fa-sync"></i>
                </button>
                <button class="tag-modal-close" onclick="closeTagModal()">
                    X
                </button>
            </div>
            <div class="tag-modal-body">
                <!-- Add Tag Input with Selected Tags -->
                <div class="tag-input-container">
                    <div class="selected-tags-pills" id="selectedTagsPills">
                        <!-- Selected tags will be rendered here -->
                    </div>
                    <input type="text" id="tagSearchInput" class="tag-add-input" placeholder="Add a tag"
                        oninput="filterTags()" onkeydown="handleTagInputKeydown(event)" />
                </div>

                <!-- Available Tags List -->
                <div class="tag-dropdown-list" id="tagList">
                    <div class="no-tags-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>ƒêang t·∫£i danh s√°ch tag...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Tag Modal -->
    <div class="tag-modal" id="createTagModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 500px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-plus-circle"></i> T·∫°o tag m·ªõi</h3>
                <button class="tag-modal-close" onclick="closeCreateTagModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body">
                <div style="margin-bottom: 20px;">
                    <label
                        style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151;">
                        <i class="fas fa-tag"></i> T√™n tag:
                    </label>
                    <input type="text" id="newTagName" placeholder="Nh·∫≠p t√™n tag..."
                        style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;" />
                </div>
                <div style="margin-bottom: 20px;">
                    <label
                        style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151;">
                        <i class="fas fa-palette"></i> M√†u s·∫Øc:
                    </label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="color" id="newTagColor" value="#3b82f6"
                            style="width: 60px; height: 40px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;" />
                        <input type="text" id="newTagColorHex" value="#3b82f6" placeholder="#000000"
                            style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-family: monospace; font-size: 14px;"
                            oninput="updateColorPreview()" />
                        <div id="colorPreview"
                            style="width: 40px; height: 40px; border-radius: 6px; background: #3b82f6; border: 2px solid #d1d5db;">
                        </div>
                    </div>
                    <div style="margin-top: 12px;">
                        <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">M√†u g·ª£i √Ω:</div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <div onclick="selectPresetColor('#ef4444')"
                                style="width: 32px; height: 32px; background: #ef4444; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="ƒê·ªè"></div>
                            <div onclick="selectPresetColor('#f59e0b')"
                                style="width: 32px; height: 32px; background: #f59e0b; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="Cam"></div>
                            <div onclick="selectPresetColor('#eab308')"
                                style="width: 32px; height: 32px; background: #eab308; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="V√†ng"></div>
                            <div onclick="selectPresetColor('#22c55e')"
                                style="width: 32px; height: 32px; background: #22c55e; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="Xanh l√°"></div>
                            <div onclick="selectPresetColor('#10b981')"
                                style="width: 32px; height: 32px; background: #10b981; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="Xanh l√° ƒë·∫≠m"></div>
                            <div onclick="selectPresetColor('#06b6d4')"
                                style="width: 32px; height: 32px; background: #06b6d4; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="Cyan"></div>
                            <div onclick="selectPresetColor('#3b82f6')"
                                style="width: 32px; height: 32px; background: #3b82f6; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="Xanh d∆∞∆°ng"></div>
                            <div onclick="selectPresetColor('#6366f1')"
                                style="width: 32px; height: 32px; background: #6366f1; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="Indigo"></div>
                            <div onclick="selectPresetColor('#8b5cf6')"
                                style="width: 32px; height: 32px; background: #8b5cf6; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="T√≠m"></div>
                            <div onclick="selectPresetColor('#ec4899')"
                                style="width: 32px; height: 32px; background: #ec4899; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="H·ªìng"></div>
                            <div onclick="selectPresetColor('#f43f5e')"
                                style="width: 32px; height: 32px; background: #f43f5e; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="H·ªìng ƒë·∫≠m"></div>
                            <div onclick="selectPresetColor('#64748b')"
                                style="width: 32px; height: 32px; background: #64748b; border-radius: 4px; cursor: pointer; border: 2px solid transparent;"
                                title="X√°m"></div>
                        </div>
                    </div>
                </div>
                <div id="createTagStatus"
                    style="display: none; padding: 10px; border-radius: 6px; margin-bottom: 16px; font-size: 14px;">
                </div>
            </div>
            <div class="tag-modal-footer"
                style="display: flex; gap: 12px; padding: 16px; border-top: 1px solid #e5e7eb;">
                <button onclick="closeCreateTagModal()"
                    style="flex: 1; padding: 10px; background: #e5e7eb; color: #374151; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
                <button onclick="createNewTag()" id="createTagBtn"
                    style="flex: 1; padding: 10px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                    <i class="fas fa-check"></i> T·∫°o tag
                </button>
            </div>
        </div>
    </div>

    <!-- Tag Settings Modal -->
    <div class="tag-modal" id="tagSettingsModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 700px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-cog"></i> C√†i ƒë·∫∑t Tag</h3>
                <button class="tag-modal-close" onclick="closeTagSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body">
                <!-- Search -->
                <div class="tag-search">
                    <div class="tag-search-wrapper">
                        <input type="text" id="tagSettingsSearchInput" placeholder="T√¨m ki·∫øm tag..."
                            oninput="filterTagSettings()" />
                        <i class="fas fa-search tag-search-icon"></i>
                    </div>
                </div>

                <!-- Info -->
                <div
                    style="margin-bottom: 16px; padding: 12px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px;">
                    <div style="font-size: 13px; color: #1e40af;">
                        <i class="fas fa-info-circle"></i>
                        Nh·∫≠p ghi ch√∫ ho·∫∑c t√™n t√πy ch·ªânh cho m·ªói tag. Th√¥ng tin n√†y s·∫Ω ƒë∆∞·ª£c l∆∞u c·ª•c b·ªô.
                    </div>
                </div>

                <!-- Tag Settings List -->
                <div class="tag-settings-list" id="tagSettingsList" style="max-height: 400px; overflow-y: auto;">
                    <div class="no-tags-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>ƒêang t·∫£i danh s√°ch tag...</p>
                    </div>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button class="tag-btn-cancel" onclick="closeTagSettingsModal()">
                    ƒê√≥ng
                </button>
                <button class="tag-btn-save" onclick="saveTagSettings()">
                    <i class="fas fa-save"></i> L∆∞u
                </button>
            </div>
        </div>
    </div>

    <!-- Column Settings Modal -->
    <div class="column-settings-modal" id="columnSettingsModal">
        <div class="column-settings-modal-content">
            <div class="column-settings-modal-header">
                <h3><i class="fas fa-columns"></i> C√†i ƒë·∫∑t hi·ªÉn th·ªã c·ªôt</h3>
                <button class="column-settings-modal-close" onclick="closeColumnSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="column-settings-modal-body">
                <p style="color: #6b7280; font-size: 13px; margin-bottom: 16px;">
                    Ch·ªçn c√°c c·ªôt b·∫°n mu·ªën hi·ªÉn th·ªã trong b·∫£ng:
                </p>
                <div class="column-settings-list" id="columnSettingsList">
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="actions" checked />
                        <span>Thao t√°c</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="stt" checked />
                        <span>STT</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="employee" />
                        <span>Nh√¢n vi√™n</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="tag" checked />
                        <span>TAG</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="order-code" />
                        <span>M√£ ƒë∆°n h√†ng</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="customer" checked />
                        <span>Kh√°ch h√†ng</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="messages" checked />
                        <span>Tin nh·∫Øn</span>
                    </label>
                    <label class="column-setting-item" style="margin-left: 20px;">
                        <input type="checkbox" data-column="messagesContent" checked />
                        <span style="font-size: 12px; color: #6b7280;">‚Ü≥ Hi·ªÉn th·ªã n·ªôi dung tin nh·∫Øn</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="comments" checked />
                        <span>B√¨nh lu·∫≠n</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="phone" checked />
                        <span>S·ªë ƒëi·ªán tho·∫°i</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="qr" checked />
                        <span>M√£ QR</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="address" />
                        <span>ƒê·ªãa ch·ªâ</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="notes" />
                        <span>Ghi ch√∫</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="total" checked />
                        <span>T·ªïng ti·ªÅn</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="quantity" checked />
                        <span>S·ªë l∆∞·ª£ng</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="created-date" />
                        <span>Ng√†y t·∫°o</span>
                    </label>
                    <label class="column-setting-item">
                        <input type="checkbox" data-column="status" checked />
                        <span>Tr·∫°ng th√°i</span>
                    </label>
                </div>

                <!-- Excluded Tags Section -->
                <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                        <h4 style="margin: 0; font-size: 14px; font-weight: 600; color: #374151;">
                            <i class="fas fa-eye-slash" style="color: #ef4444; margin-right: 6px;"></i>
                            ·∫®n ƒë∆°n theo TAG
                        </h4>
                        <button onclick="clearExcludedTags()" style="padding: 4px 10px; font-size: 11px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 4px; cursor: pointer; color: #6b7280;">
                            <i class="fas fa-times"></i> B·ªè ch·ªçn t·∫•t c·∫£
                        </button>
                    </div>
                    <p style="color: #6b7280; font-size: 12px; margin-bottom: 12px;">
                        Ch·ªçn c√°c tag ƒë·ªÉ ·∫©n ƒë∆°n h√†ng c√≥ tag ƒë√≥:
                    </p>
                    <div class="excluded-tags-search" style="margin-bottom: 12px;">
                        <input type="text" id="excludedTagsSearchInput" placeholder="T√¨m tag..."
                            oninput="filterExcludedTagOptions()"
                            style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px;">
                    </div>
                    <div id="excludedTagsList" class="excluded-tags-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px;">
                        <div style="text-align: center; color: #9ca3af; padding: 12px;">
                            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i tags...
                        </div>
                    </div>
                    <div id="excludedTagsCount" style="margin-top: 8px; font-size: 12px; color: #6b7280;">
                        ƒêang ·∫©n: <span id="excludedTagsCountNumber">0</span> tag
                    </div>
                    <div id="excludedTagsNames" style="margin-top: 6px; display: flex; flex-wrap: wrap; gap: 4px;">
                        <!-- Selected tag names will be shown here -->
                    </div>
                </div>
            </div>
            <div class="column-settings-modal-footer">
                <button class="column-settings-btn-reset" onclick="resetColumnSettings()">
                    <i class="fas fa-undo"></i> ƒê·∫∑t l·∫°i m·∫∑c ƒë·ªãnh
                </button>
                <div style="display: flex; gap: 8px;">
                    <button class="column-settings-btn-cancel" onclick="closeColumnSettingsModal()">
                        H·ªßy
                    </button>
                    <button class="column-settings-btn-save" onclick="saveColumnSettings()">
                        <i class="fas fa-save"></i> L∆∞u
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Messages Modal -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-modal-content">
            <!-- Left Panel: Chat -->
            <div class="chat-left-panel">
                <div class="chat-modal-header"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 24px; border-bottom: none;">
                    <div class="chat-header-info" style="flex: 1;">
                        <h3 id="chatModalTitle"
                            style="color: white; font-size: 18px; font-weight: 600; margin: 0 0 4px 0;">Tin nh·∫Øn v·ªõi
                            Kh√°ch h√†ng</h3>
                        <p id="chatModalSubtitle" style="color: rgba(255, 255, 255, 0.9); font-size: 13px; margin: 0; display: flex; align-items: center; gap: 10px;">
                            <span id="chatModalSubtitleText">ƒêang t·∫£i...</span>
                            <span id="chatReadBadge"
                                style="padding: 4px 10px; border-radius: 12px; background: rgba(255, 255, 255, 0.2); font-size: 11px; font-weight: 600; display: none; border: 1px solid rgba(255, 255, 255, 0.3);">
                                <i class="fas fa-circle"></i> Ch∆∞a ƒë·ªçc
                            </span>
                            <span id="chatAdClickBadge"
                                style="padding: 4px 10px; border-radius: 12px; background: linear-gradient(135deg, #fbbf24, #f59e0b); font-size: 11px; font-weight: 600; display: none; color: #1e293b; border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 2px 8px rgba(251, 191, 36, 0.4);">
                                <i class="fas fa-ad"></i> T·ª´ qu·∫£ng c√°o
                            </span>
                        </p>
                        <!-- Conversation Type Toggle -->
                        <div id="conversationTypeToggle" style="display: flex; gap: 6px; margin-top: 10px;">
                            <button id="btnViewInbox" onclick="switchConversationType('INBOX')"
                                style="padding: 6px 14px; border: 2px solid rgba(255, 255, 255, 0.8); border-radius: 6px; background: rgba(255, 255, 255, 0.2); color: white; font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                                <i class="fab fa-facebook-messenger"></i> Tin nh·∫Øn
                            </button>
                            <button id="btnViewComment" onclick="switchConversationType('COMMENT')"
                                style="padding: 6px 14px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 6px; background: transparent; color: rgba(255, 255, 255, 0.7); font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                                <i class="fas fa-comment-dots"></i> B√¨nh lu·∫≠n
                            </button>
                        </div>
                    </div>
                    <!-- QR Buttons -->
                    <div class="chat-qr-buttons" id="chatQRButtons"
                        style="display: flex; gap: 6px; margin-right: 12px; align-items: center;">
                        <button id="btnMarkReadToggle" onclick="toggleConversationReadState()" title="ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc"
                            style="background: rgba(16, 185, 129, 0.8); border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; display: none; align-items: center; gap: 4px; color: white; font-size: 11px; font-weight: 600; transition: all 0.2s;"
                            onmouseover="this.style.opacity='0.9';" onmouseout="this.style.opacity='1';">
                            <i class="fas fa-envelope"></i>
                        </button>
                        <button onclick="toggleChatRightPanel()" title="M·ªü/ƒê√≥ng panel th√¥ng tin"
                            style="background: rgba(255, 255, 255, 0.2); border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 4px; color: white; font-size: 11px; font-weight: 600; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(255, 255, 255, 0.3)';" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)';">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <button id="qrAmountToggle" onclick="toggleQRAmountSetting()"
                            title="B·∫≠t/t·∫Øt hi·ªán s·ªë ti·ªÅn trong QR"
                            style="background: rgba(16, 185, 129, 0.8); border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 4px; color: white; font-size: 11px; font-weight: 600; transition: all 0.2s;"
                            onmouseover="this.style.opacity='0.9';" onmouseout="this.style.opacity='1';">
                            <i class="fas fa-dollar-sign"></i>
                        </button>
                        <button onclick="copyQRImageFromChat()" title="Copy ·∫£nh QR"
                            style="background: rgba(255, 255, 255, 0.2); border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px; color: white; font-size: 12px; font-weight: 500; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(255, 255, 255, 0.3)';"
                            onmouseout="this.style.background='rgba(255, 255, 255, 0.2)';">
                            <i class="fas fa-copy"></i> Copy QR
                        </button>
                        <button onclick="showQRFromChat()" title="Xem QR"
                            style="background: rgba(16, 185, 129, 0.8); border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px; color: white; font-size: 12px; font-weight: 500; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(16, 185, 129, 1)';"
                            onmouseout="this.style.background='rgba(16, 185, 129, 0.8)';">
                            <i class="fas fa-qrcode"></i> Xem QR
                        </button>
                    </div>
                    <!-- Debt Display -->
                    <div id="chatDebtDisplay"
                        style="display: flex; align-items: center; gap: 6px; margin-right: 12px; padding: 6px 12px; background: rgba(255, 255, 255, 0.15); border-radius: 8px;">
                        <i class="fas fa-wallet" style="color: rgba(255, 255, 255, 0.8); font-size: 12px;"></i>
                        <span style="color: rgba(255, 255, 255, 0.8); font-size: 11px;">C√¥ng n·ª£:</span>
                        <span id="chatDebtValue" style="color: white; font-weight: 600; font-size: 13px;">-</span>
                    </div>
                    <!-- Page Selector -->
                    <div class="chat-page-selector" id="chatPageSelector" style="margin-right: 12px;">
                        <select id="chatPageSelect" onchange="onChatPageChanged(this.value)"
                            style="padding: 8px 12px; border-radius: 8px; border: none; background: rgba(255, 255, 255, 0.2); color: white; font-size: 13px; font-weight: 500; cursor: pointer; min-width: 180px; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px; padding-right: 30px;">
                            <option value="">ƒêang t·∫£i pages...</option>
                        </select>
                    </div>
                    <!-- Conversation Selector (shown when multiple conversations found) -->
                    <div class="chat-conversation-selector" id="chatConversationSelector"
                        style="display: none; margin-right: 12px;">
                        <select id="chatConversationSelect" onchange="onChatConversationChanged(this.value)"
                            style="padding: 8px 12px; border-radius: 8px; border: none; background: rgba(236, 72, 153, 0.3); color: white; font-size: 13px; font-weight: 500; cursor: pointer; min-width: 200px; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px; padding-right: 30px;">
                            <option value="">Ch·ªçn cu·ªôc h·ªôi tho·∫°i...</option>
                        </select>
                    </div>
                    <button class="chat-modal-close" onclick="closeChatModal()"
                        style="background: rgba(255, 255, 255, 0.2); border: none; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(255, 255, 255, 0.3)';"
                        onmouseout="this.style.background='rgba(255, 255, 255, 0.2)';">
                        <i class="fas fa-times" style="color: white; font-size: 16px;"></i>
                    </button>
                </div>
                <div class="chat-modal-body" id="chatModalBody" style="position: relative;">
                    <div class="chat-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>ƒêang t·∫£i tin nh·∫Øn...</p>
                    </div>
                </div>
                <!-- Reply Input (ch·ªâ hi·ªÉn th·ªã cho comments) -->
                <div class="chat-reply-container" id="chatReplyContainer"
                    style="display: none; background: white; border-top: 1px solid #e5e7eb;">
                    <!-- Sending Status Bar (visible and centered) -->
                    <div id="chatSendingIndicator"
                        style="display: none; padding: 10px 16px; background: linear-gradient(135deg, rgba(0, 132, 255, 0.1) 0%, rgba(0, 132, 255, 0.05) 100%); border-bottom: 1px solid rgba(0, 132, 255, 0.2);">
                        <div style="display: flex; align-items: center; gap: 10px; justify-content: center;">
                            <i class="fas fa-spinner fa-spin" style="color: #0084ff; font-size: 14px;"></i>
                            <span id="chatSendingText" style="color: #0084ff; font-weight: 600; font-size: 13px;">ƒêang
                                g·ª≠i...</span>
                            <span id="chatQueueCount"
                                style="display: none; background: rgba(0, 132, 255, 0.2); color: #0084ff; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 700;"></span>
                        </div>
                    </div>
                    <!-- Reply Preview Container -->
                    <div id="chatReplyPreviewContainer"
                        style="display: none; padding: 8px 16px; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: start; gap: 8px;">
                            <div style="flex: 1;">
                                <div style="font-size: 11px; color: #6b7280; margin-bottom: 2px; font-weight: 600;">
                                    <i class="fas fa-reply" style="margin-right: 4px;"></i>ƒêang tr·∫£ l·ªùi
                                </div>
                                <div id="chatReplyPreviewText"
                                    style="font-size: 12px; color: #374151; max-height: 40px; overflow: hidden; text-overflow: ellipsis;">
                                </div>
                            </div>
                            <button onclick="cancelReply()"
                                style="background: none; border: none; color: #6b7280; cursor: pointer; padding: 4px; border-radius: 4px; transition: all 0.2s;"
                                onmouseover="this.style.background='#e5e7eb';"
                                onmouseout="this.style.background='none';">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Image Preview Container -->
                    <div id="chatImagePreviewContainer"
                        style="display: none; padding: 8px 16px; border-bottom: 1px solid #f0f0f0;"></div>
                    <!-- Message Reply Type Toggle (only for message modal when order has comment) -->
                    <div id="messageReplyTypeToggle"
                        style="display: none; padding: 8px 16px; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                        <div style="display: flex; gap: 8px;">
                            <button id="btnMsgReplyInbox" onclick="setMessageReplyType('reply_inbox')"
                                style="flex: 1; padding: 8px 12px; border: 2px solid #3b82f6; border-radius: 8px; background: #eff6ff; color: #1d4ed8; font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s;">
                                <i class="fab fa-facebook-messenger"></i> Messenger
                            </button>
                            <button id="btnMsgPrivateReply" onclick="setMessageReplyType('private_replies')"
                                style="flex: 1; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; color: #6b7280; font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s;">
                                <i class="fas fa-comment-dots"></i> Reply t·ª´ comment
                            </button>
                        </div>
                        <p id="msgReplyTypeHint"
                            style="font-size: 11px; color: #6b7280; margin: 6px 0 0 0; text-align: center;">
                            G·ª≠i tin nh·∫Øn qua Messenger
                        </p>
                    </div>
                    <!-- Input Row -->
                    <div style="display: flex; gap: 8px; align-items: flex-end; padding: 8px 16px;">
                        <textarea id="chatReplyInput" placeholder="Nh·∫≠p tin nh·∫Øn tr·∫£ l·ªùi... (Shift+Enter ƒë·ªÉ xu·ªëng d√≤ng)"
                            rows="1"
                            style="flex: 1; min-width: 0; width: 0; padding: 10px 14px; border: 1px solid #e5e7eb; border-radius: 20px; font-size: 14px; background: #f9fafb; transition: all 0.2s; resize: none; overflow-y: auto; overflow-x: hidden; max-height: 120px; font-family: inherit; line-height: 1.5; word-wrap: break-word; word-break: break-word;"
                            onfocus="this.style.borderColor='#667eea'; this.style.background='white';"
                            onblur="this.style.borderColor='#e5e7eb'; this.style.background='#f9fafb';"></textarea>
                        <button class="chat-btn-send" id="chatSendBtn" onclick="sendReplyComment()"
                            style="padding: 10px 24px; background: linear-gradient(135deg, #0084ff 0%, #0066cc 100%); color: white; border: none; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0, 132, 255, 0.3);"
                            onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(0, 132, 255, 0.4)';"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0, 132, 255, 0.3)';">
                            <i class="fas fa-paper-plane"></i>
                            G·ª≠i
                        </button>
                    </div>

                    <!-- Toolbar Row -->
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; padding: 4px 16px 0 16px; border-top: 1px solid #f3f4f6;">
                        <!-- Send Page Selector -->
                        <div style="display: flex; align-items: center; gap: 6px; flex: 1;">
                            <label style="font-size: 12px; color: #6b7280; white-space: nowrap;">
                                <i class="fas fa-paper-plane" style="margin-right: 4px;"></i>G·ª≠i t·ª´:
                            </label>
                            <select id="chatSendPageSelect" onchange="onSendPageChanged(this.value)"
                                style="padding: 6px 10px; border-radius: 6px; border: 1px solid #e5e7eb; background: white; color: #374151; font-size: 12px; cursor: pointer; min-width: 150px; max-width: 200px;">
                                <option value="">ƒêang t·∫£i...</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <!-- Edit Order Icon (Shortcut) -->
                            <button class="toolbar-icon-btn" title="S·ª≠a ƒë∆°n h√†ng" onclick="openEditModal(currentChatOrderId)"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z">
                                    </path>
                                </svg>
                            </button>

                            <!-- Live Comments History Icon -->
                            <button class="toolbar-icon-btn" title="L·ªãch s·ª≠ b√¨nh lu·∫≠n Live" onclick="openLiveCommentsModal()"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z">
                                    </path>
                                </svg>
                            </button>

                            <!-- Copy Template Icon -->
                            <button class="toolbar-icon-btn" title="Copy m·∫´u ch·ªët ƒë∆°n" onclick="copyOrderTemplate()"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z">
                                    </path>
                                </svg>
                            </button>

                            <!-- Help Icon -->
                            <button class="toolbar-icon-btn" title="Tr·ª£ gi√∫p"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,168a12,12,0,1,1,12-12A12,12,0,0,1,128,192Zm8-48.72V144a8,8,0,0,1-16,0v-8a8,8,0,0,1,8-8c13.23,0,24-9,24-20s-10.77-20-24-20-24,9-24,20v4a8,8,0,0,1-16,0v-4c0-19.85,17.94-36,40-36s40,16.15,40,36C168,125.38,154.24,139.93,136,143.28Z">
                                    </path>
                                </svg>
                            </button>

                            <!-- Message Template Icon -->
                            <button class="toolbar-icon-btn" title="Tin nh·∫Øn m·∫´u" onclick="openChatTemplateModal()"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M128,24A104,104,0,0,0,36.18,176.88L24.83,210.93a16,16,0,0,0,20.24,20.24l34.05-11.35A104,104,0,1,0,128,24Zm32,128H96a8,8,0,0,1,0-16h64a8,8,0,0,1,0,16Zm0-32H96a8,8,0,0,1,0-16h64a8,8,0,0,1,0,16Z">
                                    </path>
                                </svg>
                            </button>
                        </div>

                        <div style="display: flex; gap: 4px; align-items: center;">
                            <!-- Photo Icon -->
                            <button class="toolbar-icon-btn" title="H√¨nh ·∫£nh"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M216,40H72A16,16,0,0,0,56,56V72H40A16,16,0,0,0,24,88V200a16,16,0,0,0,16,16H184a16,16,0,0,0,16-16V184h16a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM172,72a12,12,0,1,1-12,12A12,12,0,0,1,172,72Zm12,128H40V88H56v80a16,16,0,0,0,16,16H184Zm32-32H72V120.69l30.34-30.35a8,8,0,0,1,11.32,0L163.31,140,189,114.34a8,8,0,0,1,11.31,0L216,130.07V168Z">
                                    </path>
                                </svg>
                            </button>

                            <!-- File Attachment Icon -->
                            <button class="toolbar-icon-btn" title="T·ªáp ƒë√≠nh k√®m"
                                onclick="document.getElementById('uploadFileInput').click();"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M209.66,122.34a8,8,0,0,1,0,11.32l-82.05,82a56,56,0,0,1-79.2-79.21L147.67,35.73a40,40,0,1,1,56.61,56.55L105,193A24,24,0,1,1,71,159L154.3,74.38A8,8,0,1,1,165.7,85.6L82.39,170.31a8,8,0,1,0,11.27,11.36L192.93,81A24,24,0,1,0,159,47L59.76,147.68a40,40,0,1,0,56.53,56.62l82.06-82A8,8,0,0,1,209.66,122.34Z">
                                    </path>
                                </svg>
                            </button>
                            <input id="uploadFileInput" type="file" multiple=""
                                accept="video/*, audio/*, .docx, .doc, .xlsx, .xls, .pdf, .csv, .gif, .text, .pptx, .ppt, image/*"
                                style="display: none;">

                            <!-- Sticker Icon -->
                            <button class="toolbar-icon-btn" title="Sticker" onclick="openStickerPickerModal()"
                                style="background: none; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280;"
                                onmouseover="this.style.background='#f3f4f6';"
                                onmouseout="this.style.background='none';">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                    viewBox="0 0 256 256">
                                    <path
                                        d="M168,32H88A56.06,56.06,0,0,0,32,88v80a56.06,56.06,0,0,0,56,56h48a8.07,8.07,0,0,0,2.53-.41c26.23-8.75,76.31-58.83,85.06-85.06A8.07,8.07,0,0,0,224,136V88A56.06,56.06,0,0,0,168,32ZM136,207.42V176a40,40,0,0,1,40-40h31.42C198.16,157.55,157.55,198.16,136,207.42Z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Orders -->
            <div class="chat-right-panel collapsed" style="position: relative;">

                <!-- Toggle Button -->
                <button class="chat-panel-toggle-btn" onclick="toggleChatRightPanel()" title="M·ªü/ƒê√≥ng panel th√¥ng tin">
                    <i class="fas fa-chevron-left" id="chatPanelToggleIcon"></i>
                </button>

                <!-- Tabs Header -->
                <div class="chat-panel-tabs" style="
                    display: flex;
                    background: white;
                    border-bottom: 1px solid #e2e8f0;
                ">
                    <button class="chat-tab-btn active" data-tab="orders" onclick="switchChatPanelTab('orders')" style="
                        flex: 1;
                        padding: 14px 16px;
                        border: none;
                        background: white;
                        color: #3b82f6;
                        font-size: 13px;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 6px;
                        border-bottom: 2px solid #3b82f6;
                        transition: all 0.2s;
                    ">
                        <i class="fas fa-shopping-cart"></i>
                        ƒê∆°n h√†ng
                        <span id="chatOrdersCountBadge"
                            style="background: #eff6ff; color: #3b82f6; padding: 2px 8px; border-radius: 10px; font-size: 11px;">0</span>
                    </button>
                    <button class="chat-tab-btn" data-tab="dropped" onclick="switchChatPanelTab('dropped')" style="
                        flex: 1;
                        padding: 14px 16px;
                        border: none;
                        background: #f8fafc;
                        color: #64748b;
                        font-size: 13px;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 6px;
                        border-bottom: 2px solid transparent;
                        transition: all 0.2s;
                    ">
                        <i class="fas fa-box-open"></i>
                        H√†ng r·ªõt - x·∫£
                        <span id="chatDroppedCountBadge"
                            style="background: #fef2f2; color: #ef4444; padding: 2px 8px; border-radius: 10px; font-size: 11px;">0</span>
                    </button>
                    <button class="chat-tab-btn" data-tab="history" onclick="switchChatPanelTab('history')" style="
                        flex: 1;
                        padding: 14px 16px;
                        border: none;
                        background: #f8fafc;
                        color: #64748b;
                        font-size: 13px;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 6px;
                        border-bottom: 2px solid transparent;
                        transition: all 0.2s;
                    ">
                        <i class="fas fa-history"></i>
                        L·ªãch s·ª≠
                    </button>
                    <button class="chat-tab-btn" data-tab="invoice_history"
                        onclick="switchChatPanelTab('invoice_history')" style="
                        flex: 1;
                        padding: 14px 16px;
                        border: none;
                        background: #f8fafc;
                        color: #64748b;
                        font-size: 13px;
                        font-weight: 600;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 6px;
                        border-bottom: 2px solid transparent;
                        transition: all 0.2s;
                    ">
                        <i class="fas fa-file-invoice-dollar"></i>
                        H√≥a ƒë∆°n
                    </button>
                </div>

                <!-- Tab Content: Orders -->
                <div id="chatTabOrders" class="chat-tab-content"
                    style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                    <!-- Product Search -->
                    <div class="chat-product-search-inline"
                        style="padding: 16px; background: white; border-bottom: 1px solid #e2e8f0;">
                        <div class="chat-search-input-wrapper" style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 14px;"></i>
                            <input type="text" id="chatInlineProductSearch"
                                placeholder="T√¨m s·∫£n ph·∫©m theo t√™n ho·∫∑c m√£..." autocomplete="off"
                                style="width: 100%; padding: 10px 12px 10px 36px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; transition: all 0.2s; background: #f8fafc;"
                                onfocus="this.style.borderColor='#3b82f6'; this.style.background='white';"
                                onblur="this.style.borderColor='#cbd5e1'; this.style.background='#f8fafc';">
                        </div>
                        <div id="chatInlineSearchResults" class="chat-inline-search-results"
                            style="display: none; margin-top: 8px; max-height: 300px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px; background: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                        </div>
                    </div>

                    <!-- Products Table Container -->
                    <div style="flex: 1; overflow-y: auto; background: white;">
                        <!-- Danh s√°ch s·∫£n ph·∫©m ƒë∆°n h√†ng c·ªßa tin nh·∫Øn, b√¨nh lu·∫≠n -->
                        <div id="chatProductsTableContainer" style="padding: 16px;">
                            <!-- Empty State -->
                            <div class="chat-empty-products"
                                style="text-align: center; padding: 40px 20px; color: #94a3b8;">
                                <i class="fas fa-box-open"
                                    style="font-size: 40px; margin-bottom: 12px; opacity: 0.5;"></i>
                                <p style="font-size: 14px; margin: 0;">Ch∆∞a c√≥ s·∫£n ph·∫©m</p>
                                <p style="font-size: 12px; margin-top: 4px;">T√¨m ki·∫øm ƒë·ªÉ th√™m s·∫£n ph·∫©m v√†o ƒë∆°n</p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="chat-panel-footer" style="
                        padding: 16px;
                        background: white;
                        border-top: 1px solid #e2e8f0;
                        box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
                    ">
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 16px;
                        ">
                            <span style="font-size: 14px; color: #64748b;">T·ªïng ti·ªÅn:</span>
                            <span id="chatProductTotal"
                                style="font-size: 18px; font-weight: 700; color: #3b82f6;">0ƒë</span>
                        </div>
                        <div style="font-size: 12px; color: #94a3b8; text-align: center;">
                            <span id="productCount">0</span> s·∫£n ph·∫©m
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Dropped Items -->
                <div id="chatTabDropped" class="chat-tab-content"
                    style="flex: 1; display: none; flex-direction: column; overflow: hidden;">
                    <!-- Search for dropped items -->
                    <div class="chat-product-search-inline"
                        style="padding: 16px; background: white; border-bottom: 1px solid #e2e8f0;">
                        <div class="chat-search-input-wrapper" style="position: relative;">
                            <i class="fas fa-search"
                                style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 14px;"></i>
                            <input type="text" id="chatDroppedProductSearch"
                                placeholder="T√¨m s·∫£n ph·∫©m trong h√†ng r·ªõt - x·∫£..." autocomplete="off"
                                style="width: 100%; padding: 10px 12px 10px 36px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; transition: all 0.2s; background: #f8fafc;"
                                onfocus="this.style.borderColor='#ef4444'; this.style.background='white';"
                                onblur="this.style.borderColor='#cbd5e1'; this.style.background='#f8fafc';"
                                oninput="filterDroppedProducts(this.value)">
                        </div>
                    </div>

                    <!-- Dropped Products Table Container -->
                    <div style="flex: 1; overflow-y: auto; background: white;">
                        <div id="chatDroppedProductsContainer" style="padding: 16px;">
                            <div class="chat-empty-products"
                                style="text-align: center; padding: 40px 20px; color: #94a3b8;">
                                <i class="fas fa-box-open"
                                    style="font-size: 40px; margin-bottom: 12px; opacity: 0.5;"></i>
                                <p style="font-size: 14px; margin: 0;">Ch∆∞a c√≥ h√†ng r·ªõt - x·∫£</p>
                                <p style="font-size: 12px; margin-top: 4px;">S·∫£n ph·∫©m b·ªã x√≥a ho·∫∑c gi·∫£m s·ªë l∆∞·ª£ng s·∫Ω hi·ªÉn
                                    th·ªã ·ªü ƒë√¢y</p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer for Dropped -->
                    <div class="chat-panel-footer" style="
                        padding: 16px;
                        background: white;
                        border-top: 1px solid #e2e8f0;
                        box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
                    ">
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 16px;
                        ">
                            <span style="font-size: 14px; color: #64748b;">T·ªïng gi√° tr·ªã:</span>
                            <span id="chatDroppedTotal"
                                style="font-size: 18px; font-weight: 700; color: #ef4444;">0ƒë</span>
                        </div>
                        <div style="font-size: 12px; color: #94a3b8; text-align: center;">
                            <span id="droppedProductCount">0</span> s·∫£n ph·∫©m r·ªõt - x·∫£
                        </div>
                    </div>
                </div>

                <!-- Tab Content: History -->
                <div id="chatTabHistory" class="chat-tab-content"
                    style="flex: 1; display: none; flex-direction: column; overflow: hidden;">
                    <!-- History Container -->
                    <div style="flex: 1; overflow-y: auto; background: white;">
                        <div id="chatHistoryContainer" style="padding: 16px;">
                            <div class="chat-empty-products"
                                style="text-align: center; padding: 40px 20px; color: #94a3b8;">
                                <i class="fas fa-history"
                                    style="font-size: 40px; margin-bottom: 12px; opacity: 0.5;"></i>
                                <p style="font-size: 14px; margin: 0;">Ch∆∞a c√≥ l·ªãch s·ª≠</p>
                                <p style="font-size: 12px; margin-top: 4px;">C√°c thao t√°c s·∫Ω ƒë∆∞·ª£c ghi l·∫°i ·ªü ƒë√¢y</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Invoice History -->
                <div id="chatTabInvoiceHistory" class="chat-tab-content"
                    style="flex: 1; display: none; flex-direction: column; overflow: hidden;">
                    <!-- Invoice History Container -->
                    <div style="flex: 1; overflow-y: auto; background: white;">
                        <div id="chatInvoiceHistoryContainer" style="padding: 16px;">
                            <div class="chat-empty-products"
                                style="text-align: center; padding: 40px 20px; color: #94a3b8;">
                                <i class="fas fa-file-invoice-dollar"
                                    style="font-size: 40px; margin-bottom: 12px; opacity: 0.5;"></i>
                                <p style="font-size: 14px; margin: 0;">Ch∆∞a c√≥ l·ªãch s·ª≠ h√≥a ƒë∆°n</p>
                                <p style="font-size: 12px; margin-top: 4px;">Danh s√°ch h√≥a ƒë∆°n s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


        </div>
    </div>
    </div>

    <!-- Scripts -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Configuration (SHARED - initialize Firebase immediately after SDK) -->
    <script src="../shared/js/firebase-config.js"></script>
    <script>
        // Initialize Firebase immediately
        if (typeof initializeFirestore === 'function') {
            const db = initializeFirestore();
            const rtdb = initializeRealtimeDB();
            window.database = rtdb; // Alias for compatibility
            console.log('[TAB1] Firebase initialized via shared config');
        }
    </script>

    <!-- API Configuration (load first!) -->
    <script src="js/core/api-config.js"></script>

    <!-- Firebase Configuration (local fallback - must load before firebase-image-cache.js) -->
    <script src="js/core/config.js"></script>

    <!-- User Employee Loader -->
    <script src="js/core/user-employee-loader.js"></script>

    <script src="js/core/token-manager.js"></script>
    <!-- IndexedDB Storage for large data (replaces localStorage for caches) -->
    <script src="js/core/indexeddb-storage.js"></script>
    <script src="js/core/cache.js"></script>
    <!-- ES Module: Shared utilities (auto-initializes authManager, notificationManager) -->
    <script type="module" src="../shared/esm/compat.js"></script>

    <!-- Fallback for file:// protocol -->
    <script>
        if (window.location.protocol === 'file:') {
            document.write('<script src="../shared/js/shared-auth-manager.js"><\/script>');
            document.write('<script>window.authManager=new AuthManager({redirectUrl:"../index.html",sessionDuration:8*60*60*1000,rememberDuration:30*24*60*60*1000});<\/script>');
            document.write('<script src="../shared/js/notification-system.js"><\/script>');
        }
    </script>

    <script>
        // Auth helper functions (authManager is auto-initialized by compat.js)
        function getAuthState() { return window.authManager?.getAuthData(); }
        function isAuthenticated() { return window.authManager?.isAuthenticated(); }
        function hasPermission(level) { return window.authManager?.hasPermission(level); }
        function getUserName() {
            const auth = getAuthState();
            return auth?.userType ? auth.userType.split('-')[0] : 'Admin';
        }
        function handleLogout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                sessionStorage.removeItem('loginindex_auth');
                localStorage.removeItem('loginindex_auth');
                window.location.href = '../index.html';
            }
        }
    </script>
    <!-- Note: notification-system.js is loaded by compat.js ES Module -->
    <script src="js/managers/pancake-token-manager.js"></script>
    <script src="js/managers/pancake-data-manager.js"></script>
    <script src="js/utils/firebase-image-cache.js"></script>
    <!-- html2canvas for image generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="js/utils/order-image-generator.js"></script>
    <script src="js/chat/message-template-manager.js"></script>
    <script src="js/utils/copy-template-helper.js"></script>
    <script src="js/chat/live-comments-readonly-modal.js"></script>

    <script src="js/chat/quick-reply-manager.js"></script>
    <script src="js/managers/product-search-manager.js"></script>
    <!-- <script src="js/managers/dropped-products-manager.js"></script> --> <!-- TEMPORARILY DISABLED -->
    <script src="js/managers/held-products-manager.js"></script>
    <script src="js/managers/kpi-manager.js"></script>
    <script src="js/utils/search-functions.js"></script>
    <script src="js/managers/column-visibility-manager.js"></script>
    <script src="js/managers/realtime-manager.js"></script>
    <script src="js/chat/new-messages-notifier.js"></script>
    <script src="js/utils/debug-realtime.js"></script>
    <!-- ‚≠ê Image Compressor for Pancake API (500KB limit) -->
    <script src="js/utils/image-compressor.js"></script>
    <!-- ‚≠ê Bill Service for custom bill generation, printing and sending -->
    <script src="js/utils/bill-service.js"></script>
    <!-- ‚≠ê Customer 360¬∞ Wallet Integration - Phase 5 -->
    <script src="js/utils/wallet-integration.js"></script>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- ‚≠ê TAB1 ORDERS - MODULAR ARCHITECTURE (17 files, 445 functions)          -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- 1. Core: Global state, formatTimeVN, cache (lines 1-278) -->
    <script src="js/tab1/tab1-core.js"></script>

    <!-- 2. Firebase: Tag sync, KPI, filter prefs (lines 279-749) -->
    <script src="js/tab1/tab1-firebase.js"></script>

    <!-- 3. Init: DOMContentLoaded, app initialization (lines 750-1385) -->
    <script src="js/tab1/tab1-init.js"></script>

    <!-- 4. Employee: Employee range management (lines 1386-1775) -->
    <script src="js/tab1/tab1-employee.js"></script>

    <!-- 5. Tags: Single tag operations (lines 1776-2854) -->
    <script src="js/tab1/tab1-tags.js"></script>

    <!-- 6. Bulk Tags: Bulk tag add/delete (lines 2855-5240) -->
    <script src="js/tab1/tab1-bulk-tags.js"></script>

    <!-- 7. Search: Table search, campaign loading (lines 5241-6814) -->
    <script src="js/tab1/tab1-search.js"></script>

    <!-- 8. Table: Rendering, sorting, row creation (lines 6815-8392) -->
    <script src="js/tab1/tab1-table.js"></script>

    <!-- 9. Edit Modal: Order editing, inline search (lines 8393-10015) -->
    <script src="js/tab1/tab1-edit-modal.js"></script>

    <!-- 10. Chat: Messaging, comments, realtime (lines 10016-16370) -->
    <script src="js/tab1/tab1-chat.js"></script>

    <!-- 11. Encoding: Note encoding/decoding (lines 16371-17195) -->
    <script src="js/tab1/tab1-encoding.js"></script>

    <!-- 12. Chat Products: Quick add, chat products panel (lines 17196-19144) -->
    <script src="js/tab1/tab1-chat-products.js"></script>

    <!-- 13. Merge: Order merge functions (lines 19145-20743) -->
    <script src="js/tab1/tab1-merge.js"></script>

    <!-- 14. Address & Stats: Address lookup, product stats (lines 20744-22045) -->
    <script src="js/tab1/tab1-address-stats.js"></script>

    <!-- 15. QR & Debt: QR code, VietQR, debt management (lines 22046-23805) -->
    <script src="js/tab1/tab1-qr-debt.js"></script>

    <!-- 16. Sale: Sale modal, carriers (lines 23806-24974) -->
    <script src="js/tab1/tab1-sale.js"></script>

    <!-- 17. Fast Sale: Fast sale modal, bill settings (lines 24975-26905) -->
    <script src="js/tab1/tab1-fast-sale.js"></script>

    <!-- 17b. Fast Sale Invoice Status: StateCode column, manual bill send -->
    <script src="js/tab1/tab1-fast-sale-invoice-status.js"></script>

    <!-- Legacy file (backup - comment out when using modular) -->
    <!-- <script src="js/tab1/tab1-orders.js"></script> -->
    <!-- Chat Products UI & Actions - separated for easier management -->
    <script src="js/chat/chat-products-ui.js"></script>
    <script src="js/chat/chat-products-actions.js"></script>
    <script src="js/chat/comment-modal.js"></script>

    <!-- Extracted JS files (formerly inline) -->
    <script src="js/tab1/tab1-checkbox.js"></script>

    <!-- Save Indicator -->
    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-check-circle"></i>
        <span id="saveIndicatorText">ƒê√£ l∆∞u th√†nh c√¥ng</span>
    </div>

    <!-- Comment Modal (Separate from Chat Modal) -->
    <div class="comment-modal" id="commentModal">
        <div class="comment-modal-content">
            <!-- Header -->
            <div class="comment-modal-header">
                <div class="comment-header-info">
                    <h3 id="commentModalTitle">B√¨nh lu·∫≠n v·ªõi Kh√°ch h√†ng</h3>
                    <p id="commentModalSubtitle">ƒêang t·∫£i...</p>
                </div>
                <button class="comment-modal-close" onclick="closeCommentModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Body - Comments List -->
            <div class="comment-modal-body" id="commentModalBody">
                <div class="chat-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>ƒêang t·∫£i b√¨nh lu·∫≠n...</p>
                </div>
            </div>

            <!-- Reply Container -->
            <div class="comment-reply-container" id="commentReplyContainer">
                <!-- Reply Preview -->
                <div id="commentReplyPreviewContainer"
                    style="display: none; padding: 8px 16px; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; align-items: start; gap: 8px;">
                        <div style="flex: 1;">
                            <div style="font-size: 11px; color: #6b7280; margin-bottom: 2px; font-weight: 600;">
                                <i class="fas fa-reply" style="margin-right: 4px;"></i>ƒêang tr·∫£ l·ªùi
                            </div>
                            <div id="commentReplyPreviewText"
                                style="font-size: 12px; color: #374151; max-height: 40px; overflow: hidden; text-overflow: ellipsis;">
                            </div>
                        </div>
                        <button onclick="cancelCommentReply()"
                            style="background: none; border: none; color: #6b7280; cursor: pointer; padding: 4px; border-radius: 4px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Reply Type Toggle -->
                    <div id="commentReplyTypeToggle" style="display: flex; gap: 8px; margin-top: 8px;">
                        <button id="btnReplyPublic" onclick="setCommentReplyType('reply_comment')"
                            style="flex: 1; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; font-size: 12px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s; color: #374151;">
                            <i class="fas fa-comment"></i> Reply c√¥ng khai
                        </button>
                        <button id="btnReplyPrivate" onclick="setCommentReplyType('private_replies')"
                            style="flex: 1; padding: 8px 12px; border: 2px solid #3b82f6; border-radius: 8px; background: #eff6ff; color: #3b82f6; cursor: pointer; font-size: 12px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.2s;">
                            <i class="fas fa-envelope"></i> Tin nh·∫Øn ri√™ng
                        </button>
                    </div>
                </div>

                <!-- Input Row -->
                <div style="display: flex; gap: 8px; align-items: flex-end; padding: 12px 16px;">
                    <textarea id="commentReplyInput" placeholder="Ch·ªçn 'Tr·∫£ l·ªùi' m·ªôt b√¨nh lu·∫≠n ƒë·ªÉ reply..." rows="1"
                        disabled
                        style="flex: 1; padding: 10px 14px; border: 1px solid #e5e7eb; border-radius: 20px; font-size: 14px; background: #f3f4f6; resize: none; max-height: 120px; font-family: inherit; line-height: 1.5; cursor: not-allowed;"></textarea>
                    <button class="comment-btn-send" id="commentSendBtn" onclick="sendCommentReply()" disabled
                        style="padding: 10px 24px; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; border: none; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: not-allowed; display: flex; align-items: center; gap: 6px; opacity: 0.5;">
                        <i class="fas fa-paper-plane"></i>
                        G·ª≠i
                    </button>
                </div>
            </div>

            <!-- Footer -->
            <div class="comment-modal-footer">
                <button class="comment-btn-close" onclick="closeCommentModal()">
                    <i class="fas fa-times"></i> ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Merge Duplicate Orders Modal -->
    <div class="merge-modal" id="mergeDuplicateOrdersModal">
        <div class="merge-modal-content">
            <!-- Header -->
            <div class="merge-modal-header">
                <div class="merge-header-info">
                    <h3><i class="fas fa-compress-arrows-alt"></i> G·ªôp S·∫£n Ph·∫©m ƒê∆°n Tr√πng SƒêT</h3>
                    <p id="mergeDuplicateModalSubtitle">Ch·ªçn c√°c c·ª•m ƒë∆°n h√†ng c·∫ßn g·ªôp</p>
                </div>
                <div class="merge-header-actions">
                    <button class="merge-history-btn" onclick="showMergeHistoryModal()" title="Xem l·ªãch s·ª≠ g·ªôp ƒë∆°n">
                        <i class="fas fa-history"></i> L·ªãch s·ª≠
                    </button>
                    <label class="merge-select-all-label">
                        <input type="checkbox" id="mergeSelectAllCheckbox"
                            onchange="toggleSelectAllMergeClusters(this.checked)">
                        <span>Ch·ªçn t·∫•t c·∫£</span>
                    </label>
                    <button class="merge-modal-close" onclick="closeMergeDuplicateOrdersModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Body - Clusters List -->
            <div class="merge-modal-body" id="mergeDuplicateModalBody">
                <div class="merge-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="merge-modal-footer">
                <button class="merge-btn-cancel" onclick="closeMergeDuplicateOrdersModal()">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
                <button class="merge-btn-confirm" id="confirmMergeBtn" onclick="confirmMergeSelectedClusters()">
                    <i class="fas fa-check"></i> X√°c nh·∫≠n G·ªôp ƒê∆°n
                </button>
            </div>
        </div>
    </div>

    <!-- Merge History Modal -->
    <div class="merge-modal" id="mergeHistoryModal">
        <div class="merge-modal-content" style="max-width: 1400px;">
            <!-- Header -->
            <div class="merge-modal-header" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                <div class="merge-header-info">
                    <h3><i class="fas fa-history"></i> L·ªãch S·ª≠ G·ªôp ƒê∆°n H√†ng</h3>
                    <p id="mergeHistoryModalSubtitle">Xem l·∫°i c√°c l·∫ßn g·ªôp ƒë∆°n tr∆∞·ªõc ƒë√¢y</p>
                </div>
                <div class="merge-header-actions">
                    <button class="merge-modal-close" onclick="closeMergeHistoryModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Body - History List -->
            <div class="merge-modal-body" id="mergeHistoryModalBody">
                <div class="merge-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>ƒêang t·∫£i l·ªãch s·ª≠...</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="merge-modal-footer">
                <button class="merge-btn-cancel" onclick="closeMergeHistoryModal()">
                    <i class="fas fa-times"></i> ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Tag Modal -->
    <div class="bulk-tag-modal" id="bulkTagModal">
        <div class="bulk-tag-modal-content">
            <!-- Header -->
            <div class="bulk-tag-modal-header">
                <div class="bulk-tag-header-info">
                    <h3><i class="fas fa-tags"></i> G√°n Tag H√†ng Lo·∫°t</h3>
                    <p id="bulkTagModalSubtitle">Th√™m tag v√† nh·∫≠p STT ƒë∆°n h√†ng t∆∞∆°ng ·ª©ng</p>
                </div>
                <div class="bulk-tag-header-actions">
                    <button class="bulk-tag-history-btn" onclick="showBulkTagHistoryModal()" title="Xem l·ªãch s·ª≠ g√°n tag">
                        <i class="fas fa-history"></i> L·ªãch s·ª≠
                    </button>
                    <button class="bulk-tag-modal-close" onclick="closeBulkTagModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Search and Controls -->
            <div class="bulk-tag-search-section">
                <div class="bulk-tag-search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="bulkTagModalSearchInput" placeholder="T√¨m ki·∫øm tag (nh·∫≠p t√™n tag)..."
                        oninput="filterBulkTagModalOptions()"
                        onfocus="showBulkTagModalDropdown()"
                        onkeydown="handleBulkTagModalSearchKeydown(event)">
                    <div class="bulk-tag-search-dropdown" id="bulkTagModalSearchDropdown">
                        <!-- Tag options will be populated here -->
                    </div>
                </div>
                <button class="bulk-tag-clear-all-btn" onclick="clearAllBulkTagRows()" title="X√≥a t·∫•t c·∫£ tag">
                    <i class="fas fa-trash-alt"></i> X√≥a t·∫•t c·∫£
                </button>
            </div>

            <!-- Select All Checkbox -->
            <div class="bulk-tag-select-all-row">
                <label class="bulk-tag-select-all-label">
                    <input type="checkbox" id="bulkTagSelectAllCheckbox" onchange="toggleBulkTagSelectAll(this.checked)">
                    <span>Ch·ªçn t·∫•t c·∫£</span>
                </label>
                <span class="bulk-tag-count" id="bulkTagRowCount">0 tag ƒë√£ th√™m</span>
            </div>

            <!-- Body - Tag Table -->
            <div class="bulk-tag-modal-body" id="bulkTagModalBody">
                <div class="bulk-tag-table">
                    <div class="bulk-tag-table-header">
                        <div class="bulk-tag-col-tag">Tag c·∫ßn g√°n</div>
                        <div class="bulk-tag-col-stt">STT ƒê∆°n H√†ng</div>
                        <div class="bulk-tag-col-action">Thao t√°c</div>
                    </div>
                    <div class="bulk-tag-table-body" id="bulkTagTableBody">
                        <div class="bulk-tag-empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Ch∆∞a c√≥ tag n√†o ƒë∆∞·ª£c th√™m. H√£y t√¨m ki·∫øm v√† th√™m tag.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="bulk-tag-modal-footer">
                <button class="bulk-tag-btn-cancel" onclick="closeBulkTagModal()">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
                <button class="bulk-tag-btn-confirm" id="bulkTagConfirmBtn" onclick="executeBulkTagModalAssignment()">
                    <i class="fas fa-check"></i> G√°n Tag ƒê√£ Ch·ªçn
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Tag History Modal -->
    <div class="bulk-tag-modal" id="bulkTagHistoryModal">
        <div class="bulk-tag-modal-content" style="max-width: 1000px;">
            <!-- Header -->
            <div class="bulk-tag-modal-header" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                <div class="bulk-tag-header-info">
                    <h3><i class="fas fa-history"></i> L·ªãch S·ª≠ G√°n Tag H√†ng Lo·∫°t</h3>
                    <p id="bulkTagHistoryModalSubtitle">Xem l·∫°i c√°c l·∫ßn g√°n tag tr∆∞·ªõc ƒë√¢y</p>
                </div>
                <div class="bulk-tag-header-actions">
                    <button class="bulk-tag-modal-close" onclick="closeBulkTagHistoryModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Body - History List -->
            <div class="bulk-tag-modal-body" id="bulkTagHistoryModalBody">
                <div class="bulk-tag-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>ƒêang t·∫£i l·ªãch s·ª≠...</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="bulk-tag-modal-footer">
                <button class="bulk-tag-btn-cancel" onclick="closeBulkTagHistoryModal()">
                    <i class="fas fa-times"></i> ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Tag Delete Modal -->
    <div class="bulk-tag-modal bulk-tag-delete-modal" id="bulkTagDeleteModal">
        <div class="bulk-tag-modal-content">
            <!-- Header -->
            <div class="bulk-tag-modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                <div class="bulk-tag-header-info">
                    <h3><i class="fas fa-tags"></i> X√≥a Tag H√†ng Lo·∫°t</h3>
                    <p id="bulkTagDeleteModalSubtitle">Th√™m tag v√† nh·∫≠p STT ƒë∆°n h√†ng c·∫ßn x√≥a tag</p>
                </div>
                <div class="bulk-tag-header-actions">
                    <button class="bulk-tag-history-btn" onclick="showBulkTagDeleteHistoryModal()" title="Xem l·ªãch s·ª≠ x√≥a tag">
                        <i class="fas fa-history"></i> L·ªãch s·ª≠
                    </button>
                    <button class="bulk-tag-modal-close" onclick="closeBulkTagDeleteModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Search and Controls -->
            <div class="bulk-tag-search-section">
                <div class="bulk-tag-search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="bulkTagDeleteModalSearchInput" placeholder="T√¨m ki·∫øm tag c·∫ßn x√≥a..."
                        oninput="filterBulkTagDeleteModalOptions()"
                        onfocus="showBulkTagDeleteModalDropdown()"
                        onkeydown="handleBulkTagDeleteModalSearchKeydown(event)">
                    <div class="bulk-tag-search-dropdown" id="bulkTagDeleteModalSearchDropdown">
                        <!-- Tag options will be populated here -->
                    </div>
                </div>
                <button class="bulk-tag-clear-all-btn" onclick="clearAllBulkTagDeleteRows()" title="X√≥a t·∫•t c·∫£ tag">
                    <i class="fas fa-trash-alt"></i> X√≥a t·∫•t c·∫£
                </button>
            </div>

            <!-- Select All Checkbox -->
            <div class="bulk-tag-select-all-row">
                <label class="bulk-tag-select-all-label">
                    <input type="checkbox" id="bulkTagDeleteSelectAllCheckbox" onchange="toggleBulkTagDeleteSelectAll(this.checked)">
                    <span>Ch·ªçn t·∫•t c·∫£</span>
                </label>
                <span class="bulk-tag-count" id="bulkTagDeleteRowCount">0 tag ƒë√£ th√™m</span>
            </div>

            <!-- Body - Tag Table -->
            <div class="bulk-tag-modal-body" id="bulkTagDeleteModalBody">
                <div class="bulk-tag-table">
                    <div class="bulk-tag-table-header">
                        <div class="bulk-tag-col-tag">Tag c·∫ßn x√≥a</div>
                        <div class="bulk-tag-col-stt">STT ƒê∆°n H√†ng</div>
                        <div class="bulk-tag-col-action">Thao t√°c</div>
                    </div>
                    <div class="bulk-tag-table-body" id="bulkTagDeleteTableBody">
                        <div class="bulk-tag-empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Ch∆∞a c√≥ tag n√†o ƒë∆∞·ª£c th√™m. H√£y t√¨m ki·∫øm v√† th√™m tag c·∫ßn x√≥a.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="bulk-tag-modal-footer">
                <button class="bulk-tag-btn-cancel" onclick="closeBulkTagDeleteModal()">
                    <i class="fas fa-times"></i> H·ªßy
                </button>
                <button class="bulk-tag-btn-confirm bulk-tag-btn-delete" id="bulkTagDeleteConfirmBtn" onclick="executeBulkTagDeleteModalRemoval()">
                    <i class="fas fa-trash-alt"></i> X√≥a Tag ƒê√£ Ch·ªçn
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Tag Delete History Modal -->
    <div class="bulk-tag-modal" id="bulkTagDeleteHistoryModal">
        <div class="bulk-tag-modal-content" style="max-width: 1000px;">
            <!-- Header -->
            <div class="bulk-tag-modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                <div class="bulk-tag-header-info">
                    <h3><i class="fas fa-history"></i> L·ªãch S·ª≠ X√≥a Tag H√†ng Lo·∫°t</h3>
                    <p id="bulkTagDeleteHistoryModalSubtitle">Xem l·∫°i c√°c l·∫ßn x√≥a tag tr∆∞·ªõc ƒë√¢y</p>
                </div>
                <div class="bulk-tag-header-actions">
                    <button class="bulk-tag-modal-close" onclick="closeBulkTagDeleteHistoryModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Body - History List -->
            <div class="bulk-tag-modal-body" id="bulkTagDeleteHistoryModalBody">
                <div class="bulk-tag-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>ƒêang t·∫£i l·ªãch s·ª≠...</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="bulk-tag-modal-footer">
                <button class="bulk-tag-btn-cancel" onclick="closeBulkTagDeleteHistoryModal()">
                    <i class="fas fa-times"></i> ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal: No Campaigns Exist -->
    <div class="tag-modal" id="noCampaignsModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 450px;">
            <div class="tag-modal-header" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <h3 style="color: white;"><i class="fas fa-rocket"></i> B·∫Øt ƒê·∫ßu S·ª≠ D·ª•ng</h3>
            </div>
            <div class="tag-modal-body" style="padding: 24px; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">üì¢</div>
                <h4 style="margin: 0 0 12px 0; color: #374151; font-size: 18px;">Ch∆∞a c√≥ chi·∫øn d·ªãch n√†o!</h4>
                <p style="color: #6b7280; margin-bottom: 20px; line-height: 1.6;">
                    ƒê·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng, b·∫°n c·∫ßn t·∫°o chi·∫øn d·ªãch ƒë·∫ßu ti√™n.<br>
                    Chi·∫øn d·ªãch s·∫Ω x√°c ƒë·ªãnh khung th·ªùi gian ƒë·ªÉ l·ªçc d·ªØ li·ªáu t·ª´ 3000 ƒë∆°n h√†ng t·∫£i v·ªÅ t·ª´ TPOS.
                </p>
            </div>
            <div class="tag-modal-footer" style="justify-content: center;">
                <button class="btn-primary" onclick="closeNoCampaignsModal(); openCreateCampaignModal();"
                    style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 12px 24px; font-size: 15px;">
                    <i class="fas fa-plus"></i> T·∫°o Chi·∫øn D·ªãch ƒê·∫ßu Ti√™n
                </button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal: Select Campaign -->
    <div class="tag-modal" id="selectCampaignModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 450px;">
            <div class="tag-modal-header" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <h3 style="color: white;"><i class="fas fa-bullseye"></i> Ch·ªçn Chi·∫øn D·ªãch</h3>
            </div>
            <div class="tag-modal-body" style="padding: 24px;">
                <p style="color: #6b7280; margin-bottom: 16px; text-align: center;">
                    Vui l√≤ng ch·ªçn m·ªôt chi·∫øn d·ªãch ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m vi·ªác:
                </p>
                <select id="selectCampaignDropdown" style="width: 100%; padding: 12px; border: 2px solid #8b5cf6; border-radius: 8px; font-size: 14px; margin-bottom: 16px;">
                    <option value="">-- Ch·ªçn chi·∫øn d·ªãch --</option>
                </select>
                <div style="padding: 12px; background: #f0fdf4; border-radius: 8px; border-left: 3px solid #10b981;">
                    <p style="margin: 0; font-size: 13px; color: #166534;">
                        <i class="fas fa-info-circle"></i> B·∫°n c≈©ng c√≥ th·ªÉ t·∫°o chi·∫øn d·ªãch m·ªõi b√™n d∆∞·ªõi.
                    </p>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button class="btn-primary" onclick="closeSelectCampaignModal(); openCreateCampaignModal();"
                    style="background: #6b7280;">
                    <i class="fas fa-plus"></i> T·∫°o m·ªõi
                </button>
                <button class="btn-primary" onclick="confirmSelectCampaign()"
                    style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    <i class="fas fa-check"></i> Ch·ªçn
                </button>
            </div>
        </div>
    </div>

    <!-- Campaign Deleted Notification Modal -->
    <div class="tag-modal" id="campaignDeletedModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 450px;">
            <div class="tag-modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                <h3 style="color: white;"><i class="fas fa-exclamation-triangle"></i> Chi·∫øn D·ªãch ƒê√£ B·ªã X√≥a</h3>
            </div>
            <div class="tag-modal-body" style="padding: 24px; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>
                <p style="color: #6b7280; margin-bottom: 20px; line-height: 1.6;">
                    Chi·∫øn d·ªãch b·∫°n ƒëang s·ª≠ d·ª•ng ƒë√£ b·ªã x√≥a b·ªüi ng∆∞·ªùi d√πng kh√°c.<br>
                    Vui l√≤ng ch·ªçn m·ªôt chi·∫øn d·ªãch kh√°c ƒë·ªÉ ti·∫øp t·ª•c.
                </p>
            </div>
            <div class="tag-modal-footer" style="justify-content: center;">
                <button class="btn-primary" onclick="closeCampaignDeletedModal(); showSelectCampaignModal();"
                    style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 12px 24px;">
                    <i class="fas fa-hand-pointer"></i> Ch·ªçn Chi·∫øn D·ªãch Kh√°c
                </button>
            </div>
        </div>
    </div>

    <!-- Campaign No Dates Modal - When campaign has no start date -->
    <div class="tag-modal" id="campaignNoDatesModal" style="display: none; z-index: 10150;">
        <div class="tag-modal-content" style="max-width: 500px;">
            <div class="tag-modal-header" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <h3 style="color: white;"><i class="fas fa-calendar-times"></i> Chi·∫øn D·ªãch Ch∆∞a C√≥ Ng√†y</h3>
                <button class="tag-modal-close" onclick="closeCampaignNoDatesModal()" style="color: white;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body" style="padding: 24px;">
                <input type="hidden" id="noDatesModalCampaignId" />
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 48px; margin-bottom: 12px;">üìÖ</div>
                    <p style="color: #6b7280; line-height: 1.6;">
                        Chi·∫øn d·ªãch <strong id="noDatesModalCampaignName">-</strong> ch∆∞a c√≥ ng√†y b·∫Øt ƒë·∫ßu.<br>
                        Vui l√≤ng ch·ªçn kho·∫£ng th·ªùi gian ƒë·ªÉ ti·∫øp t·ª•c.
                    </p>
                </div>

                <!-- Date Range -->
                <div style="padding: 16px; background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); border-radius: 8px; border: 2px solid #8b5cf6;">
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 180px;">
                            <label style="font-size: 12px; font-weight: 600; color: #7c3aed; display: block; margin-bottom: 4px;">
                                <i class="fas fa-play"></i> T·ª´ ng√†y:
                            </label>
                            <input type="datetime-local" id="noDatesModalStartDate"
                                style="width: 100%; padding: 10px 12px; border: 2px solid #8b5cf6; border-radius: 6px; font-size: 14px;" />
                        </div>
                        <div style="flex: 1; min-width: 180px;">
                            <label style="font-size: 12px; font-weight: 600; color: #7c3aed; display: block; margin-bottom: 4px;">
                                <i class="fas fa-stop"></i> ƒê·∫øn ng√†y:
                            </label>
                            <input type="datetime-local" id="noDatesModalEndDate"
                                style="width: 100%; padding: 10px 12px; border: 2px solid #8b5cf6; border-radius: 6px; font-size: 14px;" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button class="tag-btn-cancel" onclick="closeCampaignNoDatesModal()">
                    H·ªßy
                </button>
                <button class="tag-btn-save" onclick="saveCampaignDatesAndContinue()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <i class="fas fa-check"></i> L∆∞u v√† Ti·∫øp T·ª•c
                </button>
            </div>
        </div>
    </div>

    <!-- Manage Campaigns Modal -->
    <div class="tag-modal" id="manageCampaignsModal" style="display: none; z-index: 10100;">
        <div class="tag-modal-content" style="max-width: 600px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-cog"></i> Qu·∫£n L√Ω Chi·∫øn D·ªãch</h3>
                <button class="tag-modal-close" onclick="closeManageCampaignsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body" style="padding: 20px;">
                <div id="manageCampaignsList" style="max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; color: #9ca3af; padding: 40px;">
                        <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...
                    </div>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button class="tag-btn-cancel" onclick="closeManageCampaignsModal()">
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Campaign Modal -->
    <div class="tag-modal" id="editCampaignModal" style="display: none; z-index: 10200;">
        <div class="tag-modal-content" style="max-width: 500px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-edit"></i> Ch·ªânh S·ª≠a Chi·∫øn D·ªãch</h3>
                <button class="tag-modal-close" onclick="closeEditCampaignModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body" style="padding: 20px;">
                <input type="hidden" id="editCampaignId" />
                <!-- Campaign Name -->
                <div style="margin-bottom: 20px;">
                    <label style="font-size: 13px; font-weight: 600; color: #374151; display: block; margin-bottom: 8px;">
                        <i class="fas fa-tag" style="color: #8b5cf6;"></i> T√™n chi·∫øn d·ªãch:
                    </label>
                    <input type="text" id="editCampaignName" placeholder="T√™n chi·∫øn d·ªãch"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;" />
                </div>

                <!-- Custom Date Range (always visible - Custom mode only) -->
                <div id="editCampaignCustomDateContainer" style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); border-radius: 8px; border: 2px solid #8b5cf6;">
                    <h4 style="margin: 0 0 12px 0; font-size: 13px; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-calendar-check" style="color: #8b5cf6;"></i> Kho·∫£ng Th·ªùi Gian Chi·∫øn D·ªãch
                    </h4>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 180px; display: flex; flex-direction: column; gap: 4px;">
                            <label style="font-size: 12px; font-weight: 600; color: #7c3aed;">
                                <i class="fas fa-play"></i> T·ª´ ng√†y:
                            </label>
                            <input type="datetime-local" id="editCampaignCustomStartDate"
                                onchange="autoFillEditCampaignEndDate()"
                                style="width: 100%; padding: 8px 12px; border: 2px solid #8b5cf6; border-radius: 6px; font-size: 13px;" />
                        </div>
                        <div style="flex: 1; min-width: 180px; display: flex; flex-direction: column; gap: 4px;">
                            <label style="font-size: 12px; font-weight: 600; color: #7c3aed;">
                                <i class="fas fa-stop"></i> ƒê·∫øn ng√†y:
                            </label>
                            <input type="datetime-local" id="editCampaignCustomEndDate"
                                style="width: 100%; padding: 8px 12px; border: 2px solid #8b5cf6; border-radius: 6px; font-size: 13px;" />
                        </div>
                    </div>
                    <div style="margin-top: 8px; padding: 6px 10px; background: white; border-radius: 4px; font-size: 11px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="color: #8b5cf6;"></i>
                        "ƒê·∫øn ng√†y" t·ª± ƒë·ªông = "T·ª´ ng√†y" + 3 ng√†y
                    </div>
                </div>
                <!-- Hidden time frame for backward compatibility -->
                <input type="hidden" id="editCampaignTimeFrame" value="custom" />
            </div>
            <div class="tag-modal-footer">
                <button class="tag-btn-cancel" onclick="closeEditCampaignModal()">
                    H·ªßy
                </button>
                <button class="tag-btn-save" onclick="saveEditCampaign()" style="background: #8b5cf6;">
                    <i class="fas fa-save"></i> L∆∞u Thay ƒê·ªïi
                </button>
            </div>
        </div>
    </div>

    <!-- Campaign Settings Modal -->
    <div class="tag-modal" id="campaignSettingsModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 700px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-bullhorn"></i> C√†i ƒê·∫∑t Chi·∫øn D·ªãch</h3>
                <button class="tag-modal-close" onclick="closeCampaignSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body" style="padding: 20px;">
                <!-- User Campaigns Section -->
                <div style="margin-bottom: 24px; padding: 16px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #374151; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-bullseye" style="color: #8b5cf6;"></i> Chi·∫øn D·ªãch ƒê√£ L∆∞u
                    </h4>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <select id="modalUserCampaignSelect" style="flex: 1; padding: 10px 12px; border: 2px solid #8b5cf6; border-radius: 6px; font-weight: 500;">
                                <option value="">-- Ch·ªçn chi·∫øn d·ªãch ƒë√£ l∆∞u --</option>
                            </select>
                            <button class="btn-primary" onclick="openManageCampaignsModal()"
                                style="background: #6b7280; padding: 10px 12px; white-space: nowrap;"
                                title="Qu·∫£n l√Ω chi·∫øn d·ªãch">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button class="btn-primary" onclick="openCreateCampaignModal()"
                                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 10px 12px; white-space: nowrap;"
                                title="Th√™m chi·∫øn d·ªãch m·ªõi">
                                <i class="fas fa-plus"></i> TH√äM
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Custom Date Range Section -->
                <div style="margin-bottom: 24px; padding: 16px; background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); border-radius: 8px; border: 2px solid #8b5cf6;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #7c3aed; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-calendar-check" style="color: #8b5cf6;"></i> Kho·∫£ng Th·ªùi Gian L·ªçc ƒê∆°n
                    </h4>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px; display: flex; flex-direction: column; gap: 4px;">
                            <label style="font-size: 12px; font-weight: 600; color: #7c3aed;">
                                <i class="fas fa-play"></i> T·ª´ ng√†y:
                            </label>
                            <input type="datetime-local" id="modalCustomStartDate"
                                style="width: 100%; padding: 10px 12px; border: 2px solid #8b5cf6; border-radius: 6px; font-weight: 500;" />
                        </div>
                        <div style="flex: 1; min-width: 200px; display: flex; flex-direction: column; gap: 4px;">
                            <label style="font-size: 12px; font-weight: 600; color: #7c3aed;">
                                <i class="fas fa-stop"></i> ƒê·∫øn ng√†y:
                            </label>
                            <input type="datetime-local" id="modalCustomEndDate"
                                style="width: 100%; padding: 10px 12px; border: 2px solid #8b5cf6; border-radius: 6px; font-weight: 500;" />
                        </div>
                    </div>
                    <div style="margin-top: 12px; padding: 8px 12px; background: white; border-radius: 6px; font-size: 12px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="color: #8b5cf6;"></i>
                        Khi ƒëi·ªÅn "T·ª´ ng√†y", "ƒê·∫øn ng√†y" s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ƒëi·ªÅn = T·ª´ ng√†y + 3 ng√†y
                    </div>
                </div>

                <!-- Hidden elements for backward compatibility -->
                <div style="display: none;">
                    <select id="modalCampaignFilter">
                        <option value="custom" selected>Custom</option>
                    </select>
                    <input type="datetime-local" id="modalStartDate" />
                    <input type="datetime-local" id="modalEndDate" />
                    <div id="modalCustomDateFilterContainer"></div>
                    <div id="campaignTimeFrameLabel"></div>
                    <div id="campaignCustomDateDisplay"></div>
                    <div id="campaignCustomDateLabel"></div>
                </div>

                <!-- Realtime Section -->
                <div style="margin-bottom: 24px; padding: 16px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #374151; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-bolt" style="color: #f59e0b;"></i> C√†i ƒê·∫∑t Realtime
                    </h4>
                    <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="modalRealtimeToggleCheckbox"
                                style="cursor: pointer; width: 18px; height: 18px;">
                            <label for="modalRealtimeToggleCheckbox"
                                style="cursor: pointer; font-size: 14px; font-weight: 500; color: #374151; user-select: none;">
                                <i class="fas fa-bolt" style="color: #f59e0b; margin-right: 4px;"></i> B·∫≠t Realtime
                            </label>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <label style="font-size: 12px; color: #6b7280;">Ch·∫ø ƒë·ªô:</label>
                            <select id="modalRealtimeModeSelect"
                                style="padding: 8px 12px; border-radius: 6px; border: 1px solid #d1d5db; font-size: 13px; background: white; cursor: pointer;">
                                <option value="browser">Browser (Direct)</option>
                                <option value="server" selected>Server (24/7)</option>
                                <option value="localhost">Server (Localhost)</option>
                            </select>
                        </div>
                        <button onclick="window.realtimeManager && window.realtimeManager.manualConnect()"
                            style="padding: 8px 16px; border: 1px solid #d1d5db; border-radius: 6px; background: white; cursor: pointer; font-size: 13px; color: #4b5563; margin-top: 18px;"
                            title="K·∫øt n·ªëi l·∫°i th·ªß c√¥ng">
                            <i class="fas fa-sync-alt"></i> K·∫øt n·ªëi l·∫°i
                        </button>
                    </div>
                </div>

                <!-- Pancake API Section -->
                <div style="padding: 16px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <h4 style="margin: 0 0 16px 0; font-size: 14px; color: #374151; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-cookie-bite" style="color: #8b5cf6;"></i> Pancake API
                    </h4>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn-primary" onclick="openPancakeSettingsModal()"
                            style="background: #8b5cf6;">
                            <i class="fas fa-cog"></i>
                            C√†i ƒë·∫∑t Pancake
                        </button>
                        <button class="btn-primary" id="modalChatApiToggleBtn" onclick="toggleChatAPISourceFromModal()"
                            style="background: #3b82f6" title="Ch·ªçn ngu·ªìn API ƒë·ªÉ hi·ªÉn th·ªã tin nh·∫Øn/b√¨nh lu·∫≠n">
                            <i class="fas fa-exchange-alt"></i>
                            <span id="modalChatApiSourceLabel">Pancake API</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button class="tag-btn-cancel" onclick="closeCampaignSettingsModal()">
                    ƒê√≥ng
                </button>
                <button class="tag-btn-save" onclick="applyCampaignSettings()" style="background: #8b5cf6;">
                    <i class="fas fa-check"></i> √Åp d·ª•ng
                </button>
            </div>
        </div>
    </div>

    <!-- Campaign Settings Modal Script -->
    <script src="js/tab1/tab1-campaign-settings.js"></script>

    <!-- Create Campaign Modal -->
    <div class="tag-modal" id="createCampaignModal" style="display: none; z-index: 10150;">
        <div class="tag-modal-content" style="max-width: 500px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-plus-circle"></i> Th√™m Chi·∫øn D·ªãch M·ªõi</h3>
                <button class="tag-modal-close" onclick="closeCreateCampaignModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body" style="padding: 20px;">
                <!-- Campaign Name -->
                <div style="margin-bottom: 20px;">
                    <label style="font-size: 13px; font-weight: 600; color: #374151; display: block; margin-bottom: 8px;">
                        <i class="fas fa-tag" style="color: #8b5cf6;"></i> T√™n chi·∫øn d·ªãch:
                    </label>
                    <input type="text" id="newCampaignName" placeholder="VD: Chi·∫øn d·ªãch Noel 2025"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;" />
                </div>

                <!-- Custom Date Range -->
                <div style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%); border-radius: 8px; border: 2px solid #8b5cf6;">
                    <label style="font-size: 13px; font-weight: 600; color: #7c3aed; display: block; margin-bottom: 12px;">
                        <i class="fas fa-calendar-check" style="color: #8b5cf6;"></i> Kho·∫£ng th·ªùi gian l·ªçc ƒë∆°n:
                    </label>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 180px;">
                            <label style="font-size: 11px; color: #7c3aed; display: block; margin-bottom: 4px;">T·ª´ ng√†y:</label>
                            <input type="datetime-local" id="newCampaignCustomStartDate"
                                style="width: 100%; padding: 8px 10px; border: 2px solid #8b5cf6; border-radius: 6px; font-size: 13px;" />
                        </div>
                        <div style="flex: 1; min-width: 180px;">
                            <label style="font-size: 11px; color: #7c3aed; display: block; margin-bottom: 4px;">ƒê·∫øn ng√†y:</label>
                            <input type="datetime-local" id="newCampaignCustomEndDate"
                                style="width: 100%; padding: 8px 10px; border: 2px solid #8b5cf6; border-radius: 6px; font-size: 13px;" />
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px; color: #6b7280;">
                        <i class="fas fa-info-circle" style="color: #8b5cf6;"></i> ƒê·∫øn ng√†y t·ª± ƒë·ªông = T·ª´ ng√†y + 3 ng√†y
                    </div>
                </div>

                <!-- Info Box -->
                <div style="padding: 12px; background: #f0fdf4; border-left: 3px solid #10b981; border-radius: 4px;">
                    <div style="font-size: 12px; color: #166534;">
                        <i class="fas fa-info-circle"></i> Chi·∫øn d·ªãch s·∫Ω l∆∞u l·∫°i kho·∫£ng th·ªùi gian l·ªçc ƒë∆°n.
                        B·∫°n c√≥ th·ªÉ ch·ªçn l·∫°i chi·∫øn d·ªãch n√†y sau ƒë·ªÉ √°p d·ª•ng nhanh.
                    </div>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button class="tag-btn-cancel" onclick="closeCreateCampaignModal()">
                    H·ªßy
                </button>
                <button class="tag-btn-save" onclick="saveNewCampaign()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <i class="fas fa-save"></i> L∆∞u Chi·∫øn D·ªãch
                </button>
            </div>
        </div>
    </div>

    <!-- Create Campaign Modal Script -->
    <script src="js/tab1/tab1-campaign-create.js"></script>

    <!-- Comprehensive Campaign Management System -->
    <script src="js/tab1/tab1-campaign-system.js"></script>

    <!-- Pancake Settings Modal -->
    <div class="tag-modal" id="pancakeSettingsModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 800px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-cog"></i> Qu·∫£n l√Ω Pancake Accounts</h3>
                <button class="tag-modal-close" onclick="closePancakeSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body">
                <!-- Accounts List -->
                <div style="margin-bottom: 20px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h4 style="margin: 0; font-size: 15px; color: #374151;">
                            <i class="fas fa-users"></i> Danh s√°ch t√†i kho·∫£n
                        </h4>
                        <button onclick="showAddAccountForm()"
                            style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-plus"></i> Th√™m t√†i kho·∫£n
                        </button>
                    </div>
                    <div id="pancakeAccountsList"
                        style="background: #f9fafb; border-radius: 8px; padding: 12px; max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; color: #9ca3af; padding: 20px;">
                            ƒêang t·∫£i...
                        </div>
                    </div>
                </div>

                <!-- Add Account Form (Hidden by default) -->
                <div id="addAccountForm"
                    style="display: none; margin-bottom: 20px; padding: 16px; background: #f3f4f6; border-radius: 8px; border: 2px solid #3b82f6;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h4 style="margin: 0; font-size: 14px; color: #374151;">
                            <i class="fas fa-user-plus"></i> Th√™m t√†i kho·∫£n m·ªõi
                        </h4>
                        <button onclick="hideAddAccountForm()"
                            style="padding: 4px 8px; background: transparent; border: none; cursor: pointer; font-size: 16px; color: #6b7280;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Token Input -->
                    <div style="margin-bottom: 12px;">
                        <label
                            style="display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #374151;">
                            JWT Token:
                        </label>
                        <textarea id="newAccountTokenInput" placeholder="Nh·∫≠p JWT token t·ª´ cookie pancake.vn..."
                            style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-family: monospace; font-size: 11px; resize: vertical;"
                            oninput="validateTokenInput()"></textarea>
                        <div id="tokenValidationMessage"
                            style="margin-top: 6px; font-size: 11px; color: #6b7280; display: none;">
                        </div>
                        <div style="margin-top: 6px; font-size: 11px; color: #6b7280;">
                            üí° Token s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông l√†m s·∫°ch (x√≥a kho·∫£ng tr·∫Øng, prefix "jwt=", v.v.)
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div
                        style="padding: 10px; background: #fef3c7; border-left: 3px solid #f59e0b; border-radius: 4px; margin-bottom: 12px;">
                        <div style="font-size: 12px; color: #92400e; font-weight: 500; margin-bottom: 6px;">
                            üìã C√°ch l·∫•y JWT token:
                        </div>
                        <ol style="margin: 0; padding-left: 18px; font-size: 11px; color: #92400e;">
                            <li>M·ªü tab m·ªõi: <a href="https://pancake.vn" target="_blank"
                                    style="color: #d97706;">https://pancake.vn</a></li>
                            <li>ƒêƒÉng nh·∫≠p v√†o t√†i kho·∫£n Pancake</li>
                            <li>M·ªü DevTools (F12) ‚Üí Console tab</li>
                            <li>G√µ: <code
                                    style="background: #fff; padding: 2px 4px; border-radius: 3px;">document.cookie.split(';').find(c => c.includes('jwt'))</code>
                            </li>
                            <li>Copy gi√° tr·ªã sau "jwt=" v√† paste v√†o √¥ tr√™n</li>
                        </ol>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; gap: 8px;">
                        <button class="tag-btn-save" onclick="addAccountFromCookie()"
                            style="flex: 1; background: #10b981; font-size: 13px;">
                            <i class="fas fa-sync"></i> L·∫•y t·ª´ Cookie
                        </button>
                        <button onclick="debugTokenInput()"
                            style="flex: 1; padding: 8px 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                        <button class="tag-btn-save" onclick="addAccountManual()"
                            style="flex: 1; background: #3b82f6; font-size: 13px;">
                            <i class="fas fa-save"></i> Th√™m Token
                        </button>
                    </div>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button class="tag-btn-cancel" onclick="closePancakeSettingsModal()">
                    ƒê√≥ng
                </button>
                <button class="tag-btn-cancel" onclick="clearAllPancakeAccounts()" style="background: #ef4444;">
                    <i class="fas fa-trash"></i> X√≥a t·∫•t c·∫£
                </button>
            </div>
        </div>
    </div>

    <!-- Pancake Settings Script -->
    <script src="js/tab1/tab1-pancake-settings.js"></script>

    <!-- Employee Assignment Drawer -->
    <div class="employee-drawer-overlay" id="employeeDrawerOverlay" onclick="toggleEmployeeDrawer()"></div>
    <div class="employee-drawer" id="employeeDrawer">
        <div class="employee-drawer-header">
            <h3>
                <i class="fas fa-users-cog"></i>
                C√†i ƒë·∫∑t ph√¢n chia nh√¢n vi√™n
            </h3>
            <button class="employee-drawer-close" onclick="toggleEmployeeDrawer()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="employee-drawer-body">
            <!-- Campaign Selector -->
            <div
                style="margin-bottom: 16px; padding: 12px; background: #f8f9fa; border-radius: 6px; border: 1px solid #e5e7eb;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 13px; color: #374151;">
                    <i class="fas fa-video"></i> Ch·ªçn chi·∫øn d·ªãch live:
                </label>
                <select id="employeeCampaignSelector"
                    style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 13px;">
                    <option value="">C·∫•u h√¨nh chung (t·∫•t c·∫£ chi·∫øn d·ªãch)</option>
                </select>
                <div style="margin-top: 8px; font-size: 12px; color: #6b7280;">
                    <i class="fas fa-info-circle"></i>
                    Ch·ªçn chi·∫øn d·ªãch ƒë·ªÉ c·∫•u h√¨nh ph√¢n chia ri√™ng, ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ √°p d·ª•ng cho t·∫•t c·∫£
                </div>
            </div>
            <div id="employeeAssignmentTable"
                style="max-height: calc(100vh - 280px); overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 16px;">
                <table style="width: 100%; font-size: 13px;">
                    <thead
                        style="position: sticky; top: 0; background: #f8f9fa; border-bottom: 1px solid #e5e7eb; z-index: 1;">
                        <tr>
                            <th style="padding: 8px; text-align: left; font-weight: 600;">Nh√¢n vi√™n</th>
                            <th style="padding: 8px; text-align: center; width: 100px; font-weight: 600;">STT T·ª´</th>
                            <th style="padding: 8px; text-align: center; width: 100px; font-weight: 600;">STT ƒê·∫øn</th>
                        </tr>
                    </thead>
                    <tbody id="employeeAssignmentBody">
                        <tr>
                            <td colspan="3" style="text-align: center; padding: 20px; color: #9ca3af;">
                                <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i danh s√°ch nh√¢n vi√™n...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="employee-input-help" style="margin-bottom: 16px;">
                <i class="fas fa-info-circle"></i>
                Nh·∫≠p kho·∫£ng STT cho t·ª´ng nh√¢n vi√™n. D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c l∆∞u t·ª± ƒë·ªông khi b·∫•m "√Åp d·ª•ng".
            </div>
        </div>
        <div class="employee-drawer-footer">
            <button class="btn-secondary" onclick="toggleEmployeeDrawer()">
                <i class="fas fa-times"></i> ƒê√≥ng
            </button>
            <button class="btn-primary" onclick="applyEmployeeRanges()">
                <i class="fas fa-check"></i> √Åp d·ª•ng
            </button>
        </div>
    </div>
    <!-- Edit Order Modal -->
    <div class="modal fade" id="editOrderModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-edit"></i> Xem chi ti·∫øt ƒë∆°n h√†ng - <span id="modalOrderCode"></span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" onclick="closeEditModal()"></button>
                </div>
                <div class="modal-body-wrapper">
                    <div class="edit-tabs">
                        <button class="edit-tab-btn active" onclick="switchEditTab('info')">Th√¥ng tin li√™n h·ªá</button>
                        <button class="edit-tab-btn" onclick="switchEditTab('products')">S·∫£n ph·∫©m</button>
                        <button class="edit-tab-btn" onclick="switchEditTab('delivery')">Th√¥ng tin giao h√†ng</button>
                        <button class="edit-tab-btn" onclick="switchEditTab('live')">L·ªãch s·ª≠ ƒë∆°n live</button>
                        <button class="edit-tab-btn" onclick="switchEditTab('invoice_history')">L·ªãch s·ª≠ h√≥a ƒë∆°n</button>
                        <button class="edit-tab-btn" onclick="switchEditTab('history')">L·ªãch s·ª≠ ch·ªânh s·ª≠a</button>
                    </div>
                    <div class="modal-body" id="editModalBody">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sticker/Emoji Picker Modal -->
    <div id="stickerPickerModal" class="sticker-picker-overlay">
        <div class="sticker-picker-container">
            <!-- Header with Close Button -->
            <div class="sticker-picker-header">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #1f2937;">Ch·ªçn Emoji/Sticker</h3>
                <button onclick="closeStickerPickerModal()" class="sticker-close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Tabs -->
            <div class="sticker-picker-tabs">
                <button class="sticker-tab-btn active" onclick="switchStickerTab('emoji')" data-tab="emoji">
                    Emoji
                </button>
                <button class="sticker-tab-btn" onclick="switchStickerTab('sticker')" data-tab="sticker">
                    Sticker
                </button>
            </div>

            <!-- Search Bar -->
            <div class="sticker-search-container">
                <input type="text" class="sticker-search-input" id="stickerSearchInput" placeholder="T√¨m ki·∫øm..."
                    oninput="searchSticker(this.value)">
                <i class="fas fa-search sticker-search-icon"></i>
            </div>

            <!-- Emoji Tab Content -->
            <div id="emojiTabContent" class="sticker-tab-content active">
                <!-- Frequently Used -->
                <div class="emoji-category">
                    <h4 class="emoji-category-title">Frequently Used</h4>
                    <div class="emoji-grid" id="frequentlyUsedGrid">
                        <div class="emoji-item" onclick="insertStickerEmoji('üëç')" title="thumbs up">üëç</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòä')" title="smiling face">üòä</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòò')" title="kissing face">üòò</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòç')" title="heart eyes">üòç</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÜ')" title="laughing">üòÜ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòú')" title="winking tongue">üòú</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§™')" title="zany face">ü§™</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÇ')" title="tears of joy">üòÇ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò±')" title="screaming">üò±</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòî')" title="pensive">üòî</div>
                    </div>
                </div>

                <!-- Smileys & People -->
                <div class="emoji-category">
                    <h4 class="emoji-category-title">Smileys & People</h4>
                    <div class="emoji-grid">
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÄ')" title="grinning face">üòÄ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÉ')" title="grinning face with big eyes">
                            üòÉ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÑ')"
                            title="grinning face with smiling eyes">üòÑ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÅ')"
                            title="beaming face with smiling eyes">üòÅ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÜ')" title="grinning squinting face">üòÜ
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÖ')" title="grinning face with sweat">üòÖ
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§£')"
                            title="rolling on the floor laughing">ü§£</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÇ')" title="face with tears of joy">üòÇ
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üôÇ')" title="slightly smiling face">üôÇ
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üôÉ')" title="upside-down face">üôÉ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòâ')" title="winking face">üòâ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòä')"
                            title="smiling face with smiling eyes">üòä</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòá')" title="smiling face with halo">üòá
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü•∞')" title="smiling face with hearts">ü•∞
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòç')" title="smiling face with heart-eyes">
                            üòç</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§©')" title="star-struck">ü§©</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòò')" title="face blowing a kiss">üòò</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòó')" title="kissing face">üòó</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòö')"
                            title="kissing face with closed eyes">üòö</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòô')"
                            title="kissing face with smiling eyes">üòô</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòã')" title="face savoring food">üòã</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòõ')" title="face with tongue">üòõ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòú')" title="winking face with tongue">üòú
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§™')" title="zany face">ü§™</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòù')" title="squinting face with tongue">üòù
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ë')" title="money-mouth face">ü§ë</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ó')" title="hugging face">ü§ó</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§≠')" title="face with hand over mouth">ü§≠
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§´')" title="shushing face">ü§´</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§î')" title="thinking face">ü§î</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ê')" title="zipper-mouth face">ü§ê</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§®')" title="face with raised eyebrow">ü§®
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòê')" title="neutral face">üòê</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòë')" title="expressionless face">üòë</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò∂')" title="face without mouth">üò∂</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòè')" title="smirking face">üòè</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòí')" title="unamused face">üòí</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üôÑ')" title="face with rolling eyes">üôÑ
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò¨')" title="grimacing face">üò¨</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§•')" title="lying face">ü§•</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòå')" title="relieved face">üòå</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòî')" title="pensive face">üòî</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò™')" title="sleepy face">üò™</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§§')" title="drooling face">ü§§</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò¥')" title="sleeping face">üò¥</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò∑')" title="face with medical mask">üò∑
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§í')" title="face with thermometer">ü§í
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ï')" title="face with head-bandage">ü§ï
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§¢')" title="nauseated face">ü§¢</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§Æ')" title="face vomiting">ü§Æ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ß')" title="sneezing face">ü§ß</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü•µ')" title="hot face">ü•µ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü•∂')" title="cold face">ü•∂</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòé')" title="smiling face with sunglasses">
                            üòé</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ì')" title="nerd face">ü§ì</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üßê')" title="face with monocle">üßê</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòï')" title="confused face">üòï</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòü')" title="worried face">üòü</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üôÅ')" title="slightly frowning face">üôÅ
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòÆ')" title="face with open mouth">üòÆ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòØ')" title="hushed face">üòØ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò≤')" title="astonished face">üò≤</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò≥')" title="flushed face">üò≥</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü•∫')" title="pleading face">ü•∫</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò¶')"
                            title="frowning face with open mouth">üò¶</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòß')" title="anguished face">üòß</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò®')" title="fearful face">üò®</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò∞')" title="anxious face with sweat">üò∞
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò•')" title="sad but relieved face">üò•
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò¢')" title="crying face">üò¢</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò≠')" title="loudly crying face">üò≠</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò±')" title="face screaming in fear">üò±
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòñ')" title="confounded face">üòñ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò£')" title="persevering face">üò£</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòû')" title="disappointed face">üòû</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üòì')" title="downcast face with sweat">üòì
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò©')" title="weary face">üò©</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò´')" title="tired face">üò´</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü•±')" title="yawning face">ü•±</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò§')" title="face with steam from nose">üò§
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò°')" title="pouting face">üò°</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üò†')" title="angry face">üò†</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§¨')" title="face with symbols on mouth">ü§¨
                        </div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üëç')" title="thumbs up">üëç</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üëé')" title="thumbs down">üëé</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üëè')" title="clapping hands">üëè</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üôå')" title="raising hands">üôå</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ù')" title="handshake">ü§ù</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üôè')" title="folded hands">üôè</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('‚ù§Ô∏è')" title="red heart">‚ù§Ô∏è</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíî')" title="broken heart">üíî</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíï')" title="two hearts">üíï</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíñ')" title="sparkling heart">üíñ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíó')" title="growing heart">üíó</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíô')" title="blue heart">üíô</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíö')" title="green heart">üíö</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíõ')" title="yellow heart">üíõ</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üß°')" title="orange heart">üß°</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üíú')" title="purple heart">üíú</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('üñ§')" title="black heart">üñ§</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§ç')" title="white heart">ü§ç</div>
                        <div class="emoji-item" onclick="insertStickerEmoji('ü§é')" title="brown heart">ü§é</div>
                    </div>
                </div>
            </div>

            <!-- Sticker Tab Content -->
            <div id="stickerTabContent" class="sticker-tab-content">
                <div class="emoji-category">
                    <h4 class="emoji-category-title">Stickers</h4>
                    <p style="text-align: center; padding: 40px; color: #9ca3af;">Sticker s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t s·ªõm...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="orderQRModal" class="modal-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10002; justify-content: center; align-items: center;">
        <div class="modal-content"
            style="background: white; max-width: 420px; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-qrcode"></i> QR Chuy·ªÉn Kho·∫£n
                </h3>
                <button onclick="closeOrderQRModal()"
                    style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
            </div>
            <div id="orderQRModalBody" style="padding: 20px; text-align: center;">
                <!-- QR content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Sale Button Modal (Phi·∫øu b√°n h√†ng) -->
    <div id="saleButtonModal" class="modal-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10003; justify-content: center; align-items: center; overflow-y: auto; padding: 20px;">
        <div class="modal-content"
            style="background: #f5f5f5; width: 100%; max-width: 1400px; border-radius: 8px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); margin: auto;">
            <!-- Header -->
            <div
                style="background: white; padding: 12px 20px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 16px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 16px; color: #374151;">Phi·∫øu b√°n h√†ng</span>
                    <span style="color: #9ca3af;">/</span>
                    <span style="color: #9ca3af;">M·ªõi</span>
                    <span style="color: #9ca3af;">/</span>
                    <span
                        style="background: #374151; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">Sale
                        online</span>
                </div>
                <button onclick="closeSaleButtonModal()"
                    style="margin-left: auto; background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
            </div>

            <!-- Action Buttons + Customer Info + Delivery Info -->
            <div
                style="background: white; padding: 12px 20px; border-bottom: 1px solid #e5e7eb; display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                <button class="sale-btn sale-btn-teal" onclick="confirmAndPrintSale()">X√°c nh·∫≠n v√† in (F9)</button>

                <!-- Customer Info -->
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 12px; color: #6b7280;">T√™n kh√°ch h√†ng:</span>
                    <span id="saleCustomerNameHeader" style="font-weight: 600; color: #6366f1;"></span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 12px; color: #6b7280;">Status:</span>
                    <span id="saleCustomerStatusHeader" style="font-weight: 500; color: #6366f1;"></span>
                    <span style="font-size: 11px; color: #6b7280;">(ƒêi·ªÉm t√≠ch l≈©y: <span
                            id="saleLoyaltyPointsHeader">0</span> - S·ª≠ d·ª•ng ƒëi·ªÉm: <span
                            id="saleUsedPointsHeader">0</span> = C√≤n l·∫°i: <span
                            id="saleRemainingPointsHeader">0</span>)</span>
                </div>
            </div>

            <!-- Delivery Info Row -->
            <div
                style="background: white; padding: 12px 20px; border-bottom: 1px solid #e5e7eb; display: flex; gap: 24px; flex-wrap: wrap; align-items: flex-end;">
                <div style="min-width: 200px;">
                    <label class="sale-label">ƒê·ªëi t√°c giao h√†ng</label>
                    <select id="saleDeliveryPartner" class="sale-input" style="width: 100%;">
                        <option value="">ƒêang t·∫£i...</option>
                    </select>
                </div>
                <div style="min-width: 120px;">
                    <label class="sale-label">Ph√≠ giao h√†ng</label>
                    <input type="number" id="saleShippingFee" class="sale-input" value="35000" style="width: 100%;">
                </div>
                <div style="min-width: 120px;">
                    <label class="sale-label">Giao h√†ng thu ti·ªÅn</label>
                    <input type="number" id="saleCOD" class="sale-input" value="0" style="width: 100%;">
                </div>
                <div style="min-width: 120px;">
                    <label class="sale-label">C√≤n ph·∫£i tr·∫£</label>
                    <span id="saleRemainingBalance" style="display: block; font-weight: 600; font-size: 14px; color: #ef4444; padding: 8px 12px; background: #fef2f2; border-radius: 4px; border: 1px solid #fecaca;">0</span>
                </div>
            </div>

            <!-- Tabs (only Receiver tab visible) -->
            <div style="background: white; padding: 0 20px; border-bottom: 1px solid #e5e7eb;">
                <div style="display: flex; gap: 0;">
                    <button class="sale-tab active" data-tab="receiver" onclick="switchSaleTab('receiver')">Th√¥ng tin
                        ng∆∞·ªùi nh·∫≠n</button>
                </div>
            </div>

            <!-- Tab Contents -->
            <div style="background: white; padding: 20px;">
                <!-- Info Tab (hidden but elements kept for JS compatibility) -->
                <div id="saleTabInfo" class="sale-tab-content" style="display: none !important;">
                    <div id="saleCustomerName" style="display: none;"></div>
                    <div id="saleCustomerStatus" style="display: none;"></div>
                    <div id="saleLoyaltyPoints" style="display: none;">0</div>
                    <div id="saleUsedPoints" style="display: none;">0</div>
                    <div id="saleRemainingPoints" style="display: none;">0</div>
                    <select id="salePaymentMethod" class="sale-input" style="display: none;">
                        <option value="cash">Ti·ªÅn m·∫∑t</option>
                        <option value="transfer">Chuy·ªÉn kho·∫£n</option>
                        <option value="cod">COD</option>
                    </select>
                    <input type="text" id="saleShipper" class="sale-input" style="display: none;"
                        placeholder="Ng∆∞·ªùi giao h√†ng">
                    <div id="saleOldDebt" class="sale-value" style="display: none;">0</div>
                </div>

                <!-- Delivery Tab (hidden but elements kept for JS compatibility) -->
                <div id="saleTabDelivery" class="sale-tab-content" style="display: none !important;">
                    <!-- Hidden delivery fields for JS compatibility -->
                    <input type="number" id="saleLength" value="0" style="display: none;">
                    <input type="number" id="saleWidth" value="0" style="display: none;">
                    <input type="number" id="saleHeight" value="0" style="display: none;">
                    <input type="number" id="saleWeight" value="100" style="display: none;">
                    <textarea id="saleDeliveryNote" style="display: none;"></textarea>
                    <input type="number" id="saleGoodsValue" value="0" style="display: none;">
                </div>

                <!-- Receiver Tab (now default active) -->
                <div id="saleTabReceiver" class="sale-tab-content active">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 16px;">
                        <div>
                            <label class="sale-label">T√™n ng∆∞·ªùi nh·∫≠n</label>
                            <input type="text" id="saleReceiverName" class="sale-input" placeholder="T√™n ng∆∞·ªùi nh·∫≠n">
                        </div>
                        <div>
                            <label class="sale-label">ƒêi·ªán tho·∫°i</label>
                            <input type="text" id="saleReceiverPhone" class="sale-input" placeholder="S·ªë ƒëi·ªán tho·∫°i">
                        </div>
                        <div>
                            <label class="sale-label">Ng√†y giao</label>
                            <input type="datetime-local" id="saleDeliveryDate" class="sale-input">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px;">
                        <div>
                            <label class="sale-label">ƒê·ªãa ch·ªâ giao h√†ng</label>
                            <textarea id="saleReceiverAddress" class="sale-input" rows="2"
                                placeholder="ƒê·ªãa ch·ªâ giao h√†ng..."></textarea>
                        </div>
                        <div>
                            <label class="sale-label">Ghi ch√∫</label>
                            <textarea id="saleReceiverNote" class="sale-input" rows="2"
                                placeholder="Ghi ch√∫..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Other Tab (hidden but elements kept for JS compatibility) -->
                <div id="saleTabOther" class="sale-tab-content" style="display: none !important;">
                    <div id="saleSeller" style="display: none;"></div>
                    <div id="saleInvoiceDate" style="display: none;"></div>
                    <div id="saleStatus" style="display: none;">Nh√°p</div>
                    <input type="text" id="saleSeri" style="display: none;">
                    <input type="datetime-local" id="saleRedInvoiceDate" style="display: none;">
                    <input type="text" id="saleRedInvoiceNumber" style="display: none;">
                    <input type="text" id="saleOtherNote" style="display: none;">
                </div>

                <!-- Images Tab (hidden but elements kept for JS compatibility) -->
                <div id="saleTabImages" class="sale-tab-content" style="display: none !important;">
                    <div id="saleImagesContainer" style="display: none;"></div>
                </div>
            </div>

            <!-- Products Section -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; background: #f9fafb;">
                <!-- Left: Product Search -->
                <div style="background: white; border-radius: 8px; padding: 16px; border: 1px solid #e5e7eb;">
                    <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                        <input type="text" id="saleProductSearch" class="sale-input" placeholder="T√¨m ki·∫øm [F2]..."
                            style="flex: 1;">
                        <select id="saleProductCategory" class="sale-input" style="width: 100px;">
                            <option value="">T·∫•t c·∫£</option>
                        </select>
                        <select id="saleProductSort" class="sale-input" style="width: 100px;">
                            <option value="best">B√°n ch·∫°y</option>
                        </select>
                        <button class="sale-btn sale-btn-default"><i class="fas fa-trash"></i> X√≥a cache sao
                            ch√©p</button>
                    </div>
                    <table class="sale-product-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;">·∫¢nh</th>
                                <th>T√™n s·∫£n ph·∫©m</th>
                                <th style="width: 60px;">ƒê∆°n v·ªã t√≠nh</th>
                                <th style="width: 80px;">Gi√°</th>
                            </tr>
                        </thead>
                        <tbody id="saleProductList">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Right: Order Items -->
                <div style="background: white; border-radius: 8px; padding: 16px; border: 1px solid #e5e7eb;">
                    <div style="display: flex; gap: 16px; margin-bottom: 16px; align-items: center;">
                        <div>
                            <label class="sale-label">Ng√†y tr·∫£ tr∆∞·ªõc</label>
                            <input type="datetime-local" id="salePrepaidDate" class="sale-input">
                        </div>
                        <div>
                            <!--
                                salePrepaidAmount: Tr·∫£ tr∆∞·ªõc (C√¥ng n·ª£) - S·ªë ti·ªÅn kh√°ch ƒë√£ tr·∫£ tr∆∞·ªõc
                                Data source: REALTIME t·ª´ API /api/sepay/debt-summary?phone=xxx
                                (C√πng ngu·ªìn v·ªõi c·ªôt "C√¥ng N·ª£" trong b·∫£ng orders)
                                Populated by: fetchDebtForSaleModal() in tab1-orders.js
                                Field disabled: ch·ªâ admin c√≥ th·ªÉ s·ª≠a, c√≥ n√∫t x√°c nh·∫≠n ƒë·ªÉ c·∫≠p nh·∫≠t DB
                            -->
                            <label class="sale-label">Tr·∫£ tr∆∞·ªõc (C√¥ng n·ª£)</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="number" id="salePrepaidAmount" class="sale-input" value="0"
                                    style="width: 120px; background: #f3f4f6;" disabled>
                                <button id="confirmDebtBtn" class="sale-btn sale-btn-teal"
                                    style="display: none; padding: 6px 12px; font-size: 12px;"
                                    onclick="confirmDebtUpdate()">X√°c nh·∫≠n</button>
                            </div>
                        </div>
                    </div>
                    <table class="sale-product-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;">STT</th>
                                <th>S·∫£n ph·∫©m</th>
                                <th style="width: 80px;">S·ªë l∆∞·ª£ng</th>
                                <th style="width: 100px;">ƒê∆°n gi√°</th>
                                <th style="width: 100px;">T·ªïng</th>
                                <th style="width: 50px;"></th>
                            </tr>
                        </thead>
                        <tbody id="saleOrderItems">
                            <!-- Order items will be loaded here -->
                        </tbody>
                    </table>
                    <div style="margin-top: 16px; text-align: right;">
                        <div style="display: flex; justify-content: flex-end; gap: 40px; margin-bottom: 8px;">
                            <span style="color: #6b7280;">T·ªïng s·ªë l∆∞·ª£ng:</span>
                            <span id="saleTotalQuantity" style="font-weight: 600;">0</span>
                        </div>
                        <div style="display: flex; justify-content: flex-end; gap: 40px; margin-bottom: 8px;">
                            <span style="color: #6b7280;">T·ªïng:</span>
                            <span id="saleTotalAmount" style="font-weight: 600; color: #3b82f6;">0</span>
                        </div>
                        <div
                            style="display: flex; justify-content: flex-end; gap: 40px; align-items: center; margin-bottom: 8px;">
                            <span style="color: #6b7280;">Gi·∫£m gi√°:</span>
                            <input type="number" id="saleDiscount" class="sale-input" value="0"
                                style="width: 100px; text-align: right;">
                        </div>
                        <div
                            style="display: flex; justify-content: flex-end; gap: 40px; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                            <span style="font-weight: 600;">T·ªïng ti·ªÅn:</span>
                            <span id="saleFinalTotal"
                                style="font-weight: 600; font-size: 18px; color: #3b82f6;">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Zoom Overlay -->
    <div id="imageZoomOverlay" class="image-zoom-overlay" onclick="closeImageZoom()">
        <div class="image-zoom-container" onclick="event.stopPropagation()">
            <button class="image-zoom-close" onclick="closeImageZoom()">
                <i class="fas fa-times"></i>
            </button>
            <img id="imageZoomImg" src="" alt="Zoomed Image">
            <div id="imageZoomCaption" style="
                position: absolute;
                bottom: -40px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 8px 16px;
                border-radius: 6px;
                font-size: 14px;
                white-space: nowrap;
                max-width: 90%;
                overflow: hidden;
                text-overflow: ellipsis;
            "></div>
        </div>
    </div>

    <!-- Fast Sale Modal -->
    <div class="merge-modal" id="fastSaleModal">
        <div class="merge-modal-content" style="max-width: 1200px;">
            <!-- Header -->
            <div class="merge-modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <div class="merge-header-info">
                    <h3><i class="fas fa-file-invoice-dollar"></i> Th√™m h√≥a ƒë∆°n nhanh</h3>
                    <p id="fastSaleModalSubtitle">T·∫°o phi·∫øu b√°n h√†ng t·ª´ c√°c ƒë∆°n ƒë√£ ch·ªçn</p>
                </div>
                <div class="merge-header-actions">
                    <button class="merge-modal-close" onclick="closeFastSaleModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="merge-modal-body" id="fastSaleModalBody">
                <div class="merge-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="merge-modal-footer">
                <button class="merge-btn-cancel" onclick="closeFastSaleModal()">
                    <i class="fas fa-times"></i> ƒê√≥ng
                </button>
                <button class="merge-btn-confirm" id="confirmFastSaleBtn" onclick="confirmFastSale()">
                    <i class="fas fa-check"></i> L∆∞u
                </button>
                <button class="merge-btn-confirm" id="confirmAndCheckFastSaleBtn" onclick="confirmAndCheckFastSale()"
                    style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                    <i class="fas fa-check-double"></i> L∆∞u x√°c nh·∫≠n
                </button>
            </div>
        </div>
    </div>

    <!-- Fast Sale Results Modal -->
    <div class="merge-modal" id="fastSaleResultsModal">
        <div class="merge-modal-content" style="max-width: 1400px;">
            <!-- Header -->
            <div class="merge-modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                <div class="merge-header-info">
                    <h3><i class="fas fa-poll"></i> K·∫øt qu·∫£ ƒë∆°n h√†ng</h3>
                </div>
                <div class="merge-header-actions">
                    <button class="merge-modal-close" onclick="closeFastSaleResultsModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="fast-sale-results-tabs">
                <button class="fast-sale-results-tab active" data-tab="forced" onclick="switchResultsTab('forced')">
                    C∆∞·ª°ng b·ª©c (<span id="forcedCount">0</span> ƒë∆°n)
                </button>
                <button class="fast-sale-results-tab" data-tab="failed" onclick="switchResultsTab('failed')">
                    Th·∫•t b·∫°i (<span id="failedCount">0</span> ƒë∆°n)
                </button>
                <button class="fast-sale-results-tab" data-tab="success" onclick="switchResultsTab('success')">
                    Th√†nh c√¥ng (<span id="successCount">0</span> ƒë∆°n)
                </button>
            </div>

            <!-- Tab Content -->
            <div class="merge-modal-body" id="fastSaleResultsBody" style="padding: 0;">
                <!-- Forced Tab -->
                <div class="fast-sale-results-content active" id="forcedTab">
                    <div style="padding: 20px;">
                        <div id="forcedOrdersTable"></div>
                        <div style="margin-top: 20px;">
                            <button class="merge-btn-confirm" id="createForcedBtn" onclick="createForcedOrders()"
                                style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                <i class="fas fa-bolt"></i> T·∫°o c∆∞·ª°ng b·ª©c
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Failed Tab -->
                <div class="fast-sale-results-content" id="failedTab">
                    <div style="padding: 20px;">
                        <div id="failedOrdersTable"></div>
                    </div>
                </div>

                <!-- Success Tab -->
                <div class="fast-sale-results-content" id="successTab">
                    <div style="padding: 20px;">
                        <div id="successOrdersTable"></div>
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="merge-btn-confirm" id="printInvoiceBtn" onclick="printSuccessOrders('invoice')"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                <i class="fas fa-print"></i> In h√≥a ƒë∆°n
                            </button>
                            <button class="merge-btn-confirm" id="printShippingBtn" onclick="printSuccessOrders('shipping')"
                                style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">
                                <i class="fas fa-print"></i> In phi·∫øu ship
                            </button>
                            <button class="merge-btn-confirm" id="printPickingBtn" onclick="printSuccessOrders('picking')"
                                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                <i class="fas fa-print"></i> In so·∫°n h√†ng
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="merge-modal-footer">
                <button class="merge-btn-cancel" onclick="closeFastSaleResultsModal()">
                    <i class="fas fa-times"></i> ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Bill Template Settings Modal -->
    <div class="merge-modal" id="billTemplateSettingsModal">
        <div class="merge-modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="merge-modal-header" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <div class="merge-header-info">
                    <h3><i class="fas fa-file-invoice"></i> C√†i ƒê·∫∑t M·∫´u Bill</h3>
                    <p style="font-size: 13px; opacity: 0.9;">T√πy ch·ªânh n·ªôi dung v√† b·ªë c·ª•c h√≥a ƒë∆°n</p>
                </div>
                <button class="merge-close-btn" onclick="closeBillTemplateSettings()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; flex-wrap: wrap;">
                    <button class="bill-settings-tab active" data-tab="general" onclick="switchBillSettingsTab('general')">
                        <i class="fas fa-cog"></i> Th√¥ng tin chung
                    </button>
                    <button class="bill-settings-tab" data-tab="sections" onclick="switchBillSettingsTab('sections')">
                        <i class="fas fa-th-list"></i> Hi·ªÉn th·ªã
                    </button>
                    <button class="bill-settings-tab" data-tab="style" onclick="switchBillSettingsTab('style')">
                        <i class="fas fa-palette"></i> Ki·ªÉu d√°ng
                    </button>
                    <button class="bill-settings-tab" data-tab="preview" onclick="switchBillSettingsTab('preview')">
                        <i class="fas fa-eye"></i> Xem tr∆∞·ªõc
                    </button>
                </div>
                <!-- General Tab -->
                <div class="bill-settings-content active" id="billSettingsGeneral">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="bill-settings-group">
                            <h4 style="margin-bottom: 12px; color: #374151;"><i class="fas fa-store"></i> Th√¥ng tin shop</h4>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-weight: 500;">T√™n shop:</label>
                                <input type="text" id="billShopName" placeholder="VD: NJD Live" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                            </div>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-weight: 500;">Hotline:</label>
                                <input type="text" id="billShopPhone" placeholder="VD: 090 8888 674" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                            </div>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-weight: 500;">ƒê·ªãa ch·ªâ:</label>
                                <input type="text" id="billShopAddress" placeholder="(t√πy ch·ªçn)" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                            </div>
                        </div>
                        <div class="bill-settings-group">
                            <h4 style="margin-bottom: 12px; color: #374151;"><i class="fas fa-heading"></i> Ti√™u ƒë·ªÅ & Footer</h4>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-weight: 500;">Ti√™u ƒë·ªÅ bill:</label>
                                <input type="text" id="billTitle" placeholder="PHI·∫æU B√ÅN H√ÄNG" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                            </div>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-weight: 500;">Text footer:</label>
                                <textarea id="billFooterText" rows="2" placeholder="C·∫£m ∆°n qu√Ω kh√°ch!" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Sections Tab -->
                <div class="bill-settings-content" id="billSettingsSections" style="display: none;">
                    <h4 style="margin-bottom: 15px; color: #374151;"><i class="fas fa-eye"></i> Ch·ªçn c√°c ph·∫ßn hi·ªÉn th·ªã</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowHeader" checked><span><i class="fas fa-store"></i> Header (Shop, Hotline)</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowTitle" checked><span><i class="fas fa-heading"></i> Ti√™u ƒë·ªÅ bill</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowSTT" checked><span><i class="fas fa-sort-numeric-down"></i> STT (S·ªë th·ª© t·ª±)</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowBarcode" checked><span><i class="fas fa-barcode"></i> Barcode</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowOrderInfo" checked><span><i class="fas fa-info-circle"></i> Th√¥ng tin ƒë∆°n</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowCarrier" checked><span><i class="fas fa-truck"></i> ƒêVVC</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowCustomer" checked><span><i class="fas fa-user"></i> Kh√°ch h√†ng</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowSeller" checked><span><i class="fas fa-user-tie"></i> Ng∆∞·ªùi b√°n</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowProducts" checked><span><i class="fas fa-box"></i> B·∫£ng s·∫£n ph·∫©m</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowTotals" checked><span><i class="fas fa-calculator"></i> T·ªïng c·ªông</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowCOD" checked><span><i class="fas fa-money-bill-wave"></i> COD</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowDeliveryNote" checked><span><i class="fas fa-sticky-note"></i> Ghi ch√∫ giao h√†ng</span></label>
                        <label class="bill-toggle-item"><input type="checkbox" id="billShowFooter" checked><span><i class="fas fa-shoe-prints"></i> Footer</span></label>
                    </div>
                </div>
                <!-- Style Tab -->
                <div class="bill-settings-content" id="billSettingsStyle" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="bill-settings-group">
                            <h4 style="margin-bottom: 12px; color: #374151;"><i class="fas fa-text-height"></i> Font size (px)</h4>
                            <div style="margin-bottom: 10px;"><label>T√™n shop:</label><input type="number" id="billFontShopName" value="18" min="12" max="30" style="width: 80px; padding: 6px; margin-left: 10px; border: 1px solid #d1d5db; border-radius: 4px;"></div>
                            <div style="margin-bottom: 10px;"><label>Ti√™u ƒë·ªÅ:</label><input type="number" id="billFontTitle" value="16" min="12" max="28" style="width: 80px; padding: 6px; margin-left: 10px; border: 1px solid #d1d5db; border-radius: 4px;"></div>
                            <div style="margin-bottom: 10px;"><label>N·ªôi dung:</label><input type="number" id="billFontContent" value="13" min="10" max="18" style="width: 80px; padding: 6px; margin-left: 10px; border: 1px solid #d1d5db; border-radius: 4px;"></div>
                            <div style="margin-bottom: 10px;"><label>COD:</label><input type="number" id="billFontCOD" value="18" min="14" max="28" style="width: 80px; padding: 6px; margin-left: 10px; border: 1px solid #d1d5db; border-radius: 4px;"></div>
                        </div>
                        <div class="bill-settings-group">
                            <h4 style="margin-bottom: 12px; color: #374151;"><i class="fas fa-ruler"></i> K√≠ch th∆∞·ªõc</h4>
                            <div style="margin-bottom: 10px;"><label>Chi·ªÅu r·ªông:</label>
                                <select id="billWidth" style="padding: 6px; margin-left: 10px; border: 1px solid #d1d5db; border-radius: 4px;">
                                    <option value="58mm">58mm</option><option value="80mm" selected>80mm</option><option value="100mm">100mm</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;"><label>Padding:</label><input type="number" id="billPadding" value="20" min="5" max="40" style="width: 80px; padding: 6px; margin-left: 10px; border: 1px solid #d1d5db; border-radius: 4px;"></div>
                            <h4 style="margin: 15px 0 12px; color: #374151;"><i class="fas fa-palette"></i> M√†u COD</h4>
                            <div style="margin-bottom: 10px;"><label>N·ªÅn:</label><input type="color" id="billCODBackground" value="#fef3c7" style="width: 50px; height: 30px; margin-left: 10px; border: none; cursor: pointer;"></div>
                            <div style="margin-bottom: 10px;"><label>Vi·ªÅn:</label><input type="color" id="billCODBorder" value="#f59e0b" style="width: 50px; height: 30px; margin-left: 10px; border: none; cursor: pointer;"></div>
                        </div>
                    </div>
                </div>
                <!-- Preview Tab -->
                <div class="bill-settings-content" id="billSettingsPreview" style="display: none;">
                    <button class="btn-primary" onclick="previewBillTemplate()" style="margin-bottom: 15px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                        <i class="fas fa-sync-alt"></i> C·∫≠p nh·∫≠t xem tr∆∞·ªõc
                    </button>
                    <div id="billPreviewContainer" style="border: 2px dashed #d1d5db; border-radius: 8px; padding: 10px; background: #f9fafb; min-height: 300px; overflow: auto; max-height: 500px;">
                        <p style="color: #9ca3af; padding: 40px; text-align: center;">Nh·∫•n "C·∫≠p nh·∫≠t xem tr∆∞·ªõc" ƒë·ªÉ xem bill m·∫´u</p>
                    </div>
                </div>
            </div>
            <div class="merge-modal-footer" style="display: flex; justify-content: space-between;">
                <button class="merge-btn-cancel" onclick="resetBillTemplateSettings()" style="background: #ef4444;"><i class="fas fa-undo"></i> ƒê·∫∑t l·∫°i m·∫∑c ƒë·ªãnh</button>
                <div style="display: flex; gap: 10px;">
                    <button class="merge-btn-cancel" onclick="closeBillTemplateSettings()"><i class="fas fa-times"></i> H·ªßy</button>
                    <button class="merge-btn-confirm" onclick="saveBillTemplateSettings()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"><i class="fas fa-save"></i> L∆∞u</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
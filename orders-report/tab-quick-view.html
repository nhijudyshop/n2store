<!doctype html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick View - 50 Orders</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="tab-quick-view.css" />
</head>

<body>
    <div class="quick-view-container">
        <!-- Header -->
        <div class="quick-view-header">
            <div class="header-left">
                <h3><i class="fas fa-bolt"></i> Quick View</h3>
                <span class="order-count" id="orderCount">0 orders</span>
            </div>
            <div class="header-right">
                <!-- Auto-refresh controls -->
                <div class="refresh-control">
                    <label for="refreshIntervalSelect">Auto:</label>
                    <select id="refreshIntervalSelect" onchange="updateRefreshInterval(this.value)">
                        <option value="3000">3s</option>
                        <option value="5000" selected>5s</option>
                        <option value="10000">10s</option>
                        <option value="15000">15s</option>
                        <option value="30000">30s</option>
                        <option value="60000">60s</option>
                    </select>
                    <button class="btn-save-interval" onclick="saveDefaultInterval()" title="Lưu mặc định">
                        <i class="fas fa-save"></i>
                    </button>
                    <span class="last-refresh" id="lastRefreshTime">--</span>
                </div>
                <!-- Column Settings -->
                <button class="btn-column-settings" onclick="openColumnSettingsModal()" title="Cài đặt cột">
                    <i class="fas fa-columns"></i> Cột
                </button>
                <!-- Manual refresh -->
                <button class="btn-refresh" onclick="manualRefresh()" title="Làm mới (F5)">
                    <i class="fas fa-sync-alt"></i> Làm mới
                </button>
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Đang tải...</span>
            </div>
        </div>

        <!-- Table container -->
        <div class="quick-view-table-container" id="tableContainer">
            <table class="quick-view-table" id="ordersTable">
                <thead>
                    <tr>
                        <th data-column="stt">STT</th>
                        <th data-column="name">Tên KH</th>
                        <th data-column="phone">SĐT</th>
                        <th data-column="tag">TAG</th>
                        <th data-column="note">Ghi chú</th>
                        <th data-column="debt">Công nợ</th>
                        <th data-column="address">Địa chỉ</th>
                        <th data-column="qr">QR</th>
                        <th data-column="chat">Chat</th>
                        <th data-column="edit">Sửa</th>
                        <th data-column="total">Tổng tiền</th>
                        <th data-column="paid">Đã CK</th>
                        <th data-column="date">Ngày tạo</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Orders will be rendered here -->
                </tbody>
            </table>
            <!-- Pagination Info -->
            <div class="pagination-info" id="paginationInfo">
                <span class="page-info" id="pageInfo">Hiển thị 0 đơn</span>
                <span class="scroll-hint" id="scrollHint">Cuộn xuống để tải thêm</span>
            </div>
        </div>
    </div>

    <!-- Column Settings Modal -->
    <div class="column-settings-modal" id="columnSettingsModal">
        <div class="column-settings-content">
            <div class="column-settings-header">
                <h3><i class="fas fa-columns"></i> Cài đặt hiển thị cột</h3>
                <button class="modal-close-btn" onclick="closeColumnSettingsModal()">&times;</button>
            </div>
            <div class="column-settings-body" id="columnSettingsBody">
                <!-- Column toggles will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Tag Modal -->
    <div class="tag-modal" id="tagModal">
        <div class="tag-modal-content">
            <div class="tag-modal-header">
                <button class="tag-btn-save-header" onclick="saveOrderTags()">
                    Lưu (Ctrl + Enter)
                </button>
                <button class="tag-btn-refresh" onclick="openCreateTagModal()" title="Tạo tag mới"
                    style="margin-left: 8px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="tag-btn-refresh" onclick="refreshTags()" title="Tải lại từ TPOS"
                    style="margin-left: 8px; padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    <i class="fas fa-sync"></i>
                </button>
                <button class="tag-modal-close" onclick="closeTagModal()">
                    X
                </button>
            </div>
            <div class="tag-modal-body">
                <div class="tag-input-container">
                    <div class="selected-tags-pills" id="selectedTagsPills"></div>
                    <input type="text" id="tagSearchInput" class="tag-add-input" placeholder="Add a tag"
                        oninput="filterTags()" onkeydown="handleTagInputKeydown(event)" />
                </div>
                <div class="tag-dropdown-list" id="tagList">
                    <div class="no-tags-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Đang tải danh sách tag...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Tag Modal -->
    <div class="tag-modal" id="createTagModal" style="display: none;">
        <div class="tag-modal-content" style="max-width: 500px;">
            <div class="tag-modal-header">
                <h3><i class="fas fa-plus-circle"></i> Tạo tag mới</h3>
                <button class="tag-modal-close" onclick="closeCreateTagModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tag-modal-body">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151;">
                        <i class="fas fa-tag"></i> Tên tag:
                    </label>
                    <input type="text" id="newTagName" placeholder="Nhập tên tag..."
                        style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;" />
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151;">
                        <i class="fas fa-palette"></i> Màu sắc:
                    </label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="color" id="newTagColor" value="#3b82f6"
                            style="width: 60px; height: 40px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;"
                            onchange="syncColorFromPicker()" oninput="syncColorFromPicker()" />
                        <input type="text" id="newTagColorHex" value="#3b82f6" placeholder="#000000"
                            style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-family: monospace; font-size: 14px;"
                            oninput="updateColorPreview()" />
                    </div>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeCreateTagModal()"
                        style="padding: 10px 20px; background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;">
                        Hủy
                    </button>
                    <button onclick="createNewTag()"
                        style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        <i class="fas fa-check"></i> Tạo tag
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Modal -->
    <div id="orderQRModal" class="modal-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10002; justify-content: center; align-items: center;">
        <div class="modal-content"
            style="background: white; max-width: 420px; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div class="modal-header"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-qrcode"></i> QR Chuyển Khoản
                </h3>
                <button onclick="closeOrderQRModal()"
                    style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
            </div>
            <div id="orderQRModalBody" style="padding: 20px; text-align: center;">
            </div>
        </div>
    </div>

    <!-- Note Edit Modal -->
    <div id="noteEditModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-sticky-note"></i> Sửa ghi chú</h3>
                <button onclick="closeNoteModal()" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <textarea id="noteEditInput" rows="4" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 16px;">
                    <button onclick="closeNoteModal()" style="padding: 8px 16px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer;">Hủy</button>
                    <button onclick="saveNote()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        <i class="fas fa-save"></i> Lưu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Core Managers -->
    <script src="api-config.js"></script>
    <script src="token-manager.js"></script>
    <script src="cache.js"></script>
    <script src="auth.js"></script>
    <script src="notification-system.js"></script>
    <script src="pancake-token-manager.js"></script>
    <script src="pancake-data-manager.js"></script>

    <!-- Tab Logic -->
    <script src="tab-quick-view.js"></script>
</body>

</html>

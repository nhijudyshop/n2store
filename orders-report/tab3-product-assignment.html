<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gán Sản Phẩm - STT</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="tab3-product-assignment.css" />
</head>
<body>
    <!-- Main Container -->
    <div class="container-fluid p-4">
        <!-- Header -->
        <div class="header-section mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2><i class="fas fa-link"></i> Gán Sản Phẩm - Số Thứ Tự Đơn Hàng</h2>
                    <p class="text-muted mb-0">Liên kết sản phẩm với số thứ tự đơn hàng</p>
                </div>
                <div>
                    <button class="btn btn-sm btn-outline-primary" onclick="window.location.reload()">
                        <i class="fas fa-sync"></i> Reload
                    </button>
                    <span class="badge bg-info ms-2" id="ordersCountBadge">
                        <i class="fas fa-database"></i> <span id="ordersCount">0</span> đơn hàng
                    </span>
                </div>
            </div>
        </div>

        <!-- Product Search Section -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-search"></i> Tìm kiếm sản phẩm</h5>
            </div>
            <div class="card-body">
                <div class="search-wrapper position-relative">
                    <input
                        type="text"
                        class="form-control form-control-lg"
                        id="productSearch"
                        placeholder="Nhập mã hoặc barcode sản phẩm..."
                        autocomplete="off"
                    />
                    <div class="suggestions-dropdown" id="productSuggestions"></div>
                </div>
                <div id="loadingIndicator" class="text-center mt-3" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Đang tải...</span>
                    </div>
                    <p class="mt-2">Đang tải dữ liệu sản phẩm...</p>
                </div>
            </div>
        </div>

        <!-- Assignment Table -->
        <div class="card">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-table"></i> Danh sách gán (<span id="assignmentCount">0</span>)</h5>
                <button class="btn btn-light btn-sm" onclick="clearAllAssignments()">
                    <i class="fas fa-trash"></i> Xóa tất cả
                </button>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 50%">Sản phẩm</th>
                                <th style="width: 40%">STT Đơn Hàng</th>
                                <th style="width: 10%">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentTableBody">
                            <tr>
                                <td colspan="3" class="text-center text-muted py-5">
                                    <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                                    Chưa có sản phẩm nào được gán. Hãy tìm kiếm và thêm sản phẩm.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Info Tooltip (Hidden by default) -->
    <div class="order-tooltip" id="orderTooltip"></div>

    <!-- Scripts -->
    <script src="token-manager.js"></script>
    <script src="cache.js"></script>
    <script src="auth.js"></script>
    <script src="notification-system.js"></script>
    <script src="tab3-product-assignment.js"></script>
</body>
</html>

<!--
  üìñ GHI CH√ö CHO L·∫¨P TR√åNH VI√äN:
  Khi code ph·∫£i ƒë·ªçc th∆∞ m·ª•c https://github.com/nhijudyshop/n2store/tree/main/docs tr∆∞·ªõc!
  ƒê·ªçc c√°c file SHARED_*.md ƒë·ªÉ hi·ªÉu c√°ch s·ª≠ d·ª•ng shared modules.
-->
<!doctype html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <title>S·ªï Order</title>
    <meta http-equiv="Cache-Control" content="public, max-age=31536000" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- External CSS -->
    <link rel="stylesheet" href="../hangrotxa/modern.css" />
    <link rel="stylesheet" href="css/soorder.css" />

    <!-- Navigation Manager -->
    <script src="../shared/js/core-loader.js"></script>
    <script src="../shared/js/navigation-modern.js"></script>
    <script src="../shared/js/common-utils.js"></script>

    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>

<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i data-lucide="zap"></i>
                <span>N2Shop</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i data-lucide="panel-left-close"></i>
            </button>
        </div>

        <nav class="sidebar-nav" id="sidebarNav">
            <!-- Menu items auto-generated -->
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i data-lucide="user-circle"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Admin</div>
                    <div class="user-role">Qu·∫£n tr·ªã vi√™n</div>
                </div>
            </div>
            <button class="btn-permissions" id="btnPermissions">
                <i data-lucide="shield-check"></i>
                <span>Xem Quy·ªÅn C·ªßa T√¥i</span>
            </button>
            <button class="btn-logout" id="btnLogout">
                <i data-lucide="log-out"></i>
                <span>ƒêƒÉng xu·∫•t</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <button class="btn-icon" id="menuToggle">
                    <i data-lucide="menu"></i>
                </button>
                <div class="breadcrumb">
                    <i data-lucide="notebook-pen"></i>
                    <span>S·ªï Order</span>
                </div>
            </div>
            <div class="top-bar-right">
                <button class="btn-icon" id="btnManageNCC" title="Qu·∫£n l√Ω t√™n NCC">
                    <i data-lucide="building-2"></i>
                </button>
                <button class="btn-icon" id="btnManageHolidays" title="Qu·∫£n l√Ω ng√†y ngh·ªâ">
                    <i data-lucide="calendar"></i>
                </button>
            </div>
        </header>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Date Navigation -->
            <div class="date-navigation">
                <div class="date-nav-left">
                    <!-- Quick date range buttons -->
                    <div class="quick-date-buttons">
                        <button class="btn-quick-date" id="btn7Days" title="7 ng√†y g·∫ßn nh·∫•t">7N</button>
                        <button class="btn-quick-date" id="btn15Days" title="15 ng√†y g·∫ßn nh·∫•t">15N</button>
                        <button class="btn-quick-date" id="btn30Days" title="30 ng√†y g·∫ßn nh·∫•t">30N</button>
                    </div>
                    <button class="btn-icon btn-nav" id="btnPrevDay" title="Ng√†y tr∆∞·ªõc (‚Üê)">
                        <i data-lucide="chevron-left"></i>
                    </button>
                    <div class="date-selector-container">
                        <input type="date" id="dateInput" class="date-input" />
                        <select class="date-selector" id="dateSelector">
                            <option value="current" id="currentDateOption">H√¥m nay</option>
                            <option value="today">H√¥m nay</option>
                            <option value="3days">3 ng√†y</option>
                            <option value="7days">7 ng√†y</option>
                            <option value="10days">10 ng√†y</option>
                            <option value="single">1 ng√†y...</option>
                            <option value="custom">Nhi·ªÅu ng√†y...</option>
                        </select>
                    </div>
                    <button class="btn-icon btn-nav" id="btnNextDay" title="Ng√†y sau (‚Üí)">
                        <i data-lucide="chevron-right"></i>
                    </button>
                    <label class="unpaid-filter-checkbox" id="unpaidFilterLabel">
                        <input type="checkbox" id="unpaidFilterCheckbox" />
                        <span>Ch·ªâ ch∆∞a thanh to√°n</span>
                    </label>
                    <label class="unpaid-filter-checkbox" id="discrepancyFilterLabel">
                        <input type="checkbox" id="discrepancyFilterCheckbox" />
                        <span>Ch√™nh l·ªách</span>
                    </label>
                    <div class="ncc-filter-container">
                        <input type="text" id="nccFilterInput" class="ncc-filter-input" placeholder="L·ªçc NCC..."
                            autocomplete="off" />
                        <button class="btn-icon btn-clear-filter" id="btnClearNCCFilter" title="X√≥a b·ªô l·ªçc"
                            style="display: none;">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                <div class="date-nav-right" id="holidayBadge" style="display: none;">
                    <span class="badge badge-holiday">
                        <i data-lucide="palm-tree"></i>
                        Ng√†y ngh·ªâ
                    </span>
                </div>
            </div>

            <!-- Add Order Form (Inline, hidden by default) -->
            <div class="add-order-form-container" id="addOrderFormContainer" style="display: none;">
                <div class="add-order-form">
                    <div class="form-header">
                        <h3>
                            <i data-lucide="plus-circle"></i>
                            Th√™m ƒë∆°n h√†ng m·ªõi
                        </h3>
                        <button class="btn-icon" id="btnCloseAddForm">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <div class="form-body">
                        <div class="form-row">
                            <div class="form-group required">
                                <label>NCC <span class="required-mark">*</span></label>
                                <div class="ncc-input-wrapper">
                                    <input type="text" id="addSupplier" placeholder="Nh·∫≠p t√™n nh√† cung c·∫•p"
                                        autocomplete="off" />
                                    <div class="ncc-suggestions" id="addSupplierSuggestions"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Th√†nh ti·ªÅn</label>
                                <input type="number" id="addAmount" placeholder="0" />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ch√™nh l·ªách</label>
                                <input type="number" id="addDifference" placeholder="0" />
                            </div>
                            <div class="form-group">
                                <label>Ghi ch√∫</label>
                                <input type="text" id="addNote" placeholder="Ghi ch√∫..." />
                            </div>
                        </div>
                        <!-- Holiday-specific fields (shown only on holidays) -->
                        <div class="form-row" id="holidayFieldsAdd" style="display: none;">
                            <div class="form-group">
                                <label>Ng∆∞·ªùi th·ª±c hi·ªán</label>
                                <input type="text" id="addPerformer" placeholder="T√™n ng∆∞·ªùi th·ª±c hi·ªán" />
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="addIsReconciled" />
                                    <span>ƒê√£ ƒë·ªëi so√°t</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-footer">
                        <button class="btn-secondary" id="btnCancelAdd">H·ªßy</button>
                        <button class="btn-primary" id="btnSubmitAdd">
                            <i data-lucide="plus"></i>
                            Th√™m ƒë∆°n h√†ng
                        </button>
                    </div>
                </div>
            </div>

            <!-- Toggle Add Form Button -->
            <div class="action-bar">
                <button class="btn-primary" id="btnToggleAddForm">
                    <i data-lucide="plus"></i>
                    Th√™m ƒë∆°n h√†ng
                </button>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <i data-lucide="package-open"></i>
                <p>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o trong ng√†y</p>
            </div>

            <!-- Orders Table -->
            <div class="table-container" id="tableContainer">
                <table class="order-table">
                    <thead>
                        <tr id="tableHeader">
                            <th style="width: 50px;">STT</th>
                            <th style="width: 150px;">NCC</th>
                            <th style="width: 200px; text-align: left;">Th√†nh Ti·ªÅn</th>
                            <th style="width: 130px; text-align: right;">Ch√™nh L·ªách</th>
                            <th>Ghi Ch√∫</th>
                            <!-- Holiday columns (shown only on holidays) -->
                            <th style="width: 150px;" class="holiday-col">Ng∆∞·ªùi th·ª±c hi·ªán</th>
                            <th style="width: 100px; text-align: center;" class="holiday-col">ƒê·ªëi so√°t</th>
                            <th style="width: 100px; text-align: center;">Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <!-- Rows will be generated by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Footer Summary -->
            <div class="footer-summary" id="footerSummary" style="display: none;">
                <div class="summary-item">
                    <span class="summary-label">T·ªïng th√†nh ti·ªÅn:</span>
                    <span class="summary-value" id="totalAmount">0</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">T·ªïng ch√™nh l·ªách:</span>
                    <span class="summary-value" id="totalDifference">0</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Edit Order Modal -->
    <div class="modal" id="editOrderModal" style="display: none;">
        <div class="modal-overlay" id="editModalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i data-lucide="edit"></i>
                    Ch·ªânh s·ª≠a ƒë∆°n h√†ng
                </h3>
                <button class="btn-icon" id="btnCloseEditModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group required">
                    <label>NCC <span class="required-mark">*</span></label>
                    <div class="ncc-input-wrapper">
                        <input type="text" id="editSupplier" placeholder="Nh·∫≠p t√™n nh√† cung c·∫•p" autocomplete="off" />
                        <div class="ncc-suggestions" id="editSupplierSuggestions"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Th√†nh ti·ªÅn</label>
                    <input type="number" id="editAmount" placeholder="0" />
                </div>
                <div class="form-group">
                    <label>Ch√™nh l·ªách</label>
                    <input type="number" id="editDifference" placeholder="0" />
                </div>
                <div class="form-group">
                    <label>Ghi ch√∫</label>
                    <input type="text" id="editNote" placeholder="Ghi ch√∫..." />
                </div>
                <!-- Holiday-specific fields -->
                <div id="holidayFieldsEdit" style="display: none;">
                    <div class="form-group">
                        <label>Ng∆∞·ªùi th·ª±c hi·ªán</label>
                        <input type="text" id="editPerformer" placeholder="T√™n ng∆∞·ªùi th·ª±c hi·ªán" />
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="editIsReconciled" />
                            <span>ƒê√£ ƒë·ªëi so√°t</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelEdit">H·ªßy</button>
                <button class="btn-primary" id="btnSubmitEdit">
                    <i data-lucide="save"></i>
                    L∆∞u thay ƒë·ªïi
                </button>
            </div>
        </div>
    </div>

    <!-- Holiday Management Modal -->
    <div class="modal" id="holidayModal" style="display: none;">
        <div class="modal-overlay" id="holidayModalOverlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>
                    <i data-lucide="calendar"></i>
                    Qu·∫£n l√Ω ng√†y ngh·ªâ
                </h3>
                <button class="btn-icon" id="btnCloseHolidayModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="calendar-controls">
                    <button class="btn-icon" id="btnPrevMonth">
                        <i data-lucide="chevron-left"></i>
                    </button>
                    <h4 id="calendarMonthYear">Th√°ng 12, 2025</h4>
                    <button class="btn-icon" id="btnNextMonth">
                        <i data-lucide="chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>
                <div class="calendar-legend">
                    <span class="legend-item">
                        <span class="legend-box today"></span>
                        H√¥m nay
                    </span>
                    <span class="legend-item">
                        <span class="legend-box holiday"></span>
                        Ng√†y ngh·ªâ
                    </span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelHoliday">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div class="modal" id="deleteConfirmModal" style="display: none;">
        <div class="modal-overlay" id="deleteModalOverlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>
                    <i data-lucide="alert-triangle"></i>
                    X√°c nh·∫≠n x√≥a
                </h3>
                <button class="btn-icon" id="btnCloseDeleteModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng n√†y?</p>
                <p class="text-muted">Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelDelete">H·ªßy</button>
                <button class="btn-danger" id="btnConfirmDelete">
                    <i data-lucide="trash-2"></i>
                    X√≥a
                </button>
            </div>
        </div>
    </div>

    <!-- Difference Note Modal -->
    <div class="modal" id="differenceNoteModal" style="display: none;">
        <div class="modal-overlay" id="differenceNoteModalOverlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>
                    <i data-lucide="file-check"></i>
                    Ghi ch√∫ x·ª≠ l√Ω ch√™nh l·ªách
                </h3>
                <button class="btn-icon" id="btnCloseDifferenceNoteModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ghi ch√∫ c√°ch x·ª≠ l√Ω <span class="required-mark">*</span></label>
                    <textarea id="differenceNoteInput" class="form-control" rows="3"
                        placeholder="Nh·∫≠p ghi ch√∫ v·ªÅ c√°ch x·ª≠ l√Ω ch√™nh l·ªách..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelDifferenceNote">H·ªßy</button>
                <button class="btn-primary" id="btnSaveDifferenceNote">
                    <i data-lucide="check"></i>
                    L∆∞u
                </button>
            </div>
        </div>
    </div>

    <!-- Date Range Picker Modal -->
    <div class="modal" id="dateRangeModal" style="display: none;">
        <div class="modal-overlay" id="dateRangeModalOverlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>
                    <i data-lucide="calendar-range"></i>
                    Ch·ªçn kho·∫£ng th·ªùi gian
                </h3>
                <button class="btn-icon" id="btnCloseDateRangeModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>T·ª´ ng√†y</label>
                    <input type="date" id="startDateInput" class="form-control" />
                </div>
                <div class="form-group">
                    <label>ƒê·∫øn ng√†y</label>
                    <input type="date" id="endDateInput" class="form-control" />
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelDateRange">H·ªßy</button>
                <button class="btn-primary" id="btnApplyDateRange">
                    <i data-lucide="check"></i>
                    √Åp d·ª•ng
                </button>
            </div>
        </div>
    </div>

    <!-- NCC Management Modal -->
    <div class="modal" id="nccManageModal" style="display: none;">
        <div class="modal-overlay" id="nccManageModalOverlay"></div>
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h3>
                    <i data-lucide="building-2"></i>
                    Qu·∫£n l√Ω t√™n NCC
                </h3>
                <button class="btn-icon" id="btnCloseNCCManageModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-description">Danh s√°ch c√°c nh√† cung c·∫•p ƒë√£ l∆∞u (ƒë·ªãnh d·∫°ng: Ax + t√™n g·ª£i nh·ªõ)</p>

                <!-- Fetch from TPOS button -->
                <div class="ncc-fetch-tpos-section" style="margin-bottom: 15px;">
                    <button class="btn-primary" id="btnFetchFromTPOS" style="width: 100%;">
                        <i data-lucide="download-cloud"></i>
                        T·∫£i danh s√°ch NCC t·ª´ TPOS
                    </button>
                </div>

                <!-- Add new NCC input -->
                <div class="ncc-add-form">
                    <div class="ncc-add-input-wrapper">
                        <input type="text" id="nccManualInput" placeholder="Nh·∫≠p t√™n NCC m·ªõi (VD: A1 T√™n g·ª£i nh·ªõ)"
                            autocomplete="off" />
                    </div>
                    <button class="btn-primary" id="btnAddNCCManual">
                        <i data-lucide="plus"></i>
                        Th√™m
                    </button>
                </div>

                <div class="ncc-list" id="nccList">
                    <!-- NCC items will be generated here -->
                </div>
                <div class="ncc-empty-state" id="nccEmptyState" style="display: none;">
                    <i data-lucide="inbox"></i>
                    <p>Ch∆∞a c√≥ t√™n NCC n√†o ƒë∆∞·ª£c l∆∞u</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelNCCManage">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- NCC Conflict Confirmation Modal -->
    <div class="modal" id="nccConflictModal" style="display: none;">
        <div class="modal-overlay" id="nccConflictModalOverlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>
                    <i data-lucide="alert-triangle"></i>
                    Xung ƒë·ªôt t√™n NCC
                </h3>
                <button class="btn-icon" id="btnCloseNCCConflictModal">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>M√£ NCC n√†y ƒë√£ t·ªìn t·∫°i v·ªõi t√™n kh√°c. Vui l√≤ng ch·ªçn t√™n ch√≠nh x√°c:</p>
                <div class="ncc-conflict-options">
                    <div class="ncc-conflict-option" id="nccConflictNewOption">
                        <label>
                            <input type="radio" name="nccConflictChoice" value="new" checked />
                            <span class="ncc-conflict-label">T√™n m·ªõi:</span>
                            <span class="ncc-conflict-name" id="nccConflictNewName"></span>
                        </label>
                    </div>
                    <div class="ncc-conflict-option" id="nccConflictExistingOption">
                        <label>
                            <input type="radio" name="nccConflictChoice" value="existing" />
                            <span class="ncc-conflict-label">T√™n ƒë√£ l∆∞u:</span>
                            <span class="ncc-conflict-name" id="nccConflictExistingName"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCancelNCCConflict">H·ªßy</button>
                <button class="btn-primary" id="btnConfirmNCCConflict">
                    <i data-lucide="check"></i>
                    X√°c nh·∫≠n
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="../shared/js/shared-auth-manager.js"></script>
    <script src="js/soorder-config.js"></script>
    <script src="js/soorder-utils.js"></script>
    <script src="js/soorder-crud.js"></script>
    <script src="js/soorder-supplier-loader.js"></script>
    <script src="js/soorder-ui.js"></script>
    <script src="js/soorder-main.js"></script>
    <script src="../shared/js/notification-system.js"></script>
</body>

</html>
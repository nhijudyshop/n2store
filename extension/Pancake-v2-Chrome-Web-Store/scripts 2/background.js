var CCake=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=15)}([function(e,t,r){e.exports=r(16)},function(e,t,r){(function(t){var n;e.exports=(n=n||function(e,n){var a;if("undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(a=globalThis.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&void 0!==t&&t.crypto&&(a=t.crypto),!a)try{a=r(19)}catch(e){}var s=function(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},c=i.lib={},u=c.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,a=e.sigBytes;if(this.clamp(),n%4)for(var s=0;s<a;s++){var o=r[s>>>2]>>>24-s%4*8&255;t[n+s>>>2]|=o<<24-(n+s)%4*8}else for(var i=0;i<a;i+=4)t[n+i>>>2]=r[i>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(s());return new l.init(t,e)}}),p=i.enc={},d=p.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],a=0;a<r;a++){var s=t[a>>>2]>>>24-a%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new l.init(r,t/2)}},f=p.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],a=0;a<r;a++){var s=t[a>>>2]>>>24-a%4*8&255;n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new l.init(r,t)}},h=p.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},v=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,a=n.words,s=n.sigBytes,o=this.blockSize,i=s/(4*o),c=(i=t?e.ceil(i):e.max((0|i)-this._minBufferSize,0))*o,u=e.min(4*c,s);if(c){for(var p=0;p<c;p+=o)this._doProcessBlock(a,p);r=a.splice(0,c),n.sigBytes-=u}return new l.init(r,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),_=(c.Hasher=v.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new _.HMAC.init(e,r).finalize(t)}}}),i.algo={});return i}(Math),n)}).call(this,r(12))},function(e,t,r){var n,a,s,o,i,c,u,l,p,d,f,h,v,_,m,g,b,I,y;e.exports=(n=r(1),r(4),void(n.lib.Cipher||(a=n,s=a.lib,o=s.Base,i=s.WordArray,c=s.BufferedBlockAlgorithm,u=a.enc,u.Utf8,l=u.Base64,p=a.algo.EvpKDF,d=s.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:b}return function(t){return{encrypt:function(r,n,a){return e(n).encrypt(t,r,n,a)},decrypt:function(r,n,a){return e(n).decrypt(t,r,n,a)}}}}()}),s.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),f=a.mode={},h=s.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),v=f.CBC=function(){var e=h.extend();function t(e,t,r){var n,a=this._iv;a?(n=a,this._iv=void 0):n=this._prevBlock;for(var s=0;s<r;s++)e[t+s]^=n[s]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,a=n.blockSize;t.call(this,e,r,a),n.encryptBlock(e,r),this._prevBlock=e.slice(r,r+a)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,a=n.blockSize,s=e.slice(r,r+a);n.decryptBlock(e,r),t.call(this,e,r,a),this._prevBlock=s}}),e}(),_=(a.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,a=n<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(a);var c=i.create(s,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},s.BlockCipher=d.extend({cfg:d.cfg.extend({mode:v,padding:_}),reset:function(){var e;d.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),m=s.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),g=(a.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?i.create([1398893684,1701076831]).concat(r).concat(t):t).toString(l)},parse:function(e){var t,r=l.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),m.create({ciphertext:r,salt:t})}},b=s.SerializableCipher=o.extend({cfg:o.extend({format:g}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var a=e.createEncryptor(r,n),s=a.finalize(t),o=a.cfg;return m.create({ciphertext:s,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),I=(a.kdf={}).OpenSSL={execute:function(e,t,r,n,a){if(n||(n=i.random(8)),a)s=p.create({keySize:t+r,hasher:a}).compute(e,n);else var s=p.create({keySize:t+r}).compute(e,n);var o=i.create(s.words.slice(t),4*r);return s.sigBytes=4*t,m.create({key:s,iv:o,salt:n})}},y=s.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:I}),encrypt:function(e,t,r,n){var a=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=a.iv;var s=b.encrypt.call(this,e,t,a.key,n);return s.mixIn(a),s},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var a=n.kdf.execute(r,e.keySize,e.ivSize,t.salt,n.hasher);return n.iv=a.iv,b.decrypt.call(this,e,t,a.key,n)}}))))},function(e,t,r){var n;e.exports=(n=r(1),r(8),r(20),r(21),r(5),r(22),r(6),r(13),r(10),r(23),r(14),r(24),r(25),r(26),r(11),r(27),r(4),r(2),r(28),r(29),r(30),r(31),r(32),r(33),r(34),r(35),r(36),r(37),r(38),r(39),r(40),r(41),r(42),r(43),r(44),n)},function(e,t,r){var n,a,s,o,i,c,u,l;e.exports=(l=r(1),r(13),r(11),s=(a=(n=l).lib).Base,o=a.WordArray,c=(i=n.algo).MD5,u=i.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,a=n.hasher.create(),s=o.create(),i=s.words,c=n.keySize,u=n.iterations;i.length<c;){r&&a.update(r),r=a.update(e).finalize(t),a.reset();for(var l=1;l<u;l++)r=a.finalize(r),a.reset();s.concat(r)}return s.sigBytes=4*c,s}}),n.EvpKDF=function(e,t,r){return u.create(r).compute(e,t)},l.EvpKDF)},function(e,t,r){var n,a,s;e.exports=(s=r(1),a=(n=s).lib.WordArray,n.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var a=[],s=0;s<r;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,i=0;i<4&&s+.75*i<r;i++)a.push(n.charAt(o>>>6*(3-i)&63));var c=n.charAt(64);if(c)for(;a.length%4;)a.push(c);return a.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var s=0;s<r.length;s++)n[r.charCodeAt(s)]=s}var o=r.charAt(64);if(o){var i=e.indexOf(o);-1!==i&&(t=i)}return function(e,t,r){for(var n=[],s=0,o=0;o<t;o++)if(o%4){var i=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;n[s>>>2]|=i<<24-s%4*8,s++}return a.create(n,s)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},s.enc.Base64)},function(e,t,r){var n;e.exports=(n=r(1),function(e){var t=n,r=t.lib,a=r.WordArray,s=r.Hasher,o=t.algo,i=[];!function(){for(var t=0;t<64;t++)i[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=o.MD5=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,a=e[n];e[n]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var s=this._hash.words,o=e[t+0],c=e[t+1],f=e[t+2],h=e[t+3],v=e[t+4],_=e[t+5],m=e[t+6],g=e[t+7],b=e[t+8],I=e[t+9],y=e[t+10],x=e[t+11],k=e[t+12],w=e[t+13],S=e[t+14],E=e[t+15],C=s[0],T=s[1],A=s[2],R=s[3];C=u(C,T,A,R,o,7,i[0]),R=u(R,C,T,A,c,12,i[1]),A=u(A,R,C,T,f,17,i[2]),T=u(T,A,R,C,h,22,i[3]),C=u(C,T,A,R,v,7,i[4]),R=u(R,C,T,A,_,12,i[5]),A=u(A,R,C,T,m,17,i[6]),T=u(T,A,R,C,g,22,i[7]),C=u(C,T,A,R,b,7,i[8]),R=u(R,C,T,A,I,12,i[9]),A=u(A,R,C,T,y,17,i[10]),T=u(T,A,R,C,x,22,i[11]),C=u(C,T,A,R,k,7,i[12]),R=u(R,C,T,A,w,12,i[13]),A=u(A,R,C,T,S,17,i[14]),C=l(C,T=u(T,A,R,C,E,22,i[15]),A,R,c,5,i[16]),R=l(R,C,T,A,m,9,i[17]),A=l(A,R,C,T,x,14,i[18]),T=l(T,A,R,C,o,20,i[19]),C=l(C,T,A,R,_,5,i[20]),R=l(R,C,T,A,y,9,i[21]),A=l(A,R,C,T,E,14,i[22]),T=l(T,A,R,C,v,20,i[23]),C=l(C,T,A,R,I,5,i[24]),R=l(R,C,T,A,S,9,i[25]),A=l(A,R,C,T,h,14,i[26]),T=l(T,A,R,C,b,20,i[27]),C=l(C,T,A,R,w,5,i[28]),R=l(R,C,T,A,f,9,i[29]),A=l(A,R,C,T,g,14,i[30]),C=p(C,T=l(T,A,R,C,k,20,i[31]),A,R,_,4,i[32]),R=p(R,C,T,A,b,11,i[33]),A=p(A,R,C,T,x,16,i[34]),T=p(T,A,R,C,S,23,i[35]),C=p(C,T,A,R,c,4,i[36]),R=p(R,C,T,A,v,11,i[37]),A=p(A,R,C,T,g,16,i[38]),T=p(T,A,R,C,y,23,i[39]),C=p(C,T,A,R,w,4,i[40]),R=p(R,C,T,A,o,11,i[41]),A=p(A,R,C,T,h,16,i[42]),T=p(T,A,R,C,m,23,i[43]),C=p(C,T,A,R,I,4,i[44]),R=p(R,C,T,A,k,11,i[45]),A=p(A,R,C,T,E,16,i[46]),C=d(C,T=p(T,A,R,C,f,23,i[47]),A,R,o,6,i[48]),R=d(R,C,T,A,g,10,i[49]),A=d(A,R,C,T,S,15,i[50]),T=d(T,A,R,C,_,21,i[51]),C=d(C,T,A,R,k,6,i[52]),R=d(R,C,T,A,h,10,i[53]),A=d(A,R,C,T,y,15,i[54]),T=d(T,A,R,C,c,21,i[55]),C=d(C,T,A,R,b,6,i[56]),R=d(R,C,T,A,E,10,i[57]),A=d(A,R,C,T,m,15,i[58]),T=d(T,A,R,C,w,21,i[59]),C=d(C,T,A,R,v,6,i[60]),R=d(R,C,T,A,x,10,i[61]),A=d(A,R,C,T,f,15,i[62]),T=d(T,A,R,C,I,21,i[63]),s[0]=s[0]+C|0,s[1]=s[1]+T|0,s[2]=s[2]+A|0,s[3]=s[3]+R|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,a=8*t.sigBytes;r[a>>>5]|=128<<24-a%32;var s=e.floor(n/4294967296),o=n;r[15+(a+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[14+(a+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(r.length+1),this._process();for(var i=this._hash,c=i.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return i},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,a,s,o){var i=e+(t&r|~t&n)+a+o;return(i<<s|i>>>32-s)+t}function l(e,t,r,n,a,s,o){var i=e+(t&n|r&~n)+a+o;return(i<<s|i>>>32-s)+t}function p(e,t,r,n,a,s,o){var i=e+(t^r^n)+a+o;return(i<<s|i>>>32-s)+t}function d(e,t,r,n,a,s,o){var i=e+(r^(t|~n))+a+o;return(i<<s|i>>>32-s)+t}t.MD5=s._createHelper(c),t.HmacMD5=s._createHmacHelper(c)}(Math),n.MD5)},function(e,t,r){(function(e,n){var a;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var s="Expected a function",o="__lodash_placeholder__",i=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],c="[object Arguments]",u="[object Array]",l="[object Boolean]",p="[object Date]",d="[object Error]",f="[object Function]",h="[object GeneratorFunction]",v="[object Map]",_="[object Number]",m="[object Object]",g="[object RegExp]",b="[object Set]",I="[object String]",y="[object Symbol]",x="[object WeakMap]",k="[object ArrayBuffer]",w="[object DataView]",S="[object Float32Array]",E="[object Float64Array]",C="[object Int8Array]",T="[object Int16Array]",A="[object Int32Array]",R="[object Uint8Array]",L="[object Uint16Array]",N="[object Uint32Array]",O=/\b__p \+= '';/g,P=/\b(__p \+=) '' \+/g,D=/(__e\(.*?\)|\b__t\)) \+\n'';/g,U=/&(?:amp|lt|gt|quot|#39);/g,B=/[&<>"']/g,F=RegExp(U.source),M=RegExp(B.source),G=/<%-([\s\S]+?)%>/g,q=/<%([\s\S]+?)%>/g,H=/<%=([\s\S]+?)%>/g,j=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,z=/^\w*$/,V=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,W=/[\\^$.*+?()[\]{}|]/g,K=RegExp(W.source),Q=/^\s+|\s+$/g,Y=/^\s+/,J=/\s+$/,X=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,$=/\{\n\/\* \[wrapped with (.+)\] \*/,Z=/,? & /,ee=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,te=/\\(\\)?/g,re=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ne=/\w*$/,ae=/^[-+]0x[0-9a-f]+$/i,se=/^0b[01]+$/i,oe=/^\[object .+?Constructor\]$/,ie=/^0o[0-7]+$/i,ce=/^(?:0|[1-9]\d*)$/,ue=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,le=/($^)/,pe=/['\n\r\u2028\u2029\\]/g,de="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",fe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",he="["+fe+"]",ve="["+de+"]",_e="\\d+",me="[a-z\\xdf-\\xf6\\xf8-\\xff]",ge="[^\\ud800-\\udfff"+fe+_e+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",be="\\ud83c[\\udffb-\\udfff]",Ie="[^\\ud800-\\udfff]",ye="(?:\\ud83c[\\udde6-\\uddff]){2}",xe="[\\ud800-\\udbff][\\udc00-\\udfff]",ke="[A-Z\\xc0-\\xd6\\xd8-\\xde]",we="(?:"+me+"|"+ge+")",Se="(?:"+ke+"|"+ge+")",Ee="(?:"+ve+"|"+be+")?",Ce="[\\ufe0e\\ufe0f]?"+Ee+"(?:\\u200d(?:"+[Ie,ye,xe].join("|")+")[\\ufe0e\\ufe0f]?"+Ee+")*",Te="(?:"+["[\\u2700-\\u27bf]",ye,xe].join("|")+")"+Ce,Ae="(?:"+[Ie+ve+"?",ve,ye,xe,"[\\ud800-\\udfff]"].join("|")+")",Re=RegExp("['’]","g"),Le=RegExp(ve,"g"),Ne=RegExp(be+"(?="+be+")|"+Ae+Ce,"g"),Oe=RegExp([ke+"?"+me+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[he,ke,"$"].join("|")+")",Se+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[he,ke+we,"$"].join("|")+")",ke+"?"+we+"+(?:['’](?:d|ll|m|re|s|t|ve))?",ke+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_e,Te].join("|"),"g"),Pe=RegExp("[\\u200d\\ud800-\\udfff"+de+"\\ufe0e\\ufe0f]"),De=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ue=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Be=-1,Fe={};Fe[S]=Fe[E]=Fe[C]=Fe[T]=Fe[A]=Fe[R]=Fe["[object Uint8ClampedArray]"]=Fe[L]=Fe[N]=!0,Fe[c]=Fe[u]=Fe[k]=Fe[l]=Fe[w]=Fe[p]=Fe[d]=Fe[f]=Fe[v]=Fe[_]=Fe[m]=Fe[g]=Fe[b]=Fe[I]=Fe[x]=!1;var Me={};Me[c]=Me[u]=Me[k]=Me[w]=Me[l]=Me[p]=Me[S]=Me[E]=Me[C]=Me[T]=Me[A]=Me[v]=Me[_]=Me[m]=Me[g]=Me[b]=Me[I]=Me[y]=Me[R]=Me["[object Uint8ClampedArray]"]=Me[L]=Me[N]=!0,Me[d]=Me[f]=Me[x]=!1;var Ge={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qe=parseFloat,He=parseInt,je="object"==typeof e&&e&&e.Object===Object&&e,ze="object"==typeof self&&self&&self.Object===Object&&self,Ve=je||ze||Function("return this")(),We=t&&!t.nodeType&&t,Ke=We&&"object"==typeof n&&n&&!n.nodeType&&n,Qe=Ke&&Ke.exports===We,Ye=Qe&&je.process,Je=function(){try{return Ke&&Ke.require&&Ke.require("util").types||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}(),Xe=Je&&Je.isArrayBuffer,$e=Je&&Je.isDate,Ze=Je&&Je.isMap,et=Je&&Je.isRegExp,tt=Je&&Je.isSet,rt=Je&&Je.isTypedArray;function nt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function at(e,t,r,n){for(var a=-1,s=null==e?0:e.length;++a<s;){var o=e[a];t(n,o,r(o),e)}return n}function st(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function ot(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function it(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function ct(e,t){for(var r=-1,n=null==e?0:e.length,a=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[a++]=o)}return s}function ut(e,t){return!(null==e||!e.length)&&bt(e,t,0)>-1}function lt(e,t,r){for(var n=-1,a=null==e?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}function pt(e,t){for(var r=-1,n=null==e?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}function dt(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}function ft(e,t,r,n){var a=-1,s=null==e?0:e.length;for(n&&s&&(r=e[++a]);++a<s;)r=t(r,e[a],a,e);return r}function ht(e,t,r,n){var a=null==e?0:e.length;for(n&&a&&(r=e[--a]);a--;)r=t(r,e[a],a,e);return r}function vt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var _t=kt("length");function mt(e,t,r){var n;return r(e,(function(e,r,a){if(t(e,r,a))return n=r,!1})),n}function gt(e,t,r,n){for(var a=e.length,s=r+(n?1:-1);n?s--:++s<a;)if(t(e[s],s,e))return s;return-1}function bt(e,t,r){return t==t?function(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}(e,t,r):gt(e,yt,r)}function It(e,t,r,n){for(var a=r-1,s=e.length;++a<s;)if(n(e[a],t))return a;return-1}function yt(e){return e!=e}function xt(e,t){var r=null==e?0:e.length;return r?Et(e,t)/r:NaN}function kt(e){return function(t){return null==t?void 0:t[e]}}function wt(e){return function(t){return null==e?void 0:e[t]}}function St(e,t,r,n,a){return a(e,(function(e,a,s){r=n?(n=!1,e):t(r,e,a,s)})),r}function Et(e,t){for(var r,n=-1,a=e.length;++n<a;){var s=t(e[n]);void 0!==s&&(r=void 0===r?s:r+s)}return r}function Ct(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Tt(e){return function(t){return e(t)}}function At(e,t){return pt(t,(function(t){return e[t]}))}function Rt(e,t){return e.has(t)}function Lt(e,t){for(var r=-1,n=e.length;++r<n&&bt(t,e[r],0)>-1;);return r}function Nt(e,t){for(var r=e.length;r--&&bt(t,e[r],0)>-1;);return r}var Ot=wt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Pt=wt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Dt(e){return"\\"+Ge[e]}function Ut(e){return Pe.test(e)}function Bt(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function Ft(e,t){return function(r){return e(t(r))}}function Mt(e,t){for(var r=-1,n=e.length,a=0,s=[];++r<n;){var i=e[r];i!==t&&i!==o||(e[r]=o,s[a++]=r)}return s}function Gt(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function qt(e){return Ut(e)?function(e){for(var t=Ne.lastIndex=0;Ne.test(e);)++t;return t}(e):_t(e)}function Ht(e){return Ut(e)?function(e){return e.match(Ne)||[]}(e):function(e){return e.split("")}(e)}var jt=wt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),zt=function e(t){var r,n=(t=null==t?Ve:zt.defaults(Ve.Object(),t,zt.pick(Ve,Ue))).Array,a=t.Date,de=t.Error,fe=t.Function,he=t.Math,ve=t.Object,_e=t.RegExp,me=t.String,ge=t.TypeError,be=n.prototype,Ie=fe.prototype,ye=ve.prototype,xe=t["__core-js_shared__"],ke=Ie.toString,we=ye.hasOwnProperty,Se=0,Ee=(r=/[^.]+$/.exec(xe&&xe.keys&&xe.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",Ce=ye.toString,Te=ke.call(ve),Ae=Ve._,Ne=_e("^"+ke.call(we).replace(W,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pe=Qe?t.Buffer:void 0,Ge=t.Symbol,je=t.Uint8Array,ze=Pe?Pe.allocUnsafe:void 0,We=Ft(ve.getPrototypeOf,ve),Ke=ve.create,Ye=ye.propertyIsEnumerable,Je=be.splice,_t=Ge?Ge.isConcatSpreadable:void 0,wt=Ge?Ge.iterator:void 0,Vt=Ge?Ge.toStringTag:void 0,Wt=function(){try{var e=Ja(ve,"defineProperty");return e({},"",{}),e}catch(e){}}(),Kt=t.clearTimeout!==Ve.clearTimeout&&t.clearTimeout,Qt=a&&a.now!==Ve.Date.now&&a.now,Yt=t.setTimeout!==Ve.setTimeout&&t.setTimeout,Jt=he.ceil,Xt=he.floor,$t=ve.getOwnPropertySymbols,Zt=Pe?Pe.isBuffer:void 0,er=t.isFinite,tr=be.join,rr=Ft(ve.keys,ve),nr=he.max,ar=he.min,sr=a.now,or=t.parseInt,ir=he.random,cr=be.reverse,ur=Ja(t,"DataView"),lr=Ja(t,"Map"),pr=Ja(t,"Promise"),dr=Ja(t,"Set"),fr=Ja(t,"WeakMap"),hr=Ja(ve,"create"),vr=fr&&new fr,_r={},mr=xs(ur),gr=xs(lr),br=xs(pr),Ir=xs(dr),yr=xs(fr),xr=Ge?Ge.prototype:void 0,kr=xr?xr.valueOf:void 0,wr=xr?xr.toString:void 0;function Sr(e){if(Go(e)&&!Ao(e)&&!(e instanceof Ar)){if(e instanceof Tr)return e;if(we.call(e,"__wrapped__"))return ks(e)}return new Tr(e)}var Er=function(){function e(){}return function(t){if(!Mo(t))return{};if(Ke)return Ke(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function Cr(){}function Tr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function Ar(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Rr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Lr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Nr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Or(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Nr;++t<r;)this.add(e[t])}function Pr(e){var t=this.__data__=new Lr(e);this.size=t.size}function Dr(e,t){var r=Ao(e),n=!r&&To(e),a=!r&&!n&&Oo(e),s=!r&&!n&&!a&&Qo(e),o=r||n||a||s,i=o?Ct(e.length,me):[],c=i.length;for(var u in e)!t&&!we.call(e,u)||o&&("length"==u||a&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ns(u,c))||i.push(u);return i}function Ur(e){var t=e.length;return t?e[On(0,t-1)]:void 0}function Br(e,t){return bs(ha(e),Wr(t,0,e.length))}function Fr(e){return bs(ha(e))}function Mr(e,t,r){(void 0!==r&&!So(e[t],r)||void 0===r&&!(t in e))&&zr(e,t,r)}function Gr(e,t,r){var n=e[t];we.call(e,t)&&So(n,r)&&(void 0!==r||t in e)||zr(e,t,r)}function qr(e,t){for(var r=e.length;r--;)if(So(e[r][0],t))return r;return-1}function Hr(e,t,r,n){return Xr(e,(function(e,a,s){t(n,e,r(e),s)})),n}function jr(e,t){return e&&va(t,_i(t),e)}function zr(e,t,r){"__proto__"==t&&Wt?Wt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Vr(e,t){for(var r=-1,a=t.length,s=n(a),o=null==e;++r<a;)s[r]=o?void 0:pi(e,t[r]);return s}function Wr(e,t,r){return e==e&&(void 0!==r&&(e=e<=r?e:r),void 0!==t&&(e=e>=t?e:t)),e}function Kr(e,t,r,n,a,s){var o,i=1&t,u=2&t,d=4&t;if(r&&(o=a?r(e,n,a,s):r(e)),void 0!==o)return o;if(!Mo(e))return e;var x=Ao(e);if(x){if(o=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&we.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!i)return ha(e,o)}else{var O=Za(e),P=O==f||O==h;if(Oo(e))return ca(e,i);if(O==m||O==c||P&&!a){if(o=u||P?{}:ts(e),!i)return u?function(e,t){return va(e,$a(e),t)}(e,function(e,t){return e&&va(t,mi(t),e)}(o,e)):function(e,t){return va(e,Xa(e),t)}(e,jr(o,e))}else{if(!Me[O])return a?e:{};o=function(e,t,r){var n,a=e.constructor;switch(t){case k:return ua(e);case l:case p:return new a(+e);case w:return function(e,t){var r=t?ua(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case S:case E:case C:case T:case A:case R:case"[object Uint8ClampedArray]":case L:case N:return la(e,r);case v:return new a;case _:case I:return new a(e);case g:return function(e){var t=new e.constructor(e.source,ne.exec(e));return t.lastIndex=e.lastIndex,t}(e);case b:return new a;case y:return n=e,kr?ve(kr.call(n)):{}}}(e,O,i)}}s||(s=new Pr);var D=s.get(e);if(D)return D;s.set(e,o),Vo(e)?e.forEach((function(n){o.add(Kr(n,t,r,n,e,s))})):qo(e)&&e.forEach((function(n,a){o.set(a,Kr(n,t,r,a,e,s))}));var U=x?void 0:(d?u?ja:Ha:u?mi:_i)(e);return st(U||e,(function(n,a){U&&(n=e[a=n]),Gr(o,a,Kr(n,t,r,a,e,s))})),o}function Qr(e,t,r){var n=r.length;if(null==e)return!n;for(e=ve(e);n--;){var a=r[n],s=t[a],o=e[a];if(void 0===o&&!(a in e)||!s(o))return!1}return!0}function Yr(e,t,r){if("function"!=typeof e)throw new ge(s);return vs((function(){e.apply(void 0,r)}),t)}function Jr(e,t,r,n){var a=-1,s=ut,o=!0,i=e.length,c=[],u=t.length;if(!i)return c;r&&(t=pt(t,Tt(r))),n?(s=lt,o=!1):t.length>=200&&(s=Rt,o=!1,t=new Or(t));e:for(;++a<i;){var l=e[a],p=null==r?l:r(l);if(l=n||0!==l?l:0,o&&p==p){for(var d=u;d--;)if(t[d]===p)continue e;c.push(l)}else s(t,p,n)||c.push(l)}return c}Sr.templateSettings={escape:G,evaluate:q,interpolate:H,variable:"",imports:{_:Sr}},Sr.prototype=Cr.prototype,Sr.prototype.constructor=Sr,Tr.prototype=Er(Cr.prototype),Tr.prototype.constructor=Tr,Ar.prototype=Er(Cr.prototype),Ar.prototype.constructor=Ar,Rr.prototype.clear=function(){this.__data__=hr?hr(null):{},this.size=0},Rr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Rr.prototype.get=function(e){var t=this.__data__;if(hr){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return we.call(t,e)?t[e]:void 0},Rr.prototype.has=function(e){var t=this.__data__;return hr?void 0!==t[e]:we.call(t,e)},Rr.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=hr&&void 0===t?"__lodash_hash_undefined__":t,this},Lr.prototype.clear=function(){this.__data__=[],this.size=0},Lr.prototype.delete=function(e){var t=this.__data__,r=qr(t,e);return!(r<0||(r==t.length-1?t.pop():Je.call(t,r,1),--this.size,0))},Lr.prototype.get=function(e){var t=this.__data__,r=qr(t,e);return r<0?void 0:t[r][1]},Lr.prototype.has=function(e){return qr(this.__data__,e)>-1},Lr.prototype.set=function(e,t){var r=this.__data__,n=qr(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},Nr.prototype.clear=function(){this.size=0,this.__data__={hash:new Rr,map:new(lr||Lr),string:new Rr}},Nr.prototype.delete=function(e){var t=Qa(this,e).delete(e);return this.size-=t?1:0,t},Nr.prototype.get=function(e){return Qa(this,e).get(e)},Nr.prototype.has=function(e){return Qa(this,e).has(e)},Nr.prototype.set=function(e,t){var r=Qa(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Or.prototype.add=Or.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Or.prototype.has=function(e){return this.__data__.has(e)},Pr.prototype.clear=function(){this.__data__=new Lr,this.size=0},Pr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Pr.prototype.get=function(e){return this.__data__.get(e)},Pr.prototype.has=function(e){return this.__data__.has(e)},Pr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Lr){var n=r.__data__;if(!lr||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Nr(n)}return r.set(e,t),this.size=r.size,this};var Xr=ga(sn),$r=ga(on,!0);function Zr(e,t){var r=!0;return Xr(e,(function(e,n,a){return r=!!t(e,n,a)})),r}function en(e,t,r){for(var n=-1,a=e.length;++n<a;){var s=e[n],o=t(s);if(null!=o&&(void 0===i?o==o&&!Ko(o):r(o,i)))var i=o,c=s}return c}function tn(e,t){var r=[];return Xr(e,(function(e,n,a){t(e,n,a)&&r.push(e)})),r}function rn(e,t,r,n,a){var s=-1,o=e.length;for(r||(r=rs),a||(a=[]);++s<o;){var i=e[s];t>0&&r(i)?t>1?rn(i,t-1,r,n,a):dt(a,i):n||(a[a.length]=i)}return a}var nn=ba(),an=ba(!0);function sn(e,t){return e&&nn(e,t,_i)}function on(e,t){return e&&an(e,t,_i)}function cn(e,t){return ct(t,(function(t){return Uo(e[t])}))}function un(e,t){for(var r=0,n=(t=aa(t,e)).length;null!=e&&r<n;)e=e[ys(t[r++])];return r&&r==n?e:void 0}function ln(e,t,r){var n=t(e);return Ao(e)?n:dt(n,r(e))}function pn(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Vt&&Vt in ve(e)?function(e){var t=we.call(e,Vt),r=e[Vt];try{e[Vt]=void 0;var n=!0}catch(e){}var a=Ce.call(e);return n&&(t?e[Vt]=r:delete e[Vt]),a}(e):function(e){return Ce.call(e)}(e)}function dn(e,t){return e>t}function fn(e,t){return null!=e&&we.call(e,t)}function hn(e,t){return null!=e&&t in ve(e)}function vn(e,t,r){for(var a=r?lt:ut,s=e[0].length,o=e.length,i=o,c=n(o),u=1/0,l=[];i--;){var p=e[i];i&&t&&(p=pt(p,Tt(t))),u=ar(p.length,u),c[i]=!r&&(t||s>=120&&p.length>=120)?new Or(i&&p):void 0}p=e[0];var d=-1,f=c[0];e:for(;++d<s&&l.length<u;){var h=p[d],v=t?t(h):h;if(h=r||0!==h?h:0,!(f?Rt(f,v):a(l,v,r))){for(i=o;--i;){var _=c[i];if(!(_?Rt(_,v):a(e[i],v,r)))continue e}f&&f.push(v),l.push(h)}}return l}function _n(e,t,r){var n=null==(e=ds(e,t=aa(t,e)))?e:e[ys(Ps(t))];return null==n?void 0:nt(n,e,r)}function mn(e){return Go(e)&&pn(e)==c}function gn(e,t,r,n,a){return e===t||(null==e||null==t||!Go(e)&&!Go(t)?e!=e&&t!=t:function(e,t,r,n,a,s){var o=Ao(e),i=Ao(t),f=o?u:Za(e),h=i?u:Za(t),x=(f=f==c?m:f)==m,S=(h=h==c?m:h)==m,E=f==h;if(E&&Oo(e)){if(!Oo(t))return!1;o=!0,x=!1}if(E&&!x)return s||(s=new Pr),o||Qo(e)?Ga(e,t,r,n,a,s):function(e,t,r,n,a,s,o){switch(r){case w:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case k:return!(e.byteLength!=t.byteLength||!s(new je(e),new je(t)));case l:case p:case _:return So(+e,+t);case d:return e.name==t.name&&e.message==t.message;case g:case I:return e==t+"";case v:var i=Bt;case b:var c=1&n;if(i||(i=Gt),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=2,o.set(e,t);var f=Ga(i(e),i(t),n,a,s,o);return o.delete(e),f;case y:if(kr)return kr.call(e)==kr.call(t)}return!1}(e,t,f,r,n,a,s);if(!(1&r)){var C=x&&we.call(e,"__wrapped__"),T=S&&we.call(t,"__wrapped__");if(C||T){var A=C?e.value():e,R=T?t.value():t;return s||(s=new Pr),a(A,R,r,n,s)}}return!!E&&(s||(s=new Pr),function(e,t,r,n,a,s){var o=1&r,i=Ha(e),c=i.length;if(c!=Ha(t).length&&!o)return!1;for(var u=c;u--;){var l=i[u];if(!(o?l in t:we.call(t,l)))return!1}var p=s.get(e),d=s.get(t);if(p&&d)return p==t&&d==e;var f=!0;s.set(e,t),s.set(t,e);for(var h=o;++u<c;){var v=e[l=i[u]],_=t[l];if(n)var m=o?n(_,v,l,t,e,s):n(v,_,l,e,t,s);if(!(void 0===m?v===_||a(v,_,r,n,s):m)){f=!1;break}h||(h="constructor"==l)}if(f&&!h){var g=e.constructor,b=t.constructor;g==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(f=!1)}return s.delete(e),s.delete(t),f}(e,t,r,n,a,s))}(e,t,r,n,gn,a))}function bn(e,t,r,n){var a=r.length,s=a,o=!n;if(null==e)return!s;for(e=ve(e);a--;){var i=r[a];if(o&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++a<s;){var c=(i=r[a])[0],u=e[c],l=i[1];if(o&&i[2]){if(void 0===u&&!(c in e))return!1}else{var p=new Pr;if(n)var d=n(u,l,c,e,t,p);if(!(void 0===d?gn(l,u,3,n,p):d))return!1}}return!0}function In(e){return!(!Mo(e)||(t=e,Ee&&Ee in t))&&(Uo(e)?Ne:oe).test(xs(e));var t}function yn(e){return"function"==typeof e?e:null==e?Hi:"object"==typeof e?Ao(e)?En(e[0],e[1]):Sn(e):Xi(e)}function xn(e){if(!cs(e))return rr(e);var t=[];for(var r in ve(e))we.call(e,r)&&"constructor"!=r&&t.push(r);return t}function kn(e,t){return e<t}function wn(e,t){var r=-1,a=Lo(e)?n(e.length):[];return Xr(e,(function(e,n,s){a[++r]=t(e,n,s)})),a}function Sn(e){var t=Ya(e);return 1==t.length&&t[0][2]?ls(t[0][0],t[0][1]):function(r){return r===e||bn(r,e,t)}}function En(e,t){return ss(e)&&us(t)?ls(ys(e),t):function(r){var n=pi(r,e);return void 0===n&&n===t?di(r,e):gn(t,n,3)}}function Cn(e,t,r,n,a){e!==t&&nn(t,(function(s,o){if(a||(a=new Pr),Mo(s))!function(e,t,r,n,a,s,o){var i=fs(e,r),c=fs(t,r),u=o.get(c);if(u)Mr(e,r,u);else{var l=s?s(i,c,r+"",e,t,o):void 0,p=void 0===l;if(p){var d=Ao(c),f=!d&&Oo(c),h=!d&&!f&&Qo(c);l=c,d||f||h?Ao(i)?l=i:No(i)?l=ha(i):f?(p=!1,l=ca(c,!0)):h?(p=!1,l=la(c,!0)):l=[]:jo(c)||To(c)?(l=i,To(i)?l=ri(i):Mo(i)&&!Uo(i)||(l=ts(c))):p=!1}p&&(o.set(c,l),a(l,c,n,s,o),o.delete(c)),Mr(e,r,l)}}(e,t,o,r,Cn,n,a);else{var i=n?n(fs(e,o),s,o+"",e,t,a):void 0;void 0===i&&(i=s),Mr(e,o,i)}}),mi)}function Tn(e,t){var r=e.length;if(r)return ns(t+=t<0?r:0,r)?e[t]:void 0}function An(e,t,r){t=t.length?pt(t,(function(e){return Ao(e)?function(t){return un(t,1===e.length?e[0]:e)}:e})):[Hi];var n=-1;return t=pt(t,Tt(Ka())),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(wn(e,(function(e,r,a){return{criteria:pt(t,(function(t){return t(e)})),index:++n,value:e}})),(function(e,t){return function(e,t,r){for(var n=-1,a=e.criteria,s=t.criteria,o=a.length,i=r.length;++n<o;){var c=pa(a[n],s[n]);if(c)return n>=i?c:c*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}))}function Rn(e,t,r){for(var n=-1,a=t.length,s={};++n<a;){var o=t[n],i=un(e,o);r(i,o)&&Fn(s,aa(o,e),i)}return s}function Ln(e,t,r,n){var a=n?It:bt,s=-1,o=t.length,i=e;for(e===t&&(t=ha(t)),r&&(i=pt(e,Tt(r)));++s<o;)for(var c=0,u=t[s],l=r?r(u):u;(c=a(i,l,c,n))>-1;)i!==e&&Je.call(i,c,1),Je.call(e,c,1);return e}function Nn(e,t){for(var r=e?t.length:0,n=r-1;r--;){var a=t[r];if(r==n||a!==s){var s=a;ns(a)?Je.call(e,a,1):Jn(e,a)}}return e}function On(e,t){return e+Xt(ir()*(t-e+1))}function Pn(e,t){var r="";if(!e||t<1||t>9007199254740991)return r;do{t%2&&(r+=e),(t=Xt(t/2))&&(e+=e)}while(t);return r}function Dn(e,t){return _s(ps(e,t,Hi),e+"")}function Un(e){return Ur(Si(e))}function Bn(e,t){var r=Si(e);return bs(r,Wr(t,0,r.length))}function Fn(e,t,r,n){if(!Mo(e))return e;for(var a=-1,s=(t=aa(t,e)).length,o=s-1,i=e;null!=i&&++a<s;){var c=ys(t[a]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(a!=o){var l=i[c];void 0===(u=n?n(l,c,i):void 0)&&(u=Mo(l)?l:ns(t[a+1])?[]:{})}Gr(i,c,u),i=i[c]}return e}var Mn=vr?function(e,t){return vr.set(e,t),e}:Hi,Gn=Wt?function(e,t){return Wt(e,"toString",{configurable:!0,enumerable:!1,value:Mi(t),writable:!0})}:Hi;function qn(e){return bs(Si(e))}function Hn(e,t,r){var a=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(r=r>s?s:r)<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=n(s);++a<s;)o[a]=e[a+t];return o}function jn(e,t){var r;return Xr(e,(function(e,n,a){return!(r=t(e,n,a))})),!!r}function zn(e,t,r){var n=0,a=null==e?n:e.length;if("number"==typeof t&&t==t&&a<=2147483647){for(;n<a;){var s=n+a>>>1,o=e[s];null!==o&&!Ko(o)&&(r?o<=t:o<t)?n=s+1:a=s}return a}return Vn(e,t,Hi,r)}function Vn(e,t,r,n){var a=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=r(t))!=t,i=null===t,c=Ko(t),u=void 0===t;a<s;){var l=Xt((a+s)/2),p=r(e[l]),d=void 0!==p,f=null===p,h=p==p,v=Ko(p);if(o)var _=n||h;else _=u?h&&(n||d):i?h&&d&&(n||!f):c?h&&d&&!f&&(n||!v):!f&&!v&&(n?p<=t:p<t);_?a=l+1:s=l}return ar(s,4294967294)}function Wn(e,t){for(var r=-1,n=e.length,a=0,s=[];++r<n;){var o=e[r],i=t?t(o):o;if(!r||!So(i,c)){var c=i;s[a++]=0===o?0:o}}return s}function Kn(e){return"number"==typeof e?e:Ko(e)?NaN:+e}function Qn(e){if("string"==typeof e)return e;if(Ao(e))return pt(e,Qn)+"";if(Ko(e))return wr?wr.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Yn(e,t,r){var n=-1,a=ut,s=e.length,o=!0,i=[],c=i;if(r)o=!1,a=lt;else if(s>=200){var u=t?null:Pa(e);if(u)return Gt(u);o=!1,a=Rt,c=new Or}else c=t?[]:i;e:for(;++n<s;){var l=e[n],p=t?t(l):l;if(l=r||0!==l?l:0,o&&p==p){for(var d=c.length;d--;)if(c[d]===p)continue e;t&&c.push(p),i.push(l)}else a(c,p,r)||(c!==i&&c.push(p),i.push(l))}return i}function Jn(e,t){return null==(e=ds(e,t=aa(t,e)))||delete e[ys(Ps(t))]}function Xn(e,t,r,n){return Fn(e,t,r(un(e,t)),n)}function $n(e,t,r,n){for(var a=e.length,s=n?a:-1;(n?s--:++s<a)&&t(e[s],s,e););return r?Hn(e,n?0:s,n?s+1:a):Hn(e,n?s+1:0,n?a:s)}function Zn(e,t){var r=e;return r instanceof Ar&&(r=r.value()),ft(t,(function(e,t){return t.func.apply(t.thisArg,dt([e],t.args))}),r)}function ea(e,t,r){var a=e.length;if(a<2)return a?Yn(e[0]):[];for(var s=-1,o=n(a);++s<a;)for(var i=e[s],c=-1;++c<a;)c!=s&&(o[s]=Jr(o[s]||i,e[c],t,r));return Yn(rn(o,1),t,r)}function ta(e,t,r){for(var n=-1,a=e.length,s=t.length,o={};++n<a;){var i=n<s?t[n]:void 0;r(o,e[n],i)}return o}function ra(e){return No(e)?e:[]}function na(e){return"function"==typeof e?e:Hi}function aa(e,t){return Ao(e)?e:ss(e,t)?[e]:Is(ni(e))}var sa=Dn;function oa(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:Hn(e,t,r)}var ia=Kt||function(e){return Ve.clearTimeout(e)};function ca(e,t){if(t)return e.slice();var r=e.length,n=ze?ze(r):new e.constructor(r);return e.copy(n),n}function ua(e){var t=new e.constructor(e.byteLength);return new je(t).set(new je(e)),t}function la(e,t){var r=t?ua(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function pa(e,t){if(e!==t){var r=void 0!==e,n=null===e,a=e==e,s=Ko(e),o=void 0!==t,i=null===t,c=t==t,u=Ko(t);if(!i&&!u&&!s&&e>t||s&&o&&c&&!i&&!u||n&&o&&c||!r&&c||!a)return 1;if(!n&&!s&&!u&&e<t||u&&r&&a&&!n&&!s||i&&r&&a||!o&&a||!c)return-1}return 0}function da(e,t,r,a){for(var s=-1,o=e.length,i=r.length,c=-1,u=t.length,l=nr(o-i,0),p=n(u+l),d=!a;++c<u;)p[c]=t[c];for(;++s<i;)(d||s<o)&&(p[r[s]]=e[s]);for(;l--;)p[c++]=e[s++];return p}function fa(e,t,r,a){for(var s=-1,o=e.length,i=-1,c=r.length,u=-1,l=t.length,p=nr(o-c,0),d=n(p+l),f=!a;++s<p;)d[s]=e[s];for(var h=s;++u<l;)d[h+u]=t[u];for(;++i<c;)(f||s<o)&&(d[h+r[i]]=e[s++]);return d}function ha(e,t){var r=-1,a=e.length;for(t||(t=n(a));++r<a;)t[r]=e[r];return t}function va(e,t,r,n){var a=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var i=t[s],c=n?n(r[i],e[i],i,r,e):void 0;void 0===c&&(c=e[i]),a?zr(r,i,c):Gr(r,i,c)}return r}function _a(e,t){return function(r,n){var a=Ao(r)?at:Hr,s=t?t():{};return a(r,e,Ka(n,2),s)}}function ma(e){return Dn((function(t,r){var n=-1,a=r.length,s=a>1?r[a-1]:void 0,o=a>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(a--,s):void 0,o&&as(r[0],r[1],o)&&(s=a<3?void 0:s,a=1),t=ve(t);++n<a;){var i=r[n];i&&e(t,i,n,s)}return t}))}function ga(e,t){return function(r,n){if(null==r)return r;if(!Lo(r))return e(r,n);for(var a=r.length,s=t?a:-1,o=ve(r);(t?s--:++s<a)&&!1!==n(o[s],s,o););return r}}function ba(e){return function(t,r,n){for(var a=-1,s=ve(t),o=n(t),i=o.length;i--;){var c=o[e?i:++a];if(!1===r(s[c],c,s))break}return t}}function Ia(e){return function(t){var r=Ut(t=ni(t))?Ht(t):void 0,n=r?r[0]:t.charAt(0),a=r?oa(r,1).join(""):t.slice(1);return n[e]()+a}}function ya(e){return function(t){return ft(Ui(Ti(t).replace(Re,"")),e,"")}}function xa(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Er(e.prototype),n=e.apply(r,t);return Mo(n)?n:r}}function ka(e){return function(t,r,n){var a=ve(t);if(!Lo(t)){var s=Ka(r,3);t=_i(t),r=function(e){return s(a[e],e,a)}}var o=e(t,r,n);return o>-1?a[s?t[o]:o]:void 0}}function wa(e){return qa((function(t){var r=t.length,n=r,a=Tr.prototype.thru;for(e&&t.reverse();n--;){var o=t[n];if("function"!=typeof o)throw new ge(s);if(a&&!i&&"wrapper"==Va(o))var i=new Tr([],!0)}for(n=i?n:r;++n<r;){var c=Va(o=t[n]),u="wrapper"==c?za(o):void 0;i=u&&os(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?i[Va(u[0])].apply(i,u[3]):1==o.length&&os(o)?i[c]():i.thru(o)}return function(){var e=arguments,n=e[0];if(i&&1==e.length&&Ao(n))return i.plant(n).value();for(var a=0,s=r?t[a].apply(this,e):n;++a<r;)s=t[a].call(this,s);return s}}))}function Sa(e,t,r,a,s,o,i,c,u,l){var p=128&t,d=1&t,f=2&t,h=24&t,v=512&t,_=f?void 0:xa(e);return function m(){for(var g=arguments.length,b=n(g),I=g;I--;)b[I]=arguments[I];if(h)var y=Wa(m),x=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(b,y);if(a&&(b=da(b,a,s,h)),o&&(b=fa(b,o,i,h)),g-=x,h&&g<l){var k=Mt(b,y);return Na(e,t,Sa,m.placeholder,r,b,k,c,u,l-g)}var w=d?r:this,S=f?w[e]:e;return g=b.length,c?b=function(e,t){for(var r=e.length,n=ar(t.length,r),a=ha(e);n--;){var s=t[n];e[n]=ns(s,r)?a[s]:void 0}return e}(b,c):v&&g>1&&b.reverse(),p&&u<g&&(b.length=u),this&&this!==Ve&&this instanceof m&&(S=_||xa(S)),S.apply(w,b)}}function Ea(e,t){return function(r,n){return function(e,t,r,n){return sn(e,(function(e,a,s){t(n,r(e),a,s)})),n}(r,e,t(n),{})}}function Ca(e,t){return function(r,n){var a;if(void 0===r&&void 0===n)return t;if(void 0!==r&&(a=r),void 0!==n){if(void 0===a)return n;"string"==typeof r||"string"==typeof n?(r=Qn(r),n=Qn(n)):(r=Kn(r),n=Kn(n)),a=e(r,n)}return a}}function Ta(e){return qa((function(t){return t=pt(t,Tt(Ka())),Dn((function(r){var n=this;return e(t,(function(e){return nt(e,n,r)}))}))}))}function Aa(e,t){var r=(t=void 0===t?" ":Qn(t)).length;if(r<2)return r?Pn(t,e):t;var n=Pn(t,Jt(e/qt(t)));return Ut(t)?oa(Ht(n),0,e).join(""):n.slice(0,e)}function Ra(e){return function(t,r,a){return a&&"number"!=typeof a&&as(t,r,a)&&(r=a=void 0),t=$o(t),void 0===r?(r=t,t=0):r=$o(r),function(e,t,r,a){for(var s=-1,o=nr(Jt((t-e)/(r||1)),0),i=n(o);o--;)i[a?o:++s]=e,e+=r;return i}(t,r,a=void 0===a?t<r?1:-1:$o(a),e)}}function La(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=ti(t),r=ti(r)),e(t,r)}}function Na(e,t,r,n,a,s,o,i,c,u){var l=8&t;t|=l?32:64,4&(t&=~(l?64:32))||(t&=-4);var p=[e,t,a,l?s:void 0,l?o:void 0,l?void 0:s,l?void 0:o,i,c,u],d=r.apply(void 0,p);return os(e)&&hs(d,p),d.placeholder=n,ms(d,e,t)}function Oa(e){var t=he[e];return function(e,r){if(e=ti(e),(r=null==r?0:ar(Zo(r),292))&&er(e)){var n=(ni(e)+"e").split("e");return+((n=(ni(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var Pa=dr&&1/Gt(new dr([,-0]))[1]==1/0?function(e){return new dr(e)}:Ki;function Da(e){return function(t){var r=Za(t);return r==v?Bt(t):r==b?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):function(e,t){return pt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Ua(e,t,r,a,i,c,u,l){var p=2&t;if(!p&&"function"!=typeof e)throw new ge(s);var d=a?a.length:0;if(d||(t&=-97,a=i=void 0),u=void 0===u?u:nr(Zo(u),0),l=void 0===l?l:Zo(l),d-=i?i.length:0,64&t){var f=a,h=i;a=i=void 0}var v=p?void 0:za(e),_=[e,t,r,a,i,f,h,c,u,l];if(v&&function(e,t){var r=e[1],n=t[1],a=r|n,s=a<131,i=128==n&&8==r||128==n&&256==r&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==r;if(!s&&!i)return e;1&n&&(e[2]=t[2],a|=1&r?0:4);var c=t[3];if(c){var u=e[3];e[3]=u?da(u,c,t[4]):c,e[4]=u?Mt(e[3],o):t[4]}(c=t[5])&&(u=e[5],e[5]=u?fa(u,c,t[6]):c,e[6]=u?Mt(e[5],o):t[6]),(c=t[7])&&(e[7]=c),128&n&&(e[8]=null==e[8]?t[8]:ar(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=a}(_,v),e=_[0],t=_[1],r=_[2],a=_[3],i=_[4],!(l=_[9]=void 0===_[9]?p?0:e.length:nr(_[9]-d,0))&&24&t&&(t&=-25),t&&1!=t)m=8==t||16==t?function(e,t,r){var a=xa(e);return function s(){for(var o=arguments.length,i=n(o),c=o,u=Wa(s);c--;)i[c]=arguments[c];var l=o<3&&i[0]!==u&&i[o-1]!==u?[]:Mt(i,u);return(o-=l.length)<r?Na(e,t,Sa,s.placeholder,void 0,i,l,void 0,void 0,r-o):nt(this&&this!==Ve&&this instanceof s?a:e,this,i)}}(e,t,l):32!=t&&33!=t||i.length?Sa.apply(void 0,_):function(e,t,r,a){var s=1&t,o=xa(e);return function t(){for(var i=-1,c=arguments.length,u=-1,l=a.length,p=n(l+c),d=this&&this!==Ve&&this instanceof t?o:e;++u<l;)p[u]=a[u];for(;c--;)p[u++]=arguments[++i];return nt(d,s?r:this,p)}}(e,t,r,a);else var m=function(e,t,r){var n=1&t,a=xa(e);return function t(){return(this&&this!==Ve&&this instanceof t?a:e).apply(n?r:this,arguments)}}(e,t,r);return ms((v?Mn:hs)(m,_),e,t)}function Ba(e,t,r,n){return void 0===e||So(e,ye[r])&&!we.call(n,r)?t:e}function Fa(e,t,r,n,a,s){return Mo(e)&&Mo(t)&&(s.set(t,e),Cn(e,t,void 0,Fa,s),s.delete(t)),e}function Ma(e){return jo(e)?void 0:e}function Ga(e,t,r,n,a,s){var o=1&r,i=e.length,c=t.length;if(i!=c&&!(o&&c>i))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var p=-1,d=!0,f=2&r?new Or:void 0;for(s.set(e,t),s.set(t,e);++p<i;){var h=e[p],v=t[p];if(n)var _=o?n(v,h,p,t,e,s):n(h,v,p,e,t,s);if(void 0!==_){if(_)continue;d=!1;break}if(f){if(!vt(t,(function(e,t){if(!Rt(f,t)&&(h===e||a(h,e,r,n,s)))return f.push(t)}))){d=!1;break}}else if(h!==v&&!a(h,v,r,n,s)){d=!1;break}}return s.delete(e),s.delete(t),d}function qa(e){return _s(ps(e,void 0,As),e+"")}function Ha(e){return ln(e,_i,Xa)}function ja(e){return ln(e,mi,$a)}var za=vr?function(e){return vr.get(e)}:Ki;function Va(e){for(var t=e.name+"",r=_r[t],n=we.call(_r,t)?r.length:0;n--;){var a=r[n],s=a.func;if(null==s||s==e)return a.name}return t}function Wa(e){return(we.call(Sr,"placeholder")?Sr:e).placeholder}function Ka(){var e=Sr.iteratee||ji;return e=e===ji?yn:e,arguments.length?e(arguments[0],arguments[1]):e}function Qa(e,t){var r,n,a=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?a["string"==typeof t?"string":"hash"]:a.map}function Ya(e){for(var t=_i(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,us(a)]}return t}function Ja(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return In(r)?r:void 0}var Xa=$t?function(e){return null==e?[]:(e=ve(e),ct($t(e),(function(t){return Ye.call(e,t)})))}:ec,$a=$t?function(e){for(var t=[];e;)dt(t,Xa(e)),e=We(e);return t}:ec,Za=pn;function es(e,t,r){for(var n=-1,a=(t=aa(t,e)).length,s=!1;++n<a;){var o=ys(t[n]);if(!(s=null!=e&&r(e,o)))break;e=e[o]}return s||++n!=a?s:!!(a=null==e?0:e.length)&&Fo(a)&&ns(o,a)&&(Ao(e)||To(e))}function ts(e){return"function"!=typeof e.constructor||cs(e)?{}:Er(We(e))}function rs(e){return Ao(e)||To(e)||!!(_t&&e&&e[_t])}function ns(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&ce.test(e))&&e>-1&&e%1==0&&e<t}function as(e,t,r){if(!Mo(r))return!1;var n=typeof t;return!!("number"==n?Lo(r)&&ns(t,r.length):"string"==n&&t in r)&&So(r[t],e)}function ss(e,t){if(Ao(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Ko(e))||z.test(e)||!j.test(e)||null!=t&&e in ve(t)}function os(e){var t=Va(e),r=Sr[t];if("function"!=typeof r||!(t in Ar.prototype))return!1;if(e===r)return!0;var n=za(r);return!!n&&e===n[0]}(ur&&Za(new ur(new ArrayBuffer(1)))!=w||lr&&Za(new lr)!=v||pr&&"[object Promise]"!=Za(pr.resolve())||dr&&Za(new dr)!=b||fr&&Za(new fr)!=x)&&(Za=function(e){var t=pn(e),r=t==m?e.constructor:void 0,n=r?xs(r):"";if(n)switch(n){case mr:return w;case gr:return v;case br:return"[object Promise]";case Ir:return b;case yr:return x}return t});var is=xe?Uo:tc;function cs(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ye)}function us(e){return e==e&&!Mo(e)}function ls(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in ve(r))}}function ps(e,t,r){return t=nr(void 0===t?e.length-1:t,0),function(){for(var a=arguments,s=-1,o=nr(a.length-t,0),i=n(o);++s<o;)i[s]=a[t+s];s=-1;for(var c=n(t+1);++s<t;)c[s]=a[s];return c[t]=r(i),nt(e,this,c)}}function ds(e,t){return t.length<2?e:un(e,Hn(t,0,-1))}function fs(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var hs=gs(Mn),vs=Yt||function(e,t){return Ve.setTimeout(e,t)},_s=gs(Gn);function ms(e,t,r){var n=t+"";return _s(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(X,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return st(i,(function(r){var n="_."+r[0];t&r[1]&&!ut(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match($);return t?t[1].split(Z):[]}(n),r)))}function gs(e){var t=0,r=0;return function(){var n=sr(),a=16-(n-r);if(r=n,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function bs(e,t){var r=-1,n=e.length,a=n-1;for(t=void 0===t?n:t;++r<t;){var s=On(r,a),o=e[s];e[s]=e[r],e[r]=o}return e.length=t,e}var Is=function(e){var t=bo((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(V,(function(e,r,n,a){t.push(n?a.replace(te,"$1"):r||e)})),t}),(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}();function ys(e){if("string"==typeof e||Ko(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function xs(e){if(null!=e){try{return ke.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ks(e){if(e instanceof Ar)return e.clone();var t=new Tr(e.__wrapped__,e.__chain__);return t.__actions__=ha(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var ws=Dn((function(e,t){return No(e)?Jr(e,rn(t,1,No,!0)):[]})),Ss=Dn((function(e,t){var r=Ps(t);return No(r)&&(r=void 0),No(e)?Jr(e,rn(t,1,No,!0),Ka(r,2)):[]})),Es=Dn((function(e,t){var r=Ps(t);return No(r)&&(r=void 0),No(e)?Jr(e,rn(t,1,No,!0),void 0,r):[]}));function Cs(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=null==r?0:Zo(r);return a<0&&(a=nr(n+a,0)),gt(e,Ka(t,3),a)}function Ts(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=n-1;return void 0!==r&&(a=Zo(r),a=r<0?nr(n+a,0):ar(a,n-1)),gt(e,Ka(t,3),a,!0)}function As(e){return null!=e&&e.length?rn(e,1):[]}function Rs(e){return e&&e.length?e[0]:void 0}var Ls=Dn((function(e){var t=pt(e,ra);return t.length&&t[0]===e[0]?vn(t):[]})),Ns=Dn((function(e){var t=Ps(e),r=pt(e,ra);return t===Ps(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?vn(r,Ka(t,2)):[]})),Os=Dn((function(e){var t=Ps(e),r=pt(e,ra);return(t="function"==typeof t?t:void 0)&&r.pop(),r.length&&r[0]===e[0]?vn(r,void 0,t):[]}));function Ps(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Ds=Dn(Us);function Us(e,t){return e&&e.length&&t&&t.length?Ln(e,t):e}var Bs=qa((function(e,t){var r=null==e?0:e.length,n=Vr(e,t);return Nn(e,pt(t,(function(e){return ns(e,r)?+e:e})).sort(pa)),n}));function Fs(e){return null==e?e:cr.call(e)}var Ms=Dn((function(e){return Yn(rn(e,1,No,!0))})),Gs=Dn((function(e){var t=Ps(e);return No(t)&&(t=void 0),Yn(rn(e,1,No,!0),Ka(t,2))})),qs=Dn((function(e){var t=Ps(e);return t="function"==typeof t?t:void 0,Yn(rn(e,1,No,!0),void 0,t)}));function Hs(e){if(!e||!e.length)return[];var t=0;return e=ct(e,(function(e){if(No(e))return t=nr(e.length,t),!0})),Ct(t,(function(t){return pt(e,kt(t))}))}function js(e,t){if(!e||!e.length)return[];var r=Hs(e);return null==t?r:pt(r,(function(e){return nt(t,void 0,e)}))}var zs=Dn((function(e,t){return No(e)?Jr(e,t):[]})),Vs=Dn((function(e){return ea(ct(e,No))})),Ws=Dn((function(e){var t=Ps(e);return No(t)&&(t=void 0),ea(ct(e,No),Ka(t,2))})),Ks=Dn((function(e){var t=Ps(e);return t="function"==typeof t?t:void 0,ea(ct(e,No),void 0,t)})),Qs=Dn(Hs),Ys=Dn((function(e){var t=e.length,r=t>1?e[t-1]:void 0;return r="function"==typeof r?(e.pop(),r):void 0,js(e,r)}));function Js(e){var t=Sr(e);return t.__chain__=!0,t}function Xs(e,t){return t(e)}var $s=qa((function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,a=function(t){return Vr(t,e)};return!(t>1||this.__actions__.length)&&n instanceof Ar&&ns(r)?((n=n.slice(r,+r+(t?1:0))).__actions__.push({func:Xs,args:[a],thisArg:void 0}),new Tr(n,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(a)})),Zs=_a((function(e,t,r){we.call(e,r)?++e[r]:zr(e,r,1)})),eo=ka(Cs),to=ka(Ts);function ro(e,t){return(Ao(e)?st:Xr)(e,Ka(t,3))}function no(e,t){return(Ao(e)?ot:$r)(e,Ka(t,3))}var ao=_a((function(e,t,r){we.call(e,r)?e[r].push(t):zr(e,r,[t])})),so=Dn((function(e,t,r){var a=-1,s="function"==typeof t,o=Lo(e)?n(e.length):[];return Xr(e,(function(e){o[++a]=s?nt(t,e,r):_n(e,t,r)})),o})),oo=_a((function(e,t,r){zr(e,r,t)}));function io(e,t){return(Ao(e)?pt:wn)(e,Ka(t,3))}var co=_a((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]})),uo=Dn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&as(e,t[0],t[1])?t=[]:r>2&&as(t[0],t[1],t[2])&&(t=[t[0]]),An(e,rn(t,1),[])})),lo=Qt||function(){return Ve.Date.now()};function po(e,t,r){return t=r?void 0:t,Ua(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}function fo(e,t){var r;if("function"!=typeof t)throw new ge(s);return e=Zo(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}var ho=Dn((function(e,t,r){var n=1;if(r.length){var a=Mt(r,Wa(ho));n|=32}return Ua(e,n,t,r,a)})),vo=Dn((function(e,t,r){var n=3;if(r.length){var a=Mt(r,Wa(vo));n|=32}return Ua(t,n,e,r,a)}));function _o(e,t,r){var n,a,o,i,c,u,l=0,p=!1,d=!1,f=!0;if("function"!=typeof e)throw new ge(s);function h(t){var r=n,s=a;return n=a=void 0,l=t,i=e.apply(s,r)}function v(e){var r=e-u;return void 0===u||r>=t||r<0||d&&e-l>=o}function _(){var e=lo();if(v(e))return m(e);c=vs(_,function(e){var r=t-(e-u);return d?ar(r,o-(e-l)):r}(e))}function m(e){return c=void 0,f&&n?h(e):(n=a=void 0,i)}function g(){var e=lo(),r=v(e);if(n=arguments,a=this,u=e,r){if(void 0===c)return function(e){return l=e,c=vs(_,t),p?h(e):i}(u);if(d)return ia(c),c=vs(_,t),h(u)}return void 0===c&&(c=vs(_,t)),i}return t=ti(t)||0,Mo(r)&&(p=!!r.leading,o=(d="maxWait"in r)?nr(ti(r.maxWait)||0,t):o,f="trailing"in r?!!r.trailing:f),g.cancel=function(){void 0!==c&&ia(c),l=0,n=u=a=c=void 0},g.flush=function(){return void 0===c?i:m(lo())},g}var mo=Dn((function(e,t){return Yr(e,1,t)})),go=Dn((function(e,t,r){return Yr(e,ti(t)||0,r)}));function bo(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new ge(s);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],s=r.cache;if(s.has(a))return s.get(a);var o=e.apply(this,n);return r.cache=s.set(a,o)||s,o};return r.cache=new(bo.Cache||Nr),r}function Io(e){if("function"!=typeof e)throw new ge(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}bo.Cache=Nr;var yo=sa((function(e,t){var r=(t=1==t.length&&Ao(t[0])?pt(t[0],Tt(Ka())):pt(rn(t,1),Tt(Ka()))).length;return Dn((function(n){for(var a=-1,s=ar(n.length,r);++a<s;)n[a]=t[a].call(this,n[a]);return nt(e,this,n)}))})),xo=Dn((function(e,t){return Ua(e,32,void 0,t,Mt(t,Wa(xo)))})),ko=Dn((function(e,t){return Ua(e,64,void 0,t,Mt(t,Wa(ko)))})),wo=qa((function(e,t){return Ua(e,256,void 0,void 0,void 0,t)}));function So(e,t){return e===t||e!=e&&t!=t}var Eo=La(dn),Co=La((function(e,t){return e>=t})),To=mn(function(){return arguments}())?mn:function(e){return Go(e)&&we.call(e,"callee")&&!Ye.call(e,"callee")},Ao=n.isArray,Ro=Xe?Tt(Xe):function(e){return Go(e)&&pn(e)==k};function Lo(e){return null!=e&&Fo(e.length)&&!Uo(e)}function No(e){return Go(e)&&Lo(e)}var Oo=Zt||tc,Po=$e?Tt($e):function(e){return Go(e)&&pn(e)==p};function Do(e){if(!Go(e))return!1;var t=pn(e);return t==d||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!jo(e)}function Uo(e){if(!Mo(e))return!1;var t=pn(e);return t==f||t==h||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Bo(e){return"number"==typeof e&&e==Zo(e)}function Fo(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Mo(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Go(e){return null!=e&&"object"==typeof e}var qo=Ze?Tt(Ze):function(e){return Go(e)&&Za(e)==v};function Ho(e){return"number"==typeof e||Go(e)&&pn(e)==_}function jo(e){if(!Go(e)||pn(e)!=m)return!1;var t=We(e);if(null===t)return!0;var r=we.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&ke.call(r)==Te}var zo=et?Tt(et):function(e){return Go(e)&&pn(e)==g},Vo=tt?Tt(tt):function(e){return Go(e)&&Za(e)==b};function Wo(e){return"string"==typeof e||!Ao(e)&&Go(e)&&pn(e)==I}function Ko(e){return"symbol"==typeof e||Go(e)&&pn(e)==y}var Qo=rt?Tt(rt):function(e){return Go(e)&&Fo(e.length)&&!!Fe[pn(e)]},Yo=La(kn),Jo=La((function(e,t){return e<=t}));function Xo(e){if(!e)return[];if(Lo(e))return Wo(e)?Ht(e):ha(e);if(wt&&e[wt])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[wt]());var t=Za(e);return(t==v?Bt:t==b?Gt:Si)(e)}function $o(e){return e?(e=ti(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function Zo(e){var t=$o(e),r=t%1;return t==t?r?t-r:t:0}function ei(e){return e?Wr(Zo(e),0,4294967295):0}function ti(e){if("number"==typeof e)return e;if(Ko(e))return NaN;if(Mo(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Mo(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Q,"");var r=se.test(e);return r||ie.test(e)?He(e.slice(2),r?2:8):ae.test(e)?NaN:+e}function ri(e){return va(e,mi(e))}function ni(e){return null==e?"":Qn(e)}var ai=ma((function(e,t){if(cs(t)||Lo(t))va(t,_i(t),e);else for(var r in t)we.call(t,r)&&Gr(e,r,t[r])})),si=ma((function(e,t){va(t,mi(t),e)})),oi=ma((function(e,t,r,n){va(t,mi(t),e,n)})),ii=ma((function(e,t,r,n){va(t,_i(t),e,n)})),ci=qa(Vr),ui=Dn((function(e,t){e=ve(e);var r=-1,n=t.length,a=n>2?t[2]:void 0;for(a&&as(t[0],t[1],a)&&(n=1);++r<n;)for(var s=t[r],o=mi(s),i=-1,c=o.length;++i<c;){var u=o[i],l=e[u];(void 0===l||So(l,ye[u])&&!we.call(e,u))&&(e[u]=s[u])}return e})),li=Dn((function(e){return e.push(void 0,Fa),nt(bi,void 0,e)}));function pi(e,t,r){var n=null==e?void 0:un(e,t);return void 0===n?r:n}function di(e,t){return null!=e&&es(e,t,hn)}var fi=Ea((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ce.call(t)),e[t]=r}),Mi(Hi)),hi=Ea((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ce.call(t)),we.call(e,t)?e[t].push(r):e[t]=[r]}),Ka),vi=Dn(_n);function _i(e){return Lo(e)?Dr(e):xn(e)}function mi(e){return Lo(e)?Dr(e,!0):function(e){if(!Mo(e))return function(e){var t=[];if(null!=e)for(var r in ve(e))t.push(r);return t}(e);var t=cs(e),r=[];for(var n in e)("constructor"!=n||!t&&we.call(e,n))&&r.push(n);return r}(e)}var gi=ma((function(e,t,r){Cn(e,t,r)})),bi=ma((function(e,t,r,n){Cn(e,t,r,n)})),Ii=qa((function(e,t){var r={};if(null==e)return r;var n=!1;t=pt(t,(function(t){return t=aa(t,e),n||(n=t.length>1),t})),va(e,ja(e),r),n&&(r=Kr(r,7,Ma));for(var a=t.length;a--;)Jn(r,t[a]);return r})),yi=qa((function(e,t){return null==e?{}:function(e,t){return Rn(e,t,(function(t,r){return di(e,r)}))}(e,t)}));function xi(e,t){if(null==e)return{};var r=pt(ja(e),(function(e){return[e]}));return t=Ka(t),Rn(e,r,(function(e,r){return t(e,r[0])}))}var ki=Da(_i),wi=Da(mi);function Si(e){return null==e?[]:At(e,_i(e))}var Ei=ya((function(e,t,r){return t=t.toLowerCase(),e+(r?Ci(t):t)}));function Ci(e){return Di(ni(e).toLowerCase())}function Ti(e){return(e=ni(e))&&e.replace(ue,Ot).replace(Le,"")}var Ai=ya((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),Ri=ya((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Li=Ia("toLowerCase"),Ni=ya((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()})),Oi=ya((function(e,t,r){return e+(r?" ":"")+Di(t)})),Pi=ya((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Di=Ia("toUpperCase");function Ui(e,t,r){return e=ni(e),void 0===(t=r?void 0:t)?function(e){return De.test(e)}(e)?function(e){return e.match(Oe)||[]}(e):function(e){return e.match(ee)||[]}(e):e.match(t)||[]}var Bi=Dn((function(e,t){try{return nt(e,void 0,t)}catch(e){return Do(e)?e:new de(e)}})),Fi=qa((function(e,t){return st(t,(function(t){t=ys(t),zr(e,t,ho(e[t],e))})),e}));function Mi(e){return function(){return e}}var Gi=wa(),qi=wa(!0);function Hi(e){return e}function ji(e){return yn("function"==typeof e?e:Kr(e,1))}var zi=Dn((function(e,t){return function(r){return _n(r,e,t)}})),Vi=Dn((function(e,t){return function(r){return _n(e,r,t)}}));function Wi(e,t,r){var n=_i(t),a=cn(t,n);null!=r||Mo(t)&&(a.length||!n.length)||(r=t,t=e,e=this,a=cn(t,_i(t)));var s=!(Mo(r)&&"chain"in r&&!r.chain),o=Uo(e);return st(a,(function(r){var n=t[r];e[r]=n,o&&(e.prototype[r]=function(){var t=this.__chain__;if(s||t){var r=e(this.__wrapped__);return(r.__actions__=ha(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,dt([this.value()],arguments))})})),e}function Ki(){}var Qi=Ta(pt),Yi=Ta(it),Ji=Ta(vt);function Xi(e){return ss(e)?kt(ys(e)):function(e){return function(t){return un(t,e)}}(e)}var $i=Ra(),Zi=Ra(!0);function ec(){return[]}function tc(){return!1}var rc,nc=Ca((function(e,t){return e+t}),0),ac=Oa("ceil"),sc=Ca((function(e,t){return e/t}),1),oc=Oa("floor"),ic=Ca((function(e,t){return e*t}),1),cc=Oa("round"),uc=Ca((function(e,t){return e-t}),0);return Sr.after=function(e,t){if("function"!=typeof t)throw new ge(s);return e=Zo(e),function(){if(--e<1)return t.apply(this,arguments)}},Sr.ary=po,Sr.assign=ai,Sr.assignIn=si,Sr.assignInWith=oi,Sr.assignWith=ii,Sr.at=ci,Sr.before=fo,Sr.bind=ho,Sr.bindAll=Fi,Sr.bindKey=vo,Sr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ao(e)?e:[e]},Sr.chain=Js,Sr.chunk=function(e,t,r){t=(r?as(e,t,r):void 0===t)?1:nr(Zo(t),0);var a=null==e?0:e.length;if(!a||t<1)return[];for(var s=0,o=0,i=n(Jt(a/t));s<a;)i[o++]=Hn(e,s,s+=t);return i},Sr.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,a=[];++t<r;){var s=e[t];s&&(a[n++]=s)}return a},Sr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),r=arguments[0],a=e;a--;)t[a-1]=arguments[a];return dt(Ao(r)?ha(r):[r],rn(t,1))},Sr.cond=function(e){var t=null==e?0:e.length,r=Ka();return e=t?pt(e,(function(e){if("function"!=typeof e[1])throw new ge(s);return[r(e[0]),e[1]]})):[],Dn((function(r){for(var n=-1;++n<t;){var a=e[n];if(nt(a[0],this,r))return nt(a[1],this,r)}}))},Sr.conforms=function(e){return function(e){var t=_i(e);return function(r){return Qr(r,e,t)}}(Kr(e,1))},Sr.constant=Mi,Sr.countBy=Zs,Sr.create=function(e,t){var r=Er(e);return null==t?r:jr(r,t)},Sr.curry=function e(t,r,n){var a=Ua(t,8,void 0,void 0,void 0,void 0,void 0,r=n?void 0:r);return a.placeholder=e.placeholder,a},Sr.curryRight=function e(t,r,n){var a=Ua(t,16,void 0,void 0,void 0,void 0,void 0,r=n?void 0:r);return a.placeholder=e.placeholder,a},Sr.debounce=_o,Sr.defaults=ui,Sr.defaultsDeep=li,Sr.defer=mo,Sr.delay=go,Sr.difference=ws,Sr.differenceBy=Ss,Sr.differenceWith=Es,Sr.drop=function(e,t,r){var n=null==e?0:e.length;return n?Hn(e,(t=r||void 0===t?1:Zo(t))<0?0:t,n):[]},Sr.dropRight=function(e,t,r){var n=null==e?0:e.length;return n?Hn(e,0,(t=n-(t=r||void 0===t?1:Zo(t)))<0?0:t):[]},Sr.dropRightWhile=function(e,t){return e&&e.length?$n(e,Ka(t,3),!0,!0):[]},Sr.dropWhile=function(e,t){return e&&e.length?$n(e,Ka(t,3),!0):[]},Sr.fill=function(e,t,r,n){var a=null==e?0:e.length;return a?(r&&"number"!=typeof r&&as(e,t,r)&&(r=0,n=a),function(e,t,r,n){var a=e.length;for((r=Zo(r))<0&&(r=-r>a?0:a+r),(n=void 0===n||n>a?a:Zo(n))<0&&(n+=a),n=r>n?0:ei(n);r<n;)e[r++]=t;return e}(e,t,r,n)):[]},Sr.filter=function(e,t){return(Ao(e)?ct:tn)(e,Ka(t,3))},Sr.flatMap=function(e,t){return rn(io(e,t),1)},Sr.flatMapDeep=function(e,t){return rn(io(e,t),1/0)},Sr.flatMapDepth=function(e,t,r){return r=void 0===r?1:Zo(r),rn(io(e,t),r)},Sr.flatten=As,Sr.flattenDeep=function(e){return null!=e&&e.length?rn(e,1/0):[]},Sr.flattenDepth=function(e,t){return null!=e&&e.length?rn(e,t=void 0===t?1:Zo(t)):[]},Sr.flip=function(e){return Ua(e,512)},Sr.flow=Gi,Sr.flowRight=qi,Sr.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var a=e[t];n[a[0]]=a[1]}return n},Sr.functions=function(e){return null==e?[]:cn(e,_i(e))},Sr.functionsIn=function(e){return null==e?[]:cn(e,mi(e))},Sr.groupBy=ao,Sr.initial=function(e){return null!=e&&e.length?Hn(e,0,-1):[]},Sr.intersection=Ls,Sr.intersectionBy=Ns,Sr.intersectionWith=Os,Sr.invert=fi,Sr.invertBy=hi,Sr.invokeMap=so,Sr.iteratee=ji,Sr.keyBy=oo,Sr.keys=_i,Sr.keysIn=mi,Sr.map=io,Sr.mapKeys=function(e,t){var r={};return t=Ka(t,3),sn(e,(function(e,n,a){zr(r,t(e,n,a),e)})),r},Sr.mapValues=function(e,t){var r={};return t=Ka(t,3),sn(e,(function(e,n,a){zr(r,n,t(e,n,a))})),r},Sr.matches=function(e){return Sn(Kr(e,1))},Sr.matchesProperty=function(e,t){return En(e,Kr(t,1))},Sr.memoize=bo,Sr.merge=gi,Sr.mergeWith=bi,Sr.method=zi,Sr.methodOf=Vi,Sr.mixin=Wi,Sr.negate=Io,Sr.nthArg=function(e){return e=Zo(e),Dn((function(t){return Tn(t,e)}))},Sr.omit=Ii,Sr.omitBy=function(e,t){return xi(e,Io(Ka(t)))},Sr.once=function(e){return fo(2,e)},Sr.orderBy=function(e,t,r,n){return null==e?[]:(Ao(t)||(t=null==t?[]:[t]),Ao(r=n?void 0:r)||(r=null==r?[]:[r]),An(e,t,r))},Sr.over=Qi,Sr.overArgs=yo,Sr.overEvery=Yi,Sr.overSome=Ji,Sr.partial=xo,Sr.partialRight=ko,Sr.partition=co,Sr.pick=yi,Sr.pickBy=xi,Sr.property=Xi,Sr.propertyOf=function(e){return function(t){return null==e?void 0:un(e,t)}},Sr.pull=Ds,Sr.pullAll=Us,Sr.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Ln(e,t,Ka(r,2)):e},Sr.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?Ln(e,t,void 0,r):e},Sr.pullAt=Bs,Sr.range=$i,Sr.rangeRight=Zi,Sr.rearg=wo,Sr.reject=function(e,t){return(Ao(e)?ct:tn)(e,Io(Ka(t,3)))},Sr.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,a=[],s=e.length;for(t=Ka(t,3);++n<s;){var o=e[n];t(o,n,e)&&(r.push(o),a.push(n))}return Nn(e,a),r},Sr.rest=function(e,t){if("function"!=typeof e)throw new ge(s);return Dn(e,t=void 0===t?t:Zo(t))},Sr.reverse=Fs,Sr.sampleSize=function(e,t,r){return t=(r?as(e,t,r):void 0===t)?1:Zo(t),(Ao(e)?Br:Bn)(e,t)},Sr.set=function(e,t,r){return null==e?e:Fn(e,t,r)},Sr.setWith=function(e,t,r,n){return n="function"==typeof n?n:void 0,null==e?e:Fn(e,t,r,n)},Sr.shuffle=function(e){return(Ao(e)?Fr:qn)(e)},Sr.slice=function(e,t,r){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&as(e,t,r)?(t=0,r=n):(t=null==t?0:Zo(t),r=void 0===r?n:Zo(r)),Hn(e,t,r)):[]},Sr.sortBy=uo,Sr.sortedUniq=function(e){return e&&e.length?Wn(e):[]},Sr.sortedUniqBy=function(e,t){return e&&e.length?Wn(e,Ka(t,2)):[]},Sr.split=function(e,t,r){return r&&"number"!=typeof r&&as(e,t,r)&&(t=r=void 0),(r=void 0===r?4294967295:r>>>0)?(e=ni(e))&&("string"==typeof t||null!=t&&!zo(t))&&!(t=Qn(t))&&Ut(e)?oa(Ht(e),0,r):e.split(t,r):[]},Sr.spread=function(e,t){if("function"!=typeof e)throw new ge(s);return t=null==t?0:nr(Zo(t),0),Dn((function(r){var n=r[t],a=oa(r,0,t);return n&&dt(a,n),nt(e,this,a)}))},Sr.tail=function(e){var t=null==e?0:e.length;return t?Hn(e,1,t):[]},Sr.take=function(e,t,r){return e&&e.length?Hn(e,0,(t=r||void 0===t?1:Zo(t))<0?0:t):[]},Sr.takeRight=function(e,t,r){var n=null==e?0:e.length;return n?Hn(e,(t=n-(t=r||void 0===t?1:Zo(t)))<0?0:t,n):[]},Sr.takeRightWhile=function(e,t){return e&&e.length?$n(e,Ka(t,3),!1,!0):[]},Sr.takeWhile=function(e,t){return e&&e.length?$n(e,Ka(t,3)):[]},Sr.tap=function(e,t){return t(e),e},Sr.throttle=function(e,t,r){var n=!0,a=!0;if("function"!=typeof e)throw new ge(s);return Mo(r)&&(n="leading"in r?!!r.leading:n,a="trailing"in r?!!r.trailing:a),_o(e,t,{leading:n,maxWait:t,trailing:a})},Sr.thru=Xs,Sr.toArray=Xo,Sr.toPairs=ki,Sr.toPairsIn=wi,Sr.toPath=function(e){return Ao(e)?pt(e,ys):Ko(e)?[e]:ha(Is(ni(e)))},Sr.toPlainObject=ri,Sr.transform=function(e,t,r){var n=Ao(e),a=n||Oo(e)||Qo(e);if(t=Ka(t,4),null==r){var s=e&&e.constructor;r=a?n?new s:[]:Mo(e)&&Uo(s)?Er(We(e)):{}}return(a?st:sn)(e,(function(e,n,a){return t(r,e,n,a)})),r},Sr.unary=function(e){return po(e,1)},Sr.union=Ms,Sr.unionBy=Gs,Sr.unionWith=qs,Sr.uniq=function(e){return e&&e.length?Yn(e):[]},Sr.uniqBy=function(e,t){return e&&e.length?Yn(e,Ka(t,2)):[]},Sr.uniqWith=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?Yn(e,void 0,t):[]},Sr.unset=function(e,t){return null==e||Jn(e,t)},Sr.unzip=Hs,Sr.unzipWith=js,Sr.update=function(e,t,r){return null==e?e:Xn(e,t,na(r))},Sr.updateWith=function(e,t,r,n){return n="function"==typeof n?n:void 0,null==e?e:Xn(e,t,na(r),n)},Sr.values=Si,Sr.valuesIn=function(e){return null==e?[]:At(e,mi(e))},Sr.without=zs,Sr.words=Ui,Sr.wrap=function(e,t){return xo(na(t),e)},Sr.xor=Vs,Sr.xorBy=Ws,Sr.xorWith=Ks,Sr.zip=Qs,Sr.zipObject=function(e,t){return ta(e||[],t||[],Gr)},Sr.zipObjectDeep=function(e,t){return ta(e||[],t||[],Fn)},Sr.zipWith=Ys,Sr.entries=ki,Sr.entriesIn=wi,Sr.extend=si,Sr.extendWith=oi,Wi(Sr,Sr),Sr.add=nc,Sr.attempt=Bi,Sr.camelCase=Ei,Sr.capitalize=Ci,Sr.ceil=ac,Sr.clamp=function(e,t,r){return void 0===r&&(r=t,t=void 0),void 0!==r&&(r=(r=ti(r))==r?r:0),void 0!==t&&(t=(t=ti(t))==t?t:0),Wr(ti(e),t,r)},Sr.clone=function(e){return Kr(e,4)},Sr.cloneDeep=function(e){return Kr(e,5)},Sr.cloneDeepWith=function(e,t){return Kr(e,5,t="function"==typeof t?t:void 0)},Sr.cloneWith=function(e,t){return Kr(e,4,t="function"==typeof t?t:void 0)},Sr.conformsTo=function(e,t){return null==t||Qr(e,t,_i(t))},Sr.deburr=Ti,Sr.defaultTo=function(e,t){return null==e||e!=e?t:e},Sr.divide=sc,Sr.endsWith=function(e,t,r){e=ni(e),t=Qn(t);var n=e.length,a=r=void 0===r?n:Wr(Zo(r),0,n);return(r-=t.length)>=0&&e.slice(r,a)==t},Sr.eq=So,Sr.escape=function(e){return(e=ni(e))&&M.test(e)?e.replace(B,Pt):e},Sr.escapeRegExp=function(e){return(e=ni(e))&&K.test(e)?e.replace(W,"\\$&"):e},Sr.every=function(e,t,r){var n=Ao(e)?it:Zr;return r&&as(e,t,r)&&(t=void 0),n(e,Ka(t,3))},Sr.find=eo,Sr.findIndex=Cs,Sr.findKey=function(e,t){return mt(e,Ka(t,3),sn)},Sr.findLast=to,Sr.findLastIndex=Ts,Sr.findLastKey=function(e,t){return mt(e,Ka(t,3),on)},Sr.floor=oc,Sr.forEach=ro,Sr.forEachRight=no,Sr.forIn=function(e,t){return null==e?e:nn(e,Ka(t,3),mi)},Sr.forInRight=function(e,t){return null==e?e:an(e,Ka(t,3),mi)},Sr.forOwn=function(e,t){return e&&sn(e,Ka(t,3))},Sr.forOwnRight=function(e,t){return e&&on(e,Ka(t,3))},Sr.get=pi,Sr.gt=Eo,Sr.gte=Co,Sr.has=function(e,t){return null!=e&&es(e,t,fn)},Sr.hasIn=di,Sr.head=Rs,Sr.identity=Hi,Sr.includes=function(e,t,r,n){e=Lo(e)?e:Si(e),r=r&&!n?Zo(r):0;var a=e.length;return r<0&&(r=nr(a+r,0)),Wo(e)?r<=a&&e.indexOf(t,r)>-1:!!a&&bt(e,t,r)>-1},Sr.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=null==r?0:Zo(r);return a<0&&(a=nr(n+a,0)),bt(e,t,a)},Sr.inRange=function(e,t,r){return t=$o(t),void 0===r?(r=t,t=0):r=$o(r),function(e,t,r){return e>=ar(t,r)&&e<nr(t,r)}(e=ti(e),t,r)},Sr.invoke=vi,Sr.isArguments=To,Sr.isArray=Ao,Sr.isArrayBuffer=Ro,Sr.isArrayLike=Lo,Sr.isArrayLikeObject=No,Sr.isBoolean=function(e){return!0===e||!1===e||Go(e)&&pn(e)==l},Sr.isBuffer=Oo,Sr.isDate=Po,Sr.isElement=function(e){return Go(e)&&1===e.nodeType&&!jo(e)},Sr.isEmpty=function(e){if(null==e)return!0;if(Lo(e)&&(Ao(e)||"string"==typeof e||"function"==typeof e.splice||Oo(e)||Qo(e)||To(e)))return!e.length;var t=Za(e);if(t==v||t==b)return!e.size;if(cs(e))return!xn(e).length;for(var r in e)if(we.call(e,r))return!1;return!0},Sr.isEqual=function(e,t){return gn(e,t)},Sr.isEqualWith=function(e,t,r){var n=(r="function"==typeof r?r:void 0)?r(e,t):void 0;return void 0===n?gn(e,t,void 0,r):!!n},Sr.isError=Do,Sr.isFinite=function(e){return"number"==typeof e&&er(e)},Sr.isFunction=Uo,Sr.isInteger=Bo,Sr.isLength=Fo,Sr.isMap=qo,Sr.isMatch=function(e,t){return e===t||bn(e,t,Ya(t))},Sr.isMatchWith=function(e,t,r){return r="function"==typeof r?r:void 0,bn(e,t,Ya(t),r)},Sr.isNaN=function(e){return Ho(e)&&e!=+e},Sr.isNative=function(e){if(is(e))throw new de("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return In(e)},Sr.isNil=function(e){return null==e},Sr.isNull=function(e){return null===e},Sr.isNumber=Ho,Sr.isObject=Mo,Sr.isObjectLike=Go,Sr.isPlainObject=jo,Sr.isRegExp=zo,Sr.isSafeInteger=function(e){return Bo(e)&&e>=-9007199254740991&&e<=9007199254740991},Sr.isSet=Vo,Sr.isString=Wo,Sr.isSymbol=Ko,Sr.isTypedArray=Qo,Sr.isUndefined=function(e){return void 0===e},Sr.isWeakMap=function(e){return Go(e)&&Za(e)==x},Sr.isWeakSet=function(e){return Go(e)&&"[object WeakSet]"==pn(e)},Sr.join=function(e,t){return null==e?"":tr.call(e,t)},Sr.kebabCase=Ai,Sr.last=Ps,Sr.lastIndexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var a=n;return void 0!==r&&(a=(a=Zo(r))<0?nr(n+a,0):ar(a,n-1)),t==t?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(e,t,a):gt(e,yt,a,!0)},Sr.lowerCase=Ri,Sr.lowerFirst=Li,Sr.lt=Yo,Sr.lte=Jo,Sr.max=function(e){return e&&e.length?en(e,Hi,dn):void 0},Sr.maxBy=function(e,t){return e&&e.length?en(e,Ka(t,2),dn):void 0},Sr.mean=function(e){return xt(e,Hi)},Sr.meanBy=function(e,t){return xt(e,Ka(t,2))},Sr.min=function(e){return e&&e.length?en(e,Hi,kn):void 0},Sr.minBy=function(e,t){return e&&e.length?en(e,Ka(t,2),kn):void 0},Sr.stubArray=ec,Sr.stubFalse=tc,Sr.stubObject=function(){return{}},Sr.stubString=function(){return""},Sr.stubTrue=function(){return!0},Sr.multiply=ic,Sr.nth=function(e,t){return e&&e.length?Tn(e,Zo(t)):void 0},Sr.noConflict=function(){return Ve._===this&&(Ve._=Ae),this},Sr.noop=Ki,Sr.now=lo,Sr.pad=function(e,t,r){e=ni(e);var n=(t=Zo(t))?qt(e):0;if(!t||n>=t)return e;var a=(t-n)/2;return Aa(Xt(a),r)+e+Aa(Jt(a),r)},Sr.padEnd=function(e,t,r){e=ni(e);var n=(t=Zo(t))?qt(e):0;return t&&n<t?e+Aa(t-n,r):e},Sr.padStart=function(e,t,r){e=ni(e);var n=(t=Zo(t))?qt(e):0;return t&&n<t?Aa(t-n,r)+e:e},Sr.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),or(ni(e).replace(Y,""),t||0)},Sr.random=function(e,t,r){if(r&&"boolean"!=typeof r&&as(e,t,r)&&(t=r=void 0),void 0===r&&("boolean"==typeof t?(r=t,t=void 0):"boolean"==typeof e&&(r=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=$o(e),void 0===t?(t=e,e=0):t=$o(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var a=ir();return ar(e+a*(t-e+qe("1e-"+((a+"").length-1))),t)}return On(e,t)},Sr.reduce=function(e,t,r){var n=Ao(e)?ft:St,a=arguments.length<3;return n(e,Ka(t,4),r,a,Xr)},Sr.reduceRight=function(e,t,r){var n=Ao(e)?ht:St,a=arguments.length<3;return n(e,Ka(t,4),r,a,$r)},Sr.repeat=function(e,t,r){return t=(r?as(e,t,r):void 0===t)?1:Zo(t),Pn(ni(e),t)},Sr.replace=function(){var e=arguments,t=ni(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Sr.result=function(e,t,r){var n=-1,a=(t=aa(t,e)).length;for(a||(a=1,e=void 0);++n<a;){var s=null==e?void 0:e[ys(t[n])];void 0===s&&(n=a,s=r),e=Uo(s)?s.call(e):s}return e},Sr.round=cc,Sr.runInContext=e,Sr.sample=function(e){return(Ao(e)?Ur:Un)(e)},Sr.size=function(e){if(null==e)return 0;if(Lo(e))return Wo(e)?qt(e):e.length;var t=Za(e);return t==v||t==b?e.size:xn(e).length},Sr.snakeCase=Ni,Sr.some=function(e,t,r){var n=Ao(e)?vt:jn;return r&&as(e,t,r)&&(t=void 0),n(e,Ka(t,3))},Sr.sortedIndex=function(e,t){return zn(e,t)},Sr.sortedIndexBy=function(e,t,r){return Vn(e,t,Ka(r,2))},Sr.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=zn(e,t);if(n<r&&So(e[n],t))return n}return-1},Sr.sortedLastIndex=function(e,t){return zn(e,t,!0)},Sr.sortedLastIndexBy=function(e,t,r){return Vn(e,t,Ka(r,2),!0)},Sr.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var r=zn(e,t,!0)-1;if(So(e[r],t))return r}return-1},Sr.startCase=Oi,Sr.startsWith=function(e,t,r){return e=ni(e),r=null==r?0:Wr(Zo(r),0,e.length),t=Qn(t),e.slice(r,r+t.length)==t},Sr.subtract=uc,Sr.sum=function(e){return e&&e.length?Et(e,Hi):0},Sr.sumBy=function(e,t){return e&&e.length?Et(e,Ka(t,2)):0},Sr.template=function(e,t,r){var n=Sr.templateSettings;r&&as(e,t,r)&&(t=void 0),e=ni(e),t=oi({},t,n,Ba);var a,s,o=oi({},t.imports,n.imports,Ba),i=_i(o),c=At(o,i),u=0,l=t.interpolate||le,p="__p += '",d=_e((t.escape||le).source+"|"+l.source+"|"+(l===H?re:le).source+"|"+(t.evaluate||le).source+"|$","g"),f="//# sourceURL="+(we.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Be+"]")+"\n";e.replace(d,(function(t,r,n,o,i,c){return n||(n=o),p+=e.slice(u,c).replace(pe,Dt),r&&(a=!0,p+="' +\n__e("+r+") +\n'"),i&&(s=!0,p+="';\n"+i+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=c+t.length,t})),p+="';\n";var h=we.call(t,"variable")&&t.variable;h||(p="with (obj) {\n"+p+"\n}\n"),p=(s?p.replace(O,""):p).replace(P,"$1").replace(D,"$1;"),p="function("+(h||"obj")+") {\n"+(h?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var v=Bi((function(){return fe(i,f+"return "+p).apply(void 0,c)}));if(v.source=p,Do(v))throw v;return v},Sr.times=function(e,t){if((e=Zo(e))<1||e>9007199254740991)return[];var r=4294967295,n=ar(e,4294967295);e-=4294967295;for(var a=Ct(n,t=Ka(t));++r<e;)t(r);return a},Sr.toFinite=$o,Sr.toInteger=Zo,Sr.toLength=ei,Sr.toLower=function(e){return ni(e).toLowerCase()},Sr.toNumber=ti,Sr.toSafeInteger=function(e){return e?Wr(Zo(e),-9007199254740991,9007199254740991):0===e?e:0},Sr.toString=ni,Sr.toUpper=function(e){return ni(e).toUpperCase()},Sr.trim=function(e,t,r){if((e=ni(e))&&(r||void 0===t))return e.replace(Q,"");if(!e||!(t=Qn(t)))return e;var n=Ht(e),a=Ht(t);return oa(n,Lt(n,a),Nt(n,a)+1).join("")},Sr.trimEnd=function(e,t,r){if((e=ni(e))&&(r||void 0===t))return e.replace(J,"");if(!e||!(t=Qn(t)))return e;var n=Ht(e);return oa(n,0,Nt(n,Ht(t))+1).join("")},Sr.trimStart=function(e,t,r){if((e=ni(e))&&(r||void 0===t))return e.replace(Y,"");if(!e||!(t=Qn(t)))return e;var n=Ht(e);return oa(n,Lt(n,Ht(t))).join("")},Sr.truncate=function(e,t){var r=30,n="...";if(Mo(t)){var a="separator"in t?t.separator:a;r="length"in t?Zo(t.length):r,n="omission"in t?Qn(t.omission):n}var s=(e=ni(e)).length;if(Ut(e)){var o=Ht(e);s=o.length}if(r>=s)return e;var i=r-qt(n);if(i<1)return n;var c=o?oa(o,0,i).join(""):e.slice(0,i);if(void 0===a)return c+n;if(o&&(i+=c.length-i),zo(a)){if(e.slice(i).search(a)){var u,l=c;for(a.global||(a=_e(a.source,ni(ne.exec(a))+"g")),a.lastIndex=0;u=a.exec(l);)var p=u.index;c=c.slice(0,void 0===p?i:p)}}else if(e.indexOf(Qn(a),i)!=i){var d=c.lastIndexOf(a);d>-1&&(c=c.slice(0,d))}return c+n},Sr.unescape=function(e){return(e=ni(e))&&F.test(e)?e.replace(U,jt):e},Sr.uniqueId=function(e){var t=++Se;return ni(e)+t},Sr.upperCase=Pi,Sr.upperFirst=Di,Sr.each=ro,Sr.eachRight=no,Sr.first=Rs,Wi(Sr,(rc={},sn(Sr,(function(e,t){we.call(Sr.prototype,t)||(rc[t]=e)})),rc),{chain:!1}),Sr.VERSION="4.17.20",st(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Sr[e].placeholder=Sr})),st(["drop","take"],(function(e,t){Ar.prototype[e]=function(r){r=void 0===r?1:nr(Zo(r),0);var n=this.__filtered__&&!t?new Ar(this):this.clone();return n.__filtered__?n.__takeCount__=ar(r,n.__takeCount__):n.__views__.push({size:ar(r,4294967295),type:e+(n.__dir__<0?"Right":"")}),n},Ar.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),st(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;Ar.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Ka(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),st(["head","last"],(function(e,t){var r="take"+(t?"Right":"");Ar.prototype[e]=function(){return this[r](1).value()[0]}})),st(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");Ar.prototype[e]=function(){return this.__filtered__?new Ar(this):this[r](1)}})),Ar.prototype.compact=function(){return this.filter(Hi)},Ar.prototype.find=function(e){return this.filter(e).head()},Ar.prototype.findLast=function(e){return this.reverse().find(e)},Ar.prototype.invokeMap=Dn((function(e,t){return"function"==typeof e?new Ar(this):this.map((function(r){return _n(r,e,t)}))})),Ar.prototype.reject=function(e){return this.filter(Io(Ka(e)))},Ar.prototype.slice=function(e,t){e=Zo(e);var r=this;return r.__filtered__&&(e>0||t<0)?new Ar(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),void 0!==t&&(r=(t=Zo(t))<0?r.dropRight(-t):r.take(t-e)),r)},Ar.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Ar.prototype.toArray=function(){return this.take(4294967295)},sn(Ar.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),a=Sr[n?"take"+("last"==t?"Right":""):t],s=n||/^find/.test(t);a&&(Sr.prototype[t]=function(){var t=this.__wrapped__,o=n?[1]:arguments,i=t instanceof Ar,c=o[0],u=i||Ao(t),l=function(e){var t=a.apply(Sr,dt([e],o));return n&&p?t[0]:t};u&&r&&"function"==typeof c&&1!=c.length&&(i=u=!1);var p=this.__chain__,d=!!this.__actions__.length,f=s&&!p,h=i&&!d;if(!s&&u){t=h?t:new Ar(this);var v=e.apply(t,o);return v.__actions__.push({func:Xs,args:[l],thisArg:void 0}),new Tr(v,p)}return f&&h?e.apply(this,o):(v=this.thru(l),f?n?v.value()[0]:v.value():v)})})),st(["pop","push","shift","sort","splice","unshift"],(function(e){var t=be[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Sr.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var a=this.value();return t.apply(Ao(a)?a:[],e)}return this[r]((function(r){return t.apply(Ao(r)?r:[],e)}))}})),sn(Ar.prototype,(function(e,t){var r=Sr[t];if(r){var n=r.name+"";we.call(_r,n)||(_r[n]=[]),_r[n].push({name:t,func:r})}})),_r[Sa(void 0,2).name]=[{name:"wrapper",func:void 0}],Ar.prototype.clone=function(){var e=new Ar(this.__wrapped__);return e.__actions__=ha(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ha(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ha(this.__views__),e},Ar.prototype.reverse=function(){if(this.__filtered__){var e=new Ar(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Ar.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=Ao(e),n=t<0,a=r?e.length:0,s=function(e,t,r){for(var n=-1,a=r.length;++n<a;){var s=r[n],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=ar(t,e+o);break;case"takeRight":e=nr(e,t-o)}}return{start:e,end:t}}(0,a,this.__views__),o=s.start,i=s.end,c=i-o,u=n?i:o-1,l=this.__iteratees__,p=l.length,d=0,f=ar(c,this.__takeCount__);if(!r||!n&&a==c&&f==c)return Zn(e,this.__actions__);var h=[];e:for(;c--&&d<f;){for(var v=-1,_=e[u+=t];++v<p;){var m=l[v],g=m.iteratee,b=m.type,I=g(_);if(2==b)_=I;else if(!I){if(1==b)continue e;break e}}h[d++]=_}return h},Sr.prototype.at=$s,Sr.prototype.chain=function(){return Js(this)},Sr.prototype.commit=function(){return new Tr(this.value(),this.__chain__)},Sr.prototype.next=function(){void 0===this.__values__&&(this.__values__=Xo(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},Sr.prototype.plant=function(e){for(var t,r=this;r instanceof Cr;){var n=ks(r);n.__index__=0,n.__values__=void 0,t?a.__wrapped__=n:t=n;var a=n;r=r.__wrapped__}return a.__wrapped__=e,t},Sr.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Ar){var t=e;return this.__actions__.length&&(t=new Ar(this)),(t=t.reverse()).__actions__.push({func:Xs,args:[Fs],thisArg:void 0}),new Tr(t,this.__chain__)}return this.thru(Fs)},Sr.prototype.toJSON=Sr.prototype.valueOf=Sr.prototype.value=function(){return Zn(this.__wrapped__,this.__actions__)},Sr.prototype.first=Sr.prototype.head,wt&&(Sr.prototype[wt]=function(){return this}),Sr}();Ve._=zt,void 0===(a=function(){return zt}.call(t,r,t,n))||(n.exports=a)}).call(this)}).call(this,r(12),r(17)(e))},function(e,t,r){var n,a,s,o,i,c;e.exports=(a=(n=c=r(1)).lib,s=a.Base,o=a.WordArray,(i=n.x64={}).Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var a=e[n];r.push(a.high),r.push(a.low)}return o.create(r,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),c)},function(module,exports,__webpack_require__){(function(process){(()=>{"use strict";var __webpack_modules__={607:(module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0});var serializer_1=__webpack_require__(810),deserializer_1=__webpack_require__(496),Module;void 0!==process&&process.release&&"node"===process.release.name&&(Module=eval("require")("module"));var ESSerializer=function(){function e(){}return e.throwErrorIfInNonNodeEnvironment=function(){if(!Module)throw new Error("Cannot intercept require in non-Node environment.")},e.interceptRequire=function(){this.isRequireIntercepted||(this.isRequireIntercepted=!0,this.throwErrorIfInNonNodeEnvironment(),e.originRequire=Module.prototype.require,Module.prototype.require=function(){var t=e.originRequire.apply(this,arguments),r=t.name;return e.requiredClasses[r]||(e.requiredClasses[r]=t),t})},e.stopInterceptRequire=function(){this.throwErrorIfInNonNodeEnvironment(),Module.prototype.require=e.originRequire,this.isRequireIntercepted=!1},e.isInterceptingRequire=function(){return this.isRequireIntercepted},e.getRequiredClasses=function(){return this.requiredClasses},e.clearRequiredClasses=function(){this.requiredClasses={}},e.registerClass=function(e){this.registeredClasses.push(e)},e.registerClasses=function(e){this.registeredClasses=this.registeredClasses.concat(e)},e.clearRegisteredClasses=function(){this.registeredClasses=[]},e.serialize=function(e,t){return void 0===t&&(t={}),JSON.stringify(serializer_1.getSerializeValueWithClassName(e,t))},e.deserialize=function(e,t,r){return void 0===t&&(t=[]),void 0===r&&(r={}),deserializer_1.deserializeFromParsedObj(JSON.parse(e),Object.values(this.requiredClasses).concat(this.registeredClasses).concat(t),r)},e.originRequire=null,e.isRequireIntercepted=!1,e.requiredClasses={},e.registeredClasses=[],e}();module.exports=ESSerializer},917:function(e,t){var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,a++)n[a]=s[o];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.TO_STRING_FIELD=t.TIMESTAMP_FIELD=t.OPTIONS_FIELD=t.CLASS_NAME_FIELD=t.BOOLEAN_FIELD=t.ARRAY_FIELD=t.BUILTIN_TYPE_UNDEFINED=t.BUILTIN_TYPE_NOT_FINITE=t.BUILTIN_TYPE_BIG_INT=t.BUILTIN_CLASS_AGGREGATE_ERROR=t.BUILTIN_CLASS_URI_ERROR=t.BUILTIN_CLASS_TYPE_ERROR=t.BUILTIN_CLASS_SYNTAX_ERROR=t.BUILTIN_CLASS_REFERENCE_ERROR=t.BUILTIN_CLASS_RANGE_ERROR=t.BUILTIN_CLASS_EVAL_ERROR=t.BUILTIN_CLASS_ERROR=t.BUILTIN_CLASS_STRING=t.BUILTIN_CLASS_SET=t.BUILTIN_CLASS_REGEXP=t.BUILTIN_CLASS_INTL_RELATIVETIMEFORMAT=t.BUILTIN_CLASS_INTL_PLURALRULES=t.BUILTIN_CLASS_INTL_NUMBERFORMAT=t.BUILTIN_CLASS_INTL_LOCALE=t.BUILTIN_CLASS_INTL_LISTFORMAT=t.BUILTIN_CLASS_INTL_DATETIMEFORMAT=t.BUILTIN_CLASS_INTL_COLLATOR=t.BUILTIN_CLASS_DATE=t.BUILTIN_CLASS_DATAVIEW=t.BUILTIN_CLASS_BOOLEAN=t.BUILTIN_CLASS_SHAREDARRAYBUFFER=t.BUILTIN_CLASS_ARRAYBUFFER=t.BUILTIN_CLASS_BIGUINT64ARRAY=t.BUILTIN_CLASS_BIGINT64ARRAY=t.BUILTIN_CLASS_FLOAT64ARRAY=t.BUILTIN_CLASS_FLOAT32ARRAY=t.BUILTIN_CLASS_UINT32ARRAY=t.BUILTIN_CLASS_INT32ARRAY=t.BUILTIN_CLASS_UINT16ARRAY=t.BUILTIN_CLASS_INT16ARRAY=t.BUILTIN_CLASS_UINT8CLAMPEDARRAY=t.BUILTIN_CLASS_UINT8ARRAY=t.BUILTIN_CLASS_INT8ARRAY=t.CLASSNAMES_WHOSE_ENUMERABLE_PROPERTIES_SHOULD_BE_IGNORED=t.ALL_BUILTIN_INTLS=t.ALL_BUILTIN_ERRORS=t.ALL_BUILTIN_ARRAYS=t.ESSERIALIZER_NULL=void 0,t.ESSERIALIZER_NULL="__ESSERIALIZER_NULL__",t.ARRAY_FIELD="ess_arr",t.BOOLEAN_FIELD="ess_bool",t.CLASS_NAME_FIELD="ess_cn",t.OPTIONS_FIELD="ess_opt",t.TIMESTAMP_FIELD="ess_ts",t.TO_STRING_FIELD="ess_str";var n="Int8Array";t.BUILTIN_CLASS_INT8ARRAY=n;var a="Uint8Array";t.BUILTIN_CLASS_UINT8ARRAY=a;var s="Uint8ClampedArray";t.BUILTIN_CLASS_UINT8CLAMPEDARRAY=s;var o="Int16Array";t.BUILTIN_CLASS_INT16ARRAY=o;var i="Uint16Array";t.BUILTIN_CLASS_UINT16ARRAY=i;var c="Int32Array";t.BUILTIN_CLASS_INT32ARRAY=c;var u="Uint32Array";t.BUILTIN_CLASS_UINT32ARRAY=u;var l="Float32Array";t.BUILTIN_CLASS_FLOAT32ARRAY=l;var p="Float64Array";t.BUILTIN_CLASS_FLOAT64ARRAY=p;var d="BigInt64Array";t.BUILTIN_CLASS_BIGINT64ARRAY=d;var f="BigUint64Array";t.BUILTIN_CLASS_BIGUINT64ARRAY=f,t.BUILTIN_CLASS_ARRAYBUFFER="ArrayBuffer",t.BUILTIN_CLASS_SHAREDARRAYBUFFER="SharedArrayBuffer",t.BUILTIN_CLASS_BOOLEAN="Boolean",t.BUILTIN_CLASS_DATAVIEW="DataView",t.BUILTIN_CLASS_DATE="Date";var h="Collator";t.BUILTIN_CLASS_INTL_COLLATOR=h;var v="DateTimeFormat";t.BUILTIN_CLASS_INTL_DATETIMEFORMAT=v;var _="ListFormat";t.BUILTIN_CLASS_INTL_LISTFORMAT=_,t.BUILTIN_CLASS_INTL_LOCALE="Locale";var m="NumberFormat";t.BUILTIN_CLASS_INTL_NUMBERFORMAT=m;var g="PluralRules";t.BUILTIN_CLASS_INTL_PLURALRULES=g;var b="RelativeTimeFormat";t.BUILTIN_CLASS_INTL_RELATIVETIMEFORMAT=b,t.BUILTIN_CLASS_REGEXP="RegExp",t.BUILTIN_CLASS_SET="Set";var I="String";t.BUILTIN_CLASS_STRING=I;var y="Error";t.BUILTIN_CLASS_ERROR=y;var x="EvalError";t.BUILTIN_CLASS_EVAL_ERROR=x;var k="RangeError";t.BUILTIN_CLASS_RANGE_ERROR=k;var w="ReferenceError";t.BUILTIN_CLASS_REFERENCE_ERROR=w;var S="SyntaxError";t.BUILTIN_CLASS_SYNTAX_ERROR=S;var E="TypeError";t.BUILTIN_CLASS_TYPE_ERROR=E;var C="URIError";t.BUILTIN_CLASS_URI_ERROR=C;var T="AggregateError";t.BUILTIN_CLASS_AGGREGATE_ERROR=T,t.BUILTIN_TYPE_BIG_INT="BI",t.BUILTIN_TYPE_NOT_FINITE="NF",t.BUILTIN_TYPE_UNDEFINED="UD";var A=[n,a,s,o,i,c,u,l,p,d,f];t.ALL_BUILTIN_ARRAYS=A;var R=[y,x,k,w,S,E,C,T];t.ALL_BUILTIN_ERRORS=R;var L=[h,v,_,m,g,b];t.ALL_BUILTIN_INTLS=L;var N=r([I],A);t.CLASSNAMES_WHOSE_ENUMERABLE_PROPERTIES_SHOULD_BE_IGNORED=N},496:function(e,t,r){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,a++)n[a]=s[o];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.getParentClassName=t.getClassMappingFromClassArray=t.deserializeFromParsedObjWithClassMapping=t.deserializeFromParsedObj=void 0;var a=r(821),s=r(917),o=/^\s*class\s+/;function i(e,t,r){if(void 0===r&&(r={}),a.notObject(e))return e;if(Array.isArray(e))return c(e,t);var n=e[s.CLASS_NAME_FIELD],o=function(e,t,r){switch(e){case s.BUILTIN_CLASS_INT8ARRAY:return u(t[s.ARRAY_FIELD],Int8Array);case s.BUILTIN_CLASS_UINT8ARRAY:return u(t[s.ARRAY_FIELD],Uint8Array);case s.BUILTIN_CLASS_UINT8CLAMPEDARRAY:return u(t[s.ARRAY_FIELD],Uint8ClampedArray);case s.BUILTIN_CLASS_INT16ARRAY:return u(t[s.ARRAY_FIELD],Int16Array);case s.BUILTIN_CLASS_UINT16ARRAY:return u(t[s.ARRAY_FIELD],Uint16Array);case s.BUILTIN_CLASS_INT32ARRAY:return u(t[s.ARRAY_FIELD],Int32Array);case s.BUILTIN_CLASS_UINT32ARRAY:return u(t[s.ARRAY_FIELD],Uint32Array);case s.BUILTIN_CLASS_FLOAT32ARRAY:return u(t[s.ARRAY_FIELD],Float32Array);case s.BUILTIN_CLASS_FLOAT64ARRAY:return u(t[s.ARRAY_FIELD],Float64Array);case s.BUILTIN_CLASS_BIGINT64ARRAY:return l(t[s.ARRAY_FIELD],BigInt64Array);case s.BUILTIN_CLASS_BIGUINT64ARRAY:return l(t[s.ARRAY_FIELD],BigUint64Array);case s.BUILTIN_TYPE_BIG_INT:return p(t[s.TO_STRING_FIELD]);case s.BUILTIN_TYPE_UNDEFINED:return;case s.BUILTIN_TYPE_NOT_FINITE:return a.getValueFromToStringResult(t[s.TO_STRING_FIELD]);case s.BUILTIN_CLASS_ARRAYBUFFER:return n=t[s.ARRAY_FIELD],new Uint8Array(n).buffer;case s.BUILTIN_CLASS_SHAREDARRAYBUFFER:return function(e){var t=new SharedArrayBuffer(e.length),r=new Uint8Array(t);return e.forEach((function(e,t){r[t]=e})),t}(t[s.ARRAY_FIELD]);case s.BUILTIN_CLASS_BOOLEAN:return function(e){return new Boolean(e[s.BOOLEAN_FIELD])}(t);case s.BUILTIN_CLASS_DATAVIEW:return function(e){return new DataView(new Uint8Array(e).buffer)}(t[s.ARRAY_FIELD]);case s.BUILTIN_CLASS_DATE:return function(e){return"number"==typeof e[s.TIMESTAMP_FIELD]?new Date(e[s.TIMESTAMP_FIELD]):null}(t);case s.BUILTIN_CLASS_INTL_COLLATOR:return d(t,Intl.Collator);case s.BUILTIN_CLASS_INTL_DATETIMEFORMAT:return d(t,Intl.DateTimeFormat);case s.BUILTIN_CLASS_INTL_LISTFORMAT:return d(t,Intl.ListFormat);case s.BUILTIN_CLASS_INTL_LOCALE:return new Intl.Locale(t[s.TO_STRING_FIELD]);case s.BUILTIN_CLASS_INTL_NUMBERFORMAT:return d(t,Intl.NumberFormat);case s.BUILTIN_CLASS_INTL_PLURALRULES:return d(t,Intl.PluralRules);case s.BUILTIN_CLASS_INTL_RELATIVETIMEFORMAT:return d(t,Intl.RelativeTimeFormat);case s.BUILTIN_CLASS_REGEXP:return function(e){var t=e[s.TO_STRING_FIELD],r=t.lastIndexOf("/");return new RegExp(t.substring(1,r),t.substring(r+1))}(t);case s.BUILTIN_CLASS_SET:return function(e,t){return new Set(c(e[s.ARRAY_FIELD],t))}(t,r);case s.BUILTIN_CLASS_STRING:return function(e){return new String(e[s.TO_STRING_FIELD])}(t);case s.BUILTIN_CLASS_ERROR:return f(t,Error);case s.BUILTIN_CLASS_EVAL_ERROR:return f(t,EvalError);case s.BUILTIN_CLASS_RANGE_ERROR:return f(t,RangeError);case s.BUILTIN_CLASS_REFERENCE_ERROR:return f(t,ReferenceError);case s.BUILTIN_CLASS_SYNTAX_ERROR:return f(t,SyntaxError);case s.BUILTIN_CLASS_TYPE_ERROR:return f(t,TypeError);case s.BUILTIN_CLASS_URI_ERROR:return f(t,URIError);case s.BUILTIN_CLASS_AGGREGATE_ERROR:return f(t,AggregateError);default:return s.ESSERIALIZER_NULL}var n}(n,e,t);if(o!==s.ESSERIALIZER_NULL)return o;if(n&&!t[n])throw new Error("Class "+n+" not found");var _=[];return r.fieldsForConstructorParameters&&(_=r.fieldsForConstructorParameters.map((function(t){return t in e?e[t]:{}}))),function(e,t,r,n){for(var a in t){var o=t[a];if(!n.ignoreProperties||!n.ignoreProperties.includes(a))if(n.rawProperties&&n.rawProperties.includes(a))e[a]=JSON.stringify(o);else{var c=Object.getOwnPropertyDescriptor(e,a);u=o,l=c,a===s.CLASS_NAME_FIELD||l&&("function"==typeof l.set||!1===l.writable&&"object"!=typeof u)||(c&&!1===c.writable&&"object"==typeof o?v(e[a],o,r):e[a]=i(o,r))}}var u,l;return e}(function(e,t){if(!e)return{};for(var r,n=Math.max(e.length-t.length,0),a=[{},0,"",null],s=a.shift();!r&&void 0!==s;)r=h(e,t.concat(Array.from(Array(n),(function(){return s})))),s=0===n?void 0:a.shift();return r||(r={},Object.setPrototypeOf(r,e?e.prototype:Object.prototype)),r}(t[n],_),e,t,r)}function c(e,t){return e.map((function(e){return i(e,t)}))}function u(e,t){return new t(e)}function l(e,t){return new t(e.map((function(e){return p(e[s.TO_STRING_FIELD])})))}function p(e){return BigInt(e)}function d(e,t){var r=e[s.OPTIONS_FIELD],n=r.locale;return delete r.locale,new t(n,r)}function f(e,t){var r;return delete(r=e.message?new t(e.message):new t).stack,e.name&&(r.name=e.name),e.stack&&(r.stack=e.stack),t===AggregateError&&(r.errors=i(e.errors,{})),r}function h(e,t){var r;try{if(o.test(e.toString()))r=new(e.bind.apply(e,n([void 0],t)));else{var a=e.prototype.constructor;"Object"===a.name&&(a=e),r=Object.create(a.prototype),a.call(r,t)}}catch(e){r=null}return r}function v(e,t,r){for(var n in t){var a=Object.getOwnPropertyDescriptor(e,n);a&&!0!==a.writable&&"function"!=typeof a.set||(e[n]=i(t[n],r))}}function _(e){void 0===e&&(e=[]);var t={};return e.forEach((function(e){if(a.isClass(e)){var r=e.name,n=t[r];n&&n!==e&&console.warn("WARNING: Found class definition with the same name: "+r),t[r]=e}})),t}t.deserializeFromParsedObj=function(e,t,r){return i(e,_(t),r)},t.deserializeFromParsedObjWithClassMapping=i,t.getClassMappingFromClassArray=_,t.getParentClassName=function(e){return e.prototype.__proto__.constructor.name}},821:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isClass=t.notObject=t.getValueFromToStringResult=void 0,t.notObject=function(e){return null===e||"object"!=typeof e},t.getValueFromToStringResult=function(e){switch(e){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN;default:return null}},t.isClass=function(e){if(function(e){return[Date].indexOf(e)>=0}(e))return!0;try{Reflect.construct(String,[],e)}catch(e){return!1}return!0}},810:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSerializeValueWithClassName=void 0;var n=r(917),a=r(821);function s(e,t){void 0===t&&(t={});var r=function(e){var t,r,s;return void 0===e?((t={})[n.CLASS_NAME_FIELD]=n.BUILTIN_TYPE_UNDEFINED,t):"number"!=typeof e||isFinite(e)?"bigint"==typeof e?((s={})[n.CLASS_NAME_FIELD]=n.BUILTIN_TYPE_BIG_INT,s[n.TO_STRING_FIELD]=e.toString(),s):a.notObject(e)?e:n.ESSERIALIZER_NULL:((r={})[n.CLASS_NAME_FIELD]=n.BUILTIN_TYPE_NOT_FINITE,r[n.TO_STRING_FIELD]=e.toString(),r)}(e);if(r!==n.ESSERIALIZER_NULL)return r;if(Array.isArray(e))return o(e);var i={};if(!function(e){var t=e.__proto__.constructor.name;return n.CLASSNAMES_WHOSE_ENUMERABLE_PROPERTIES_SHOULD_BE_IGNORED.includes(t)}(e)){if(t.ignoreProperties&&t.ignoreProperties.forEach((function(t){delete e[t]})),t.interceptProperties)for(var c in t.interceptProperties)e[c]=t.interceptProperties[c].call(e,e[c]);!function(e,t){for(var r in e)"function"!=typeof e[r]&&(t[r]=s(e[r]))}(e,i)}return function(e,t){var r=e.__proto__.constructor.name;return"Object"===r&&(r=e.constructor.name),"Object"!==r&&(t[n.CLASS_NAME_FIELD]=r,r===n.BUILTIN_CLASS_ARRAYBUFFER||r===n.BUILTIN_CLASS_SHAREDARRAYBUFFER?t[n.ARRAY_FIELD]=o(Array.from(new Uint8Array(e))):r===n.BUILTIN_CLASS_BOOLEAN?t[n.BOOLEAN_FIELD]=e.valueOf():r===n.BUILTIN_CLASS_DATAVIEW?t[n.ARRAY_FIELD]=o(Array.from(new Uint8Array(e.buffer))):r===n.BUILTIN_CLASS_DATE?t[n.TIMESTAMP_FIELD]=e.getTime():r===n.BUILTIN_CLASS_INTL_LOCALE||r===n.BUILTIN_CLASS_REGEXP?t[n.TO_STRING_FIELD]=e.toString():r===n.BUILTIN_CLASS_SET?t[n.ARRAY_FIELD]=o(Array.from(e)):r===n.BUILTIN_CLASS_STRING?t[n.TO_STRING_FIELD]=e.toString():n.ALL_BUILTIN_ARRAYS.includes(r)?t[n.ARRAY_FIELD]=o(Array.from(e)):n.ALL_BUILTIN_ERRORS.includes(r)?function(e,t,r){"Error"!==e.name&&(t.name=e.name),e.message&&(t.message=e.message),e.stack&&(t.stack=e.stack),r===n.BUILTIN_CLASS_AGGREGATE_ERROR&&(t.errors=s(e.errors))}(e,t,r):n.ALL_BUILTIN_INTLS.includes(r)&&(t[n.OPTIONS_FIELD]=e.resolvedOptions())),t}(e,i)}function o(e){return e.map((function(e){return s(e)}))}t.getSerializeValueWithClassName=s}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}var __webpack_exports__=__webpack_require__(607),__webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})()}).call(this,__webpack_require__(18))},function(e,t,r){var n;e.exports=(n=r(1),function(e){var t=n,r=t.lib,a=r.WordArray,s=r.Hasher,o=t.algo,i=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,a=0;a<64;)t(n)&&(a<8&&(i[a]=r(e.pow(n,.5))),c[a]=r(e.pow(n,1/3)),a++),n++}();var u=[],l=o.SHA256=s.extend({_doReset:function(){this._hash=new a.init(i.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],a=r[1],s=r[2],o=r[3],i=r[4],l=r[5],p=r[6],d=r[7],f=0;f<64;f++){if(f<16)u[f]=0|e[t+f];else{var h=u[f-15],v=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,_=u[f-2],m=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;u[f]=v+u[f-7]+m+u[f-16]}var g=n&a^n&s^a&s,b=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),I=d+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&l^~i&p)+c[f]+u[f];d=p,p=l,l=i,i=o+I|0,o=s,s=a,a=n,n=I+(b+g)|0}r[0]=r[0]+n|0,r[1]=r[1]+a|0,r[2]=r[2]+s|0,r[3]=r[3]+o|0,r[4]=r[4]+i|0,r[5]=r[5]+l|0,r[6]=r[6]+p|0,r[7]=r[7]+d|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,a=8*t.sigBytes;return r[a>>>5]|=128<<24-a%32,r[14+(a+64>>>9<<4)]=e.floor(n/4294967296),r[15+(a+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(l),t.HmacSHA256=s._createHmacHelper(l)}(Math),n.SHA256)},function(e,t,r){var n,a,s;e.exports=(a=(n=r(1)).lib.Base,s=n.enc.Utf8,void(n.algo.HMAC=a.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var a=this._oKey=t.clone(),o=this._iKey=t.clone(),i=a.words,c=o.words,u=0;u<r;u++)i[u]^=1549556828,c[u]^=909522486;a.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n,a,s,o,i,c,u,l;e.exports=(a=(n=l=r(1)).lib,s=a.WordArray,o=a.Hasher,i=n.algo,c=[],u=i.SHA1=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],a=r[1],s=r[2],o=r[3],i=r[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var p=(n<<5|n>>>27)+i+c[u];p+=u<20?1518500249+(a&s|~a&o):u<40?1859775393+(a^s^o):u<60?(a&s|a&o|s&o)-1894007588:(a^s^o)-899497514,i=o,o=s,s=a<<30|a>>>2,a=n,n=p}r[0]=r[0]+n|0,r[1]=r[1]+a|0,r[2]=r[2]+s|0,r[3]=r[3]+o|0,r[4]=r[4]+i|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA1=o._createHelper(u),n.HmacSHA1=o._createHmacHelper(u),l.SHA1)},function(e,t,r){var n;e.exports=(n=r(1),r(8),function(){var e=n,t=e.lib.Hasher,r=e.x64,a=r.Word,s=r.WordArray,o=e.algo;function i(){return a.create.apply(a,arguments)}var c=[i(1116352408,3609767458),i(1899447441,602891725),i(3049323471,3964484399),i(3921009573,2173295548),i(961987163,4081628472),i(1508970993,3053834265),i(2453635748,2937671579),i(2870763221,3664609560),i(3624381080,2734883394),i(310598401,1164996542),i(607225278,1323610764),i(1426881987,3590304994),i(1925078388,4068182383),i(2162078206,991336113),i(2614888103,633803317),i(3248222580,3479774868),i(3835390401,2666613458),i(4022224774,944711139),i(264347078,2341262773),i(604807628,2007800933),i(770255983,1495990901),i(1249150122,1856431235),i(1555081692,3175218132),i(1996064986,2198950837),i(2554220882,3999719339),i(2821834349,766784016),i(2952996808,2566594879),i(3210313671,3203337956),i(3336571891,1034457026),i(3584528711,2466948901),i(113926993,3758326383),i(338241895,168717936),i(666307205,1188179964),i(773529912,1546045734),i(1294757372,1522805485),i(1396182291,2643833823),i(1695183700,2343527390),i(1986661051,1014477480),i(2177026350,1206759142),i(2456956037,344077627),i(2730485921,1290863460),i(2820302411,3158454273),i(3259730800,3505952657),i(3345764771,106217008),i(3516065817,3606008344),i(3600352804,1432725776),i(4094571909,1467031594),i(275423344,851169720),i(430227734,3100823752),i(506948616,1363258195),i(659060556,3750685593),i(883997877,3785050280),i(958139571,3318307427),i(1322822218,3812723403),i(1537002063,2003034995),i(1747873779,3602036899),i(1955562222,1575990012),i(2024104815,1125592928),i(2227730452,2716904306),i(2361852424,442776044),i(2428436474,593698344),i(2756734187,3733110249),i(3204031479,2999351573),i(3329325298,3815920427),i(3391569614,3928383900),i(3515267271,566280711),i(3940187606,3454069534),i(4118630271,4000239992),i(116418474,1914138554),i(174292421,2731055270),i(289380356,3203993006),i(460393269,320620315),i(685471733,587496836),i(852142971,1086792851),i(1017036298,365543100),i(1126000580,2618297676),i(1288033470,3409855158),i(1501505948,4234509866),i(1607167915,987167468),i(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=i()}();var l=o.SHA512=t.extend({_doReset:function(){this._hash=new s.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],a=r[1],s=r[2],o=r[3],i=r[4],l=r[5],p=r[6],d=r[7],f=n.high,h=n.low,v=a.high,_=a.low,m=s.high,g=s.low,b=o.high,I=o.low,y=i.high,x=i.low,k=l.high,w=l.low,S=p.high,E=p.low,C=d.high,T=d.low,A=f,R=h,L=v,N=_,O=m,P=g,D=b,U=I,B=y,F=x,M=k,G=w,q=S,H=E,j=C,z=T,V=0;V<80;V++){var W,K,Q=u[V];if(V<16)K=Q.high=0|e[t+2*V],W=Q.low=0|e[t+2*V+1];else{var Y=u[V-15],J=Y.high,X=Y.low,$=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Z=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=u[V-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,ae=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),se=u[V-7],oe=se.high,ie=se.low,ce=u[V-16],ue=ce.high,le=ce.low;K=(K=(K=$+oe+((W=Z+ie)>>>0<Z>>>0?1:0))+ne+((W+=ae)>>>0<ae>>>0?1:0))+ue+((W+=le)>>>0<le>>>0?1:0),Q.high=K,Q.low=W}var pe,de=B&M^~B&q,fe=F&G^~F&H,he=A&L^A&O^L&O,ve=R&N^R&P^N&P,_e=(A>>>28|R<<4)^(A<<30|R>>>2)^(A<<25|R>>>7),me=(R>>>28|A<<4)^(R<<30|A>>>2)^(R<<25|A>>>7),ge=(B>>>14|F<<18)^(B>>>18|F<<14)^(B<<23|F>>>9),be=(F>>>14|B<<18)^(F>>>18|B<<14)^(F<<23|B>>>9),Ie=c[V],ye=Ie.high,xe=Ie.low,ke=j+ge+((pe=z+be)>>>0<z>>>0?1:0),we=me+ve;j=q,z=H,q=M,H=G,M=B,G=F,B=D+(ke=(ke=(ke=ke+de+((pe+=fe)>>>0<fe>>>0?1:0))+ye+((pe+=xe)>>>0<xe>>>0?1:0))+K+((pe+=W)>>>0<W>>>0?1:0))+((F=U+pe|0)>>>0<U>>>0?1:0)|0,D=O,U=P,O=L,P=N,L=A,N=R,A=ke+(_e+he+(we>>>0<me>>>0?1:0))+((R=pe+we|0)>>>0<pe>>>0?1:0)|0}h=n.low=h+R,n.high=f+A+(h>>>0<R>>>0?1:0),_=a.low=_+N,a.high=v+L+(_>>>0<N>>>0?1:0),g=s.low=g+P,s.high=m+O+(g>>>0<P>>>0?1:0),I=o.low=I+U,o.high=b+D+(I>>>0<U>>>0?1:0),x=i.low=x+F,i.high=y+B+(x>>>0<F>>>0?1:0),w=l.low=w+G,l.high=k+M+(w>>>0<G>>>0?1:0),E=p.low=E+H,p.high=S+q+(E>>>0<H>>>0?1:0),T=d.low=T+z,d.high=C+j+(T>>>0<z>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),n.SHA512)},function(e,t,r){e.exports=r(45)},function(e,t,r){var n=function(e){"use strict";var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var a=t&&t.prototype instanceof p?t:p,s=Object.create(a.prototype),o=new k(n||[]);return s._invoke=function(e,t,r){var n="suspendedStart";return function(a,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw s;return{value:void 0,done:!0}}for(r.method=a,r.arg=s;;){var o=r.delegate;if(o){var i=I(o,r);if(i){if(i===l)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,o),s}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function p(){}function d(){}function f(){}var h={};h[a]=function(){return this};var v=Object.getPrototypeOf,_=v&&v(v(w([])));_&&_!==t&&r.call(_,a)&&(h=_);var m=f.prototype=p.prototype=Object.create(h);function g(e){["next","throw","return"].forEach((function(t){i(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(a,s){function o(){return new t((function(n,o){!function n(a,s,o,i){var c=u(e[a],e,s);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,o,i)}),(function(e){n("throw",e,o,i)})):t.resolve(p).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,i)}))}i(c.arg)}(a,s,n,o)}))}return n=n?n.then(o,o):o()}}function I(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=m.constructor=f,f.constructor=d,d.displayName=i(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,i(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(b.prototype),b.prototype[s]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,a,s){void 0===s&&(s=Promise);var o=new b(c(t,r,n,a),s);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(m),i(m,o,"Generator"),m[a]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=w,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var i=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(i&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;x(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=n}catch(e){}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var r,n,a=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c,u=[],l=!1,p=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):p=-1,u.length&&f())}function f(){if(!l){var e=i(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++p<t;)c&&c[p].run();p=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||l||i(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t){},function(e,t,r){var n;e.exports=(n=r(1),function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,n=[],a=0;a<r;a++)n[a>>>2]|=e[a]<<24-a%4*8;t.call(this,n,r)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)},function(e,t,r){var n;e.exports=(n=r(1),function(){var e=n,t=e.lib.WordArray,r=e.enc;function a(e){return e<<8&4278255360|e>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],a=0;a<r;a+=2){var s=t[a>>>2]>>>16-a%4*8&65535;n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var r=e.length,n=[],a=0;a<r;a++)n[a>>>1]|=e.charCodeAt(a)<<16-a%2*16;return t.create(n,2*r)}},r.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],s=0;s<r;s+=2){var o=a(t[s>>>2]>>>16-s%4*8&65535);n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var r=e.length,n=[],s=0;s<r;s++)n[s>>>1]|=a(e.charCodeAt(s)<<16-s%2*16);return t.create(n,2*r)}}}(),n.enc.Utf16)},function(e,t,r){var n,a,s;e.exports=(s=r(1),a=(n=s).lib.WordArray,n.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var r=e.words,n=e.sigBytes,a=t?this._safe_map:this._map;e.clamp();for(var s=[],o=0;o<n;o+=3)for(var i=(r[o>>>2]>>>24-o%4*8&255)<<16|(r[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|r[o+2>>>2]>>>24-(o+2)%4*8&255,c=0;c<4&&o+.75*c<n;c++)s.push(a.charAt(i>>>6*(3-c)&63));var u=a.charAt(64);if(u)for(;s.length%4;)s.push(u);return s.join("")},parse:function(e,t){void 0===t&&(t=!0);var r=e.length,n=t?this._safe_map:this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var o=0;o<n.length;o++)s[n.charCodeAt(o)]=o}var i=n.charAt(64);if(i){var c=e.indexOf(i);-1!==c&&(r=c)}return function(e,t,r){for(var n=[],s=0,o=0;o<t;o++)if(o%4){var i=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;n[s>>>2]|=i<<24-s%4*8,s++}return a.create(n,s)}(e,r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},s.enc.Base64url)},function(e,t,r){var n,a,s,o,i,c;e.exports=(c=r(1),r(10),a=(n=c).lib.WordArray,s=n.algo,o=s.SHA256,i=s.SHA224=o.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=o._doFinalize.call(this);return e.sigBytes-=4,e}}),n.SHA224=o._createHelper(i),n.HmacSHA224=o._createHmacHelper(i),c.SHA224)},function(e,t,r){var n,a,s,o,i,c,u,l;e.exports=(l=r(1),r(8),r(14),a=(n=l).x64,s=a.Word,o=a.WordArray,i=n.algo,c=i.SHA512,u=i.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),n.SHA384=c._createHelper(u),n.HmacSHA384=c._createHmacHelper(u),l.SHA384)},function(e,t,r){var n;e.exports=(n=r(1),r(8),function(e){var t=n,r=t.lib,a=r.WordArray,s=r.Hasher,o=t.x64.Word,i=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,r=0;r<24;r++){c[e+5*t]=(r+1)*(r+2)/2%64;var n=(2*e+3*t)%5;e=t%5,t=n}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var a=1,s=0;s<24;s++){for(var i=0,p=0,d=0;d<7;d++){if(1&a){var f=(1<<d)-1;f<32?p^=1<<f:i^=1<<f-32}128&a?a=a<<1^113:a<<=1}l[s]=o.create(i,p)}}();var p=[];!function(){for(var e=0;e<25;e++)p[e]=o.create()}();var d=i.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,n=this.blockSize/2,a=0;a<n;a++){var s=e[t+2*a],o=e[t+2*a+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),(T=r[a]).high^=o,T.low^=s}for(var i=0;i<24;i++){for(var d=0;d<5;d++){for(var f=0,h=0,v=0;v<5;v++)f^=(T=r[d+5*v]).high,h^=T.low;var _=p[d];_.high=f,_.low=h}for(d=0;d<5;d++){var m=p[(d+4)%5],g=p[(d+1)%5],b=g.high,I=g.low;for(f=m.high^(b<<1|I>>>31),h=m.low^(I<<1|b>>>31),v=0;v<5;v++)(T=r[d+5*v]).high^=f,T.low^=h}for(var y=1;y<25;y++){var x=(T=r[y]).high,k=T.low,w=c[y];w<32?(f=x<<w|k>>>32-w,h=k<<w|x>>>32-w):(f=k<<w-32|x>>>64-w,h=x<<w-32|k>>>64-w);var S=p[u[y]];S.high=f,S.low=h}var E=p[0],C=r[0];for(E.high=C.high,E.low=C.low,d=0;d<5;d++)for(v=0;v<5;v++){var T=r[y=d+5*v],A=p[y],R=p[(d+1)%5+5*v],L=p[(d+2)%5+5*v];T.high=A.high^~R.high&L.high,T.low=A.low^~R.low&L.low}T=r[0];var N=l[i];T.high^=N.high,T.low^=N.low}},_doFinalize:function(){var t=this._data,r=t.words,n=(this._nDataBytes,8*t.sigBytes),s=32*this.blockSize;r[n>>>5]|=1<<24-n%32,r[(e.ceil((n+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*r.length,this._process();for(var o=this._state,i=this.cfg.outputLength/8,c=i/8,u=[],l=0;l<c;l++){var p=o[l],d=p.high,f=p.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),u.push(f),u.push(d)}return new a.init(u,i)},clone:function(){for(var e=s.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});t.SHA3=s._createHelper(d),t.HmacSHA3=s._createHmacHelper(d)}(Math),n.SHA3)},function(e,t,r){var n;e.exports=(n=r(1),
/** @preserve
	(c) 2012 by Cédric Mesnil. All rights reserved.

	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/
function(e){var t=n,r=t.lib,a=r.WordArray,s=r.Hasher,o=t.algo,i=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),p=a.create([0,1518500249,1859775393,2400959708,2840853838]),d=a.create([1352829926,1548603684,1836072691,2053994217,0]),f=o.RIPEMD160=s.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,a=e[n];e[n]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var s,o,f,I,y,x,k,w,S,E,C,T=this._hash.words,A=p.words,R=d.words,L=i.words,N=c.words,O=u.words,P=l.words;for(x=s=T[0],k=o=T[1],w=f=T[2],S=I=T[3],E=y=T[4],r=0;r<80;r+=1)C=s+e[t+L[r]]|0,C+=r<16?h(o,f,I)+A[0]:r<32?v(o,f,I)+A[1]:r<48?_(o,f,I)+A[2]:r<64?m(o,f,I)+A[3]:g(o,f,I)+A[4],C=(C=b(C|=0,O[r]))+y|0,s=y,y=I,I=b(f,10),f=o,o=C,C=x+e[t+N[r]]|0,C+=r<16?g(k,w,S)+R[0]:r<32?m(k,w,S)+R[1]:r<48?_(k,w,S)+R[2]:r<64?v(k,w,S)+R[3]:h(k,w,S)+R[4],C=(C=b(C|=0,P[r]))+E|0,x=E,E=S,S=b(w,10),w=k,k=C;C=T[1]+f+S|0,T[1]=T[2]+I+E|0,T[2]=T[3]+y+x|0,T[3]=T[4]+s+k|0,T[4]=T[0]+o+w|0,T[0]=C},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var a=this._hash,s=a.words,o=0;o<5;o++){var i=s[o];s[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}return a},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,r){return e^t^r}function v(e,t,r){return e&t|~e&r}function _(e,t,r){return(e|~t)^r}function m(e,t,r){return e&r|t&~r}function g(e,t,r){return e^(t|~r)}function b(e,t){return e<<t|e>>>32-t}t.RIPEMD160=s._createHelper(f),t.HmacRIPEMD160=s._createHmacHelper(f)}(Math),n.RIPEMD160)},function(e,t,r){var n,a,s,o,i,c,u,l,p;e.exports=(p=r(1),r(10),r(11),s=(a=(n=p).lib).Base,o=a.WordArray,c=(i=n.algo).SHA256,u=i.HMAC,l=i.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=u.create(r.hasher,e),a=o.create(),s=o.create([1]),i=a.words,c=s.words,l=r.keySize,p=r.iterations;i.length<l;){var d=n.update(t).finalize(s);n.reset();for(var f=d.words,h=f.length,v=d,_=1;_<p;_++){v=n.finalize(v),n.reset();for(var m=v.words,g=0;g<h;g++)f[g]^=m[g]}a.concat(d),c[0]++}return a.sigBytes=4*l,a}}),n.PBKDF2=function(e,t,r){return l.create(r).compute(e,t)},p.PBKDF2)},function(e,t,r){var n;e.exports=(n=r(1),r(2),n.mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,r,n){var a,s=this._iv;s?(a=s.slice(0),this._iv=void 0):a=this._prevBlock,n.encryptBlock(a,0);for(var o=0;o<r;o++)e[t+o]^=a[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,a=n.blockSize;t.call(this,e,r,a,n),this._prevBlock=e.slice(r,r+a)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,a=n.blockSize,s=e.slice(r,r+a);t.call(this,e,r,a,n),this._prevBlock=s}}),e}(),n.mode.CFB)},function(e,t,r){var n,a,s;e.exports=(s=r(1),r(2),s.mode.CTR=(a=(n=s.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,a=this._iv,s=this._counter;a&&(s=this._counter=a.slice(0),this._iv=void 0);var o=s.slice(0);r.encryptBlock(o,0),s[n-1]=s[n-1]+1|0;for(var i=0;i<n;i++)e[t+i]^=o[i]}}),n.Decryptor=a,n),s.mode.CTR)},function(e,t,r){var n;e.exports=(n=r(1),r(2),
/** @preserve
	 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
	 * derived from CryptoJS.mode.CTR
	 * Jan Hruby jhruby.web@gmail.com
	 */
n.mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,r=e>>8&255,n=255&e;255===t?(t=0,255===r?(r=0,255===n?n=0:++n):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=n}return e}var r=e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,a=n.blockSize,s=this._iv,o=this._counter;s&&(o=this._counter=s.slice(0),this._iv=void 0),function(e){0===(e[0]=t(e[0]))&&(e[1]=t(e[1]))}(o);var i=o.slice(0);n.encryptBlock(i,0);for(var c=0;c<a;c++)e[r+c]^=i[c]}});return e.Decryptor=r,e}(),n.mode.CTRGladman)},function(e,t,r){var n,a,s;e.exports=(s=r(1),r(2),s.mode.OFB=(a=(n=s.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,a=this._iv,s=this._keystream;a&&(s=this._keystream=a.slice(0),this._iv=void 0),r.encryptBlock(s,0);for(var o=0;o<n;o++)e[t+o]^=s[o]}}),n.Decryptor=a,n),s.mode.OFB)},function(e,t,r){var n,a;e.exports=(a=r(1),r(2),a.mode.ECB=((n=a.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),n.Decryptor=n.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),n),a.mode.ECB)},function(e,t,r){var n;e.exports=(n=r(1),r(2),n.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,n=4*t,a=n-r%n,s=r+a-1;e.clamp(),e.words[s>>>2]|=a<<24-s%4*8,e.sigBytes+=a},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)},function(e,t,r){var n;e.exports=(n=r(1),r(2),n.pad.Iso10126={pad:function(e,t){var r=4*t,a=r-e.sigBytes%r;e.concat(n.lib.WordArray.random(a-1)).concat(n.lib.WordArray.create([a<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)},function(e,t,r){var n;e.exports=(n=r(1),r(2),n.pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)},function(e,t,r){var n;e.exports=(n=r(1),r(2),n.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){var t=e.words,r=e.sigBytes-1;for(r=e.sigBytes-1;r>=0;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},n.pad.ZeroPadding)},function(e,t,r){var n;e.exports=(n=r(1),r(2),n.pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)},function(e,t,r){var n,a,s,o;e.exports=(o=r(1),r(2),a=(n=o).lib.CipherParams,s=n.enc.Hex,n.format.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return a.create({ciphertext:t})}},o.format.Hex)},function(e,t,r){var n;e.exports=(n=r(1),r(5),r(6),r(4),r(2),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,a=[],s=[],o=[],i=[],c=[],u=[],l=[],p=[],d=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var h=n^n<<1^n<<2^n<<3^n<<4;h=h>>>8^255&h^99,a[r]=h,s[h]=r;var v=e[r],_=e[v],m=e[_],g=257*e[h]^16843008*h;o[r]=g<<24|g>>>8,i[r]=g<<16|g>>>16,c[r]=g<<8|g>>>24,u[r]=g,g=16843009*m^65537*_^257*v^16843008*r,l[h]=g<<24|g>>>8,p[h]=g<<16|g>>>16,d[h]=g<<8|g>>>24,f[h]=g,r?(r=v^e[e[e[m^v]]],n^=e[e[n]]):r=n=1}}();var h=[0,1,2,4,8,16,32,64,128,27,54],v=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),s=this._keySchedule=[],o=0;o<n;o++)o<r?s[o]=t[o]:(u=s[o-1],o%r?r>6&&o%r==4&&(u=a[u>>>24]<<24|a[u>>>16&255]<<16|a[u>>>8&255]<<8|a[255&u]):(u=a[(u=u<<8|u>>>24)>>>24]<<24|a[u>>>16&255]<<16|a[u>>>8&255]<<8|a[255&u],u^=h[o/r|0]<<24),s[o]=s[o-r]^u);for(var i=this._invKeySchedule=[],c=0;c<n;c++){if(o=n-c,c%4)var u=s[o];else u=s[o-4];i[c]=c<4||o<=4?u:l[a[u>>>24]]^p[a[u>>>16&255]]^d[a[u>>>8&255]]^f[a[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,i,c,u,a)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,l,p,d,f,s),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,a,s,o,i){for(var c=this._nRounds,u=e[t]^r[0],l=e[t+1]^r[1],p=e[t+2]^r[2],d=e[t+3]^r[3],f=4,h=1;h<c;h++){var v=n[u>>>24]^a[l>>>16&255]^s[p>>>8&255]^o[255&d]^r[f++],_=n[l>>>24]^a[p>>>16&255]^s[d>>>8&255]^o[255&u]^r[f++],m=n[p>>>24]^a[d>>>16&255]^s[u>>>8&255]^o[255&l]^r[f++],g=n[d>>>24]^a[u>>>16&255]^s[l>>>8&255]^o[255&p]^r[f++];u=v,l=_,p=m,d=g}v=(i[u>>>24]<<24|i[l>>>16&255]<<16|i[p>>>8&255]<<8|i[255&d])^r[f++],_=(i[l>>>24]<<24|i[p>>>16&255]<<16|i[d>>>8&255]<<8|i[255&u])^r[f++],m=(i[p>>>24]<<24|i[d>>>16&255]<<16|i[u>>>8&255]<<8|i[255&l])^r[f++],g=(i[d>>>24]<<24|i[u>>>16&255]<<16|i[l>>>8&255]<<8|i[255&p])^r[f++],e[t]=v,e[t+1]=_,e[t+2]=m,e[t+3]=g},keySize:8});e.AES=t._createHelper(v)}(),n.AES)},function(e,t,r){var n;e.exports=(n=r(1),r(5),r(6),r(4),r(2),function(){var e=n,t=e.lib,r=t.WordArray,a=t.BlockCipher,s=e.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],i=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],p=s.DES=a.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var n=o[r]-1;t[r]=e[n>>>5]>>>31-n%32&1}for(var a=this._subKeys=[],s=0;s<16;s++){var u=a[s]=[],l=c[s];for(r=0;r<24;r++)u[r/6|0]|=t[(i[r]-1+l)%28]<<31-r%6,u[4+(r/6|0)]|=t[28+(i[r+24]-1+l)%28]<<31-r%6;for(u[0]=u[0]<<1|u[0]>>>31,r=1;r<7;r++)u[r]=u[r]>>>4*(r-1)+3;u[7]=u[7]<<5|u[7]>>>27}var p=this._invSubKeys=[];for(r=0;r<16;r++)p[r]=a[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],d.call(this,4,252645135),d.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),d.call(this,1,1431655765);for(var n=0;n<16;n++){for(var a=r[n],s=this._lBlock,o=this._rBlock,i=0,c=0;c<8;c++)i|=u[c][((o^a[c])&l[c])>>>0];this._lBlock=o,this._rBlock=s^i}var p=this._lBlock;this._lBlock=this._rBlock,this._rBlock=p,d.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),d.call(this,16,65535),d.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function d(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function f(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}e.DES=a._createHelper(p);var h=s.TripleDES=a.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),n=e.length<4?e.slice(0,2):e.slice(2,4),a=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=p.createEncryptor(r.create(t)),this._des2=p.createEncryptor(r.create(n)),this._des3=p.createEncryptor(r.create(a))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=a._createHelper(h)}(),n.TripleDES)},function(e,t,r){var n;e.exports=(n=r(1),r(5),r(6),r(4),r(2),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,a=r.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],a=0;a<256;a++)n[a]=a;a=0;for(var s=0;a<256;a++){var o=a%r,i=t[o>>>2]>>>24-o%4*8&255;s=(s+n[a]+i)%256;var c=n[a];n[a]=n[s],n[s]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var e=this._S,t=this._i,r=this._j,n=0,a=0;a<4;a++){r=(r+e[t=(t+1)%256])%256;var s=e[t];e[t]=e[r],e[r]=s,n|=e[(e[t]+e[r])%256]<<24-8*a}return this._i=t,this._j=r,n}e.RC4=t._createHelper(a);var o=r.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)s.call(this)}});e.RC4Drop=t._createHelper(o)}(),n.RC4)},function(e,t,r){var n;e.exports=(n=r(1),r(5),r(6),r(4),r(2),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,a=[],s=[],o=[],i=r.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)a[r]^=n[r+4&7];if(t){var s=t.words,o=s[0],i=s[1],u=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),p=u>>>16|4294901760&l,d=l<<16|65535&u;for(a[0]^=u,a[1]^=p,a[2]^=l,a[3]^=d,a[4]^=u,a[5]^=p,a[6]^=l,a[7]^=d,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),a[0]=r[0]^r[5]>>>16^r[3]<<16,a[1]=r[2]^r[7]>>>16^r[5]<<16,a[2]=r[4]^r[1]>>>16^r[7]<<16,a[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)a[n]=16711935&(a[n]<<8|a[n]>>>24)|4278255360&(a[n]<<24|a[n]>>>8),e[t+n]^=a[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],a=65535&n,i=n>>>16,c=((a*a>>>17)+a*i>>>15)+i*i,u=((4294901760&n)*n|0)+((65535&n)*n|0);o[r]=c^u}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.Rabbit=t._createHelper(i)}(),n.Rabbit)},function(e,t,r){var n;e.exports=(n=r(1),r(5),r(6),r(4),r(2),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,a=[],s=[],o=[],i=r.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var a=0;a<4;a++)c.call(this);for(a=0;a<8;a++)n[a]^=r[a+4&7];if(t){var s=t.words,o=s[0],i=s[1],u=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),p=u>>>16|4294901760&l,d=l<<16|65535&u;for(n[0]^=u,n[1]^=p,n[2]^=l,n[3]^=d,n[4]^=u,n[5]^=p,n[6]^=l,n[7]^=d,a=0;a<4;a++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),a[0]=r[0]^r[5]>>>16^r[3]<<16,a[1]=r[2]^r[7]>>>16^r[5]<<16,a[2]=r[4]^r[1]>>>16^r[7]<<16,a[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)a[n]=16711935&(a[n]<<8|a[n]>>>24)|4278255360&(a[n]<<24|a[n]>>>8),e[t+n]^=a[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],a=65535&n,i=n>>>16,c=((a*a>>>17)+a*i>>>15)+i*i,u=((4294901760&n)*n|0)+((65535&n)*n|0);o[r]=c^u}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.RabbitLegacy=t._createHelper(i)}(),n.RabbitLegacy)},function(e,t,r){var n;e.exports=(n=r(1),r(5),r(6),r(4),r(2),function(){var e=n,t=e.lib.BlockCipher,r=e.algo;const a=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],s=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var o={pbox:[],sbox:[]};function i(e,t){let r=t>>24&255,n=t>>16&255,a=t>>8&255,s=255&t,o=e.sbox[0][r]+e.sbox[1][n];return o^=e.sbox[2][a],o+=e.sbox[3][s],o}function c(e,t,r){let n,a=t,s=r;for(let t=0;t<16;++t)a^=e.pbox[t],s=i(e,a)^s,n=a,a=s,s=n;return n=a,a=s,s=n,s^=e.pbox[16],a^=e.pbox[17],{left:a,right:s}}var u=r.Blowfish=t.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4;!function(e,t,r){for(let t=0;t<4;t++){e.sbox[t]=[];for(let r=0;r<256;r++)e.sbox[t][r]=s[t][r]}let n=0;for(let s=0;s<18;s++)e.pbox[s]=a[s]^t[n],n++,n>=r&&(n=0);let o=0,i=0,u=0;for(let t=0;t<18;t+=2)u=c(e,o,i),o=u.left,i=u.right,e.pbox[t]=o,e.pbox[t+1]=i;for(let t=0;t<4;t++)for(let r=0;r<256;r+=2)u=c(e,o,i),o=u.left,i=u.right,e.sbox[t][r]=o,e.sbox[t][r+1]=i}(o,t,r)}},encryptBlock:function(e,t){var r=c(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},decryptBlock:function(e,t){var r=function(e,t,r){let n,a=t,s=r;for(let t=17;t>1;--t)a^=e.pbox[t],s=i(e,a)^s,n=a,a=s,s=n;return n=a,a=s,s=n,s^=e.pbox[1],a^=e.pbox[0],{left:a,right:s}}(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=t._createHelper(u)}(),n.Blowfish)},function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,s=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw s}}return r}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.r(t),r.d(t,"InboxNormal",(function(){return Bt})),r.d(t,"SyncOrderPaymentWithFacebook",(function(){return Ft})),r.d(t,"CommentMobile",(function(){return Mt})),r.d(t,"ListenInbox",(function(){return Gt})),r.d(t,"Listen",(function(){return qt})),r.d(t,"InboxMobile",(function(){return Ht})),r.d(t,"Stickers",(function(){return jt})),r.d(t,"EcommerceProduct",(function(){return zt})),r.d(t,"SendStickerComment",(function(){return Vt})),r.d(t,"GetProfileInfo",(function(){return Yt})),r.d(t,"GetBirthdayInfo",(function(){return Xt})),r.d(t,"Comment",(function(){return Ee})),r.d(t,"base",(function(){return rn})),r.d(t,"validateConnect",(function(){return Vr})),r.d(t,"GraphQL",(function(){return Rt})),r.d(t,"checkOriginThenReloadListenerIfNeeds",(function(){return Wr})),r.d(t,"getInboxNormal",(function(){return Zr})),r.d(t,"getInboxMobile",(function(){return tn})),r.d(t,"CommentInstagram",(function(){return ir})),r.d(t,"updateDynamicHeaderRules",(function(){return Xr}));var u=r(0),l=r.n(u);function p(e,t,r,n,a,s,o){try{var i=e[s](o),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function o(e){p(s,n,a,o,i,"next",e)}function i(e){p(s,n,a,o,i,"throw",e)}o(void 0)}))}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function m(e){throw new Error('"'+e+'" is read-only')}function g(){var e=4022871197,t=function(t){t=t.toString();for(var r=0;r<t.length;r++){var n=.02519603282416938*(e+=(m("a"),t.charCodeAt(r)));m("a"),n-=e=n>>>0,n*=e,m("a"),n-=e=n>>>0,e+=(m("a"),4294967296*n)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}var b,I=new function(){return function(){for(var e=0,t=0,r=0,n=1,a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];var i=s.length>0?s:[new Date],c=new g;e=c(" "),t=c(" "),r=c(" ");for(var u=0;u<i.length;u++)(e-=c(i[u]))<0&&(e+=1),(t-=c(i[u]))<0&&(t+=1),(r-=c(i[u]))<0&&(r+=1);c=null;var l=function(){var a=2091639*e+2.3283064365386963e-10*n;return e=t,t=r,r=a-(n=0|a)};return l.version="Alea 0.9",l.args=i,l}};function y(e){return null==b&&(b=I(e)),b}var x={Session:null},k=Math.pow(36,6),w=function(){function e(){h(this,e);var t,r=Date.now();this.sessionStorage={},t=null!=t?t:r+35e3;var n=this.r(r);n&&n.expiryTime>=t||t<=r||(null!=r&&(n=null==n?this.o():n.id,x.Session={id:n,expiryTime:t}),this.p=null)}return _(e,[{key:"reset",value:function(){var e,t=Date.now();e=null!=e?e:t+35e3;var r=this.r(t);r&&r.expiryTime>=e||e<=t||null!=t&&(r=null==r?this.o():r.id,x.Session={id:r,expiryTime:e})}},{key:"setServerNonce",value:function(e){this.ServerNonce=e}},{key:"getId",value:function(){this.reset();var e,t,r=this.q();return(e=null!=(e=this.s())?e:"")+":"+(t=null!=(t=this.t())?t:"")+":"+r}},{key:"getPageId_DO_NOT_USE",value:function(){return this.q()}},{key:"k",value:function(e){return null==e||!1===Number.isFinite(e)||e<=0?null:e}},{key:"l",value:function(e){if(null==e)return null;var t=parseInt(e,10);return""+t!=="".concat(e)?null:this.k(t)}},{key:"m",value:function(e){return null==e||6!==e.length?null:Number.isInteger(e)?1:!1===/^[a-z0-9]+$/.test(e)?null:e}},{key:"n",value:function(e){if(null==e)return null;var t=e.id,r=e.expiryTime;return r=this.l(r),t=this.m(t),null==r||null==t?null:{expiryTime:r,id:t}}},{key:"o",value:function(){var e=Math.floor(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="function"==typeof Uint32Array?new Uint32Array(1):null,r=crypto||msCrypto;if(null!=t)try{var n=null==r?void 0:r.getRandomValues;if("function"==typeof n){var a=n.bind(r);return function(){try{a(t)}catch(t){return y(e)()}return t[0]/4294967296}}}catch(e){}return y(e)}(this.ServerNonce)()*k);return e=e.toString(36),"0".repeat(6-e.length)+e}},{key:"q",value:function(){return null==this.p&&(this.p=this.o()),this.p}},{key:"r",value:function(e){void 0===e&&(e=Date.now());var t=this.n(x.Session);return t&&e<t.expiryTime?t:null}},{key:"s",value:function(){var e;return null==(e=this.r())?void 0:e.id}},{key:"t",value:function(){var e=this.m(this.sessionStorage.TabId);if(null==e){var t=this.o();return this.sessionStorage.TabId=t,t}return e}}]),e}();function S(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var E=new(function(){function e(){h(this,e),this.logLevel=3}return _(e,[{key:"success",value:function(e){this.logLevel<3||console.log("%c".concat(e),"color: #0F9960; font-weight: bold;")}},{key:"warning",value:function(e){this.logLevel<2||console.log("%c".concat(e),"color: #D99E0B; font-weight: bold;")}},{key:"error",value:function(e,t){e&&console.log("%c".concat(e),"color: #DB3737; font-weight: bold;"),t&&console.log(t)}},{key:"log",value:function(){var e;this.logLevel<4||(e=console).log.apply(e,arguments)}}]),e}());self.Logger=E;var C=E;function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A=function(e,t){for(var r=function(r){var n="",a=!1;function s(t){for(var r=0,n=t-1;n>=0&&"\\"===e[n];n--)r++;return r%2==1}for(var o=new R,i=!1,c=r;c<e.length;c++){var u=e[c];if(a)switch(u){case"{":case"}":case"[":case"]":if(!i){var l=o.push(u,c),p=l.done,d=l.end,f=l.start;if(p)return{start:f,end:d,done:!1}}break;case'"':s(c)||(i=!i)}else t[n.length]===u?(n+=u).length===t.length&&(a=!0):n=""}return{done:!0}},n=[],a=0;;){var s=r(a),o=s.start,i=s.end;if(s.done)break;n.push({start:o,end:i}),a=i+1}return n.map((function(t){var r=t.start,n=t.end;return e.slice(r,n+1)}))};self.extractObjectFromString=A;var R=function(){function e(){h(this,e),this.stack=[],this.pairs={"{":"}","[":"]"},this.startIndex=null,this.endIndex=null}return _(e,[{key:"push",value:function(e,t){if(this.pairs[e])return null===this.startIndex&&(this.startIndex=t),this.stack.push(e),{done:!1};var r=this.peek();return r&&this.pairs[r]===e&&(this.stack.pop(),this.isEmpty())?(this.endIndex=t,{done:!0,start:this.startIndex,end:this.endIndex}):{done:!1}}},{key:"peek",value:function(){return this.isEmpty()?null:this.stack[this.stack.length-1]}},{key:"isEmpty",value:function(){return 0===this.stack.length}}]),e}(),L=function(e){try{return JSON.parse(e)}catch(t){return CCake.base.runStringFunction("function() {return ".concat(e,";}"),[])}};self.convertStringToObject=L;var N,O=function(){var e=d(l.a.mark((function e(t,r){var n,a,s,o,i,c,u,p,d,f,h,v,_;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=/\["adp_FeedStoryUFIRootQueryRelayPreloader_\w+",(.+})\]/,(s=(s=t.match(a))&&s[1])||(a=/\["adp_CometPagePostsRootHoistedStoryQueryRelayPreloader_\w+",(.+})\]/,s=(s=t.match(a))&&s[1]),s||(a=/\["adp_CometSinglePostContentQueryRelayPreloader_\w+",(.+})\]/,s=(s=t.match(a))&&s[1]),s||(a=/\["adp_CometSinglePostRootQueryRelayPreloader_\w+",(.+})\]/,s=(s=t.match(a))&&s[1]),s){e.next=23;break}o=function(e,t,r){for(;r.length>1;)e=e[r.shift()];e[r.shift()]=t},c=[],a=/\["adp_CometPhotoRootContentQueryRelayPreloader_\w+",(.+})\]/g,u=S(t.matchAll(a)),p=0;case 12:if(!(p<u.length)){e.next=22;break}return d=u[p][1],f=A(d,'"__bbox":'),e.next=17,L(f[0]);case 17:(f=e.sent).result.path?c.push(f):i=f;case 19:p++,e.next=12;break;case 22:i&&(c.forEach((function(e){o(i,e.result.data,["result","data"].concat(S(e.result.path)))})),n=i);case 23:if(s||n||(a=/\["adp_CometVideoHomeInjectedLiveVideoQueryRelayPreloader_\w+",(.+})\]/,s=(s=t.match(a))&&s[1]),!s&&!n){e.next=33;break}if(n){e.next=30;break}return h=A(s,'"__bbox":'),e.next=29,L(h[0]);case 29:n=e.sent;case 30:return e.abrupt("return",{feedback_data:P(n),variables:n.variables});case 33:if(C.log("FALLBACK TO FACEBOOK WATCH SPECIAL CASE"),r=r.split("_")[1],v=new RegExp('"subscription_target_id":"'.concat(r,'","id":"(.+?)"')),!(_=t.match(v))){e.next=39;break}return e.abrupt("return",{feedback_data:{id:_[1]},variables:{}});case 39:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),P=function(e){var t=function(e){var t,r;return"feedback_context"in e?e.feedback_context.feedback_target_with_context:"feedback"in e?e.feedback:(null==e||null===(t=e.comet_feed_ufi_container)||void 0===t||null===(r=t.story)||void 0===r?void 0:r.feedback_context)?e.comet_feed_ufi_container.story.feedback_context.feedback_target_with_context:void 0}(function(){var t=e.result.data;return"node"in t?t.node.comet_sections.feedback.story:"nodes"in t?t.nodes[0].comet_sections.feedback.story:"video"in t?t.video.creation_story:"currMedia"in t?t.currMedia:void 0}());return"ufi_renderer"in t?t.ufi_renderer.feedback:t},D=function(e,t){return t.reduce((function(t,r){return c(c({},t),{},o({},r,e[r]))}),{})},U=function(e){return Object.entries?Object.entries(e):Object.keys(obj).map((function(t){return[t,e[t]]}))},B=function(e){var t,r={},n=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}(e);try{for(n.s();!(t=n.n()).done;){var a=s(t.value,2),o=a[0],i=a[1];r[o]=i}}catch(e){n.e(e)}finally{n.f()}return r},F=function(e){var t,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).timeout||2e4,n=null;function a(){n=null}return function(){if(n)return n;for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return n=e.apply(this,o),t=setTimeout(a,r),n.finally((function(){clearTimeout(t),a()})),n}},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.min||0,r=e.max||1e4,n=Math.random()*(r-t)+t;return new Promise((function(e){return setTimeout((function(){e()}),n)}))},G=function(){var e=d(l.a.mark((function e(t,r,n){var a,s,o,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.map((function(e){return(e.attachments||[]).map((function(t){return c(c({},t),{},{messageId:e.id})}))})),o=(a=[]).concat.apply(a,S(s)),e.next=4,Promise.allSettled(o.map((function(e){return q(e,r,n)})));case 4:return i=e.sent.map((function(e){return null==e?void 0:e.value})).filter((function(e){return!!e})),u=i.reduce((function(e,t){return e[null==t?void 0:t.messageId]?e[null==t?void 0:t.messageId].push(t):e[null==t?void 0:t.messageId]=[t],e}),{}),e.abrupt("return",t.map((function(e){return u[null==e?void 0:e.id]?c(c({},e),{},{attachments:u[null==e?void 0:e.id]||[]}):e})));case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),q=function(){var e=d(l.a.mark((function e(){var t,r,n,a,s,o,i,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S,E,T,A,R,L,N,O,P,D,U,B,F=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=F.length>1?F[1]:void 0,f=F.length>2?F[2]:void 0,h=(p=F.length>0&&void 0!==F[0]?F[0]:{}).post_attachments&&(null===(t=p.post_attachments)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.url),v=p.products&&(null===(n=p.products)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.url),!p||["image","photo","commerce_product"].includes(p.type||p.media_type)||h){e.next=8;break}return e.abrupt("return",p||{});case 8:if(_=v?null===(s=p.products)||void 0===s||null===(o=s[0])||void 0===o?void 0:o.url:h?(null===(i=p.post_attachments)||void 0===i||null===(u=i[0])||void 0===u?void 0:u.url)||"":(null==p?void 0:p.url)||"",(m=j(_))&&"cdn.pancake.vn"!=m){e.next=12;break}return e.abrupt("return",p||{});case 12:if(g=c({},p||{}),e.prev=13,"commerce_product"!=p.type||!Array.isArray(null===(b=g)||void 0===b?void 0:b.products)){e.next=32;break}I=0;case 16:if(!(I<(null===(y=g)||void 0===y||null===(x=y.products)||void 0===x?void 0:x.length))){e.next=30;break}return A=null===(k=g)||void 0===k||null===(w=k.products)||void 0===w?void 0:w[I],R=(null==A||null===(S=A.image)||void 0===S?void 0:S.url)||(null==A?void 0:A.url),e.next=21,H(d,R,f);case 21:return L=e.sent,e.next=24,null==L?void 0:L.json();case 24:(N=e.sent).success&&(null==N||null===(E=N.result)||void 0===E?void 0:E.url)&&(R=(null==N||null===(T=N.result)||void 0===T?void 0:T.url)||R),g.products[I]=c(c({},A),{},{image:c(c({},null==A?void 0:A.image),{},{url:R})});case 27:I++,e.next=16;break;case 30:e.next=39;break;case 32:return e.next=34,H(d,_,f);case 34:return P=e.sent,e.next=37,null==P?void 0:P.json();case 37:(D=e.sent).success&&(null==D||null===(O=D.result)||void 0===O?void 0:O.url)&&(h?g.post_attachments[0].url=null==D||null===(B=D.result)||void 0===B?void 0:B.url:g=c(c({},g),{},{url:(null==D||null===(U=D.result)||void 0===U?void 0:U.url)||""}));case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(13),C.log("utils.js: Encounter error while: doUploadMedia",e.t0);case 44:return e.prev=44,e.abrupt("return",g);case 47:case"end":return e.stop()}}),e,null,[[13,41,44,47]])})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=d(l.a.mark((function e(t,r,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://pages.fm/api/v1/pages/".concat(t,"/contents/upload_media_by_url?access_token=").concat(n),{method:"POST",body:JSON.stringify({url:r}),headers:{"Content-Type":"application/json"}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),j=function(e){try{return new URL(e).hostname}catch(e){return null}},z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4,r=(new Date).valueOf();try{var n=self.taskWithTimeoutTracker?self.taskWithTimeoutTracker:self.taskWithTimeoutTracker={};n[r]=!0,setTimeout((function(){n[r]=!1}),t)}catch(e){C.error("withTimeoutTask: CAN NOT INIT TIMEOUT TRACKER")}e(r)},V=function(e){try{var t=(new Date).valueOf(),r=self.taskWithTimeoutTracker?self.taskWithTimeoutTracker:self.taskWithTimeoutTracker={},n=e,a=r[e];if(delete r[e],n&&"boolean"==typeof a){if(a){var s=35e3-(t-n);return s>0?s:null}return null}return"NO_TIMEOUT"}catch(e){C.error("withTimeoutTask: CAN NOT CLEAR TIMEOUT TRACKER")}return"NO_TIMEOUT"},W=function(e){return new Promise((function(t){return setTimeout(t,e)}))},K=function(e){return e&&0===Object.keys(e).length&&e.constructor===Object},Q={getAllItems:function(){return chrome.storage.local.get()},getItem:(N=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.storage.local.get(t);case 2:return e.t0=t,e.abrupt("return",e.sent[e.t0]);case 4:case"end":return e.stop()}}),e)}))),function(e){return N.apply(this,arguments)}),setItem:function(e,t){return chrome.storage.local.set(o({},e,t))},removeItems:function(e){return chrome.storage.local.remove(e)}};self.LS=Q;var Y,J,X=Q,$=function(){var e=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X.getItem("fb_referer_config");case 3:if(!(t=e.sent)){e.next=9;break}return data=JSON.parse(t),e.abrupt("return",data||{});case 9:return e.abrupt("return",{});case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{});case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X.setItem("fb_referer_config",JSON.stringify(t));case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),ee={set:(J=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$();case 2:return(n=e.sent)[t]=r,e.next=6,Z(n);case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return J.apply(this,arguments)}),get:(Y=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$();case 2:return r=e.sent,e.abrupt("return",r[t]);case 4:case"end":return e.stop()}}),e)}))),function(e){return Y.apply(this,arguments)})};self.Referer=ee;var te,re=function(){var e=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=p.length>1&&void 0!==p[1]?p[1]:{}).parseResponse,a=r.headers,s=void 0===a?{}:a,o=r.params,i=void 0===o?{}:o,c=r.skipProcessReferer,u=void 0!==c&&c,e.next=4,oe(t,{headers:s,params:i},{parseResponse:n||function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),skipProcessReferer:u,headers:s});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=d(l.a.mark((function e(t){var r,n=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=3,oe(t,{},r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=d(l.a.mark((function e(t,r){var n,a,s,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:{},s=(a=o.length>3&&void 0!==o[3]?o[3]:{}).headers||{},e.next=5,oe(t,{method:"POST",body:r,headers:s,params:n},a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),se=function(){var e=d(l.a.mark((function e(t,r){var n,a,s,o,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},s=(a=i.length>3&&void 0!==i[3]?i[3]:{}).parseResponse,o=a.headers,e.next=5,oe(t,{method:"POST",headers:c(c({},o),{},{"Content-Type":"application/json"}),body:r,params:n},{parseResponse:s||function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),oe=function(){var e=d(l.a.mark((function e(t){var r,n,a,s,o,i,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=S.length>2&&void 0!==S[2]?S[2]:{},a=(r=S.length>1&&void 0!==S[1]?S[1]:{}).method,s=void 0===a?"GET":a,o=r.params,i=void 0===o?{}:o,u=r.body,p=r.headers,d=void 0===p?{}:p,f=n.timeout,h=n.parseResponse,void 0!==(v=n.skipProcessReferer)&&v){e.next=7;break}return e.next=7,ie(t,null==n||null===(_=n.headers)||void 0===_?void 0:_.Referer);case 7:m=null,g=f||3e4,b=new AbortController,I=setTimeout((function(){return b.abort()}),g),y={signal:b.signal,method:s,cache:"no-cache",redirect:"follow"},x=t,k="",K(d)||(y.headers=c({},d)),x=K(i)?x:x+"?"+new URLSearchParams(i),e.t0=s,e.next="GET"===e.t0?17:"POST"===e.t0?18:21;break;case 17:return e.abrupt("break",22);case 18:return"application/json"==d["Content-Type"]&&(k=JSON.stringify(u)),y.body=k||u,e.abrupt("break",22);case 21:return e.abrupt("break",22);case 22:return e.prev=22,e.next=25,ce(fetch(x,y));case 25:return w=e.sent,e.next=28,h?h(w):w;case 28:m=e.sent,e.next=34;break;case 31:e.prev=31,e.t1=e.catch(22),console.log("Request: Encounter error while fetching",s,t,e.t1);case 34:return e.prev=34,clearTimeout(I),e.abrupt("return",m);case 38:case"end":return e.stop()}}),e,null,[[22,31,34,38]])})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee.get(t);case 2:return n=e.sent,e.next=5,CCake.updateDynamicHeaderRules(t,"Referer",n||r||"");case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();function ce(e){return ue.apply(this,arguments)}function ue(){return(ue=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,n=setInterval(chrome.runtime.getPlatformInfo,25e3),e.prev=2,e.next=5,t;case 5:r=e.sent;case 6:return e.prev=6,clearInterval(n),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,null,[[2,,6,10]])})))).apply(this,arguments)}function le(e){return pe.apply(this,arguments)}function pe(){return(pe=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=chrome.runtime.getURL(t),e.next=3,chrome.runtime.getContexts({contextTypes:["OFFSCREEN_DOCUMENT"],documentUrls:[r]});case 3:if(!((null==(n=e.sent)?void 0:n.length)>0)){e.next=6;break}return e.abrupt("return");case 6:if(!te){e.next=11;break}return e.next=9,te;case 9:e.next=21;break;case 11:return e.prev=11,te=chrome.offscreen.createDocument({url:t,reasons:["WORKERS"],justification:"For calculate some dom element"}),e.next=15,te;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(11),console.error("Encounter error while setupOffscreenDocument",e.t0);case 20:te=null;case 21:case"end":return e.stop()}}),e,null,[[11,17]])})))).apply(this,arguments)}self.PancExtRequest={fetchHTML:re,httpGet:ne,httpPost:ae,httpPostJson:se,internalHttpRequest:oe};var de="__spin_r",fe="__spin_t",he="__spin_b",ve="__spin_dev_mhenv";function _e(){var e=Math.floor(Date.now()/1e3),t=Math.floor(4294967295*Math.random());return"T"+Number(4294967295&e).toString(36)+t.toString(36)}var me=function(){function e(){h(this,e),this.ctx={},this.sprinkle_config={param_name:"jazoest",version:1,should_randomize:!0},this.Env=null,this.request_count=50,this.webSession=new w,this.lastLoadHtmlAt=null,this.sessionId=_e(),this.activityId=_e(),this.tabId=Math.floor(Math.random()*Math.pow(36,6)).toString(36).padStart(6,"0")}var t,r,n,a,s;return _(e,[{key:"load_html",value:(s=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t);case 2:r=e.sent,this.ctxFromHtml(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"cometUniqueID",value:function(){var e=0;return e=Math.floor(6*Math.random())+10,"jsc_c_"+(e++).toString(36)}},{key:"getCompatIframeSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"https://www.facebook.com",r=-1!==e.indexOf("?")?"&":"?";return""+e+r+"cquick="+this.cometUniqueID()+"&ctarget="+encodeURIComponent(t)+"&cquick_token="+(null!=this.Env.compat_iframe_token?this.Env.compat_iframe_token:"")}},{key:"ctxFromHtml",value:(a=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.match(/\\?"USER_ID\\?":\\?"(\d+)\\?"/i))&&0!==r[1]&&(this.ctx.userID=r[1]),r=t.match(/(?!function)(?:envFlush)(?:\()({.*})(?=\);(?=(<|_)))/))try{this.Env=JSON.parse(r[1])}catch(e){}if(((r=t.match(/"DTSGInitialData",\[\],{"token":"([^"]+)"/i))&&0!==r[1]||(r=t.match(/name="fb_dtsg" value="([^"]+)"/))&&0!==r[1])&&(this.ctx.dtsg=r[1],this.lastLoadHtmlAt=(new Date).getTime()/1e3),(r=t.match(/"DTSGInitData",\[\],{"token":"([^"]+)","async_get_token":"([^"]+)"}/))&&0!==r[1]&&(this.ctx.dtsg=r[1],this.ctx.dtsg_async=r[2],this.lastLoadHtmlAt=(new Date).getTime()/1e3),!(r=t.match(/\["MRequestConfig",\[\],([^\]]+),\d+\]/))){e.next=19;break}return e.prev=10,e.next=13,this.runStringFunction("function() {return ".concat(r[1],";}"),[]);case 13:this.m_request_config=e.sent,this.lastLoadHtmlAt=(new Date).getTime()/1e3,e.next=19;break;case 17:e.prev=17,e.t0=e.catch(10);case 19:if((r=t.match(/\["SprinkleConfig",\[\],{"param_name":"([^"]+)","version":(\d+),"should_randomize":(true|false)}/))&&(this.sprinkle_config={param_name:r[1],version:r[2],should_randomize:"true"==r[3]}),!(r=t.match(/\["SiteData",\[\],([^\]]+),\d+\]/))){e.next=31;break}return e.prev=23,e.next=26,this.runStringFunction("function() {return ".concat(r[1],";}"),[]);case 26:this.SiteData=e.sent,e.next=31;break;case 29:e.prev=29,e.t1=e.catch(23);case 31:if(!(r=t.match(/\["ServerNonce",\[\],([^\]]+),\d+\]/))){e.next=42;break}return e.prev=33,e.next=36,this.runStringFunction("function() {return ".concat(r[1],";}"),[]);case 36:this.ServerNonce=e.sent,this.ServerNonce&&this.ServerNonce.ServerNonce&&this.webSession.setServerNonce(this.ServerNonce.ServerNonce),e.next=42;break;case 40:e.prev=40,e.t2=e.catch(33);case 42:if(!(r=t.match(/\["WebConnectionClassServerGuess",\[\],([^\]]+),\d+\]/))){e.next=52;break}return e.prev=44,e.next=47,this.runStringFunction("function() {return ".concat(r[1],";}"),[]);case 47:this.WebConnectionClassServerGuess=e.sent,e.next=52;break;case 50:e.prev=50,e.t3=e.catch(44);case 52:if(!(r=t.match(/\["MercuryServerRequestsConfig",\[\],([^\]]+),\d+\]/))){e.next=62;break}return e.prev=54,e.next=57,this.runStringFunction("function() {return ".concat(r[1],";}"),[]);case 57:this.MercuryServerRequestsConfig=e.sent,e.next=62;break;case 60:e.prev=60,e.t4=e.catch(54);case 62:if((r=t.match(/server_revision":(\d+)/))&&r[1]&&(this.ctx.server_revision=r[1]),(r=t.match(/client_revision":(\d+)/))&&r[1]&&(this.ctx.client_revision=r[1]),(r=t.match(/sequenceId":(\d+)/))&&r[1]&&(this.ctx.sequence_id=r[1]),this.ctx.messenger_region||((r=t.match(/"(?:regionNullable|msgrRegion)":"(\w+)"/))&&r[1]?(C.log("FOUND messenger region",r[1]),this.ctx.messenger_region=r[1]):this.ctx.messenger_region="PRN"),this.ctx.usid_metadata){e.next=77;break}if(!(r=A(t,'"USIDMetadata",[],')[0])){e.next=77;break}return e.next=74,L(r);case 74:n=e.sent,C.log("FOUND USID metadata",n),this.ctx.usid_metadata=n;case 77:if(!(r=A(t,'"LSD",[],')[0])){e.next=84;break}return e.next=81,L(r);case 81:a=e.sent,C.log("FOUND lsd",a.token),this.ctx.lsd=a.token;case 84:case"end":return e.stop()}}),e,this,[[10,17],[23,29],[33,40],[44,50],[54,60]])}))),function(e){return a.apply(this,arguments)})},{key:"buildHeaders",value:function(){return this.MercuryServerRequestsConfig?{"X-MSGR-Region":this.MercuryServerRequestsConfig.msgrRegion}:{}}},{key:"buildMParams",value:function(){var e={__user:this.ctx.userID,__req:(this.request_count++).toString(36)};return this.m_request_config&&this.m_request_config.ajaxResponseToken&&(e.__a=this.m_request_config.ajaxResponseToken.encrypted||""),this.m_request_config&&this.m_request_config.dtsg&&(e.fb_dtsg=this.m_request_config.dtsg.token,this.sprinkle_config&&2==this.sprinkle_config.version?e[this.sprinkle_config.param_name]=this.calcJazoestV2(e.fb_dtsg):e[this.sprinkle_config.param_name]=this.calcJazoest(e.fb_dtsg)),e}},{key:"buildParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.ctx,t={__user:e.userID,__a:1,__req:(this.request_count++).toString(36)};return this.SiteData&&(t.__csr="",t.__beoa=this.SiteData.be_one_ahead?1:0,t.__pc=this.SiteData.pkg_cohort,t.dpr=this.SiteData.pr,this.WebConnectionClassServerGuess&&(t.__ccg=this.WebConnectionClassServerGuess.connectionClass),t.__rev=this.SiteData.client_revision,t.__hsi=this.SiteData.hsi,t.__hs=this.SiteData.haste_session,t.__comet_req=this.SiteData.is_comet?1:0,this.SiteData.spin&&(t[de]=this.SiteData[de],t[he]=this.SiteData[he],t[fe]=this.SiteData[fe],this.SiteData[ve]&&(t[ve]=this.SiteData[ve])),this.SiteData.force_blue&&(t.force_blue=1),t.__s=this.webSession.getId()),!t.__rev&&(t.__rev=e.client_revision),e.dtsg&&(t.fb_dtsg=e.dtsg,this.sprinkle_config&&2==this.sprinkle_config.version?t[this.sprinkle_config.param_name]=this.calcJazoestV2(e.dtsg):t[this.sprinkle_config.param_name]=this.calcJazoest(e.dtsg)),this.Env&&this.Env.isCQuick&&(t=Object.assign(t,{cquick:this.Env.iframeKey,cquick_token:this.Env.iframeToken,ctarget:encodeURIComponent(this.Env.iframeTarget)})),!t[de]&&e.spin&&(t.__spin_r=e.__spin_r,t.__spin_b=e.__spin_b,t.__spin_t=e.__spin_t),t.lsd=e.lsd,t}},{key:"serialize",value:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}},{key:"calcJazoestV2",value:function(e){for(var t=0,r=0;r<e.length;r++)t+=e.charCodeAt(r);return t=t.toString(),this.sprinkle_config.should_randomize?t:"2"+t}},{key:"calcJazoest",value:function(e){for(var t="",r=0;r<e.length;r++)t+=e.charCodeAt(r);return"2"+t}},{key:"makeParsable",value:function(e,t){return e.replace(/for\s*\(\s*;\s*;\s*\)\s*;\s*/,"")}},{key:"parseFbRes",value:function(e){return JSON.parse(this.makeParsable(e))}},{key:"runStringFunction",value:(n=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le("offscreen.html");case 2:return n=Date.now(),e.abrupt("return",new Promise((function(e,a){chrome.runtime.onMessage.addListener((function t(r){"runStringFunction"==r.command&&r.taskId==n&&(chrome.runtime.onMessage.removeListener(t),r.success?e(r.response):a())}));var s={command:"runStringFunction",taskId:n,code:t,argNames:r};chrome.runtime.sendMessage({target:"offscreen_tab",message:s})})));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"generateUsid",value:function(){return null}},{key:"persistBase",value:(r=d(l.a.mark((function e(t,r,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a="base_".concat(t),C.log("persisBase_key:",a),e.next=5,X.setItem(a,JSON.stringify({base:this,cquick_token:r,refererUrl:n}));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Encounter error while persistBase",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"restoreBase",value:(t=d(l.a.mark((function e(t,r){var n,a,s,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="base_".concat(r),e.prev=1,C.log("restoreBase_key:",n),e.next=5,X.getItem(n);case 5:if(!(a=e.sent)){e.next=18;break}if(s=JSON.parse(a),o=s.base,i=s.cquick_token,c=s.refererUrl,!((null==o?void 0:o.lastLoadHtmlAt)>=(new Date).getTime()/1e3-3600)){e.next=13;break}return(null==o?void 0:o.webSession)&&(o.webSession=Object.assign(new w,o.webSession)),e.abrupt("return",[Object.assign(t,o),i,c]);case 13:return e.next=15,X.removeItems([n]);case 15:case 18:return e.abrupt("return",!1);case 16:e.next=19;break;case 19:e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(1),e.next=25,X.removeItems([n]);case 25:return console.error("Encounter error while restore base: ".concat(n),e.t0),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[1,21]])}))),function(e,r){return t.apply(this,arguments)})}]),e}();function ge(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?be(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}self.Base=me;var Ie=function(e,t,r){return r.indexOf(e)===t},ye=function(){function e(t){var r=this,n=t.pageId,a=t.convId,s=t.postId,i=t.pageAccessToken,c=t.convName,u=t.allowPrioritySearchByName;h(this,e),o(this,"getFbPostId",(function(){var e=r.postId.split("_");return e[e.length-1]})),this.convId=a,this.pageId=n,this.base=null,this.graphql=null,this.html=null,this.postId=s,this.accessToken=i,this.allComments=[],this.convName=c,this.allowPrioritySearchByName=u}var t,r,n,a,i,c,u,p,v,m,g,b,I,y,x;return _(e,[{key:"getAllComments",value:function(){return this.allComments||[]}},{key:"init",value:(x=d(l.a.mark((function t(){var r,n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getHtmlBusinessCommentsView(this.pageId);case 2:return r=t.sent,n=r.html,this.html=n,t.next=7,this.initBaseForGraphReq(n,this.pageId);case 7:case"end":return t.stop()}}),t,this)}))),function(){return x.apply(this,arguments)})},{key:"initBaseForGraphReq",value:(y=d(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.base=new me,e.next=3,this.base.ctxFromHtml(t);case 3:this.graphql=new Rt({base:this.base,pageId:r});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"getComment",value:(I=d(l.a.mark((function t(){var r,n,a,s,o,i,c,u,p;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(At.isFeatureReady("businessInboxComment")){t.next=4;break}return C.log("feature: businessInboxComment is NOT ready, preloadDocIds is running..."),t.next=4,e.preloadDocIds({pageId:this.pageId,html:this.html});case 4:return t.prev=4,t.next=7,this.searchCommentByUserName();case 7:if(!(r=t.sent)){t.next=10;break}return t.abrupt("return",r);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),console.error("Encounter error while searchCommentByUserName",t.t0);case 15:return t.next=17,this.getCommentThread(0,null);case 17:if(!(n=t.sent)){t.next=36;break}return t.next=21,this.getCommentDetailHeader(n.node.id);case 21:if(!(a=t.sent)){t.next=36;break}return t.next=25,this.getViewDetailHeaderTitle(a.target_id);case 25:if(!(s=t.sent)){t.next=35;break}return t.next=29,this.getExtraJsFilesToLoad(n.node.id,null==n||null===(o=n.node)||void 0===o||null===(i=o.page_comm_item_parts)||void 0===i||null===(c=i.nodes)||void 0===c||null===(u=c[0])||void 0===u?void 0:u.comm_source_id);case 29:return t.next=31,this.findComment(s.id);case 31:return p=t.sent,t.abrupt("return",p);case 35:case 36:return t.abrupt("return",null);case 37:case"end":return t.stop()}}),t,this,[[4,12]])}))),function(){return I.apply(this,arguments)})},{key:"searchCommentByUserName",value:(b=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S,E,T,R,L,N,O,P,D,U,B,F,M,G,q,H,j,z,V,W,K,Q,Y,J,X,$,Z,ee,te,re,ne,ae,se,oe,ie,ce,ue,le=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.convName){e.next=2;break}return e.abrupt("return",null);case 2:if(s=this.convId.split("_")[1],At.has(it)&&At.has(ct)){e.next=6;break}return e.next=6,At.loadDocIdsFromView({html:this.html,docNames:[it,ct]});case 6:return o={pageID:this.pageId,count:5,cursor:null,searchTerm:this.convName,channel:"FACEBOOK",selectedIgAssetId:null},e.next=9,this.graphql.graphql(it,o);case 9:if(!(null==(i=e.sent)||null===(t=i.data)||void 0===t||null===(r=t.page)||void 0===r||null===(n=r.page_unified_customer_search)||void 0===n||null===(a=n.edges)||void 0===a?void 0:a.length)){e.next=122;break}if(C.log("FOUND_USER_BY_SEARCH_USER_NAME",null==i||null===(c=i.data)||void 0===c||null===(u=c.page)||void 0===u||null===(p=u.page_unified_customer_search)||void 0===p?void 0:p.edges),1!=(null==(g=null==i||null===(d=i.data)||void 0===d||null===(f=d.page)||void 0===f||null===(h=f.page_unified_customer_search)||void 0===h?void 0:h.edges.filter((function(e){var t;return(null==e||null===(t=e.node)||void 0===t?void 0:t.name)===le.convName})))?void 0:g.length)||!this.allowPrioritySearchByName||!(null===(v=g[0])||void 0===v||null===(_=v.node)||void 0===_||null===(m=_.user)||void 0===m?void 0:m.id)){e.next=16;break}return C.log("PRIORITY_SEARCH_COMMENT_USER_BY_NAME",g[0]),e.abrupt("return",{node:{author:{id:null===(b=g[0])||void 0===b||null===(I=b.node)||void 0===I||null===(y=I.user)||void 0===y?void 0:y.id}}});case 16:x=ge(g),e.prev=17,x.s();case 19:if((k=x.n()).done){e.next=114;break}return L=k.value,N={count:null,cursor:null,pageCustomerID:null==L||null===(w=L.node)||void 0===w?void 0:w.id},e.next=24,this.graphql.graphql(ct,N);case 24:if(!(null==(O=e.sent)||null===(S=O.data)||void 0===S||null===(E=S.CrmUnifiedContact)||void 0===E||null===(T=E.facebook_comms)||void 0===T||null===(R=T.edges)||void 0===R?void 0:R.length)){e.next=112;break}P=ge(O.data.CrmUnifiedContact.facebook_comms.edges),e.prev=27,P.s();case 29:if((D=P.n()).done){e.next=104;break}if(G=D.value,!(q=(null==G||null===(U=G.node)||void 0===U||null===(B=U.parent_item)||void 0===B?void 0:B.id)||(null==G||null===(F=G.node)||void 0===F||null===(M=F.node)||void 0===M?void 0:M.id))){e.next=102;break}return H={commItemID:q,feedLocation:"BUSINESS_COMMENT_INBOX_TAB",feedbackSource:107,focusCommentID:null,privacySelectorRenderLocation:"BUSINESS_COMMENT_INBOX_TAB",scale:1,useDefaultActor:!1,renderLocation:"business_comment_inbox_tab",__relay_internal__pv__CometImmersivePhotoCanUserDisable3DMotionrelayprovider:!1,__relay_internal__pv__IsWorkUserrelayprovider:!1,__relay_internal__pv__IsMergQAPollsrelayprovider:!1,__relay_internal__pv__CometUFIReactionsEnableShortNamerelayprovider:!1,__relay_internal__pv__CometUFIShareActionMigrationrelayprovider:!0,__relay_internal__pv__IncludeCommentWithAttachmentrelayprovider:!0,__relay_internal__pv__StoriesArmadilloReplyEnabledrelayprovider:!1,__relay_internal__pv__EventCometCardImage_prefetchEventImagerelayprovider:!1},e.next=36,this.graphql.graphql(xt,H,{__aaid:0,__ccg:"EXCELLENT",__comet_req:11,__jssesw:1,server_timestamps:!0},!1,(function(e){return e.text()}));case 36:j=e.sent,z=A(j,'"comment_list_renderer":'),V=[],W=ge(z),e.prev=40,W.s();case 42:if((K=W.n()).done){e.next=94;break}if(Q=K.value,e.prev=44,(null==(te=JSON.parse(Q))||null===(Y=te.feedback)||void 0===Y?void 0:Y.id)&&V.push(null==te||null===(J=te.feedback)||void 0===J?void 0:J.id),!(null==te||null===(X=te.feedback)||void 0===X||null===($=X.comment_rendering_instance_for_feed_location)||void 0===$||null===(Z=$.comments)||void 0===Z||null===(ee=Z.edges)||void 0===ee?void 0:ee.length)){e.next=65;break}re=ge(te.feedback.comment_rendering_instance_for_feed_location.comments.edges),e.prev=49,re.s();case 51:if((ne=re.n()).done){e.next=57;break}if((null==(se=ne.value)||null===(ae=se.node)||void 0===ae?void 0:ae.legacy_fbid)!==s){e.next=55;break}return e.abrupt("return",se);case 55:e.next=51;break;case 57:e.next=62;break;case 59:e.prev=59,e.t0=e.catch(49),re.e(e.t0);case 62:return e.prev=62,re.f(),e.finish(62);case 65:V=V.filter(Ie),C.log("feedbackIds",V),oe=ge(V),e.prev=68,oe.s();case 70:if((ie=oe.n()).done){e.next=80;break}return ce=ie.value,e.next=74,this.findComment(ce);case 74:if(ue=e.sent,C.log("res_find_comment",ue),!ue){e.next=78;break}return e.abrupt("return",ue);case 78:e.next=70;break;case 80:e.next=85;break;case 82:e.prev=82,e.t1=e.catch(68),oe.e(e.t1);case 85:return e.prev=85,oe.f(),e.finish(85);case 88:e.next=92;break;case 90:e.prev=90,e.t2=e.catch(44);case 92:e.next=42;break;case 94:e.next=99;break;case 96:e.prev=96,e.t3=e.catch(40),W.e(e.t3);case 99:return e.prev=99,W.f(),e.finish(99);case 102:e.next=29;break;case 104:e.next=109;break;case 106:e.prev=106,e.t4=e.catch(27),P.e(e.t4);case 109:return e.prev=109,P.f(),e.finish(109);case 112:e.next=19;break;case 114:e.next=119;break;case 116:e.prev=116,e.t5=e.catch(17),x.e(e.t5);case 119:return e.prev=119,x.f(),e.finish(119);case 122:case"end":return e.stop()}}),e,this,[[17,116,119,122],[27,106,109,112],[40,96,99,102],[44,90],[49,59,62,65],[68,82,85,88]])}))),function(){return b.apply(this,arguments)})},{key:"getCommentThread",value:(g=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:0,r=u.length>1&&void 0!==u[1]?u[1]:null,n=u.length>2&&void 0!==u[2]&&u[2],a=this.getFbPostId(),s={pageID:this.pageId,count:20,cursor:r,filterType:null,filterIsReadStatus:null,filterOwnerID:null,filterStatus:"TODO",platformFilter:"FACEBOOK",isHighlightedComment:!1,isStarsComment:!1},e.next=7,this.graphql.graphql(bt,s);case 7:o=e.sent,i=0;case 9:if(!(i<o.data.page.business_comm_items.edges.length)){e.next=20;break}return e.next=12,this.getCommentDetailHeader(o.data.page.business_comm_items.edges[i].node.id);case 12:if(c=e.sent,0!==i||!n){e.next=15;break}return e.abrupt("return",o.data.page.business_comm_items.edges[i]);case 15:if(!c||(null==c?void 0:c.comm_source_id)!=a){e.next=17;break}return e.abrupt("return",o.data.page.business_comm_items.edges[i]);case 17:i++,e.next=9;break;case 20:if(!(t<10)){e.next=22;break}return e.abrupt("return",this.getCommentThread(t+1,o.data.page.business_comm_items.page_info.end_cursor));case 22:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"getCommentDetailHeader",value:(m=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={commItemID:t},e.next=3,this.graphql.graphql(It,r);case 3:return n=e.sent,e.abrupt("return",n.data.commItem);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getViewDetailHeaderTitle",value:(v=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={postID:t},e.next=3,this.graphql.graphql(yt,r);case 3:return n=e.sent,e.abrupt("return",n.data.facebook_post.feedback);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"findComment",value:(p=d(l.a.mark((function e(t){var r,n,a,o,i,c,u,p,d,f,h,v,_;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.convId.split("_")[1],c={commentsIntentToken:"RANKED_UNFILTERED_CHRONOLOGICAL_REPLIES_INTENT_V1",feedLocation:"BUSINESS_COMMENT_INBOX_TAB",feedbackSource:107,focusCommentID:null,scale:1,useDefaultActor:!1,id:t},e.next=4,this.graphql.graphql(kt,c);case 4:return u=e.sent,p=null==u||null===(r=u.data)||void 0===r||null===(n=r.node)||void 0===n||null===(a=n.comment_rendering_instance_for_feed_location)||void 0===a?void 0:a.comments,d=null==p||null===(o=p.edges)||void 0===o?void 0:o.find((function(e){var t;return(null==e||null===(t=e.node)||void 0===t?void 0:t.legacy_fbid)==i})),e.next=9,this.findInChildComment((null==p?void 0:p.edges)||[]);case 9:return this.allComments=this.allComments.concat((null==p?void 0:p.edges)||[]),e.next=12,this.getCommentByPagegination([(null==p?void 0:p.edges)||[],d],t,p.page_info.end_cursor,1);case 12:return f=e.sent,h=s(f,2),v=h[0],_=h[1],C.log("commentResult:",_,v),this.syncGlobalId(v),e.abrupt("return",_);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"findInChildComment",value:(u=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p,d,f,h,v,_,m,g,b,I,y,x;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(t||[]).filter((function(e){var t,r,n,a,s,o,i,c;return(null==e||null===(t=e.node)||void 0===t||null===(r=t.feedback)||void 0===r||null===(n=r.expansion_info)||void 0===n?void 0:n.expansion_token)&&(null==e||null===(a=e.node)||void 0===a||null===(s=a.feedback)||void 0===s?void 0:s.id)&&(null==e||null===(o=e.node)||void 0===o||null===(i=o.feedback)||void 0===i||null===(c=i.replies_fields)||void 0===c?void 0:c.total_count)>0})),n=ge(r),e.prev=2,n.s();case 4:if((a=n.n()).done){e.next=15;break}return g=a.value,b=null==g||null===(s=g.node)||void 0===s||null===(o=s.feedback)||void 0===o||null===(i=o.expansion_info)||void 0===i?void 0:i.expansion_token,I=null==g||null===(c=g.node)||void 0===c||null===(u=c.feedback)||void 0===u?void 0:u.id,y={clientKey:null,expansionToken:b,feedLocation:"BUSINESS_COMMENT_INBOX_TAB",focusCommentID:null,id:I,repliesAfterCount:null,repliesAfterCursor:null,repliesBeforeCount:null,repliesBeforeCursor:null,scale:1,useDefaultActor:!1},e.next=11,this.graphql.graphql(St,y);case 11:(null==(x=e.sent)||null===(p=x.data)||void 0===p||null===(d=p.node)||void 0===d||null===(f=d.replies_connection)||void 0===f||null===(h=f.edges)||void 0===h?void 0:h.length)>0&&(this.allComments=this.allComments.concat((null==x||null===(v=x.data)||void 0===v||null===(_=v.node)||void 0===_||null===(m=_.replies_connection)||void 0===m?void 0:m.edges)||[]));case 13:e.next=4;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[2,17,20,23]])}))),function(e){return u.apply(this,arguments)})},{key:"syncGlobalId",value:(c=d(l.a.mark((function e(t){var r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.accessToken){e.next=3;break}return e.abrupt("return");case 3:if(n=this.getFbPostId()){e.next=6;break}return e.abrupt("return");case 6:return a=null==t||null===(r=t.filter((function(e){var t;return!!(null==e||null===(t=e.node)||void 0===t?void 0:t.legacy_fbid)})))||void 0===r?void 0:r.map((function(e){var t,r,a,s;return{comment_id:"".concat(n,"_").concat(null==e||null===(t=e.node)||void 0===t?void 0:t.legacy_fbid),global_id:null==e||null===(r=e.node)||void 0===r||null===(a=r.author)||void 0===a?void 0:a.id,created_time:null==e||null===(s=e.node)||void 0===s?void 0:s.created_time}})),a=a.filter(function(e){return function(t,r,n){return n.findIndex((function(r){return r[e]==t[e]}))==r}}("global_id")),s="https://pages.fm/api/v1/pages/".concat(this.pageId,"/customers/update_global_id?access_token=").concat(this.accessToken),e.next=11,se(s,{global_ids_by_comment:a},{},{parseResponse:function(e){return e}});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("CommentNormal: Encounter error while syncGlobalId",e.t0);case 16:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return c.apply(this,arguments)})},{key:"getCommentByPagegination",value:(i=d(l.a.mark((function e(t,r,n){var a,o,i,c,u,p,d,f,h,v,_,m=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s(t,2),i=o[0],c=o[1],u=m.length>3&&void 0!==m[3]?m[3]:1,p=this.convId.split("_")[1],d={commentsAfterCount:-1,commentsAfterCursor:n,commentsBeforeCount:null,commentsBeforeCursor:null,commentsIntentToken:"RANKED_UNFILTERED_CHRONOLOGICAL_REPLIES_INTENT_V1",feedLocation:"BUSINESS_COMMENT_INBOX_TAB",focusCommentID:null,scale:1,useDefaultActor:!1,id:r},e.next=6,this.graphql.graphql(wt,d);case 6:if(f=e.sent,h=f.data.node.comment_rendering_instance_for_feed_location.comments,v=c||(null==h||null===(a=h.edges)||void 0===a?void 0:a.find((function(e){return e.node.legacy_fbid==p}))),_=[i.concat((null==h?void 0:h.edges)||[]),v],!(h.page_info.has_next_page&&u<20)){e.next=14;break}return e.abrupt("return",this.getCommentByPagegination(_,r,h.page_info.end_cursor,u+1));case 14:return e.abrupt("return",_);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(a=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(At.has(kt)&&At.has(wt)&&At.has(St)&&At.has(Et))){e.next=2;break}return e.abrupt("return");case 2:return n={commItemID:t,feedLocation:"BUSINESS_COMMENT_INBOX_TAB",feedbackSource:107,focusCommentID:r||null,privacySelectorRenderLocation:"BUSINESS_COMMENT_INBOX_TAB",scale:1,useDefaultActor:!1,renderLocation:"business_comment_inbox_tab",__relay_internal__pv__IsWorkUserrelayprovider:!1,__relay_internal__pv__IsMergQAPollsrelayprovider:!1,__relay_internal__pv__CometUFIReactionsEnableShortNamerelayprovider:!1,__relay_internal__pv__StoriesArmadilloReplyEnabledrelayprovider:!0,__relay_internal__pv__StoriesRingrelayprovider:!1},e.next=5,this.graphql.graphql(xt,n,{__aaid:0,__ccg:"EXCELLENT",__comet_req:11,__jssesw:1,server_timestamps:!0},!1,(function(e){return e.text()}));case 5:return a=e.sent,C.log("typeof Response BIZ_INBOX_POST_DETAIL_WRAPPER_QUERY",f(a)),"string"!=typeof a&&(a=JSON.stringify({response:a})),e.next=10,At.loadDocIdsFromView({html:a,docNames:[kt,wt,St,Et]});case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})}],[{key:"preloadDocIds",value:(n=d(l.a.mark((function t(r){var n,a,s,o,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.html,a=r.pageId,!(At.has(bt)&&At.has(It)&&At.has(yt)&&At.has(xt))){t.next=3;break}return t.abrupt("return");case 3:if(!n){t.next=7;break}s=n,t.next=12;break;case 7:return t.next=9,e.getHtmlBusinessCommentsView(a);case 9:o=t.sent,i=o.html,s=i;case 12:return t.next=14,At.loadDocIdsFromView({html:s,docNames:[bt,It,yt,xt]});case 14:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})},{key:"getHtmlBusinessCommentsView",value:(r=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://business.facebook.com/latest/inbox/facebook?asset_id=".concat(t,"&thread_type=FB_PAGE_POST"),self.externalGraphLog&&externalGraphLog.log(t,"getHtmlBusinessCommentsView_comment_normal"),e.next=4,re(r,{parseResponse:function(e){return e}});case 4:return n=e.sent,e.next=7,n.text();case 7:return a=e.sent,e.abrupt("return",{html:a,response:n});case 9:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"getMessengerView",value:(t=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://business.facebook.com/latest/inbox/messenger?asset_id=".concat(t),self.externalGraphLog&&externalGraphLog.log(t,"getMessengerView_comment_normal"),e.next=4,re(r,{parseResponse:function(e){return e}});case 4:return n=e.sent,e.next=7,n.text();case 7:return a=e.sent,e.abrupt("return",{html:a,response:n});case 9:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();function xe(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ke(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ke(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function we(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}var Se=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e),o(this,"cacheFirstCommentItemId",(function(e){return X.setItem("".concat(t.pageId,"firstCommentItemId"),e)})),o(this,"firstCommentItemId",(function(){return X.getItem("".concat(t.pageId,"firstCommentItemId"))})),o(this,"focusCommentId",(function(){return X.getItem("".concat(t.pageId,"focusCommentId"))})),o(this,"cacheFocusCommentId",(function(e){return X.setItem("".concat(t.pageId,"focusCommentId"),e)})),o(this,"findTargetComment",(function(e,r){var n,a,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.display_comments&&(n=e.display_comments),!n&&e.comment_list_renderer&&((n=e.comment_list_renderer.feedback.display_comments)||(n=null===(a=e.comment_list_renderer.feedback.comment_rendering_instance_for_feed_location)||void 0===a?void 0:a.comments)),!n)return null;for(var o=n.edges,i=o.length-1;i>=0;i--){var c=o[i];if(c.node.legacy_fbid==r)return c;var u=t.findTargetComment(c.node.feedback,r,s);if(u)return s?u:c}})),this.pageId=r.pageId,this.postId=r.postId,this.commentId=r.commentId,this.originalCommentId=r.originalCommentId,this.stickerId=r.stickerId,this.message=r.message,this.mentions=r.mentions,this.photoUrl=r.photoUrl,this.initialized=!1,this.currentPageName=r.currentPageName,this.conversationId=r.conversationId||r.convId,this.customerName=r.customerName,this.allowSearchByName=r.allowSearchByName,this.commentNormal=null,this.attachments=r.attachments}var t,r,n,a,s,i,u,p,f,v,m,g,b,I,y,x,k,w;return _(e,[{key:"init",value:(w=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBusinessCommentView();case 2:return t=e.sent,this.base=new me,e.next=6,this.base.ctxFromHtml(t);case 6:this.graphql=new Rt({base:this.base,pageId:this.pageId,isBussiness:!0});case 7:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getPostHtml",value:(k=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:this.commentId,r="https://www.facebook.com/".concat(this.postId,"?comment_id=").concat(t),e.next=5,this.getHtmlCommentView(r);case 5:if(n=e.sent,a=n.response,s=n.html,this.stopCrawlRedirectPage||!a.url||a.url==r){e.next=22;break}if(o=new URL(a.url),i=o.searchParams,!(c=i.get("comment_id"))){e.next=19;break}return this.commentId=c,e.next=16,re(a.url);case 16:return e.abrupt("return",e.sent);case 19:case 22:return e.abrupt("return",s);case 20:e.next=23;break;case 23:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"getHtmlCommentView",value:(x=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t,{parseResponse:function(e){return e}});case 2:return r=e.sent,e.next=5,r.text();case 5:return n=e.sent,e.abrupt("return",{html:n,response:r});case 7:case"end":return e.stop()}}),e)}))),function(e){return x.apply(this,arguments)})},{key:"getFacebookInternalComment",value:(y=d(l.a.mark((function e(t,r){var n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,"");case 2:return n=e.sent,a=n.feedback_data,C.log("Post feed_back data",a),s=this.findTargetComment(a,r,!0),C.log("Comment node for comment ".concat(r),s),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"getPostFeedbackId",value:(I=d(l.a.mark((function e(){var t,r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("post:feedback_id:".concat(this.postId));case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,this.getPostHtml();case 7:return r=e.sent,n=A(r,'"feedback":')[0],e.next=11,L(n);case 11:return a=e.sent,X.setItem("post:feedback_id:".concat(this.postId),a.id),e.abrupt("return",a.id);case 14:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"send",value:(b=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=3;break}return e.next=3,this.init();case 3:return e.next=5,this.getPostHtml();case 5:return r=e.sent,e.next=8,this.loadCommentDocs();case 8:return e.next=10,this.getPostFeedbackId();case 10:if(s=e.sent,!(null===(t=this.mentions)||void 0===t?void 0:t.length)){e.next=19;break}return a=new ye({pageId:this.pageId,postId:this.postId,convId:this.conversationId}),e.next=15,a.init();case 15:return e.next=17,a.getComment();case 17:n=e.sent,C.log("send_comment - COMMENT_FOUND: ",n);case 19:return e.next=21,this.makeMessage({message:this.message,mentions:this.mentions,postHtml:r,commentNode:n,commentNormalInstance:a});case 21:if(o=e.sent,i={client_mutation_id:"8",actor_id:this.pageId,attachments:null,feedback_id:s,formatting_style:null,message:o,reply_target_clicked:!1,attribution_id_v2:"BusinessCometBizSuiteInboxRoot.react,bizkit.facebook,via_cold_start,".concat((new Date).getTime(),",892503,,,"),vod_video_timestamp:null,is_tracking_encrypted:!0,tracking:[],feedback_source:"BUSINESS_COMMENT_INBOX_TAB",idempotence_token:"client:"+we(),session_id:we()},this.commentId&&(i.reply_target_clicked=!0,i.reply_comment_parent_fbid=this.hashFbCommentId(this.originalCommentId),i.feedback_id=this.hashFbFeedbackId(this.originalCommentId)),!this.photoUrl){e.next=29;break}return e.next=27,this.upload(this.photoUrl);case 27:c=e.sent,i.attachments=[{media:{id:c}}];case 29:return this.stickerId&&(i.attachments=[{media:{id:this.stickerId}}]),u={feedLocation:"BUSINESS_COMMENT_INBOX_TAB",feedbackSource:107,groupID:null,input:i,inviteShortLinkKey:null,renderLocation:null,scale:2,useDefaultActor:!1,focusCommentID:null,__relay_internal__pv__IsWorkUserrelayprovider:!1},e.prev=31,e.next=34,this.graphql.graphql(rt,u,{__aaid:0,__ccg:"GOOD",__comet_req:11,__jssesw:1,server_timestamps:!0},!1,(function(e){return e.json()}));case 34:return p=e.sent,e.abrupt("return",{success:!0,message_id:p.data.comment_create.feedback_comment_edge.node.legacy_fbid,timestamp:p.data.comment_create.feedback_comment_edge.node.created_time});case 38:return e.prev=38,e.t0=e.catch(31),e.abrupt("return",{success:!1});case 41:case"end":return e.stop()}}),e,this,[[31,38]])}))),function(){return b.apply(this,arguments)})},{key:"hashFbCommentId",value:function(e){var t="comment:".concat(e);return btoa(t)}},{key:"hashFbFeedbackId",value:function(e){var t="feedback:".concat(e);return btoa(t)}},{key:"getBusinessCommentView",value:(g=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://business.facebook.com/latest/inbox/facebook?asset_id=".concat(this.pageId,"&mailbox_id=&thread_type=FB_PAGE_POST"),e.next=3,re(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"loadCommentDocs",value:(m=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(At.has(Et)&&At.has(rt)&&At.has(nt)){e.next=33;break}if(t=[],At.has(bt)||t.push(bt),At.has(xt)||t.push(xt),!t.length){e.next=10;break}return e.next=7,this.getBusinessCommentView();case 7:return r=e.sent,e.next=10,At.loadDocIdsFromView({html:r,docNames:t});case 10:return e.next=12,this.firstCommentItemId();case 12:return n=e.sent,e.next=15,this.focusCommentId();case 15:if(a=e.sent,n&&a){e.next=24;break}return y={pageID:this.pageId,count:20,cursor:null,filterType:null,filterIsReadStatus:null,filterOwnerID:null,filterStatus:"TODO",platformFilter:"FACEBOOK",isHighlightedComment:!1,isStarsComment:!1},e.next=20,this.graphql.graphql(bt,y,{__aaid:0,__ccg:"EXCELLENT",__comet_req:11,__jssesw:1,server_timestamps:!0},!1,(function(e){return e.text()}));case 20:x=e.sent,n=null==x||null===(s=x.data)||void 0===s||null===(o=s.page)||void 0===o||null===(i=o.business_comm_items)||void 0===i||null===(c=i.edges)||void 0===c||null===(u=c[0])||void 0===u||null===(p=u.node)||void 0===p?void 0:p.id,a=(null==x||null===(d=x.data)||void 0===d||null===(f=d.page)||void 0===f||null===(h=f.business_comm_items)||void 0===h||null===(v=h.edges)||void 0===v||null===(_=v[0])||void 0===_||null===(m=_.node)||void 0===m||null===(g=m.page_comm_item_parts)||void 0===g||null===(b=g.nodes)||void 0===b||null===(I=b[0])||void 0===I?void 0:I.comm_source_id)||null,C.log("GET_FIRST_COMMENT_ID_FOR_LOAD_DOC:",n,a);case 24:return k={commItemID:n,feedLocation:"BUSINESS_COMMENT_INBOX_TAB",feedbackSource:107,focusCommentID:a,privacySelectorRenderLocation:"BUSINESS_COMMENT_INBOX_TAB",scale:1,useDefaultActor:!1,renderLocation:"business_comment_inbox_tab",__relay_internal__pv__CometImmersivePhotoCanUserDisable3DMotionrelayprovider:!1,__relay_internal__pv__IsWorkUserrelayprovider:!1,__relay_internal__pv__IsMergQAPollsrelayprovider:!1,__relay_internal__pv__CometUFIReactionsEnableShortNamerelayprovider:!1,__relay_internal__pv__CometUFIShareActionMigrationrelayprovider:!0,__relay_internal__pv__IncludeCommentWithAttachmentrelayprovider:!0,__relay_internal__pv__StoriesArmadilloReplyEnabledrelayprovider:!1,__relay_internal__pv__EventCometCardImage_prefetchEventImagerelayprovider:!1,__relay_internal__pv__FBReelsMediaFooter_comet_enable_reels_ads_gkrelayprovider:!1,__relay_internal__pv__GHLShouldChangeAdIdFieldNamerelayprovider:!1,__relay_internal__pv__GHLShouldChangeSponsoredDataFieldNamerelayprovider:!1},e.next=27,this.graphql.graphql(xt,k,{__aaid:0,__ccg:"GOOD",__comet_req:11,__jssesw:1,server_timestamps:!0},!1,(function(e){return null==e?void 0:e.text()}));case 27:return w=e.sent,e.next=30,L(A(w,'"rsrcMap":')[0]);case 30:return S=e.sent,e.next=33,At.loadDocIdsFromView({html:JSON.stringify(w),extraResourceMap:S,docNames:[at,Et,rt,nt]});case 33:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"edit",value:(v=d(l.a.mark((function e(t,r){var n,a,s,o,i,c,u,p,d,f,h,v,_,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stopCrawlRedirectPage=!0,this.initialized){e.next=4;break}return e.next=4,this.init();case 4:return n=this.hashFbCommentId(this.commentId),C.log("internal_comment_id:",n,this.commentId),e.next=8,this.loadCommentDocs();case 8:if(!n){e.next=23;break}if(!(null===(a=this.attachments)||void 0===a||null===(s=a.filter((function(e){return"photo"==(null==e?void 0:e.type)})))||void 0===s?void 0:s.length)){e.next=14;break}return v=null===(d=this.attachments)||void 0===d||null===(f=d.filter((function(e){return"photo"==(null==e?void 0:e.type)})))||void 0===f||null===(h=f[0])||void 0===h?void 0:h.url,e.next=13,this.upload(v);case 13:p=e.sent;case 14:return _={feedLocation:"BUSINESS_COMMENT_INBOX_TAB",scale:2,useDefaultActor:!1,input:{client_mutation_id:"4",actor_id:this.pageId,attachments:null,attribution_id_v2:"BusinessCometBizSuiteInboxRoot.react,bizkit.facebook",comment_id:n,formatting_style:"PLAIN_TEXT",message:{ranges:[],text:this.message},tracking:[]}},p&&(_.input.attachments=[{media:{id:p}}]),e.next=18,this.graphql.graphql(Et,_,{__aaid:0,__comet_req:11,__jssesw:1,server_timestamps:!0});case 18:m=e.sent,C.log("RESPONSE EDIT COMMENT:",m),(null==m||null===(o=m.data)||void 0===o||null===(i=o.comment_edit)||void 0===i?void 0:i.comment)?t(null==m||null===(c=m.data)||void 0===c||null===(u=c.comment_edit)||void 0===u?void 0:u.comment):r(),e.next=24;break;case 23:r();case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"upload",value:(f=d(l.a.mark((function e(t){var r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(t,{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 2:return r=e.sent,e.next=5,CCake.getInboxNormal(this.pageId);case 5:return n=e.sent,a={av:this.pageId,profile_id:this.pageId,source:19,target_id:this.pageId},Object.assign(a,n.base.buildParams()),delete a.cquick,delete a.cquick_token,delete a.ctarget,(s=new FormData).append("file",r),e.next=15,ae("https://www.facebook.com/ajax/ufi/upload",s,a,{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 15:return o=e.sent,o=n.base.parseFbRes(o),e.abrupt("return",o.payload.fbid);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"makeMessage",value:(p=d(l.a.mark((function e(t){var r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.message,n=t.mentions,a=t.commentNode,s=t.commentNormalInstance,!n||!a){e.next=5;break}return e.next=4,this.fillGlobalIdMention(a,n,s);case 4:n=e.sent;case 5:if(n){e.next=7;break}return e.abrupt("return",{ranges:[],text:r});case 7:return e.next=9,this.getGlobalIdForMentions(n);case 9:if(o=e.sent){e.next=12;break}return e.abrupt("return",null);case 12:return i=o.map((function(e){return{entity:{id:e.global_id},length:e.length,offset:e.offset}})),e.abrupt("return",{ranges:i,text:r});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"fillGlobalIdMention",value:(u=d(l.a.mark((function e(t,r,n){var a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=n?n.getAllComments():[],r=r.map((function(e){var r,n,a,s;if(e.global_id)return e;var o=null==e||null===(r=e.commentId)||void 0===r?void 0:r.split("_")[1];return(null==t||null===(n=t.node)||void 0===n?void 0:n.legacy_fbid)==o?c(c({},e),{},{global_id:null==t||null===(a=t.node)||void 0===a||null===(s=a.author)||void 0===s?void 0:s.id}):e})),!(r=(null===(a=s)||void 0===a?void 0:a.length)>0?r.map((function(e){var t,r,n;if(null==e?void 0:e.global_id)return e;var a=null==e||null===(t=e.commentId)||void 0===t?void 0:t.split("_")[1],o=s.find((function(e){var t;return(null==e||null===(t=e.node)||void 0===t?void 0:t.legacy_fbid)==a}));return o?c(c({},e),{},{global_id:null==o||null===(r=o.node)||void 0===r||null===(n=r.author)||void 0===n?void 0:n.id}):e})):r).find((function(e){return!e.global_id}))){e.next=13;break}return i=new ye({pageId:this.pageId,postId:this.postId,convId:null===(o=r[0])||void 0===o?void 0:o.commentId}),e.next=9,i.init();case 9:return e.next=11,i.getComment();case 11:s=i.getAllComments()||[],r=r.map((function(e){try{var t,r,n;if(null==e?void 0:e.global_id)return e;var a=null==e||null===(t=e.commentId)||void 0===t?void 0:t.split("_")[1],o=s.find((function(e){var t;return(null==e||null===(t=e.node)||void 0===t?void 0:t.legacy_fbid)==a}));return o?c(c({},e),{},{global_id:null==o||null===(r=o.node)||void 0===r||null===(n=r.author)||void 0===n?void 0:n.id}):e}catch(t){return console.log(t),e}}));case 13:return e.abrupt("return",r);case 16:return e.prev=16,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e,t,r){return u.apply(this,arguments)})},{key:"getGlobalIdForMentions",value:(i=d(l.a.mark((function e(t){var r,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.map(function(){var e=d(l.a.mark((function e(t){var r,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.global_id){e.next=2;break}return e.abrupt("return",t);case 2:return r=t.commentId.split("_")[1],e.next=5,n.getPostHtml(r);case 5:return a=e.sent,e.next=8,n.getFacebookInternalComment(a,r);case 8:return s=e.sent,e.abrupt("return",Object.assign({},t,{global_id:s.node.author.id}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(r));case 5:return e.prev=5,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return i.apply(this,arguments)})},{key:"privateReply",value:(s=d(l.a.mark((function e(){var t,r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=3;break}return e.next=3,this.init();case 3:return t=this.hashFbFeedbackId(this.commentId),e.next=6,this.loadCommentDocs();case 6:return r={input:{activity_id:this.commentId,feedback_id:t,message_body:this.message,actor_id:this.pageId,client_mutation_id:"1",feedback_source:null}},e.prev=7,n=(new Date).getTime(),e.next=11,this.graphql.graphql(at,r);case 11:if(a=e.sent,s=(new Date).getTime(),!(a.errors&&a.errors.length>0)){e.next=16;break}return o=a.errors[0],e.abrupt("return",{success:!1,message:o.description});case 16:return e.abrupt("return",{success:!0,messageCreatedRange:[n,s]});case 19:return e.prev=19,e.t0=e.catch(7),console.log("error",e.t0),e.abrupt("return",{success:!1});case 23:case"end":return e.stop()}}),e,this,[[7,19]])}))),function(){return s.apply(this,arguments)})},{key:"removeComment",value:(a=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=3;break}return e.next=3,this.init();case 3:return e.next=5,this.getPostHtml();case 5:return e.sent,e.next=8,this.loadCommentDocs();case 8:return e.prev=8,t={input:{comment_id:this.hashFbCommentId(this.commentId),remove_location:"MENU",actor_id:this.pageId,client_mutation_id:"1"},scale:1},e.next=12,this.graphql.graphql(nt,t);case 12:if(!(r=e.sent).errors){e.next=17;break}return e.abrupt("return",{success:!1,message:r.errors[0].message});case 17:return e.abrupt("return",{success:!0});case 18:e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(8),e.abrupt("return",{success:!1,message:e.t0.toString()});case 23:case"end":return e.stop()}}),e,this,[[8,20]])}))),function(){return a.apply(this,arguments)})}],[{key:"get_SEND_COMMENT_DOC_NAME",value:(n=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye.getHtmlBusinessCommentsView(t);case 2:return r=e.sent,n=r.html,e.next=6,At.loadDocIdsFromView({html:n,docNames:[rt]});case 6:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"getListJsToLoad",value:(r=d(l.a.mark((function e(t,r){var n,a,s,o,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r,e.next="normalComment"===e.t0?3:"privateReply"===e.t0?25:32;break;case 3:n=A(t,"loadResources("),a=[],s=xe(n),e.prev=6,s.s();case 8:if((o=s.n()).done){e.next=16;break}return i=o.value,e.next=12,L(i);case 12:c=e.sent,a=a.concat(c);case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(6),s.e(e.t1);case 21:return e.prev=21,s.f(),e.finish(21);case 24:return e.abrupt("return",a);case 25:if(u=A(t,'"CometUFICommentPrivateReplyDialog.react":')[0]){e.next=28;break}return e.abrupt("return",null);case 28:return e.next=30,L(u);case 30:return p=e.sent,e.abrupt("return",p.rds.r);case 32:case"end":return e.stop()}}),e,null,[[6,18,21,24]])}))),function(e,t){return r.apply(this,arguments)})},{key:"isProfilePage",value:(t=d(l.a.mark((function t(r){var n,a,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r in e.profilePages)){t.next=2;break}return t.abrupt("return",e.profilePages[r]);case 2:return t.next=4,re("https://www.facebook.com/".concat(r));case 4:return n=t.sent,a=n.match(/"delegatePageID":(?:null|"(\d+)")/),(s=a&&a[1])?C.log("PAGE ".concat(r," IS PROFILE PAGE. DELEGATE PAGE ").concat(s)):C.log("PAGE ".concat(r," IS NOT PROFILE PAGE"),r),o=!(!s||s!==r),e.profilePages[r]=o,t.abrupt("return",o);case 11:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]),e}();o(Se,"profilePages",{}),self.Comment=Se;var Ee=Se,Ce=function(){function e(t){var r=t.pageId;h(this,e),this.pageId=r}var t,r,n,a,o;return _(e,[{key:"init",value:function(){var e=this;return new Promise(function(){var t=d(l.a.mark((function t(r,n){var a,s,o,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getHtmlByUIVersion(6);case 3:if(a=t.sent,s=a.html,o=a.response,!s||!(null==s?void 0:s.includes("Bạn tạm thời bị chặn"))){t.next=14;break}return t.next=9,e.getHtmlByUIVersion(7);case 9:if(i=t.sent,c=i.html,i.response,!c||(null==c?void 0:c.includes("Bạn tạm thời bị chặn"))){t.next=14;break}return t.abrupt("return",r(7));case 14:return t.next=16,e.isRedirectedToVerion6(o);case 16:if(!t.sent){t.next=18;break}return t.abrupt("return",r(6));case 18:return t.next=20,e.isRedirectedToVerion5(o);case 20:if(!t.sent){t.next=22;break}return t.abrupt("return",r(5));case 22:return t.next=24,e.isRedirectedToVerion4(o);case 24:if(!t.sent){t.next=26;break}return t.abrupt("return",r(4));case 26:return t.next=28,e.isReturnErrorView(s);case 28:if(!t.sent){t.next=30;break}return t.abrupt("return",r(1));case 30:return t.abrupt("return",r(3));case 33:return t.prev=33,t.t0=t.catch(0),console.log("error",t.t0),t.abrupt("return",n());case 37:case"end":return t.stop()}}),t,null,[[0,33]])})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"isReturnErrorView",value:(o=d(l.a.mark((function e(t){var r,n,a,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=A(t,'{"__dr":"CometErrorRoot.react"},"props":'),n=s(r,1),!(a=n[0])){e.next=6;break}if(!JSON.parse(a).title){e.next=6;break}return e.abrupt("return",!0);case 6:o=0,i=["Rất tiếc, nội dung này hiện không khả dụng","Sorry, this content isn&#039;t available right now"];case 8:if(!(o<i.length)){e.next=15;break}if(c=i[o],!t.includes(c)){e.next=12;break}return e.abrupt("return",!0);case 12:o++,e.next=8;break;case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"isRedirectedToVerion5",value:(a=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.url.includes("web.facebook.com"));case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"isRedirectedToVerion4",value:(n=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.url.includes("business.facebook.com"));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"isRedirectedToVerion6",value:(r=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.url.includes("https://business.facebook.com/latest/inbox/messenger"));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"getHtmlByUIVersion",value:(t=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.makeUrl(t),self.externalGraphLog&&externalGraphLog.log(this.pageId,"getHtmlByUIVersion_check_ui_version"),e.next=4,re(r,{parseResponse:function(e){return e}});case 4:return n=e.sent,e.next=7,n.text();case 7:return a=e.sent,e.abrupt("return",{html:a,response:n});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"makeUrl",value:function(e){switch(e){case 1:return"https://www.facebook.com/".concat(this.pageId,"/inbox");case 2:return"https://business.facebook.com/".concat(this.pageId,"/inbox");case 3:return"https://www.facebook.com/latest/inbox/all?asset_id=".concat(this.pageId,"&nav_ref=diode_page_inbox&mailbox_id=").concat(this.pageId);case 4:return"https://business.facebook.com/latest/inbox/all?asset_id=".concat(this.pageId,"&nav_ref=diode_page_inbox&mailbox_id=").concat(this.pageId);case 5:return"https://web.facebook.com/".concat(this.pageId,"/inbox");case 6:return"https://business.facebook.com/latest/inbox/messenger?asset_id=".concat(this.pageId,"&nav_ref=diode_page_inbox");case 7:return"https://business.facebook.com/latest?asset_id=".concat(this.pageId)}}},{key:"loadResource",value:function(e){}}]),e}(),Te="fb_ui_version",Ae=new(function(){function e(){h(this,e),this.check=F(this.check),this.retrieveFromStorage=F(this.retrieveFromStorage)}var t,r,n,a;return _(e,[{key:"set",value:function(){var e=d(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.success("SET TO VERSION ".concat(r," - PAGE ID ").concat(t)),e.next=3,this.persistData(t,r);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.retrieveFromStorage();case 2:if(r=e.sent,!(n=r[t])){e.next=6;break}return e.abrupt("return",Promise.resolve(n));case 6:return e.abrupt("return",this.check(t).catch((function(e){return C.error("FAIL TO CHECK UI VERSION",e),1})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAll",value:(a=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.retrieveFromStorage();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"retrieveFromStorage",value:(n=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X.getItem(Te);case 3:if(!(t=e.sent)){e.next=9;break}return r=JSON.parse(t),e.abrupt("return",r||{});case 9:return e.abrupt("return",{});case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{});case 15:case"end":return e.stop()}}),e,null,[[0,12]])}))),function(){return n.apply(this,arguments)})},{key:"persistData",value:(r=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.retrieveFromStorage();case 3:return(n=e.sent)[t]=r,e.next=7,X.setItem(Te,JSON.stringify(n));case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t){return r.apply(this,arguments)})},{key:"check",value:(t=d(l.a.mark((function e(t){var r,n,a,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.retrieveFromStorage();case 2:if(r=e.sent,!(n=r[t])){e.next=6;break}return e.abrupt("return",Promise.resolve(n));case 6:return a=new Ce({pageId:t}),e.abrupt("return",a.init().then(function(){var e=d(l.a.mark((function e(r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.set(t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}());self.PageFacebookUIVersion=Ae;var Re=Ae,Le={},Ne=function(){function e(t){var r=t.pageId,n=t.timeRangeMin,a=t.maxThreadCount;h(this,e),this.pageId=r,this.timeRangeMin=n,this.maxThreadCount=a||250}var t,r;return _(e,[{key:"init",value:(r=d(l.a.mark((function e(){var t,r,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(new Date).getTime(),At.get(et,tt)){e.next=3;break}return e.abrupt("return",Promise.reject("Missing doc_id ".concat(et," or ").concat(tt)));case 3:if(!Le[this.pageId]){e.next=5;break}return e.abrupt("return",Promise.reject("There is a running job"));case 5:return Le[this.pageId]=!0,e.prev=6,e.delegateYield(l.a.mark((function e(){var r,a,o,i,u,p,d,f,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,CCake.getInboxNormal(n.pageId);case 2:r=e.sent,n.graphQLInstance=new Rt({pageId:n.pageId,base:r.base}),o={},i=0,u=null;case 7:return p=50,n.maxThreadCount&&n.maxThreadCount-i<50&&(p=n.maxThreadCount-i),e.next=12,n.getFacebookThreads(a,p);case 12:if(d=e.sent,i+=d.length,d.forEach((function(e){var t=s(n.extractGlobalId(e),2),r=t[0],a=t[1];o[r]=a})),0!==d.length){e.next=18;break}return u="There's no thread left",e.abrupt("break",28);case 18:if(!(null!=n.maxThreadCount&&i>n.maxThreadCount)){e.next=21;break}return u="Reach max thread count",e.abrupt("break",28);case 21:if(f=parseInt(d[d.length-1].updated_time_precise),!(null!=n.timeRangeMin&&f<n.timeRangeMin)){e.next=25;break}return u="Reach min time range",e.abrupt("break",28);case 25:a=f-1,e.next=7;break;case 28:return h=(new Date).getTime(),C.log("BATCH GET GLOBAL ID STATS:\n        - Threads loaded: ".concat(i,"\n        - Duration: ").concat(h-t,"ms\n        - Terminate reason: ").concat(u)),e.abrupt("return",{v:Object.entries(o).map((function(e){var t=s(e,2),r=t[0];return c(c({},t[1]),{},{threadId:r})}))});case 31:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:if("object"!==f(r=e.t0)){e.next=11;break}return e.abrupt("return",r.v);case 11:return e.prev=11,Le[this.pageId]=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[6,,11,14]])}))),function(){return r.apply(this,arguments)})},{key:"extractGlobalId",value:function(t){var r=e.isAllActorArePage(t);if(r){var n=t.thread_key.other_user_id;return[n,{globalId:n,updatedAt:parseInt(t.updated_time_precise),isCustomerUsePageRole:r}]}return[t.page_comm_item.id||t.page_comm_item.comm_source_id,{globalId:t.thread_key.other_user_id,updatedAt:parseInt(t.updated_time_precise)}]}},{key:"getFacebookThreads",value:(t=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.graphQLInstance.graphqlbatch({batchName:"MessengerGraphQLThreadlistFetcher",graphqlQueries:[{doc_id:At.get(et,tt),query_params:{limit:r,before:t,tags:["INBOX"],isWorkUser:!1,includeDeliveryReceipts:!0,includeSeqID:!1,is_work_teamwork_not_putting_muted_in_unreads:!1,threadlistViewFieldsOnly:!1}}]});case 2:return n=e.sent,e.prev=3,e.abrupt("return",n[0].data.viewer.message_threads.nodes);case 7:return e.prev=7,e.t0=e.catch(3),C.error("MALFORMED LOAD THREADS RESPONSE",e.t0),e.abrupt("return",Project.reject());case 11:case"end":return e.stop()}}),e,this,[[3,7]])}))),function(e,r){return t.apply(this,arguments)})}],[{key:"isAllActorArePage",value:function(e){var t,r,n;return 2==(null==e||null===(t=e.all_participants)||void 0===t||null===(r=t.edges)||void 0===r?void 0:r.length)&&!(null==e||null===(n=e.all_participants)||void 0===n?void 0:n.edges.find((function(e){var t,r;return"Page"!=(null==e||null===(t=e.node)||void 0===t||null===(r=t.messaging_actor)||void 0===r?void 0:r.__typename)})))}}]),e}();function Oe(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}self.BatchGetGlobalId=Ne;var De=function(e){try{var t="findThreadByUsername_".concat(e);return self[t]||!1}catch(e){return console.log("Error GetEnableFindThreadByUsername",e),!1}},Ue={},Be=new Map,Fe=function(){function e(t){var r=t.pageId,n=t.postId,a=t.convId,s=t.convType,o=t.threadId,i=t.threadKey,c=t.isBusiness,u=t.conversationUpdatedTime,l=t.customerName,p=t.accessToken,d=t.allowSearchByName;h(this,e),this.pageId=r,this.postId=n,this.convId=a,this.convType=s,this.threadId=o,this.threadKey=i,this.conversationUpdatedTime=u,this.isBusiness=c,this.customerName=l,this.pageAccessToken=p,this.allowSearchByName=d}var t,r,n,a,s;return _(e,[{key:"init",value:function(){var e=this;return new Promise(function(){var t=d(l.a.mark((function t(r,n){var a,s,o,i,c,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,a={},t.t0=e.convType,t.next="INBOX"===t.t0?5:"COMMENT"===t.t0?7:(t.t0,9);break;case 5:return a=e.getGlobalIdFromInbox(),t.abrupt("break",10);case 7:return a=e.getGlobalIdFromLiveComment(),t.abrupt("break",10);case 9:a=e.getGlobalIdFromComment();case 10:return t.next=12,a;case 12:if(s=t.sent,o=s.success,i=s.globalId,c=s.threadInfoToRecheck,u=!0===De(e.pageId),"INBOX"!==e.convType||e.isThreadCorrect(c)||u){t.next=20;break}return C.error("FAIL TO GET GLOBAL ID --\x3e INCORRECT THREAD ".concat(e.threadId,", ").concat(e.threadKey," VS ").concat(c)),t.abrupt("return",n("INCORRECT THREAD"));case 20:o?r(i):(C.error("FAIL TO GET GLOBAL ID"),n()),t.next=28;break;case 23:t.prev=23,t.t1=t.catch(0),console.log("error",t.t1),C.error("FAIL TO GET GLOBAL ID","Reason: ".concat(t.t1)),n();case 28:case"end":return t.stop()}}),t,null,[[0,23]])})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"getGlobalIdFromInbox",value:(s=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S=this,E=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.length>0&&void 0!==E[0]&&E[0],e.next=3,CCake.getInboxNormal(this.pageId);case 3:if(r=e.sent,n=new Rt({pageId:this.pageId,base:self.not_using_current_base?null:r.base}),a=function(){return S.getGlobalIdFromInbox(!0)},!t&&At.isFeatureReady("inbox")){e.next=9;break}return e.next=9,Bt.preloadDocIds({pageId:this.pageId,isBusiness:this.isBusiness});case 9:if(!At.get($e)||!this.threadId){e.next=21;break}return e.next=12,n.graphql($e,{pageID:this.pageId,commItemID:this.threadId});case 12:if(s=e.sent,C.log("PagesManagerInboxAdminAssignerRootQuery response",s),!(s&&s.data&&s.data.commItem&&s.data.commItem.target_id)){e.next=18;break}return e.abrupt("return",{success:!0,globalId:s.data.commItem.target_id,threadInfoToRecheck:s.data.commItem.id});case 18:o=s.errors&&s.errors[0],i=o&&"Rate limit exceeded"===o.message,t||i||At.delete($e);case 21:if(C.error("CANNOT GET GLOBAL ID WITH PagesManagerInboxAdminAssignerRootQuery"),!(At.get(Ze)&&r.cquick_token&&this.threadKey)){e.next=37;break}return c={cquick:"jsc_c_d",cquick_token:r.cquick_token,ctarget:"https%3A%2F%2Fwww.facebook.com",av:"".concat(this.pageId)},e.next=26,n.graphql(Ze,{pageID:this.pageId,messageThreadID:this.threadKey},c);case 26:if(u=e.sent,C.log("PagesManagerInboxQueryUtilCommItemHeaderMercuryQuery response",u),!(u&&u.data.page&&u.data.page.page_comm_item_for_message_thread&&u.data.page.page_comm_item_for_message_thread.target_id)){e.next=32;break}return e.abrupt("return",{success:!0,globalId:u.data.page.page_comm_item_for_message_thread.target_id,threadInfoToRecheck:u.data.page.page_comm_item_for_message_thread.comm_source_id});case 32:if(p=u.errors&&u.errors[0],d=p&&"Rate limit exceeded"===p.message,t||d){e.next=37;break}return At.delete(Ze),e.abrupt("return",a());case 37:if(C.error("CANNOT GET GLOBAL ID WITH PagesManagerInboxQueryUtilCommItemHeaderMercuryQuery"),!At.get(et,tt)||!this.threadId&&!this.customerName){e.next=49;break}return e.next=41,this.findThread({customerName:this.customerName,threadId:this.threadId,graphQLInstance:n,timeCursor:this.conversationUpdatedTime+6e4});case 41:if(I=e.sent,y=this.convId?null===(f=this.convId)||void 0===f?void 0:f.replace("".concat(this.pageId,"_"),""):null,(x=Ne.isAllActorArePage(I))?this.threadId=(null==I||null===(h=I.page_comm_item)||void 0===h?void 0:h.id)||y||this.threadId:this.threadId||(this.threadId=null==I||null===(v=I.page_comm_item)||void 0===v?void 0:v.id),C.log("USER THREAD FOUND",I),k=x?[(null==I||null===(_=I.page_comm_item)||void 0===_?void 0:_.id)||y,null==I||null===(m=I.page_comm_item)||void 0===m?void 0:m.comm_source_id]:[null==I||null===(g=I.page_comm_item)||void 0===g?void 0:g.id,null==I||null===(b=I.page_comm_item)||void 0===b?void 0:b.comm_source_id],!I){e.next=49;break}return e.abrupt("return",{success:!0,globalId:this.globalIdFromThread(I),threadInfoToRecheck:k});case 49:return e.next=51,this.getUserInboxByName(n);case 51:if(!(w=e.sent)){e.next=55;break}return C.log("FOUND THREAD BY NAME: ",w),e.abrupt("return",w);case 55:return e.abrupt("return",{success:!1});case 56:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getUserInboxByName",value:(a=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p,d,f,h,v,_,m,g,b,I;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(At.get(it)){e.next=12;break}return r="https://business.facebook.com/latest/inbox/messenger?asset_id=".concat(this.pageId,"&mailbox_id=&thread_type=FB_MESSAGE"),self.externalGraphLog&&externalGraphLog.log(this.pageId,"getUserInboxByName_get_global_id"),e.next=5,re(r);case 5:return n=e.sent,e.next=8,Bt.getExtraJsFilesToLoad(n);case 8:return a=e.sent,s=[it],e.next=12,At.loadDocIdsFromView({html:n,docNames:s,extraResource:a});case 12:if(!At.get(it)||!this.customerName){e.next=22;break}return u=this.threadId,e.next=16,t.graphql(it,{pageID:this.pageId,channel:"MESSENGER",count:5,cursor:null,searchTerm:this.customerName,selectedIgAssetId:null});case 16:if(p=e.sent,d=(null==p||null===(o=p.data)||void 0===o||null===(i=o.page)||void 0===i||null===(c=i.page_unified_customer_search)||void 0===c?void 0:c.edges)||[],!(f=d.find((function(e){var t,r,n;return null==e||null===(t=e.node)||void 0===t||null===(r=t.unified_contact_comms_facebook)||void 0===r||null===(n=r.edges)||void 0===n?void 0:n.find((function(e){var t;return(null==e||null===(t=e.node)||void 0===t?void 0:t.id)==u}))})))){e.next=22;break}return I=null==f||null===(h=f.node)||void 0===h||null===(v=h.unified_contact_comms_facebook)||void 0===v||null===(_=v.edges)||void 0===_?void 0:_.find((function(e){var t;return(null==e||null===(t=e.node)||void 0===t?void 0:t.id)==u})),e.abrupt("return",{success:!0,globalId:null==I||null===(m=I.node)||void 0===m?void 0:m.target_id,threadInfoToRecheck:[null==I||null===(g=I.node)||void 0===g?void 0:g.target_id,null==I||null===(b=I.node)||void 0===b?void 0:b.id]});case 22:return e.abrupt("return",null);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"findThread",value:(n=d(l.a.mark((function e(t){var r,n,a,s,o,i,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S,E,T,A,R,L,N,O,P=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.threadId,n=t.customerName,a=t.graphQLInstance,s=t.timeCursor,o=t.originTimeCursor,i=void 0===o?s:o,u=t.count,p=void 0===u?0:u,d=t.category,f=void 0===d?"main":d,h=t.isLoadWithCursorNow,v=this.threadCacheKey(r),!Be.has(v)){e.next=5;break}return C.success("FOUND THREAD IN CACHE. KEY: ".concat(v)),e.abrupt("return",Be.get(v));case 5:e.t0=f,e.next="main"===e.t0?8:"done"===e.t0?10:"page_background"===e.t0?12:"spam"===e.t0?14:16;break;case 8:return _=["INBOX"],e.abrupt("break",18);case 10:return _=["ARCHIVED"],e.abrupt("break",18);case 12:return _=["PAGE_BACKGROUND"],e.abrupt("break",18);case 14:return _=["OTHER"],e.abrupt("break",18);case 16:return _=["INBOX","ARCHIVED"],e.abrupt("break",18);case 18:return(m=6e4*Math.round((new Date).getTime()/6e4))in Ue||(Ue[m]=0),Ue[m]++,e.next=23,a.graphqlbatch({batchName:"MessengerGraphQLThreadlistFetcher",graphqlQueries:[{doc_id:At.get(et,tt),query_params:{limit:20,tags:_,before:s,isWorkUser:!1,includeDeliveryReceipts:!0,includeSeqID:!1,is_work_teamwork_not_putting_muted_in_unreads:!1,threadlistViewFieldsOnly:!1}}]});case 23:if(g=e.sent,e.prev=24,k=g[0].data.viewer.message_threads.nodes,w=(null===(b=g[0])||void 0===b||null===(I=b.errors)||void 0===I?void 0:I.length)>0&&(!k||0==(null===(y=k)||void 0===y?void 0:y.length)),C.log("LOAD FACEBOOK THREADS SUCCESS (".concat(f,")"),k.map((function(e){try{return e.all_participants.edges[0].node.messaging_actor.name}catch(e){return null}}))),(k=k.map((function(e){return c(c({},e),{},{page_comm_item:e.page_comm_item||{}})}))).forEach((function(e){var t=e.page_comm_item.id;t&&Be.set(P.threadCacheKey(t),e)})),S=this.convId?null===(x=this.convId)||void 0===x?void 0:x.replace("".concat(this.pageId,"_"),""):null,!(E=k.find((function(e){if(Ne.isAllActorArePage(e)&&S)return e.all_participants.edges.map((function(e){return e.node.messaging_actor.id})).includes(S);if(r)return e.page_comm_item.id===r||e.page_comm_item.comm_source_id===r;if(n){var t=e.all_participants.edges.map((function(e){return e.node.messaging_actor.name}));return C.log("LOOKING FOR ".concat(n," in"),t),t.includes(n)}})))&&n&&De(this.pageId)&&(E=k.find((function(e){var t=e.all_participants.edges.map((function(e){return e.node.messaging_actor.name}));return C.log("LOOKING FOR ".concat(n," in"),t),t.includes(n)})),C.log("THREAD FOUND BY MATCHING USER NAME:",E)),T=p<200&&k.length&&20==k.length&&!w,A="main"===f&&!w,R="done"===f&&!w,L="page_background"===f&&!w,N="spam"===f&&!h&&!w,!E){e.next=42;break}return e.abrupt("return",E);case 42:if(!T){e.next=47;break}return O=k[k.length-1],e.abrupt("return",this.findThread(c(c({},t),{},{timeCursor:O.updated_time_precise,originTimeCursor:i,count:p+k.length,isLoadWithCursorNow:h})));case 47:if(!A){e.next=52;break}return C.log("SWITCHING THREAD CATEGORY TO DONE"),e.abrupt("return",this.findThread(c(c({},t),{},{category:"done",timeCursor:i,originTimeCursor:i,count:0,isLoadWithCursorNow:h})));case 52:if(!R){e.next=57;break}return C.log("SWITCHING THREAD CATEGORY TO PAGE BACKGROUND"),e.abrupt("return",this.findThread(c(c({},t),{},{category:"page_background",timeCursor:i,originTimeCursor:i,count:0,isLoadWithCursorNow:h})));case 57:if(!L){e.next=62;break}return C.log("SWITCHING THREAD CATEGORY TO SPAM"),e.abrupt("return",this.findThread(c(c({},t),{},{category:"spam",timeCursor:i,originTimeCursor:i,count:0,isLoadWithCursorNow:h})));case 62:if(!N){e.next=64;break}return e.abrupt("return",this.findThread(c(c({},t),{},{category:"main",timeCursor:(new Date).valueOf(),originTimeCursor:i,count:0,isLoadWithCursorNow:!0})));case 64:e.next=70;break;case 66:return e.prev=66,e.t1=e.catch(24),C.error("MALFORM THREAD LIST RESPONSE",e.t1),e.abrupt("return",null);case 70:case"end":return e.stop()}}),e,this,[[24,66]])}))),function(e){return n.apply(this,arguments)})},{key:"threadCacheKey",value:function(e){return"".concat(this.pageId,":").concat(e)}},{key:"globalIdFromThread",value:function(e){return e.thread_key.other_user_id}},{key:"getGlobalIdFromComment",value:(r=d(l.a.mark((function e(){var t,r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(this.makeUrl(),{headers:{Accept:"text/html"}});case 2:return t=e.sent,r=new Ee,n=this.convId.split("_")[1],e.next=7,r.getFacebookInternalComment(t,n);case 7:return a=e.sent,s=a.node.author.id,e.abrupt("return",s?{success:!0,globalId:s}:{success:!1});case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getGlobalIdFromLiveComment",value:(t=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,d,f,h,v,_,m,g,b,I,y,x=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.convId.split("_")[1],r=this.postId.split("_")[1],console.log("url_comment","https://m.facebook.com/".concat(r,"?comment_id=").concat(t)),e.next=6,re("https://m.facebook.com/".concat(r,"?comment_id=").concat(t),{headers:{Accept:"text/html"}});case 6:if(n=e.sent,a=n.match(/data-sigil="comment">.*?data-sigil="feed_story_ring(\d+)/)){e.next=43;break}if(e.prev=9,!(null==(s=A(n,'"comments":'))?void 0:s.length)){e.next=38;break}o=Oe(s),e.prev=13,o.s();case 15:if((i=o.n()).done){e.next=30;break}if(c=i.value,e.prev=17,v=JSON.parse(c),_=null==v||null===(u=v.edges)||void 0===u?void 0:u.find((function(e){var t;return(null==e||null===(t=e.node)||void 0===t?void 0:t.legacy_token)==x.convId})),C.log("comment_found_",_),!_||!(null==_||null===(p=_.node)||void 0===p||null===(d=p.author)||void 0===d?void 0:d.id)){e.next=23;break}return e.abrupt("return",{success:!0,globalId:null==_||null===(f=_.node)||void 0===f||null===(h=f.author)||void 0===h?void 0:h.id});case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(17),console.error("error process comment item",e.t0);case 28:e.next=15;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(13),o.e(e.t1);case 35:return e.prev=35,o.f(),e.finish(35);case 38:e.next=43;break;case 40:e.prev=40,e.t2=e.catch(9),console.error("Encounter Error while finding comment",e.t2);case 43:if(!a){e.next=47;break}return e.abrupt("return",{success:!0,globalId:a[1]});case 47:return e.prev=47,e.next=50,this.getGlobalIdFromComment();case 50:m=e.sent,e.next=56;break;case 53:e.prev=53,e.t3=e.catch(47),console.log("%cGetGlobalId: Encounter error while getGlobalIdFromLiveComment -> getGlobalIdFromComment","color: #D99E0B; font-weight: bold;",e.t3);case 56:if(!m){e.next=60;break}return e.abrupt("return",m);case 60:return I=new ye({pageId:this.pageId,convId:this.convId,postId:this.postId,pageAccessToken:this.pageAccessToken,convName:this.customerName,allowPrioritySearchByName:this.allowSearchByName}),e.next=63,I.init();case 63:return e.next=65,I.getComment();case 65:if(y=e.sent,C.log("COMMENT_FOUNDED",y),!y){e.next=69;break}return e.abrupt("return",{success:!0,globalId:null==y||null===(g=y.node)||void 0===g||null===(b=g.author)||void 0===b?void 0:b.id});case 69:e.next=74;break;case 71:e.prev=71,e.t4=e.catch(0),console.error("GetGlobalId: Encounter error while getGlobalIdFromLiveComment",e.t4);case 74:return e.abrupt("return",{success:!1});case 75:case"end":return e.stop()}}),e,this,[[0,71],[9,40],[13,32,35,38],[17,25],[47,53]])}))),function(){return t.apply(this,arguments)})},{key:"makeUrl",value:function(){var e=this.isBusiness?"business.facebook.com":"www.facebook.com";switch(this.convType){case"INBOX":return"https://".concat(e,"/").concat(this.pageId,"/inbox?selected_item_id=").concat(this.threadId);case"COMMENT":var t=this.convId.split("_")[1],r=this.postId.split("_")[1];return"https://".concat(e,"/").concat(r,"?comment_id=").concat(t);default:var n=this.convId.split("_")[1];return"https://".concat(e,"/").concat(this.postId,"?comment_id=").concat(n)}}},{key:"isThreadCorrect",value:function(e){return Array.isArray(e)||(e=[e]),!(0===e.length||e.every((function(e){return!e}))||!this.threadId)&&e.includes(this.threadId)}}]),e}();Fe.httpRequestCounter=Ue,self.GetGlobalId=Fe;var Me=function(){function e(t){var r=this,n=t.pageId,a=t.convId,s=t.convType,i=t.threadId,u=t.threadKey,p=t.isBusiness,f=t.globalUserId,v=t.product_ids;h(this,e),o(this,"init",d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.prepareDocId();case 2:case"end":return e.stop()}}),e)})))),o(this,"prepareDocId",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(At.isFeatureReady("sendCommerceProduct")){e.next=11;break}return C.warning("Fallback to load doc id from bootloader endpoint: SendFacebookShopProduct"),e.next=4,r.getBootleaderEndpoint();case 4:if(!(t=e.sent)){e.next=11;break}return e.next=8,r.getRsrcMap(t);case 8:return n=e.sent,e.next=11,At.loadDocIdsFromView({html:t,docNames:[st],extraResourceMap:n});case 11:case"end":return e.stop()}}),e)})))),o(this,"getBootleaderEndpoint",d(l.a.mark((function e(){var t,n,a,s,o,i,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="https://business.facebook.com/ajax/bootloader-endpoint/",e.next=4,CCake.getInboxNormal(r.pageId);case 4:for(i in n=e.sent,a=n.base.buildParams(),s=c(c({},a),{},{modules:"BizInboxLegacyDetailViewContainer.react",__aaid:0,__crn:"comet.bizweb.BusinessCometBizSuiteInboxAllMessagesRoute",__comet_req:11}),o=[],s)u=encodeURIComponent(i),p=encodeURIComponent(s[i]),o.push(u+"="+p);return o=o.join("&"),t=t+"?"+o,e.next=13,re(t);case 13:return e.abrupt("return",e.sent);case 16:return e.prev=16,e.t0=e.catch(0),console.error("Error on getBootleaderEndpoint:",e.t0),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))),o(this,"send",d(l.a.mark((function e(){var t,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,CCake.getInboxNormal(r.pageId);case 2:if(t=e.sent,n=new Rt({pageId:r.pageId,base:t.base,isBussiness:!0}),r.globalUserId){e.next=8;break}return e.next=7,r.getGlobalUserId();case 7:r.globalUserId=e.sent;case 8:if(!(r.product_ids.length<=5)){e.next=12;break}return e.abrupt("return",n.graphql(st,{input:{client_mutation_id:"5",actor_id:r.pageId,product_ids:r.product_ids,recipient_id:r.globalUserId}},{__ccg:"EXCELLENT",server_timestamps:!0}));case 12:for(a=[],s=0;s<r.product_ids.length;s+=5)o=r.product_ids.slice(s,s+5).filter((function(e){return!!e})),a=[].concat(S(a),[o]);return i=a.map((function(e){return new Promise((function(t,a){n.graphql(st,{input:{client_mutation_id:"5",actor_id:r.pageId,product_ids:e,recipient_id:r.globalUserId}},{__ccg:"EXCELLENT",server_timestamps:!0}).then(t(r.globalUserId)).catch((function(e){return a(e)}))}))})),e.abrupt("return",Promise.all(i));case 16:case"end":return e.stop()}}),e)})))),o(this,"sendSuccess",(function(e,t,n,a,s){var o=r;e.errors||e.error?o.sendInboxFail(e.errors||e.error,t,n,a,s)():t.port.postMessage({type:"REPLY_INBOX_PRODUCT_SUCCESS",taskId:n,pageId:a,convId:s,globalUserId:r.globalUserId,success:!0})})),o(this,"sendFail",(function(e,t,n,a){return function(s){console.log(s),e.port.postMessage({type:"REPLY_INBOX_PRODUCT_FAILURE",taskId:t,pageId:n,convId:a,error:s,success:!1,globalUserId:r.globalUserId})}})),this.pageId=n,this.convId=a,this.convType=s,this.threadId=i,this.threadKey=u,this.isBusiness=p,this.globalUserId=f,this.product_ids=v}var t,r,n;return _(e,[{key:"getRsrcMap",value:(n=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"rsrcMap":')[0]){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return n.apply(this,arguments)})},{key:"getGlobalUserId",value:function(){var e={pageId:this.pageId,threadId:this.threadId,threadKey:this.threadKey,isBusiness:!0,postId:null,convId:null,convType:"INBOX"};return new Fe(e).init()}}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.html,a=r.pageId,r.isBusiness,t.next=3,Bt.makeInboxViewUrl(a,!0);case 3:if(s=t.sent,self.externalGraphLog&&externalGraphLog.log(a,"preloadDocIds_send_faceboo_shop_product"),t.t0=n,t.t0){t.next=10;break}return t.next=9,re(s);case 9:t.t0=t.sent;case 10:return o=t.t0,t.t1=At,t.t2=o,t.t3=[st],t.next=16,e.getExtraJsFilesToLoad(o);case 16:return t.t4=t.sent,t.t5={html:t.t2,docNames:t.t3,extraResource:t.t4},t.next=20,t.t1.loadDocIdsFromView.call(t.t1,t.t5);case 20:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"PagesManagerInboxProductPickerButton.react":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n.r);case 10:return e.prev=10,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}();function Ge(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}self.SendFacebookShopProduct=Me;var He=function(){function e(t,r){h(this,e),o(this,"getActorFromSetting",(function(e){var t,r,n,a;return null==e||null===(t=e.__bbox)||void 0===t||null===(r=t.result)||void 0===r||null===(n=r.data)||void 0===n||null===(a=n.viewer)||void 0===a?void 0:a.actor})),this.pageId=t,this.base=null,this.graphql=null,this.html=null,this.targetToPersonalProfile=r,this.originProfile=null}var t,r,n,a,s,i,u;return _(e,[{key:"restoreOriginProfile",value:function(t){var r,n,a;this.originProfile&&(null===(r=this.originProfile)||void 0===r?void 0:r.id)&&(null===(n=this.originProfile)||void 0===n?void 0:n.id)!=this.pageId?(C.log("NEED RESTORE TO ORIGIN PROFILE"),e.startCheck(null===(a=this.originProfile)||void 0===a?void 0:a.id,(function(){t&&t()}),!1,!0)):C.log("DONT NEED TO RESTORE TO ORIGIN PROFILE")}},{key:"init",value:(u=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkValidProfile();case 2:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"checkValidProfile",value:(i=d(l.a.mark((function t(){var r,n,a,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getHtmlFbMainPage();case 2:if(r=t.sent,!(n=r.html)){t.next=21;break}return this.html=n,t.next=8,this.getProfileSetting(n);case 8:if(a=t.sent,s=a.currentProfile,o=a.profiles,C.log("PROFILE SETTING FOUND: ",s,o),(null==s?void 0:s.id)==this.pageId){t.next=20;break}return t.next=15,this.initBaseForGraphReq(n,null==s?void 0:s.id);case 15:return C.log("NEED SWITCH PROFILE FROM: ".concat(null==s?void 0:s.id," TO: ").concat(this.pageId)),t.next=18,this.switchProfile(s,o);case 18:t.next=21;break;case 20:C.log("USER IS CURRENTLY USING RIGHT PROFILE");case 21:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"initBaseForGraphReq",value:(s=d(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.base=new me,e.next=3,this.base.ctxFromHtml(t);case 3:this.graphql=new Rt({base:this.base,pageId:r}),C.log("base graph switch profile: ",this.base,this.graphql);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"getProfileSetting",value:(a=d(l.a.mark((function e(t){var r,n,a,s,o,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=A(t,'{"require":[["ScheduledServerJS","handle",null,[{"__bbox":{"require":[["RelayPrefetchedStreamCache","next",[],').filter((function(e){return e.startsWith('["adp_CometSettingsDropdownListQueryRelayPreloader_')})),n=[],a=[],s=Ge(r),e.prev=3,s.s();case 5:if((o=s.n()).done){e.next=14;break}return i=o.value,e.next=9,L(i);case 9:u=e.sent,n.push(this.getCurrentProfile(u[1])),a.push(this.getAvailableProfiles(u[1]));case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),s.e(e.t0);case 19:return e.prev=19,s.f(),e.finish(19);case 22:return n=n.reduce((function(e,t){return c(c({},e),t||{})}),{}),a=a.reduce((function(e,t){return e.concat(t)}),[]),this.originProfile=n,e.abrupt("return",{currentProfile:n,profiles:a});case 26:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return a.apply(this,arguments)})},{key:"getCurrentProfile",value:function(e){var t=this.getActorFromSetting(e);return(null==t?void 0:t.id)?{id:null==t?void 0:t.id,name:null==t?void 0:t.name}:null}},{key:"getAvailableProfiles",value:function(e){var t,r=this.getActorFromSetting(e);return(null==r||null===(t=r.profiles)||void 0===t?void 0:t.edges)||[]}},{key:"switchProfile",value:(n=d(l.a.mark((function t(r,n){var a,s,o,i,c,u,p,d,f,h,v,_,m=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.targetToPersonalProfile){t.next=20;break}if((a=(null==n?void 0:n.length)>0&&(null==n?void 0:n.find((function(e){var t,r;return!(null==e||null===(t=e.node)||void 0===t||null===(r=t.profile)||void 0===r?void 0:r.delegate_page_id)}))))&&C.log("CURRENT PROFILE IS PAGE"),!a){t.next=18;break}return t.prev=4,i={profile_id:null==a||null===(s=a.node)||void 0===s||null===(o=s.profile)||void 0===o?void 0:o.id},c={__aaid:0,__comet_req:15,server_timestamps:!0},t.next=9,this.graphql.graphql(ft,i,c,!1,null,{Referer:"https://www.facebook.com/"});case 9:u=t.sent,C.log("response switch profile:",u),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(4),C.error("Switch Profile error:",t.t0);case 16:t.next=19;break;case 18:C.log("NOT FOUND PERSONAL PROFILE");case 19:return t.abrupt("return");case 20:if(At.isFeatureReady("switchProfile")){t.next=24;break}return C.log("feature: switchProfile is NOT ready, preloadDocIds is running..."),t.next=24,e.preloadDocIds({html:this.html});case 24:if((p=n.find((function(e){var t,r;return(null==e||null===(t=e.node)||void 0===t||null===(r=t.profile)||void 0===r?void 0:r.delegate_page_id)==m.pageId})))||(p=n.find((function(e){var t,r;return(null==e||null===(t=e.node)||void 0===t||null===(r=t.profile)||void 0===r?void 0:r.id)==m.pageId}))),C.log("PROFILE NEED TO SWITCH TO: ",n,p,this.pageId),!p){t.next=39;break}return t.prev=28,v={profile_id:null===(d=p)||void 0===d||null===(f=d.node)||void 0===f||null===(h=f.profile)||void 0===h?void 0:h.id},t.next=32,this.graphql.graphql(ft,v,{__comet_req:15});case 32:_=t.sent,C.log("response switch profile:",_),t.next=39;break;case 36:t.prev=36,t.t1=t.catch(28),C.error("Switch Profile error:",t.t1);case 39:case"end":return t.stop()}}),t,this,[[4,13],[28,36]])}))),function(e,t){return n.apply(this,arguments)})}],[{key:"startCheck",value:function(t,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];arguments.length>3&&void 0!==arguments[3]&&arguments[3]?(C.log("SWITCH_PROFILE_BUT_NOT_HANDLE_ERROR"),new e(t,n).init().then((function(){C.log("SWITCH PROFILE SUCCESS")})).catch((function(e){C.log("SWITCH PROFILE ERROR: ",e)})).finally(r)):(C.log("FIRST_TRY_DOING_TASK_WITHOUT_SWITCH_PROFILE"),r((function(){e.startCheck(t,r,n,!0)})))}},{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.html,r.pageId,t.t0=n,t.t0){t.next=6;break}return t.next=5,e.getHtmlFbMainPage();case 5:t.t0=t.sent;case 6:return a=t.t0,t.next=9,At.loadDocIdsFromView({html:a,docNames:[ft]});case 9:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"getHtmlFbMainPage",value:(t=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,re("https://www.facebook.com/",{parseResponse:function(e){return e}});case 3:return t=e.sent,e.next=6,t.text();case 6:return r=e.sent,e.abrupt("return",{html:r,response:t});case 8:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();self.ProfileSwitcher=He;var je=He,ze=function(){function e(t,r,n){var a=this;h(this,e),o(this,"applyRecurrenceTypeConfigs",(function(e){switch(a.extraData.recurrenceEndType){case"NEVER":default:return e;case"AFTER_N_TIMES":return e.input.number_of_appointments=a.extraData.numberOfAppointments,e;case"ON_DATE":return e.input.recurrence_end_time=a.extraData.recurrenceEndTime,e}})),this.pageId=t,this.appointmentMessage=r,this.base=null,this.graphql=null,this.extraData=n}var t,r,n,a,s,i,c,u;return _(e,[{key:"init",value:(u=d(l.a.mark((function e(){var t,r=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.next=3,this.initBaseForGraphReq(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"initBaseForGraphReq",value:(c=d(l.a.mark((function t(r){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.base=new me,t.next=3,e.getHtmlBusinessPage(this.pageId);case 3:return n=t.sent,t.next=6,this.base.ctxFromHtml(n);case 6:this.graphql=new Rt({base:this.base,pageId:this.pageId,isBussiness:r});case 7:case"end":return t.stop()}}),t,this)}))),function(e){return c.apply(this,arguments)})},{key:"approveAppointment",value:(i=d(l.a.mark((function t(){var r,n,a,s,o,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.init();case 2:if(At.isFeatureReady("approveAppointment")){t.next=6;break}return C.log("feature: approveAppointment is NOT ready, preloadDocIds is running..."),t.next=6,e.preloadDocIds({pageId:this.pageId,targetDocName:ht});case 6:return i={input:{actor_id:null===(r=this.appointmentMessage)||void 0===r||null===(n=r.native_component_flow_request)||void 0===n||null===(a=n.user)||void 0===a?void 0:a.id,client_mutation_id:"2",referrer_ui_component:"BUBBLE",referrer_ui_surface:"MESSAGE",request_id:null===(s=this.appointmentMessage)||void 0===s||null===(o=s.native_component_flow_request)||void 0===o?void 0:o.id,request_note_body:null}},t.next=9,this.graphql.graphql(ht,i);case 9:return c=t.sent,C.log("response approve appointment:",c),t.abrupt("return",c);case 12:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"denyAppointment",value:(s=d(l.a.mark((function t(r){var n,a,s,o,i,c,u,p,d,f,h,v,_;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.init();case 2:if(At.isFeatureReady("denyAppointment")){t.next=6;break}return C.log("feature: denyAppointment is NOT ready, preloadDocIds is running..."),t.next=6,e.preloadDocIds({pageId:this.pageId,targetDocName:vt});case 6:return v={input:{action:"admin_decline",actor_id:null===(n=this.appointmentMessage)||void 0===n||null===(a=n.native_component_flow_request)||void 0===a||null===(s=a.user)||void 0===s?void 0:s.id,client_mutation_id:"2",message_text:r||"Xin chào. Rất tiếc là chúng tôi không còn suất nào phù hợp với thời gian bạn đề xuất. Còn lúc nào khác thuận tiện cho bạn không?",page_id:this.pageId,referrer_ui_component:"bubble",referrer_ui_surface:"message",request_id:null===(o=this.appointmentMessage)||void 0===o||null===(i=o.native_component_flow_request)||void 0===i?void 0:i.id,suggested_end_time:null===(c=this.appointmentMessage)||void 0===c||null===(u=c.native_component_flow_request)||void 0===u||null===(p=u.suggested_time_range)||void 0===p?void 0:p.end,suggested_time:null===(d=this.appointmentMessage)||void 0===d||null===(f=d.native_component_flow_request)||void 0===f||null===(h=f.suggested_time_range)||void 0===h?void 0:h.start}},t.next=9,this.graphql.graphql(vt,v);case 9:return _=t.sent,t.abrupt("return",_);case 11:case"end":return t.stop()}}),t,this)}))),function(e){return s.apply(this,arguments)})},{key:"createAppointment",value:(a=d(l.a.mark((function t(r,n){var a=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.init(!0);case 2:this.prepareUserGlobalId().then(function(){var t=d(l.a.mark((function t(s){var o,i,c,u,p,d,f;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.globalUserId=s,At.isFeatureReady("createAppointment")){t.next=5;break}return C.log("feature: createAppointment is NOT ready, preloadDocIds is running..."),t.next=5,e.preloadDocIds({pageId:a.pageId,targetDocName:vt});case 5:t.t0=a.extraData.recurrenceType,t.next="NO_RECURRENCE"===t.t0?8:"EVERY_SIX_WEEKS"===t.t0||"EVERY_FOUR_WEEKS"===t.t0||"MONTHLY"===t.t0||"EVERY_TWO_WEEKS"===t.t0||"WEEKLY"===t.t0||"DAILY"===t.t0?13:21;break;case 8:return d={input:{action:"create",actor_id:a.pageId,client_mutation_id:"2",consumer_name:null,consumer_phone_number:null,job_application_id:null,job_search_surface:"messenger",page_id:a.pageId,referrer_ui_component:"composer",referrer_ui_surface:"message",request_note_body:{text:a.extraData.note||""},request_owner_id:s,service_ids:[],services_flow_type:"MANUAL_CREATION",should_create_page_contact:!1,suggested_end_time:a.extraData.endTime,suggested_time:a.extraData.startTime}},t.next=11,a.graphql.graphql(vt,d);case 11:return p=t.sent,t.abrupt("break",22);case 13:if(At.isFeatureReady("createAppointment")){t.next=16;break}return t.next=16,e.preloadDocIds({pageId:a.pageId,targetDocName:_t});case 16:return f=a.applyRecurrenceTypeConfigs({input:{actor_id:a.pageId,client_mutation_id:"8",consumer_name:null,consumer_phone:null,consumer_strid:s,flow_type:"MANUAL_CREATION",instance_end_time:a.extraData.endTime,page_id:a.pageId,recurrence_end_time:null,recurrence_end_type:a.extraData.recurrenceEndType,recurrence_frequency_type:a.extraData.recurrenceType,recurrence_start_time:a.extraData.startTime,request_note_body:{text:a.extraData.note||""},service_ids:[]}}),t.next=19,a.graphql.graphql(_t,f);case 19:return p=t.sent,t.abrupt("break",22);case 21:return t.abrupt("break",22);case 22:(null===(o=p)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.native_booking_request_status_update)||(null===(c=p)||void 0===c||null===(u=c.data)||void 0===u?void 0:u.create_recurring_appointment)?r.port.postMessage({type:"CREATE_APPOINTMENT_SUCCESS",taskId:n,success:!0}):r.port.postMessage({type:"CREATE_APPOINTMENT_FAILURE",taskId:n,success:!1});case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"prepareUserGlobalId",value:(n=d(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(t.extraData.globalUserId)return e(t.extraData.globalUserId);new Fe({pageId:t.pageId,threadId:t.extraData.threadId,threadKey:t.extraData.threadKey,convId:t.extraData.convId,convType:"INBOX",isBusiness:!0}).init().then(e).catch(r)})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}],[{key:"getHtmlBusinessPage",value:(r=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bt.makeInboxViewUrl(t,!0);case 2:return r=e.sent,self.externalGraphLog&&externalGraphLog.log(t,"getHtmlBusinessPage_appointment_action"),e.next=6,re(r);case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"preloadDocIds",value:(t=d(l.a.mark((function t(r){var n,a,s,o,i,c,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.html,a=r.pageId,r.isBusiness,s=r.targetDocName,o=s?[s]:[ht,vt],!n){t.next=6;break}i=n,t.next=15;break;case 6:return t.next=8,e.getHtmlBusinessPage(a);case 8:return i=t.sent,t.next=11,Bt.getExtraJsFilesToLoad(i);case 11:return c=t.sent,u=o,t.next=15,At.loadDocIdsFromView({html:i,docNames:u,isLoadCompleted:function(){return At.isFeatureReady(s==vt?"denyAppointment":"approveAppointment")},extraResource:c});case 15:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]),e}(),Ve=function(){function e(t,r,n,a,s){h(this,e),this.ctx={clientID:(2147483648*Math.random()|0).toString(16)},this.base=new me,this.graphql=new Rt({pageId:t}),this.pageId=t,this.convId=r,this.threadId=n,this.threadKey=a,this.html=null,this.base=null,this.graphql=null,this.globalUserId=s}var t;return _(e,[{key:"init",value:(t=d(l.a.mark((function e(t,r){var n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.prepareUserGlobalId().then((function(e){n.globalUserId=e,Zr(n.pageId).then((function(e){return e.archiveConversation(n.globalUserId).then(t).catch(r)})).catch(r)})).catch((function(){C.error("ArchiveConversation: CAN NOT FIND globalUserId"),r()}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"prepareUserGlobalId",value:function(){var e=this;return new Promise((function(t,r){if(e.globalUserId)return t(e.globalUserId);new Fe({pageId:e.pageId,threadId:e.threadId,threadKey:e.threadKey,convId:e.convId,convType:"INBOX"}).init().then(t).catch(r)}))}}]),e}();function We(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Ke(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ke(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Qe=function(){function e(t){h(this,e),o(this,"retrieveLock",(function(){return!self.currentRunningCacheRoutingApp})),o(this,"setLock",(function(){self.currentRunningCacheRoutingApp=!0,C.log("setLock_lock_state: ",self.currentRunningCacheRoutingApp)})),o(this,"releaseLock",(function(){self.currentRunningCacheRoutingApp=!1,C.log("releaseLock_lock_state: ",self.currentRunningCacheRoutingApp)})),this.pageId=t,this.html=null,this.base=null,this.graphql=null}var t,r,n,a,s,i,u,p,f,v,m,g,b,I,y,x;return _(e,[{key:"init",value:(x=d(l.a.mark((function t(r){var n,a,s,o=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=null,a=new je(this.pageId,!1),s=!1,a.init().then((function(){s=!0,C.log("ConfigRoutingApp - SWITCH PROFILE SUCCESS")})).catch((function(e){s=!1,C.log("ConfigRoutingApp - SWITCH PROFILE ERROR:",e)})).finally(d(l.a.mark((function t(){var i,u,p,d,f;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getConversationRoutingSettingPage();case 3:return i=t.sent,u=i.html,o.html=u,t.next=8,e.getCurrentConfig(u);case 8:return p=t.sent,t.next=11,e.getActorId(u);case 11:return d=t.sent,f=o.processConfigs(p),t.next=15,o.processDoNext(f,c(c({},p),{},{actorId:d}));case 15:n=t.sent,r&&r(n),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),C.error("ConfigRoutingApp: Encounter error when init",t.t0);case 22:s&&a.restoreOriginProfile();case 23:case"end":return t.stop()}}),t,null,[[0,19]])}))));case 4:case"end":return t.stop()}}),t,this)}))),function(e){return x.apply(this,arguments)})},{key:"cacheCurrentConfigs",value:(y=d(l.a.mark((function t(r){var n,a,s=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkValidCacheConfigsForPage(this.pageId);case 2:if(!t.sent){t.next=10;break}if(C.log("VALID_CONFIG_ROUTING_APP_KEEP_CURRENT_DATA"),t.t0=r,!t.t0){t.next=8;break}return t.next=8,r();case 8:t.next=18;break;case 10:if(this.retrieveLock()){t.next=13;break}return C.log("There is a current running task - pause this task"),t.abrupt("return");case 13:this.setLock(),C.log("INVALID_CONFIG_ROUTING_APP_NEED_REFRESH_DATA"),n=new je(this.pageId,!1),a=!1,n.init().then((function(){a=!0,C.log("ConfigRoutingApp - SWITCH PROFILE SUCCESS")})).catch((function(e){a=!1,C.log("ConfigRoutingApp - SWITCH PROFILE ERROR:",e)})).finally(d(l.a.mark((function t(){var o,i,c,u,p,d,f,h,v;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getConversationRoutingSettingPage();case 3:return c=t.sent,u=c.html,s.html=u,t.next=8,e.getActorId(u);case 8:return p=t.sent,s.actorID=p,t.next=12,e.getCurrentConfig(u);case 12:return d=t.sent,f=null==d||null===(o=d.defaultRoutingApp)||void 0===o?void 0:o.id,h=null==d||null===(i=d.socialRoutingApp)||void 0===i?void 0:i.id,v=(null==d?void 0:d.isDefaultAppTcTakeoverEnabled)||!1,C.log("STORE ROUTING CONFIG FOR PAGE: ",s.pageId,f,h,v),t.next=19,e.setLocalConfigs(s.pageId,f,h,v);case 19:if(t.t0=r,!t.t0){t.next=23;break}return t.next=23,r();case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(0),C.error("ConfigRoutingApp: Encounter error when cacheCurrentConfigs",t.t1);case 28:a&&n.restoreOriginProfile(s.releaseLock);case 29:case"end":return t.stop()}}),t,null,[[0,25]])}))));case 18:case"end":return t.stop()}}),t,this)}))),function(e){return y.apply(this,arguments)})},{key:"makePancakeTakeControl",value:(I=d(l.a.mark((function t(){var r,n,a,s=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getLocalRoutingConfigs(this.pageId);case 2:if(!(r=t.sent)||!(null==r?void 0:r.defaultRoutingAppId)||("1733556690196497"!==(null==r?void 0:r.defaultRoutingAppId)||r.isDefaultAppTCTakeoverEnabled)&&"1733556690196497"==(null==r?void 0:r.defaultRoutingAppId)){t.next=13;break}if(At.isFeatureReady("configRoutingApp")){t.next=8;break}return C.log("changeDefaultAppToPancake - feature: configRoutingApp is NOT ready, preloadDocIds is running..."),t.next=8,e.preloadDocIds({html:this.html});case 8:return t.next=10,this.initBaseForGraphReq();case 10:n=new je(this.pageId,!1),a=!1,n.init().then((function(){a=!0,C.log("ConfigRoutingApp: makePancakeTakeControl - SWITCH PROFILE SUCCESS")})).catch((function(e){a=!1,C.log("ConfigRoutingApp: makePancakeTakeControl - SWITCH PROFILE ERROR:",e)})).finally(d(l.a.mark((function t(){var o,i,c,u,p,d,f,h,v;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(null==r?void 0:r.socialRoutingAppId)||"",t.prev=1,"556376998159104"!=(null==r?void 0:r.defaultRoutingAppId)){t.next=10;break}return C.warning("CONFIG BOTCAKE TO SOCIAL ROUTING APP"),u={input:{action:"EDIT",actor_id:s.actorID,app_id:"556376998159104",client_mutation_id:"2",complete_link:"",entrypoint:"ORGANIC_ENTRYPOINT",name:"",page_id:s.pageId,platform:"MESSENGER",ref_param:""}},t.next=7,s.graphql.graphql(gt,u);case 7:(null==(p=t.sent)||null===(i=p.data)||void 0===i||null===(c=i.update_conversation_routing_settings)||void 0===c?void 0:c.succeed)&&(o="556376998159104"),C.log("response_config_botcake_app:",p);case 10:if("1733556690196497"==(null==r?void 0:r.defaultRoutingAppId)&&r.isDefaultAppTCTakeoverEnabled){t.next=20;break}return C.warning("CONFIG PANCAKE TO DEFAULT ROUTING APP"),h={input:{actor_id:s.actorID,app_id:"1733556690196497",app_roles:[],client_mutation_id:"2",default_app_tc_takeover_config_action:"ENABLE",is_add:!0,is_messenger:!0,is_multi_app:!0,page_id:s.pageId},platform:"MESSENGER"},t.next=15,s.graphql.graphql(mt,h);case 15:if(v=t.sent,C.log("response_config_app:",v),!(null==v||null===(d=v.data)||void 0===d||null===(f=d.set_handover_app_role)||void 0===f?void 0:f.succeed)){t.next=20;break}return t.next=20,e.setLocalConfigs(s.pageId,"1733556690196497",o,!0);case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(1),C.error("ConfigRoutingApp: Encounter error when makePancakeTakeControl",t.t0);case 25:a&&n.restoreOriginProfile();case 26:case"end":return t.stop()}}),t,null,[[1,22]])}))));case 13:case"end":return t.stop()}}),t,this)}))),function(){return I.apply(this,arguments)})},{key:"processDoNext",value:(b=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,a=null,"KEEP_CURRENT_SETTING"==t.defaultApp&&"KEEP_CURRENT_SETTING"==t.socialApp){e.next=4;break}return e.next=4,this.initBaseForGraphReq();case 4:if("SET_TO_PANCAKE"!=t.defaultApp){e.next=8;break}return e.next=7,this.changeDefaultAppToPancake(r);case 7:n=e.sent;case 8:if("SET_TO_BOTCAKE"!=t.socialApp){e.next=12;break}return e.next=11,this.changeSocialAppToBotCake(r);case 11:a=e.sent;case 12:return e.abrupt("return",{responseChangeDefaultAppToPancake:n,responseChangeSocialAppToBotCake:a,doNext:t});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"initBaseForGraphReq",value:(g=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.base=new me,e.next=3,this.base.ctxFromHtml(this.html);case 3:this.graphql=new Rt({base:this.base,pageId:this.pageId}),C.log("base graph config routing app: ",this.base,this.graphql);case 5:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"changeDefaultAppToPancake",value:(m=d(l.a.mark((function t(r){var n,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(At.isFeatureReady("configRoutingApp")){t.next=4;break}return C.log("changeDefaultAppToPancake - feature: configRoutingApp is NOT ready, preloadDocIds is running..."),t.next=4,e.preloadDocIds({html:this.html});case 4:return n=r.actorId,a={input:{actor_id:n,app_id:"1733556690196497",app_roles:[],client_mutation_id:"2",default_app_tc_takeover_config_action:"ENABLE",is_add:!0,is_messenger:!0,is_multi_app:!0,page_id:this.pageId},platform:"MESSENGER"},t.next=8,this.graphql.graphql(mt,a);case 8:return s=t.sent,t.abrupt("return",s);case 10:case"end":return t.stop()}}),t,this)}))),function(e){return m.apply(this,arguments)})},{key:"changeSocialAppToBotCake",value:(v=d(l.a.mark((function t(r){var n,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(At.isFeatureReady("configRoutingApp")){t.next=4;break}return C.log("changeSocialAppToBotCake - feature: configRoutingApp is NOT ready, preloadDocIds is running..."),t.next=4,e.preloadDocIds({html:this.html});case 4:return n=r.actorId,a={input:{action:"EDIT",actor_id:n,app_id:"556376998159104",client_mutation_id:"1",complete_link:"",entrypoint:"ORGANIC_ENTRYPOINT",name:"",page_id:this.pageId,platform:"MESSENGER",ref_param:""},platform:"MESSENGER"},t.next=8,this.graphql.graphql(gt,a);case 8:return s=t.sent,t.abrupt("return",s);case 10:case"end":return t.stop()}}),t,this)}))),function(e){return v.apply(this,arguments)})},{key:"processConfigs",value:function(e){var t,r,n,a,s={defaultApp:"KEEP_CURRENT_SETTING",socialApp:"KEEP_CURRENT_SETTING"};return(null==e?void 0:e.defaultRoutingApp)&&"1733556690196497"!=(null==e||null===(t=e.defaultRoutingApp)||void 0===t?void 0:t.id)?s.defaultApp="SET_TO_PANCAKE":s.defaultApp="KEEP_CURRENT_SETTING",(null==e?void 0:e.socialRoutingApp)&&"556376998159104"==(null==e||null===(r=e.socialRoutingApp)||void 0===r?void 0:r.id)&&((null==e?void 0:e.defaultRoutingApp)||(s.defaultApp="SET_TO_PANCAKE"),s.socialApp="KEEP_CURRENT_SETTING"),(null==e?void 0:e.socialRoutingApp)&&"556376998159104"!=(null==e||null===(n=e.socialRoutingApp)||void 0===n?void 0:n.id)&&"556376998159104"==(null==e||null===(a=e.defaultRoutingApp)||void 0===a?void 0:a.id)&&(s.defaultApp="SET_TO_PANCAKE",s.socialApp="SET_TO_BOTCAKE"),s}}],[{key:"getLocalRoutingConfigs",value:(f=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.prev=1,e.next=4,X.getItem("routing_app_config");case 4:(n=e.sent)&&(r=JSON.parse(n)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),C.error("Encounter error while getLocalConfigs",e.t0);case 11:if(!r){e.next=15;break}return e.abrupt("return",r[t]||null);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[1,8]])}))),function(e){return f.apply(this,arguments)})},{key:"checkValidCacheConfigsForPage",value:(p=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLocalRoutingConfigs(t);case 2:if(null==(r=e.sent)?void 0:r.hasOwnProperty("isDefaultAppTCTakeoverEnabled")){e.next=5;break}return e.abrupt("return",!1);case 5:if(!r||!(null==r?void 0:r.refreshedAt)){e.next=11;break}return n=(new Date).getTime(),a=r.refreshedAt,e.abrupt("return",(n-a)/864e5<14);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"needArchiConversation",value:function(e){return e&&"1733556690196497"==e.defaultRoutingAppId}},{key:"archiveConversation",value:(u=d(l.a.mark((function e(t){var r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.pageId,n=t.convId,a=t.threadId,s=t.threadKey,o=t.globalUserId,e.prev=1,e.next=4,this.getLocalRoutingConfigs(r);case 4:i=e.sent,this.needArchiConversation(i)?(C.log("ConfigRoutingApp: CHANGE_CONV_STATUS_TO_ARCHIVED, globalUserId:",o),new Ve(r,n,a,s,o).init((function(e){return C.log("ARCHIVE CONVERSATION SUCCESS")}),(function(){return C.log("ARCHIVE CONVERSATION ERROR")}))):C.log("ConfigRoutingApp: no need to archive conversation"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),C.error("ConfigRoutingApp: Encounter error while archiveConversation",e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return u.apply(this,arguments)})},{key:"setLocalConfigs",value:(i=d(l.a.mark((function e(t,r,n,a){var s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllLocalRoutingConfigs();case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:s=e.t0;try{i=c(c({},s||{}),{},o({},t,{defaultRoutingAppId:r,socialRoutingAppId:n,refreshedAt:(new Date).getTime(),isDefaultAppTCTakeoverEnabled:a})),X.setItem("routing_app_config",JSON.stringify(i))}catch(e){C.log("Encounter error while setLocalConfigs",e)}case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"getAllLocalRoutingConfigs",value:(s=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.prev=1,e.next=4,X.getItem("routing_app_config");case 4:(r=e.sent)&&(t=JSON.parse(r)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),C.error("Encounter error while getLocalConfigs",e.t0);case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,null,[[1,8]])}))),function(){return s.apply(this,arguments)})},{key:"preloadDocIds",value:(a=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.html,t.pageId,n=r||this.getConversationRoutingSettingPage(),e.next=4,At.loadDocIdsFromView({html:n,docNames:[mt,gt]});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getConversationRoutingSettingPage",value:(n=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,re("https://www.facebook.com/settings?tab=msgr_conversation_routing",{parseResponse:function(e){return e}});case 3:return t=e.sent,e.next=6,t.text();case 6:return r=e.sent,e.abrupt("return",{html:r,response:t});case 8:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getCurrentConfig",value:(r=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(A(t,'"page_comet_admin_conversation_routing_settings":')[0]);case 2:r=e.sent,n=null,a=null,o=!1,i=We(r);try{for(i.s();!(c=i.n()).done;)"PagesCometConversationRoutingSettingsDefaultApps"==(null==(u=c.value)?void 0:u.__typename)&&(n=null==u||null===(p=u.connected_apps)||void 0===p?void 0:p.find((function(e){var t;return null==e||null===(t=e.multi_app_role)||void 0===t?void 0:t.includes("DEFAULT_APP")})),s=(null==u?void 0:u.connected_apps)||[],o=u.is_default_app_tc_takeover_enabled),"PagesCometConversationRoutingSettingsSocialRouting"==(null==u?void 0:u.__typename)&&function(){var e,t,r=null==u||null===(e=u.social_routing_config)||void 0===e?void 0:e.app_id;a=null==u||null===(t=u.connected_apps)||void 0===t?void 0:t.find((function(e){return(null==e?void 0:e.id)==r}))}()}catch(e){i.e(e)}finally{i.f()}return e.abrupt("return",{defaultRoutingApp:n,socialRoutingApp:a,apps:s,isDefaultAppTcTakeoverEnabled:o});case 7:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"getActorId",value:(t=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(A(t,'["RelayAPIConfigDefaults",[],')[0]);case 2:return r=e.sent,e.abrupt("return",(null==r?void 0:r.actorID)||"");case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();self.ConfigRoutingApp=Qe;var Ye=Qe;function Je(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Xe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $e="PagesManagerInboxAdminAssignerRootQuery",Ze="PagesManagerInboxQueryUtilCommItemHeaderMercuryQuery",et="MessengerThreadlistWebGraphQLQuery",tt="MessengerThreadlistQuery",rt="useCometUFICreateCommentMutation",nt="CometUFIDeleteCommentMutation",at="CometUFICommentPrivateReplyMutation",st="PageCommSendProductMutation",ot="useCometProfilePlusSendPostLikerFollowerInviteMutation",it="BizInboxCustomerRelaySearchSourceQuery",ct="BizInboxSearchResultListContainerQuery",ut="CometResharesDialogQuery",lt="CometResharesFeedPaginationQuery",pt="BizInboxCommentThreadListContainerQuery",dt="BizInboxCommentDetailViewHeaderContainerQuery",ft="CometProfileSwitchMutation",ht="ServicesAppointmentMutationUtilsApproveAppointmentMutation",vt="ServicesBookingRequestStatusUpdateMutation",_t="NativeBookingRequestRecurringAppointmentCreationMutation",mt="PagesCometAdminEditHandoverMutation",gt="PagesCometUpdateConversationRoutingSettingsMutation",bt="BizInboxCommentThreadListContainerQuery",It="BizInboxCommentDetailViewHeaderContainerQuery",yt="BizInboxCommentDetailViewHeaderFacebookTitleQuery",xt="BizInboxPostDetailViewWrapperQuery",kt="CommentListComponentsRootQuery",wt="CommentsListComponentsPaginationQuery",St="Depth1CommentsListPaginationQuery",Et="useCometUFIEditCommentMutation",Ct={inbox:[$e,Ze],comment:[rt,nt],privateReply:[at],personalInfo:["ProfileCometAboutAppSectionQuery"],sendCommerceProduct:[st],crawlLivestreamData:[ut,lt,"CometTahoeRootQuery"],inviteLikePage:[ot,"useCometPageInviteFromAdminsMutation","CometUFIReactionsDialogQuery","CometUFIReactionsDialogTabContentRefetchQueryStable","CometUFIReactionsDialogTabContentRefetchQueryExperimental","CometUFIReactionsDialogTabContentRefetchQuery"],instagramInbox:["InstagramMessageThreadsWebGraphQLQuery"],instagramComment:[pt,"BizInboxIGPostDetailViewContainerQuery","BizInboxIGCommentListContainerQuery",dt,"BizInboxIGCommentRepliesContainerQuery","BizInboxIGCommentReplyCreateMutation","BizInboxCommentThreadListWrapperQuery"],reactMessage:["BizInboxMessengerReactionMutation"],sticker:["CometStickerPickerCardQuery","CometStickerPickerPackContentRootQuery"],listenFbComment:[pt,dt,"BizInboxCommentThreadListWrapperQuery"],switchProfile:[ft],createAppointment:[vt,_t],approveAppointment:[ht],denyAppointment:[vt],configRoutingApp:[mt,gt],businessInboxComment:[bt,It,yt,xt],blockUser:["BlockingSettingsDialogQuery","BlockingSettingsBlockMutation","ProfileCometActionBlockUserMutation","BizKitContextCardBlockMutation"]},Tt=new(function(){function e(){h(this,e),this.docIdsMap=this.populateDocIdsMap(),this.featureNeedsPreloadDocIds=["inbox","comment","sendCommerceProduct","switchProfile","approveAppointment","denyAppointment","createAppointment","configRoutingApp","businessInboxComment"],this.preloadDocIds=F(this.preloadDocIds)}var t,r,n,a,o,i,u,p,f,v;return _(e,[{key:"populateDocIdsMap",value:(v=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDocIdsFromLocalStorage();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",new Map);case 5:return e.abrupt("return",new Map(U(t)));case 6:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"prepareDocIdsMap",value:(f=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.populateDocIdsMap();case 2:this.docIdsMap=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getDocIdsFromLocalStorage",value:(p=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("GraphQLDocId_docIdsMap");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.prev=5,e.abrupt("return",JSON.parse(t));case 9:return e.prev=9,e.t0=e.catch(5),C.error("MALFORMED DOC IDS CACHE --\x3e CLEARING",t),X.removeItems(["GraphQLDocId_docIdsMap"]),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[5,9]])}))),function(){return p.apply(this,arguments)})},{key:"preloadDocIds",value:(u=d(l.a.mark((function e(t){var r,n,a,s,o,i=this,c=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=c.length>1&&void 0!==c[1]?c[1]:this.featureNeedsPreloadDocIds,n=r.filter((function(e){return!i.isFeatureReady(e)})).map((function(e){return i.getFeatureHandlerClass(e)})).reduce((function(e,t){return e.includes(t)?e:e.concat(t)}),[]),a=Je(n),e.prev=3,a.s();case 5:if((s=a.n()).done){e.next=11;break}return o=s.value,e.next=9,o.preloadDocIds(t);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),a.e(e.t0);case 16:return e.prev=16,a.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])}))),function(e){return u.apply(this,arguments)})},{key:"getFeatureHandlerClass",value:function(e){var t;switch(e){case"inbox":t=Bt;break;case"comment":case"privateReply":t=Ee;break;case"sendCommerceProduct":t=Me;break;case"switchProfile":t=je;break;case"configRoutingApp":t=Ye;break;case"businessInboxComment":t=ye}if(!t)throw"Not supported feature";if(!("preloadDocIds"in t))throw"preloadDocIds static method is missing from ".concat(t);return t}},{key:"isFeatureReady",value:function(e){switch(e){case"loadMessages":return this.has("MessengerThreadsWebGraphQLQuery")||this.has("MessengerThreadsQuery");case"inbox":return this.has(et)||this.has(tt)||this.isAllDocIdLoaded(Ct.inbox);case"instagramInbox":return this.has(it)&&this.has(ct)&&(this.has("InstagramMessageThreadItemsWebGraphQLQuery")||this.has("InstagramMessageThreadItemsQuery"));case"crawlLivestreamData":return this.has("CometTahoeRootQuery")&&this.has(ut)&&this.has(lt);case"inviteLikePage":return(this.has(ot)||this.has("useCometPageInviteFromAdminsMutation"))&&this.has("CometUFIReactionsDialogQuery")&&(this.has("CometUFIReactionsDialogTabContentRefetchQueryStable")||this.has("CometUFIReactionsDialogTabContentRefetchQueryExperimental")||this.has("CometUFIReactionsDialogTabContentRefetchQuery"));case"switchProfile":return this.has(ft);case"createAppointment":return this.has(vt)&&this.has(_t);case"approveAppointment":return this.has(ht);case"denyAppointment":return this.has(vt);case"configRoutingApp":return this.has(mt)&&this.has(gt);case"businessInboxComment":return this.has(bt)&&this.has(It)&&this.has(yt)&&this.has(xt);default:var t=Ct[e];return this.isAllDocIdLoaded(t)}}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,a=t;n<a.length;n++){var s=a[n];if(this.has(s))return this.docIdsMap.get(s).value}return null}},{key:"set",value:function(e,t){C.success("FOUND ".concat(e," DOC ID"));var r={value:t,lastUpdatedAt:(new Date).getTime()};this.docIdsMap.set(e,r),this.persistToLocalStorage()}},{key:"persistToLocalStorage",value:function(){var e=B(this.docIdsMap);X.setItem("GraphQLDocId_docIdsMap",JSON.stringify(e))}},{key:"has",value:function(e){return!(!this.docIdsMap.has(e)||(new Date).getTime()-this.docIdsMap.get(e).lastUpdatedAt>18e6&&(C.log("CLEARING EXPIRED DOC ID ".concat(e)),this.delete(e),1))}},{key:"delete",value:function(e){this.docIdsMap.delete(e),this.persistToLocalStorage()}},{key:"loadDocIdsFromView",value:(i=d(l.a.mark((function e(t){var r,n,a,o,i,c,u,p,d,f=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.html,n=t.docNames,a=t.extraResource,o=t.extraResourceMap,!this.isAllDocIdLoaded(n)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.makeResourceMap(r);case 5:if(i=e.sent,C.log("resourceMap",i),o&&Object.entries(o).forEach((function(e){var t=s(e,2),r=t[0],n=t[1];return i.set(r,n)})),!(c=function(){return t.isLoadCompleted&&"function"==typeof t.isLoadCompleted?t.isLoadCompleted():f.isAllDocIdLoaded(n)})()){e.next=11;break}return e.abrupt("return");case 11:if(u=this.getResourceNeedsLoad({html:r,extraResource:a,resourceMap:i}),C.log("List JS files to load ",u),!u.length){e.next=18;break}return e.next=16,this.loadResources(u,i,n,c);case 16:e.next=34;break;case 18:if(!r.match(/<title>Redirecting...<\/title>/)){e.next=34;break}if(!(p=(p=r.match(/<meta.+bocnext=(.+)"/))&&p[1])){e.next=34;break}return p=decodeURIComponent(p),e.prev=23,e.next=26,re(p);case 26:return d=e.sent,e.next=29,this.loadDocIdsFromView(Object.assign({},t,{html:d}));case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(23),console.log(e.t0);case 34:case"end":return e.stop()}}),e,this,[[23,31]])}))),function(e){return i.apply(this,arguments)})},{key:"makeResourceMap",value:(o=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=A(t,'"resource_map":')).length||(r=A(t,'"rsrcMap":')),e.next=4,this.combineResourceMaps(r);case 4:return n=e.sent,Array.from(t.matchAll(/setResourceMap\(([^)]+), \[\]\)/g)).forEach((function(e){Object.assign(n,JSON.parse(e[1]))})),e.abrupt("return",new Map(U(n)));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"combineResourceMaps",value:(a=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return L(e)})));case 2:return r=e.sent,e.abrupt("return",r.reduce((function(e,t){return c(c({},e),t)}),{}));case 4:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"getResourceNeedsLoad",value:function(e){var t=e.html,r=e.extraResource,n=e.resourceMap,a=[],o=t.match(/loadOnDOMContentReady\((\[[^\]]+\])/);o&&o[1]&&(a=a.concat(JSON.parse(o[1])));var i=S(t.matchAll(/script src="([^"]+)" data-bootloader-hash="([^"]+)"/g)).map((function(e){var t=s(e,3),r=(t[0],t[1]),a=t[2];return n.set(a,{type:"js",src:r}),a}));return r&&(C.log("Priority resource",r),a=r.concat(a)),a.concat(i).concat(Array.from(n.keys()))}},{key:"loadResources",value:(n=d(l.a.mark((function e(t,r,n,a){var s,o,i,c=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=6,o=0;case 2:if(!(o<t.length)){e.next=11;break}return i=t.slice(o,o+s),e.next=6,Promise.all(i.map(function(){var e=d(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.get(t)){e.next=3;break}return e.abrupt("return",C.log("Missing resource: ".concat(t)));case 3:if("js"===a.type){e.next=5;break}return e.abrupt("return",C.log("Unsupported resource type: ".concat(a.type)));case 5:return e.next=7,c.loadResource(a.src,n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:if(!a()){e.next=8;break}return e.abrupt("break",11);case 8:o+=s,e.next=2;break;case 11:case"end":return e.stop()}}),e)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"loadResource",value:(r=d(l.a.mark((function e(t,r){var n,a,s,o,i,c,u,p,d,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ajaxWithoutException(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(s=r.join("|"),o=new RegExp('operationKind:"(?:[^"]+)",name:"(?<name>'+s+')",id:"(?<id>\\d+)"',"g"),a=S(n.matchAll(o)),i=new RegExp('id:"(?<id>\\d+)",(?:[^:]+:.+,)?name:"(?<name>'+s+')"',"g"),(a=[].concat(S(a),S(n.matchAll(i)))).length||(c=new RegExp('__d\\("(?<name>'.concat(s,')".+__getDocID=function\\(\\){return"(?<id>\\d+)"'),"g"),a=[].concat(S(a),S(n.matchAll(c)))),a.length||(u=new RegExp('__d\\("(?<name>'.concat(s,')_instagramRelayOperation".+?exports="(?<id>\\d+)"'),"g"),a=[].concat(S(a),S(n.matchAll(u)))),p=new RegExp('__d\\("(?<name>'.concat(s,')_facebookRelayOperation".+?exports="(?<id>\\d+)"'),"g"),a=[].concat(S(a),S(n.matchAll(p))))for(d=a.length-1;d>=0;d--)f=a[d].groups,this.set(f.name,f.id);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"ajaxWithoutException",value:(t=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",e.prev=1,e.next=4,re(t,{skipProcessReferer:!0});case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("Encounter error while ajaxWithoutException",e.t0);case 10:return e.prev=10,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,null,[[1,7,10,13]])}))),function(e){return t.apply(this,arguments)})},{key:"isAllDocIdLoaded",value:function(e){var t,r=!0,n=Je(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;this.has(a)||(r=!1)}}catch(e){n.e(e)}finally{n.f()}return r}}]),e}());Tt.prepareDocIdsMap(),self.GraphQLDocId=Tt;var At=Tt,Rt=function(){function e(t){var r=t.base,n=t.pageId,a=t.isBussiness,s=t.isIGD,o=void 0!==s&&s;h(this,e),this.base=r||CCake.base,this.pageId=n,this.isBussiness=a,this.isIGD=o}var t,r;return _(e,[{key:"graphql",value:(r=d(l.a.mark((function e(t,r){var n,a,s,o,i,u,p,f,h,v,_,m,g,b,I=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=I.length>2&&void 0!==I[2]?I[2]:{},a=I.length>3&&void 0!==I[3]&&I[3],s=I.length>4?I[4]:void 0,o=I.length>5&&void 0!==I[5]?I[5]:{},i=At.get(t)){e.next=7;break}throw"Missing doc_id ".concat(t);case 7:for(f in u=Object.assign(this.base.buildParams(),{av:this.pageId,doc_id:i,variables:JSON.stringify(r),fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:t,__usid:this.base.generateUsid()},n),p=[],u)h=encodeURIComponent(f),v=encodeURIComponent(u[f]),p.push(h+"="+v);return p=p.join("&"),e.next=13,ae(this.isIGD?"https://www.instagram.com/graphql/query":"".concat(this.isBussiness||["102228126193332","109308204814787"].includes(this.pageId)?"https://business.facebook.com":"https://www.facebook.com","/api/graphql/"),p,{},{headers:c(c({},o),{},{"Content-Type":"application/x-www-form-urlencoded","X-Fb-Friendly-Name":t,"X-Fb-Lsd":u.lsd,dpr:u.dpr,"X-Asbd-Id":129477,"Sec-Ch-Prefers-Color-Scheme":"dark","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Full-Version-List":'"Chromium";v="122.0.6261.112", "Not(A:Brand";v="24.0.0.0", "Google Chrome";v="122.0.6261.112"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Model":"","Sec-Ch-Ua-Platform":"macOS","Sec-Ch-Ua-Platform-Version":"13.4.1","Viewport-Width":1115}),parseResponse:s||function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 13:return _=e.sent,e.prev=14,m=JSON.parse(_),e.abrupt("return",m);case 19:if(e.prev=19,e.t0=e.catch(14),"function"!=typeof(g=this.makeErrorHandler(_,a))){e.next=24;break}return e.abrupt("return",g());case 24:if("retry"!==g){e.next=33;break}return e.next=27,CCake.checkOriginThenReloadListenerIfNeeds();case 27:return e.next=29,CCake.getInboxNormal(this.pageId,!0);case 29:return b=e.sent,e.next=32,b.init(this.pageId);case 32:return e.abrupt("return",this.graphql(t,r,n,!0));case 33:if(g){e.next=35;break}return e.abrupt("return",_);case 35:case"end":return e.stop()}}),e,this,[[14,19]])}))),function(e,t){return r.apply(this,arguments)})},{key:"graphqlbatch",value:(t=d(l.a.mark((function e(t){var r,n,a,s,o,i,u,p,f,h,v,_,m,g;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.batchName,n=t.graphqlQueries,a=t.hasRetried,s=void 0!==a&&a,e.next=3,Re.get(this.pageId);case 3:for(f in o=e.sent,i=[4,6,7].includes(o)?"business.facebook.com":"www.facebook.com",u=Object.assign(this.base.buildParams(),{av:this.pageId,batch_name:r,queries:this.getBatchQuery(n),__usid:this.base.generateUsid()}),p=[],u)h=encodeURIComponent(f),v=encodeURIComponent(u[f]),p.push(h+"="+v);return p=p.join("&"),e.next=11,ae("https://".concat(i,"/api/graphqlbatch/"),p,{},{headers:{"x-msgr-region":this.base.ctx.messenger_region,"Content-Type":"application/x-www-form-urlencoded","X-Fb-Friendly-Name":t.batchName},parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 11:if((_=e.sent).startsWith("for (;;)")){e.next=16;break}return e.abrupt("return",this.parseBatchQueryResponse(_,n.length));case 16:if("function"!=typeof(m=this.makeErrorHandler(_,s))){e.next=19;break}return e.abrupt("return",m());case 19:if("retry"!==m){e.next=28;break}return e.next=22,CCake.checkOriginThenReloadListenerIfNeeds();case 22:return e.next=24,CCake.getInboxNormal(this.pageId,!0);case 24:return g=e.sent,e.next=27,g.init(this.pageId);case 27:return e.abrupt("return",this.graphqlbatch(c(c({},t),{},{hasRetried:!0})));case 28:if(m){e.next=30;break}return e.abrupt("return",_);case 30:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getBatchQuery",value:function(e){var t=this,r=e.map((function(e,r){return[t.getQueryIdentifier(r),e]}));return JSON.stringify(function(e){return Object.fromEntries?Object.fromEntries(e):e.reduce((function(e,t){var r=s(t,2),n=r[0],a=r[1];return c(c({},e),{},o({},n,a))}),{})}(r))}},{key:"getQueryIdentifier",value:function(e){return"__q".concat(e,"__")}},{key:"parseBatchQueryResponse",value:function(e,t){for(var r=[],n=0;n<t;n++){var a=this.getQueryIdentifier(n),s=A(e,'"'.concat(a,'":'));s=L(s),r.push(s)}return r}},{key:"makeErrorHandler",value:function(e,t){try{var r=CCake.base.parseFbRes(e);if(r&&r.error&&r.errorDescription&&r.errorDescription.match(/mở lại|re-opening/))return t?this.notifyErrorToParentWindow.bind(this,"reopenBrowser"):"retry"}catch(e){}}},{key:"notifyErrorToParentWindow",value:function(e){var t;if("reopenBrowser"===e)C.error("GRAPHQL_ERROR: Please re-open browser"),null===(t=self.pancGlobalWorker)||void 0===t||t.port.postMessage({type:"EXTENSION_NOTIFICATIONS",error:"REOPEN_BROWSER"})}}]),e}();function Lt(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Nt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Nt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}self.GraphQL=Rt,self.igdUserFbIdCache={};var Ot=function(){function e(t){var r=this,n=t.pageId,a=t.isBusiness,s=t.isIGD,i=void 0!==s&&s;h(this,e),o(this,"uploadPhoto",(function(e){return new Promise((function(t){return r.inboxNormalInstance.getBlob(e,t)}))})),this.pageId=n,this.isBusiness=a,this.currentThreadCursor=null,this.threadList=[],this.isIGD=i}var t,r,n,a,i,u,p,f,v,m,g,b,I;return _(e,[{key:"init",value:(I=d(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(At.isFeatureReady("instagramInbox")){t.next=3;break}return t.next=3,e.preloadDocIds({pageId:this.pageId,isBusiness:this.isBusiness});case 3:return t.next=5,CCake.getInboxNormal(this.pageId);case 5:this.inboxNormalInstance=t.sent,this.graphQLInstance=new Rt({pageId:this.pageId,base:this.inboxNormalInstance.base,isBussiness:!0});case 7:case"end":return t.stop()}}),t,this)}))),function(){return I.apply(this,arguments)})},{key:"findUserThread",value:(b=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]&&u[1],e.next=3,this.getCustomers(t);case 3:n=(n=e.sent).filter((function(e){return e.ig_profile_info&&e.ig_profile_info.username===t})),a=Lt(n),e.prev=6,a.s();case 8:if((s=a.n()).done){e.next=20;break}return o=s.value,e.next=12,this.listCustomerThreads(o.id);case 12:return i=e.sent,e.next=15,this.getIgThreadDetail(i[0].token,r);case 15:if(!(c=e.sent).thread_users.nodes.find((function(e){return e.username===t}))){e.next=18;break}return e.abrupt("return",c);case 18:e.next=8;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(6),a.e(e.t0);case 25:return e.prev=25,a.f(),e.finish(25);case 28:return C.log("CAN NOT FIND CUSTOMER IN SEARCH RESULT"),e.abrupt("return",null);case 30:case"end":return e.stop()}}),e,this,[[6,22,25,28]])}))),function(e){return b.apply(this,arguments)})},{key:"getCustomers",value:(g=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.graphQLInstance.graphql(it,{pageID:this.pageId,count:5,cursor:null,searchTerm:t,channel:"INSTAGRAM_DIRECT"});case 2:return r=e.sent,n=r.data.page.page_unified_customer_search.edges,C.log("FIND CUSTOMER SEARCH RESULT",n),e.abrupt("return",n.map((function(e){return e.node})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"listCustomerThreads",value:(m=d(l.a.mark((function e(t){var r,n,a,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]&&s[1],e.next=3,this.graphQLInstance.graphql(ct,{pageCustomerID:t});case 3:if(n=e.sent,a=n.data.CrmUnifiedContact.instagram_direct_comms.edges.map((function(e){return e.node})).filter((function(e){return"InstagramMessageThread"===e.__typename})),!r){e.next=7;break}return e.abrupt("return",[n,a]);case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getIgThreadDetail",value:(v=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.graphQLInstance.graphqlbatch({batchName:"InstagramMessageGraphQLThreadItemsFetcher",graphqlQueries:this.buildGraphqlQueries(t,r)});case 2:return n=e.sent,e.abrupt("return",n[0].data.instagram_message_thread);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"buildGraphqlQueries",value:function(e,t){var r=At.get("InstagramMessageThreadItemsWebGraphQLQuery","InstagramMessageThreadItemsQuery");if(!r)throw"Missing doc_id ".concat("InstagramMessageThreadItemsWebGraphQLQuery"," or ").concat("InstagramMessageThreadItemsQuery");return[{doc_id:r,query_params:{token:e,item_limit:t?20:1,load_items:t}}]}},{key:"sendInbox",value:(f=d(l.a.mark((function e(t){var r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.customerUsername,n=t.igThreadId,a=t.photoUrl,s=t.igPageId,n){e.next=6;break}return e.next=4,this.findUserThread(r);case 4:o=e.sent,n=o&&o.token;case 6:if(n){e.next=8;break}return e.abrupt("return",Promise.reject("CAN NOT GET IG THREAD ID"));case 8:if(e.t0=a,!e.t0){e.next=13;break}return e.next=12,this.uploadPhoto(a);case 12:e.t0=e.sent;case 13:return i=e.t0,e.abrupt("return",this.inboxNormalInstance.sendInbox(c(c({},t),{},{igThreadId:n,platform:"instagram",pageId:this.pageId,photoBlob:i,inboxIGInstance:this,igPageId:s})));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getNormalThreadId",value:(p=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://business.facebook.com/latest/inbox/all/?asset_id=".concat(this.pageId,"&mailbox_id=").concat(this.pageId,"&selected_item_id=").concat(t,"&thread_type=IG_MESSAGE"),self.externalGraphLog&&externalGraphLog.log(this.pageId,"getNormalThreadId_inbox_instagram"),e.next=4,re(r);case 4:return n=e.sent,a=n.match(/entity_id=(\d+)&/),e.abrupt("return",(a[1]?parseInt(a[1]):null)||t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"sendInboxSuccess",value:function(){var e;return(e=this.inboxNormalInstance).sendInboxSuccess.apply(e,arguments)}},{key:"sendInboxFail",value:function(){var e;return(e=this.inboxNormalInstance).sendInboxFail.apply(e,arguments)}},{key:"findContactId",value:function(e){var t=this;return this.isIGD?this.findIGDContact(e):this.init().then(d(l.a.mark((function r(){var n,a,o,i,c,u,p,d;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getCustomers(e);case 2:n=(n=r.sent).filter((function(t){return t.ig_profile_info&&t.ig_profile_info.username===e})),a=Lt(n),r.prev=5,a.s();case 7:if((o=a.n()).done){r.next=22;break}return i=o.value,r.next=11,t.listCustomerThreads(i.id,!0);case 11:return c=r.sent,u=s(c,2),p=u[0],d=u[1],r.next=17,t.getIgThreadDetail(d[0].token,!1);case 17:if(!r.sent.thread_users.nodes.find((function(t){return t.username===e}))){r.next=20;break}return r.abrupt("return",p);case 20:r.next=7;break;case 22:r.next=27;break;case 24:r.prev=24,r.t0=r.catch(5),a.e(r.t0);case 27:return r.prev=27,a.f(),r.finish(27);case 30:return r.abrupt("return",null);case 31:case"end":return r.stop()}}),r,null,[[5,24,27,30]])})))).then(function(){var e=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p,d,f,h,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==(null==t||null===(r=t.data)||void 0===r||null===(n=r.CrmUnifiedContact)||void 0===n||null===(a=n.instagram_direct_comms)||void 0===a||null===(s=a.edges)||void 0===s?void 0:s.length)){e.next=7;break}if(f=null==t||null===(o=t.data)||void 0===o||null===(i=o.CrmUnifiedContact)||void 0===i||null===(c=i.instagram_direct_comms)||void 0===c||null===(u=c.edges)||void 0===u?void 0:u[0],2!==(null==(h=null==f||null===(p=f.node)||void 0===p||null===(d=p.thread_users)||void 0===d?void 0:d.nodes)?void 0:h.length)){e.next=7;break}if(1!==(null==(v=null==h?void 0:h.map((function(e){return null==e?void 0:e.eimu_id})).filter((function(e){return e})))?void 0:v.length)){e.next=7;break}return e.abrupt("return",v[0]);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"findIGDContact",value:(u=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p,f,h,v,_,m,g,b,I,y,x,k;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.pageId&&self.igdUserFbIdCache&&self.igdUserFbIdCache["".concat(this.pageId,"_").concat(t)])){e.next=4;break}return n=self.igdUserFbIdCache["".concat(this.pageId,"_").concat(t)],C.log("Hit cache fb_id from ig user: ",n),e.abrupt("return",n);case 4:return a="https://www.instagram.com/".concat(t),e.next=7,re(a);case 7:return s=e.sent,e.next=10,this.initIGD(s);case 10:for(h in o=s.match(/\\?"profile_id\\?":\\?"(\d+)\\?"/i),i=(null==o?void 0:o[1])||"",C.log("findIGDContact: userId",i),c=s.match(/\\?"appId\\?":\\?"(\d+)\\?"/i),u=c[1],C.log("findIGDContact: appId",u),f=[],p={recipient_users:[i]})v=encodeURIComponent(h),_=encodeURIComponent(JSON.stringify(p[h])),f.push(v+"="+_);return f=f.join("&"),e.next=22,chrome.cookies.getAll({domain:"instagram.com",path:"/"});case 22:return g=e.sent,b=g.map((function(e){return"csrftoken"==e.name&&(m=(null==e?void 0:e.value)||""),"".concat((null==e?void 0:e.name)||"","=").concat((null==e?void 0:e.value)||"")})).join(";"),e.next=26,ae("https://www.instagram.com/api/v1/direct_v2/create_group_thread/",f,{},{headers:{"Content-Type":"application/x-www-form-urlencoded","X-Asbd-Id":129477,"Sec-Ch-Prefers-Color-Scheme":"dark","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Full-Version-List":'"Chromium";v="122.0.6261.112", "Not(A:Brand";v="24.0.0.0", "Google Chrome";v="122.0.6261.112"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Model":"","Sec-Ch-Ua-Platform":"macOS","Sec-Ch-Ua-Platform-Version":"13.4.1","Viewport-Width":1115,Cookie:b,"X-Csrftoken":m,Referer:a,"X-Ig-App-Id":u},parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 26:if(1!==(null==(I=e.sent)||null===(r=I.users)||void 0===r?void 0:r.length)){e.next=34;break}return k=null==I||null===(y=I.users)||void 0===y||null===(x=y[0])||void 0===x?void 0:x.interop_messaging_user_fbid,C.log("findIGDContact: contact_id",k),k&&this.pageId&&(self.igdUserFbIdCache||(self.igdUserFbIdCache={}),self.igdUserFbIdCache["".concat(this.pageId,"_").concat(t)]="".concat(k)),e.abrupt("return",k);case 34:return e.abrupt("return",null);case 35:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"initIGD",value:(i=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.base=new me,e.next=3,this.base.ctxFromHtml(t);case 3:this.graphql=new Rt({base:this.base,pageId:this.pageId,isIGD:!0});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"validSendIGDInbox",value:(a=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(self.currentLoginIGDPageId&&self.lastSyncCurrentLoginIGDPageId&&!((new Date).valueOf()-self.lastSyncCurrentLoginIGDPageId>3e5)){e.next=3;break}return e.next=3,this.syncCurrentLoginIGDPage();case 3:return e.abrupt("return","".concat(self.currentLoginIGDPageId)===(null===(t=this.pageId)||void 0===t?void 0:t.replace("igo_","")));case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"syncCurrentLoginIGDPage",value:(n=d(l.a.mark((function e(){var t,r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,re("https://www.instagram.com");case 4:t=e.sent,r=A(t,'["PolarisViewer",[],{"data":'),(null==(n=JSON.parse(r[0]))?void 0:n.fbid)&&(self.currentLoginIGDPageId=null==n?void 0:n.fbid,self.lastSyncCurrentLoginIGDPageId=(new Date).valueOf()),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),C.error("Encounter error while syncCurrentLoginIGDPage",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(){return n.apply(this,arguments)})}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a,s,o,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.html,a=r.pageId,s=r.isBusiness,t.next=3,Bt.makeInboxViewUrl(a,s);case 3:if(o=t.sent,self.externalGraphLog&&externalGraphLog.log(a,"preloadDocIds_inbox_instagram"),t.t0=n,t.t0){t.next=10;break}return t.next=9,re(o);case 9:t.t0=t.sent;case 10:if(!(i=t.t0)){t.next=28;break}if(i.match(/"selectedItem":{"id":"(\d+)"/)){t.next=19;break}if(!(c=i.match(/"compat_iframe_token":"([^"]+)"/))){t.next=19;break}return t.next=18,Bt.loadCompatView(o,c[1]);case 18:i=t.sent;case 19:return t.t1=At,t.t2=i,t.t3=[it,ct,"InstagramMessageThreadItemsWebGraphQLQuery","InstagramMessageThreadItemsQuery"],t.next=24,e.getExtraJsFilesToLoad(i);case 24:return t.t4=t.sent,t.t5={html:t.t2,docNames:t.t3,extraResource:t.t4},t.next=28,t.t1.loadDocIdsFromView.call(t.t1,t.t5);case 28:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"BizInboxSettingsLayout.react":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n.r);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}();Ot.preloadDocIds=F(Ot.preloadDocIds),self.InboxInstagram=Ot;var Pt=Ot,Dt=function(){function e(t){var r=t.pageId,n=t.threadId,a=t.threadKey,s=t.isBusiness,o=t.before,i=t.platform,c=t.customerName,u=t.conversationUpdatedTime,l=t.globalUserId;h(this,e),this.globalId=l,this.pageId=r,this.threadId=n,this.threadKey=a,this.isBusiness=s,this.before=o,this.platform=i,this.customerName=c,this.conversationUpdatedTime=u}var t,r,n,a,o;return _(e,[{key:"init",value:function(){switch(this.platform){case"facebook":case"":case null:return this.loadFacebookMessages();case"instagram_official":return this.loadIgMessages()}}},{key:"loadFacebookMessages",value:(o=d(l.a.mark((function t(){var r,n,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,At.isFeatureReady("loadMessages")){t.next=4;break}return t.next=4,e.preloadDocIds({pageId:this.pageId,isBusiness:this.isBusiness});case 4:return t.next=6,CCake.getInboxNormal(this.pageId);case 6:return r=t.sent,n=new Rt({pageId:this.pageId,base:r.base}),t.next=10,this.getGlobalId();case 10:return a=t.sent,t.next=13,n.graphqlbatch({batchName:"MessengerGraphQLThreadFetcher",graphqlQueries:this.getGraphqlQueries(a,this.before)});case 13:return s=t.sent,t.abrupt("return",{messages:s[0].data.message_thread.messages.nodes,globalId:a});case 17:return t.prev=17,t.t0=t.catch(0),C.error("FAIL TO LOAD FACEBOOK MESSAGES",t.t0),t.abrupt("return",Promise.reject(null));case 21:case"end":return t.stop()}}),t,this,[[0,17]])}))),function(){return o.apply(this,arguments)})},{key:"loadIgMessages",value:(a=d(l.a.mark((function e(){var t,r,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.log("LOADING IG MESSAGES OF CUSTOMER: ".concat(this.customerName)),t=new Pt({pageId:this.pageId,isBusiness:this.isBusiness}),e.next=4,t.init().then((function(){return t.findUserThread(n.customerName,!0)}));case 4:return r=e.sent,e.abrupt("return",{messages:r.thread_items.nodes,globalId:r.token});case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getGlobalId",value:(n=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.globalId){e.next=2;break}return e.abrupt("return",this.globalId);case 2:return t=D(this,["pageId","threadId","threadKey","isBusiness","conversationUpdatedTime"]),Object.assign(t,{postId:null,convId:null,convType:"INBOX"}),r=new Fe(t),e.abrupt("return",r.init());case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getGraphqlQueries",value:function(e,t){var r=At.get("MessengerThreadsWebGraphQLQuery","MessengerThreadsQuery");if(!r)throw"Missing doc_id ".concat("MessengerThreadsWebGraphQLQuery"," or ").concat("MessengerThreadsQuery");return[{doc_id:r,query_params:{id:e,load_messages:!0,message_limit:40,before:t}}]}}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a,o,i,c,u,p,d;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.html,a=r.pageId,o=r.isBusiness,self.externalGraphLog&&externalGraphLog.log(a,"preloadDocIds_get_facebook_messages"),t.next=4,Bt.makeInboxViewUrl(a,o);case 4:if(i=t.sent,c=[],t.t0=n,t.t0){t.next=11;break}return t.next=10,re(i);case 10:t.t0=t.sent;case 11:return u=t.t0,t.next=14,e.getExtraJsFilesToLoad(u,i);case 14:return p=t.sent,d=s(p,2),c=d[0],u=d[1],t.next=20,At.loadDocIdsFromView({html:u,docNames:["MessengerThreadsWebGraphQLQuery","MessengerThreadsQuery"],isLoadCompleted:function(){return At.isFeatureReady("loadMessages")},extraResource:c});case 20:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t,r){var n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=[],e.next=4,Bt.getExtraJsFilesToLoad(t);case 4:if(a=e.sent,0!==(n=n.concat(a)).length){e.next=18;break}if(t.match(/"selectedItem":{"id":"(\d+)"/)){e.next=18;break}if(!(s=t.match(/"compat_iframe_token":"([^"]+)"/))){e.next=18;break}return e.next=13,Bt.loadCompatView(r,s[1]);case 13:return t=e.sent,e.next=16,Bt.getExtraJsFilesToLoad(t);case 16:a=e.sent,n=n.concat(a);case 18:return e.abrupt("return",[n,t]);case 21:return e.prev=21,e.t0=e.catch(0),C.log("error",e.t0),e.abrupt("return",[]);case 25:case"end":return e.stop()}}),e,null,[[0,21]])}))),function(e,r){return t.apply(this,arguments)})}]),e}();Dt.preloadDocIds=F(Dt.preloadDocIds),self.GetFacebookMessages=Dt;self.MqttConnectSocket=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h(this,e),this.ctx=t,this.pageId=r,this.instagramPageId=n,this.count=-1,this.pendingSendMessages={},this.reConnectCount=0,this.connected=!1};new me,self.socketConns={};var Ut=function(){function e(t){var r=t.pageId;h(this,e),o(this,"checkCanReuploadPhotos",(function(e){return 1545012===e.error&&["Tạm thời không thực hiện được","Temporary Failure"].includes(e.errorSummary)&&["Đã xảy ra lỗi tạm thời, vui lòng thử lại.","There was a temporary error, please try again."].includes(e.errorDescription)})),this.ctx={clientID:(2147483648*Math.random()|0).toString(16)},this.base=new me,this.pageId=r,this.graphql=new Rt({pageId:r})}var t,r,n,a,i,u,p,v,m,g,b;return _(e,[{key:"generateOfflineThreadingID",value:function(){var e=Date.now(),t=Math.floor(4294967296*Math.random())+0;return t=("0000000000000000000000"+t.toString(2)).slice(-22),e=e.toString(2)+t,this.h(e.slice(-63))}},{key:"h",value:function(e){for(var t="";"0"!=e;){for(var r=0,n="",a=0;a<e.length;a++)(r=2*r+parseInt(e[a],10))>=10?(n+="1",r-=10):n+="0";t=r.toString()+t,e=n.slice(n.indexOf("1"))}return t}},{key:"sendInbox",value:function(e){var t=this,r=e.pageId,n=e.threadId,a=e.threadKey,s=e.globalUserId,o=e.isBusiness,i=e.platform,u=e.photoUrls,p=e.conversationUpdatedTime,h=e.customerName,v=e.accessToken,_=e.contentIds,m=e.tryResizeImage,g=(e.igThreadId,e.inboxIGInstance,e.igPageId,e.attachmentType,e.timeoutKey),b=e.retry||0;this.platform=i;var I=this.getSendAPIUrl(i);return new Promise(function(){var y=d(l.a.mark((function y(x,k){var w,S,E,T,A,R,L,N,O,P,D,U,B,F;return l.a.wrap((function(y){for(;;)switch(y.prev=y.next){case 0:if("facebook"!==i||s){y.next=2;break}return y.abrupt("return",t.getGlobalUserId({pageId:r,threadId:n,threadKey:a,isBusiness:o,conversationUpdatedTime:p,customerName:h}).then((function(r){Object.assign(e,{globalUserId:r}),t.sendInbox(e).then(x).catch(k)})).catch((function(e){console.log("error",e),k(e)})));case 2:return y.next=4,t.buildSendParams(e);case 4:if(w=y.sent,S=new FormData,Object.keys(w).map((function(e,t){var r=w[e];S.append(e,r)})),!t.refererUrl){y.next=10;break}return y.next=10,ee.set(I,t.refererUrl);case 10:if(E=g?V(g):"NO_TIMEOUT",C.warning("Time remain send inbox: ".concat(E)),null!==E){y.next=14;break}return y.abrupt("return",x({success:!1,retryReason:"execute task timeout"}));case 14:for(R in T={url:I,type:"POST",data:w,cache:!1,dataType:"text",headers:t.base.buildHeaders()},"number"==typeof E&&(T.timeout=E),"instagram"===i&&(T.contentType=!1,T.processData=!1,T.data=S),A=[],w)L=encodeURIComponent(R),N=encodeURIComponent(w[R]),A.push(L+"="+N);return A=A.join("&"),y.prev=20,O=(new Date).getTime(),y.next=24,ae(I,A,{},{headers:c(c({},t.base.buildHeaders()),{},{"Content-Type":"application/x-www-form-urlencoded"}),parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 24:if(P=y.sent,D=(new Date).getTime(),U=t.base.parseFbRes(P),!t.isResponseSuccess(U,i)){y.next=31;break}x(c(c({success:!0,retryReason:b?e.retryReason:null},t.parseSuccessResponse({response:U,platform:i,globalUserId:s,igThreadId:e.igThreadId})),{},{messageCreatedRange:[O,D]})),y.next=50;break;case 31:return B=![1545041].includes(null==(M=U)?void 0:M.error),y.next=34,t.getErrorHandler(r,U,b);case 34:y.t0=y.sent,y.next="retryUsingSocket"===y.t0?37:"restartInbox"===y.t0?38:"reuploadPhotos"===y.t0?41:"reuploadPhotosByApi"===y.t0?44:"cannotRetry"===y.t0?46:50;break;case 37:return y.abrupt("return",k({success:!1,canRetryUsingSocket:!0,retryReason:"blocked_3252001",fbErrorCode:null==U?void 0:U.error}));case 38:return C.warning("FAIL TO SEND MESSAGE TO FACEBOOK --\x3e RESTARTING INBOX NORMAL AND RETRY"),t.init(r,!0).then((function(){B&&CCake.checkOriginThenReloadListenerIfNeeds()})).then((function(){return t.init(r)})).then((function(){return t.sendInbox(c(c({},e),{},{retry:1,retryReason:"restartInbox"}))})).then(x).catch(k),y.abrupt("break",50);case 41:return F=u.map((function(e,n){return t.upload(e,r,n).then((function(e){return e.fbid}))})),Promise.all(F).then((function(r){return t.sendInbox(c(c({},e),{},{files:r,retry:1,retryReason:"reuploadPhotos"}))})).then(x).catch((function(){C.warning("FAIL TO SEND MESSAGE TO FACEBOOK --\x3e CANNOT RETRY"),k()})),y.abrupt("break",50);case 44:return t.uploadFacebookPhoto(r,{contentIds:_,accessToken:v,tryResizeImage:m}).then((function(r){return t.sendInbox(c(c({},e),{},{files:r.fb_ids,retry:1,retryReason:"reuploadPhotosByApi"}))})).catch((function(){k()})),y.abrupt("break",50);case 46:return C.warning("FAIL TO SEND MESSAGE TO FACEBOOK --\x3e CANNOT RETRY"),B&&CCake.checkOriginThenReloadListenerIfNeeds(),U&&U.errorDescription?"object"===f(U.errorDescription)?k(c(c({},U.errorDescription||{}),{},{fbErrorCode:null==U?void 0:U.error})):k({errorDescription:U.errorDescription,fbErrorCode:null==U?void 0:U.error}):k({fbErrorCode:null==U?void 0:U.error}),y.abrupt("break",50);case 50:y.next=57;break;case 52:y.prev=52,y.t1=y.catch(20),console.error("InboxNormal: Encounter error while sendInbox",y.t1),CCake.checkOriginThenReloadListenerIfNeeds(),k();case 57:case"end":return y.stop()}var M}),y,null,[[20,52]])})));return function(e,t){return y.apply(this,arguments)}}())}},{key:"retrySendMessageUsingSocket",value:(b=d(l.a.mark((function e(t,r,n,a,s){var o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(e){switch(a){case"VIDEO":var s=t.genNewAttTask(r);s.attachment_fbids=n.files,e.payload.tasks.push(s);break;case"PHOTO":var o=t.genNewAttTask(r);o.attachment_fbids=n.files,e.payload.tasks.push(o);break;case"STICKER":case"SEND_TEXT_ONLY":case"REPLY_MESSAGE":break;case"FILE":var i=t.genNewAttTask(r);i.attachment_fbids=n.files,e.payload.tasks.push(i)}return e},e.next=3,t.sendMqtt(n.text,r,o);case 3:i=e.sent,s&&s(i);case 5:case"end":return e.stop()}}),e)}))),function(e,t,r,n,a){return b.apply(this,arguments)})},{key:"isUploadBlocked",value:(g=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("uploadBlocked");case 2:if(!(r=e.sent)){e.next=8;break}return r=JSON.parse(r),n=r[t],a=n&&n.expiredAt,e.abrupt("return",a>Date.now());case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"setUploadBlocked",value:(m=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(3252001!=r.error&&!["You’re Temporarily Blocked"].includes(r.errorSummary)){e.next=9;break}return e.next=4,X.getItem("uploadBlocked");case 4:return(n=(n=e.sent)?JSON.parse(n):{})[t]={expiredAt:Date.now()+6048e5},e.next=9,X.setItem("uploadBlocked",JSON.stringify(n));case 9:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"uploadFacebookPhoto",value:function(e,t){var r=t.contentIds,n=t.accessToken,a=t.tryResizeImage,s={content_ids:JSON.stringify(r)},o="https://pages.fm/api/v1/pages/".concat(e,"/contents/facebook?access_token=").concat(n,"&is_reusable=",!1,"&try_resize=").concat(a,"&force_cache=",!0);return se(o,s)}},{key:"archiveConversation",value:function(e){var t=this,r=[1939455039,1939461367,1939496291,1939501863,1939507927,1939513967,1939519539],n=r[Math.floor(Math.random()*r.length)],a={source:"PagesManagerMessagesInterface",request_user_id:this.pageId,qpl_active_flow_ids:n};return a["ids[".concat(e,"]")]=!0,a=this.buildArchiveConvParams(a),new Promise(function(){var e=d(l.a.mark((function e(r,n){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae("https://business.facebook.com/ajax/mercury/change_archived_status.php",a,{},{headers:t.base.buildHeaders(),parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:s=e.sent,o=t.base.parseFbRes(s),t.isArchiveConvSuccess(o)?(C.log("RESPONSE_ARCHIVE_CONV",o),r({success:!0,response:o})):n(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("InboxNormal: Encounter error while archiveConversation",e.t0),n();case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"isArchiveConvSuccess",value:function(e){return e&&e.payload&&"server_change_archived_status"==e.payload.payload_source}},{key:"buildArchiveConvParams",value:function(e){return Object.assign(e,this.base.buildParams(),{__usid:this.base.generateUsid()})}},{key:"getErrorHandler",value:(v=d(l.a.mark((function e(t,r,n){var a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[1357004,1545012,1545006,3252001,1390008],1545012!==(null==r?void 0:r.error)||1!==n){e.next=4;break}return C.log("FALLBACK REPLY BY WS"),e.abrupt("return","retryUsingSocket");case 4:if(r){e.next=6;break}return e.abrupt("return","restartInbox");case 6:if(!0!==(null==r||null===(a=r.payload)||void 0===a?void 0:a.error_payload)||!["instagram_official","instagram"].includes(this.platform)||r.error){e.next=8;break}return e.abrupt("return","retryUsingSocket");case 8:if(s.includes(r.error)){e.next=10;break}return e.abrupt("return","cannotRetry");case 10:if(!this.checkCanReuploadPhotos(r)&&1545006!==r.error){e.next=18;break}return e.next=13,this.isUploadBlocked(t);case 13:if(e.sent){e.next=17;break}return e.abrupt("return","reuploadPhotos");case 17:return e.abrupt("return","reuploadPhotosByApi");case 18:if(3252001!==r.error&&1390008!==r.error){e.next=20;break}return e.abrupt("return","retryUsingSocket");case 20:return e.abrupt("return","restartInbox");case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return v.apply(this,arguments)})},{key:"getGlobalUserId",value:function(e){var t=D(e,["pageId","threadId","threadKey","isBusiness","conversationUpdatedTime","customerName"]);return Object.assign(t,{postId:null,convId:null,convType:"INBOX"}),new Fe(t).init()}},{key:"getSendAPIUrl",value:function(e){switch(e){case"facebook":return"https://business.facebook.com/messaging/send/";case"instagram":return"https://business.facebook.com/unified_inbox/instagram_direct/send/"}}},{key:"buildSendParams",value:(p=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p,d,f,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.pageId,n=t.globalUserId,a=t.files,s=t.text,o=t.platform,i=t.igThreadId,c=t.photoBlob,u=t.attachmentType,p=t.replyMessage,d={},f=this.generateOfflineThreadingID(),d.body=s||"",d.offline_threading_id=f,d.source="source:page_unified_inbox",d.timestamp=(new Date).getTime(),d.request_user_id=r,d=Object.assign(d,this.base.buildParams(),{__usid:this.base.generateUsid()}),e.t0=o,e.next="facebook"===e.t0?12:"instagram"===e.t0?28:34;break;case 12:if(!p){e.next=18;break}return e.next=15,this.findInternalMessage(t,p);case 15:h=e.sent,C.log("loadedReplyMessage:",h),d.replied_to_message_id=h.message_id;case 18:return d["specific_to_list[0]"]="fbid:"+n,d["specific_to_list[1]"]="fbid:"+r,d.other_user_fbid=n,d.message_id=f,d.client="mercury",d.action_type="ma-type:user-generated-message",d.ephemeral_ttl_mode=0,d.has_attachment=a&&a.length>0,a&&a.length>0&&("STICKER"==u?d.sticker_id=a[0]:"VIDEO"==u?a.forEach((function(e,t){d["video_ids["+t+"]"]=e})):"FILE"==u?a.forEach((function(e,t){d["file_ids["+t+"]"]=e})):"AUDIO"==u?a.forEach((function(e,t){d["audio_ids["+t+"]"]=e})):a.forEach((function(e,t){d["image_ids["+t+"]"]=e}))),e.abrupt("break",34);case 28:return d.client_thread_id=i,d.thread_fbid=i,d.source="source:page_unified_inbox",d.attachment_type="Image",d.attachment=c,e.abrupt("break",34);case 34:return e.abrupt("return",d);case 35:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"findInternalMessage",value:(u=d(l.a.mark((function e(t,r){var n,a,s,o,i,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=new Dt(c(c({},t),{},{before:r.timestamp})),e.next=3,p.init();case 3:if(d=e.sent,f=d.messages,h=d.globalId,v=r.from,_=r.insertedAt,m=r.message,g=v.id==t.pageId,null==(b=f.filter((function(e){var t,r,n=parseInt(parseInt(e.timestamp_precise)/1e3)==_,a=!m||(null==m?void 0:m.trim())==(null===(t=e.message)||void 0===t||null===(r=t.text)||void 0===r?void 0:r.trim()),s=g?"".concat(e.message_sender.id)=="".concat(v.id):"".concat(e.message_sender.id)=="".concat(h);return n&&a&&s})))?void 0:b.length){e.next=11;break}return e.abrupt("return",null);case 11:if(1!==(null==b?void 0:b.length)){e.next=13;break}return e.abrupt("return",b[0]);case 13:if(1!==(null==r||null===(n=r.attachments)||void 0===n?void 0:n.length)||"photo"!==(null==r||null===(a=r.attachments)||void 0===a||null===(s=a[0])||void 0===s?void 0:s.type)||!(null==r||null===(o=r.attachments)||void 0===o||null===(i=o[0])||void 0===i||null===(u=i.image_data)||void 0===u?void 0:u.preview_url)){e.next=17;break}return C.log("SEARCH REPLY MSG MESSAGE BY PHOTO URI"),k=this.getPhotoName(null==r||null===(I=r.attachments)||void 0===I||null===(y=I[0])||void 0===y||null===(x=y.image_data)||void 0===x?void 0:x.preview_url),e.abrupt("return",b.find((function(e){var t,r,n,a,s=1===(null==e||null===(t=e.blob_attachments)||void 0===t?void 0:t.length)&&(null==e||null===(r=e.blob_attachments)||void 0===r||null===(n=r[0])||void 0===n||null===(a=n.preview)||void 0===a?void 0:a.uri),o=w.getPhotoName(s);return!!k&&!!o&&k===o})));case 17:return C.log("SEARCH REPLY MSG MESSAGE BY MINIMUM timestamp_precise"),null==b||b.sort((function(e,t){return e.timestamp_precise-t.timestamp_precise})),e.abrupt("return",null==b?void 0:b[0]);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"getPhotoName",value:function(e){try{var t,r=new URL(e).pathname.split("/");return null===(t=r[r.length-1])||void 0===t?void 0:t.trim()}catch(e){return null}}},{key:"isResponseSuccess",value:function(e,t){switch(t){case"facebook":return e&&e.payload&&(e.payload.actions&&e.payload.actions[0].message_id||e.payload.error_payload);case"instagram":return e&&e.payload&&e.payload.item_token}}},{key:"parseSuccessResponse",value:function(e){var t=e.response,r=e.platform,n=e.globalUserId,a=e.igThreadId;switch(r){case"facebook":return t.payload.error_payload?{}:{messageId:t.payload.actions[0].message_id,globalUserId:n,timestamp:t.payload.actions[0].timestamp};case"instagram":return{globalUserId:a}}}},{key:"sendInboxSuccess",value:function(e,t,r,n){var a=this;return function(s){s&&s.success?e.port.postMessage({type:"REPLY_INBOX_PHOTO_SUCCESS",taskId:t,pageId:r,convId:n,messageId:s.messageId,globalUserId:s.globalUserId,timestamp:s.timestamp,retryReason:s.retryReason,messageCreatedRange:s.messageCreatedRange,unreliableTimestamp:s.unreliableTimestamp}):a.sendInboxFail(e,t,r,n)()}}},{key:"sendInboxFail",value:function(e,t,r,n){return function(a){console.log(a),e.port.postMessage({type:"REPLY_INBOX_PHOTO_FAILURE",taskId:t,pageId:r,convId:n,error:a})}}},{key:"upload",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n&&(this.platform=n);var a=this;return new Promise((function(n,s){new Promise((function(t,r){a.getBlob(e,t)})).then((function(e){a.uploadBlob(e,t,r).then(n).catch(s)}))}))}},{key:"getBlob",value:(i=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(t,{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 2:n=e.sent,r(n);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"uploadBlob",value:function(e,t,r){return this.doUpload(e,t,r)}},{key:"refineUploadIGAttachment",value:function(e){return"instagram_official"===this.platform?e+"&platform=INSTAGRAM_DIRECT":e}},{key:"doUpload",value:function(e,t,r){var n=this,a="instagram_direct"===this.platform,s=a?"https://www.instagram.com/ajax/mercury/upload.php?":"https://upload-business.facebook.com/ajax/mercury/upload.php?",o=this.base,i=o.buildParams();a&&(i.__d="www",i.__user="0",i.__comet_req=7,i.__ccg="GOOD",delete i.__pc),t&&!a&&(i.request_user_id=t),s+=o.serialize(i),s=this.refineUploadIGAttachment(s);var c=new FormData,u=a?"farr":"upload_".concat([1024,1025,1026,1027,1028,1029,1030,1031,1032,1033,1034][parseInt(10*Math.random())]);return c.append(u,e,r),new Promise(function(){var e=d(l.a.mark((function e(r,a){var o,i,u,p,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae(s,c,{},{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:return o=e.sent,i=CCake.base.parseFbRes(o),e.next=7,n.setUploadBlocked(t,i);case 7:u=i.payload,p=u.metadata&&u.metadata[0]&&u.metadata[0].fbid?u.metadata[0].fbid:null,f=u.metadata&&u.metadata[0]&&u.metadata[0].src?u.metadata[0].src:null,p||(p=u.metadata&&u.metadata[0]&&u.metadata[0].video_id?u.metadata[0].video_id:null),f||(f=u.metadata&&u.metadata[0]&&u.metadata[0].thumbnail_src?u.metadata[0].thumbnail_src:null),p||(p=u.metadata&&u.metadata[0]&&u.metadata[0].file_id?u.metadata[0].file_id:null),f||(f=u.metadata&&u.metadata[0]&&u.metadata[0].filename?u.metadata[0].filename:null),p||(p=u.metadata&&u.metadata[0]&&u.metadata[0].gif_id?u.metadata[0].gif_id:null),f||(f=u.metadata&&u.metadata[0]&&u.metadata[0].filename?u.metadata[0].filename:null),p&&f?r({fbid:p,previewUri:f}):(CCake.checkOriginThenReloadListenerIfNeeds(),a()),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),CCake.checkOriginThenReloadListenerIfNeeds(),a();case 23:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"reset",value:function(){this.ctx.clientID=(2147483648*Math.random()|0).toString(16),this.ctx.userID="",this.ctx.dtsg="",this.ctx.server_revision="",this.ctx.client_revision="",this.ctx.sync_sequence_id="",this.ctx.sequence_id="",this.ctx.spin="",this.ctx.__spin_r="",this.ctx.__spin_b="",this.ctx.__spin_t="",this.jsDefine="",this.refererUrl=null}},{key:"init",value:function(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.reset(),new Promise(function(){var a=d(l.a.mark((function a(o,i){var c,u,p,d,f,h,v,_;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.base.restoreBase(r.base,t);case 2:if(c=a.sent,n||3!=(null==c?void 0:c.length)){a.next=12;break}C.log("fallback_stored_base_data",c),u=s(c,3),p=u[0],d=u[1],f=u[2],r.base=p,r.cquick_token=d,r.refererUrl=f,o(),a.next=43;break;case 12:return a.next=14,e.makeInboxViewUrl(t);case 14:return h=a.sent,self.externalGraphLog&&externalGraphLog.log(t,"init_inbox_normal"),a.prev=16,a.next=19,re(h);case 19:return v=a.sent,a.next=22,r.base.ctxFromHtml(v);case 22:if(r.getCQuickToken(v),!r.base.Env||!r.base.Env.compat_iframe_token){a.next=28;break}h=r.base.getCompatIframeSource(h),r.base.load_html(h).then((function(){r.base.persistBase(t,r.cquick_token,h),o()})).catch(i),a.next=37;break;case 28:if(!r.cquick_token){a.next=35;break}return a.next=31,e.loadCompatView(h,r.cquick_token);case 31:_=a.sent,r.base.ctxFromHtml(_).then((function(){r.base.persistBase(t,r.cquick_token,h),o()})).catch(i),a.next=37;break;case 35:r.base.persistBase(t,r.cquick_token,h),o();case 37:r.refererUrl=h,a.next=43;break;case 40:a.prev=40,a.t0=a.catch(16),i();case 43:case"end":return a.stop()}}),a,null,[[16,40]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"getCQuickToken",value:function(e){var t=e.match(/"compat_iframe_token":"([^"]+)"/);t&&(this.cquick_token=t[1]),C.log("cquick_token",this.cquick_token)}},{key:"crawlLeadFormMsgDetail",value:function(t){var r=this;return new Promise(function(){var n=d(l.a.mark((function n(a,s){var o,i,c,u,p,d;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(o=t.match(/https:\/\/www.facebook.com\/(\d+)/))){n.next=24;break}if(i=o[1],At.has("ServicesCometLeadFormDialogRootQuery")){n.next=16;break}if(n.t0=r.cachedHTML,n.t0){n.next=13;break}return n.t1=re,n.next=9,e.makeInboxViewUrl(r.pageId);case 9:return n.t2=n.sent,n.next=12,(0,n.t1)(n.t2);case 12:n.t0=r.cachedHTML=n.sent;case 13:return c=n.t0,n.next=16,At.loadDocIdsFromView({html:c,docNames:["ServicesCometLeadFormDialogRootQuery"]});case 16:return u={responseID:i},p=r.businessGraph||(r.businessGraph=new Rt({pageId:r.pageId,isBussiness:!0,base:r.base})),n.next=20,p.graphql("ServicesCometLeadFormDialogRootQuery",u);case 20:d=n.sent,a(d),n.next=25;break;case 24:s();case 25:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}}],[{key:"preloadDocIds",value:(a=d(l.a.mark((function t(r){var n,a,s,o,i,c,u,p,d;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.html,a=r.pageId,s=r.isBusiness,self.externalGraphLog&&externalGraphLog.log(a,"preloadDocIds_inbox_normal"),t.next=4,e.makeInboxViewUrl(a,s);case 4:if(o=t.sent,C.log("Loading Facebook view. URL: ".concat(o)),t.t0=n,t.t0){t.next=11;break}return t.next=10,re(o);case 10:t.t0=t.sent;case 11:if(i=t.t0,C.log("Loaded Facebook view. HTML: ".concat(i)),c=i,!i){t.next=33;break}if(i.match(/"selectedItem":{"id":"(\d+)"/)){t.next=23;break}if(!(u=i.match(/"compat_iframe_token":"([^"]+)"/))){t.next=23;break}return t.next=21,e.loadCompatView(o,u[1]);case 21:i=t.sent,this.cquick_token=u[1];case 23:return t.next=25,e.getExtraJsFilesToLoad(c);case 25:return p=t.sent,d=[$e,Ze,et,tt],t.next=29,At.loadDocIdsFromView({html:i,docNames:d,isLoadCompleted:function(){return At.isFeatureReady("inbox")},extraResource:p});case 29:if(At.isFeatureReady("inbox")){t.next=33;break}return C.warning("InboxNormal.preloadDocIds: FALLBACK TO USING originalHtml. PAGE ID: ".concat(a)),t.next=33,At.loadDocIdsFromView({html:c,docNames:d,isLoadCompleted:function(){return At.isFeatureReady("inbox")},extraResource:p});case 33:case"end":return t.stop()}}),t,this)}))),function(e){return a.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(n=d(l.a.mark((function e(t){var r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=[],n=A(t,'"MessengerPlatformVerticalListItemAttachment.react":')[0],!(a=A(t,'"MessengerGraphQLThreadlistFetcher.bs":')[0])){e.next=9;break}return e.next=7,L(a);case 7:s=e.sent,r=r.concat(s.r);case 9:if(!n){e.next=14;break}return e.next=12,L(n);case 12:o=e.sent,r=r.concat(o.r);case 14:return e.abrupt("return",r);case 17:return e.prev=17,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),function(e){return n.apply(this,arguments)})},{key:"loadCompatView",value:(r=d(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.includes("?")?t+="&":t+="?",t+="cquick=jsc_c_d&cquick_token="+r+"&ctarget=https%3A%2F%2Fwww.facebook.com",e.next=4,re(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"makeInboxViewUrl",value:(t=d(l.a.mark((function e(t){var r,n,a,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]&&s[1],e.next=3,Re.get(t);case 3:n=e.sent,e.t0=n,e.next=1===e.t0||2===e.t0||5===e.t0?7:3===e.t0?10:4===e.t0?11:6===e.t0?12:7===e.t0?13:14;break;case 7:return a=r?"business.facebook.com":"www.facebook.com",5===n&&(a="web.facebook.com"),e.abrupt("return","https://".concat(a,"/").concat(t,"/inbox"));case 10:return e.abrupt("return","https://www.facebook.com/latest/inbox/all?asset_id=".concat(t,"&nav_ref=diode_page_inbox&mailbox_id=").concat(t));case 11:return e.abrupt("return","https://business.facebook.com/latest/inbox/all?asset_id=".concat(t,"&nav_ref=diode_page_inbox&mailbox_id=").concat(t));case 12:return e.abrupt("return","https://business.facebook.com/latest/inbox/messenger?asset_id=".concat(t,"&nav_ref=diode_page_inbox"));case 13:return e.abrupt("return","https://business.facebook.com/latest?asset_id=".concat(t));case 14:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();Ut.preloadDocIds=F(Ut.preloadDocIds),self.InboxNormal=Ut;var Bt=Ut,Ft=function(){function e(){h(this,e),this.ctx={clientID:(2147483648*Math.random()|0).toString(16)},this.accessToken="",this.started=!1,this.loop(),this.base=CCake.base}var t,r,n;return _(e,[{key:"setAccessToken",value:function(e){e&&this.accessToken!=e&&(this.started=!1,this.accessToken=e,this.startup())}},{key:"getPageIds",value:function(){var e="https://pages.fm/api/v1/pages?access_token=".concat(this.accessToken);return new Promise(function(){var t=d(l.a.mark((function t(r,n){var a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ne(e,{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:(a=t.sent).success&&a.categorized&&a.categorized.activated&&a.categorized.activated.length>0?(s=a.categorized.activated.find((function(e){return"facebook"==e.platform||!e.platform})),r(s.id)):n(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),n();case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"startup",value:(n=d(l.a.mark((function e(t){var r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.started=!1,this.accessToken){e.next=3;break}return e.abrupt("return");case 3:if(r=this,t){e.next=7;break}return this.getPageIds().then((function(e){r.startup(e)})),e.abrupt("return");case 7:return e.next=9,re("https://www.facebook.com/"+t+"/inbox/");case 9:if(n=e.sent,self.externalGraphLog&&externalGraphLog.log(t,"startup_sync_order_payment_with_facebook"),r.base.ctxFromHtml(n),(a=n.match(/\\?"USER_ID\\?":\\?"(\d+)\\?"/i))&&0!==a[1]&&"0"!==a[1]&&(r.ctx.userID=a[1]),(a=n.match(/"DTSGInitialData",\[\],{"token":"([^"]+)"/i))&&0!==a[1]){for(r.ctx.dtsg=a[1],s="2",o=0;o<r.ctx.dtsg.length;o++)s+=r.ctx.dtsg.charCodeAt(o);r.ctx.ttstamp=s}(a=n.match(/server_revision":(\d+)/))&&a[1]&&(r.ctx.server_revision=a[1]),(a=n.match(/client_revision":(\d+)/))&&a[1]&&(r.ctx.client_revision=a[1]),(a=n.match(/initSyncSequenceID":(\d+)/))&&a[1]&&(r.ctx.sync_sequence_id=a[1]),(a=n.match(/sequenceId":(\d+)/))&&a[1]&&(r.ctx.sequence_id=a[1]),(a=n.match(/"defaultCurrency":"([^"]+)"/))&&a[1]?r.currency=a[1]:r.currency="",r.ctx.userID&&(r.started=!0);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"loop",value:function(){var e=this;this.accessToken&&this.started?this.claim().then((function(){e.currentlyRunning=setTimeout(e.loop.bind(e),3e3)})).catch((function(){e.currentlyRunning=setTimeout(e.loop.bind(e),3e4)})):this.currentlyRunning=setTimeout(this.loop.bind(this),3e3)}},{key:"setSynced",value:(r=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,a="https://pages.fm/api/v1/shops/sync_order_payment_with_facebook/synced?access_token=".concat(this.accessToken),e.prev=2,e.next=5,se(a,{shop_id:t,order_id:r});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),setTimeout(n.setSynced.bind(n,t,r),3e3);case 10:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e,t){return r.apply(this,arguments)})},{key:"claim",value:(t=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,r="https://pages.fm/api/v1/shops/sync_order_payment_with_facebook/claim?access_token=".concat(this.accessToken),e.abrupt("return",new Promise(function(){var e=d(l.a.mark((function e(n,a){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ne(r,{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:(s=e.sent).success?t.sendPayment(s.data).then(n).catch(a):(s.continue||(t.started=!1),a()),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a();case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sendPayment",value:function(e){var t=this;return console.log(e),new Promise((function(r,n){if(e.global_id){var a=t.buildVariables(e);t.graphql("1241088092643730",a).then((function(){t.setSynced(e.shop_id,e.order_id),r()})).catch(n)}else CCake.getInboxNormal(e.page_id).then((function(a){a.getGlobalUserId(e.page_id,e.thread_id,!1).then((function(a){e.global_id=a.id,t.sendPayment(e).then(r).catch(n)})).catch(n)})).catch(n)}))}},{key:"graphql",value:function(e,t){console.log(t),t=encodeURI(JSON.stringify(t)),console.log(t);var r="https://www.facebook.com/webgraphql/mutation/?doc_id=".concat(e,"&variables=").concat(t,"&__a=1");console.log(r);var n=this;return new Promise(function(){var e=d(l.a.mark((function e(t,a){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,se(r,{__user:n.ctx.userID,__a:1,fb_dtsg:n.ctx.dtsg,__req:1,__be:1,__pc:"PHASED:DEFAULT",__rev:n.ctx.client_revision,jazoest:n.ctx.ttstamp?n.ctx.ttstamp:"",__spin_r:n.ctx.client_revision,__spin_b:"trunk",__spin_t:"1514187418"},{},{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:s=e.sent,o=parseFbRes(s),console.log(o),o&&o.payload&&o.payload.data&&o.payload.data.payment_invoice_create&&o.payload.data.payment_invoice_create.invoice_id?t():a(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),a();case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"buildVariables",value:function(e){return console.log(e),{data:{client_mutation_id:"www",actor_id:e.page_id,client:"pages_commerce",seller_id:e.page_id,buyer_id:e.global_id,is_buyer_initialized:!1,items:[{id:null,title:e.title,subtitle:null,currency_amount:{currency:this.currency,amount:"".concat(e.total_price)},quantity:"1",type:"shop"}],custom_shipping_options:null,notes:"Đơn hàng ".concat(e.order_display_id),invoice_type:"payment_confirmation",xmat_mid:null,referrer:"action_sheet",discount:{currency:this.currency,amount:"0"},interaction_id:null}}}}]),e}(),Mt=function(){function e(t,r,n,a,s,o,i){h(this,e),this.worker=t,this.pageId=r,this.postId=n,this.commentId=a,this.stickerId=s,this.message=o,this.taskId=i,this.base=CCake.base}return _(e,[{key:"send",value:function(){}}]),e}(),Gt=function(){function e(t,r){h(this,e),this.accessToken=t,this.page_id=r,this.ctx={clientID:(2147483648*Math.random()|0).toString(16)}}var t,r,n;return _(e,[{key:"reset",value:function(){this.shouldStop=!1,this.currentlyRunning=null,this.prev_list_posts=[],this.page=0}},{key:"stop",value:function(){this.shouldStop=!0,this.currentlyRunning&&(this.req&&this.req.abort(),clearTimeout(this.currentlyRunning),this.currentlyRunning=null)}},{key:"start",value:function(){this.currentlyRunning||this.startup()}},{key:"trigger_to_pancake",value:(n=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://pages.fm/api/v1/pages/".concat(this.page_id,"/rescue_mode_inbox?access_token=").concat(this.accessToken),e.next=3,se(r,{message_ids:t},{});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"startup",value:(r=d(l.a.mark((function e(t){var r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,e.next=3,re("https://www.facebook.com/"+this.page_id+"/inbox/");case 3:if(n=e.sent,self.externalGraphLog&&externalGraphLog.log(this.page_id,"startup_listen_inbox"),(a=n.match(/\\?"USER_ID\\?":\\?"(\d+)\\?"/i))&&0!==a[1]&&(r.ctx.userID=a[1]),(a=n.match(/"DTSGInitialData",\[\],{"token":"([^"]+)"/i))&&0!==a[1]){for(r.ctx.dtsg=a[1],s="2",o=0;o<dtsg.length;o++)s+=dtsg.charCodeAt(o);r.ctx.ttstamp=s}(a=n.match(/server_revision":(\d+)/))&&a[1]&&(r.ctx.server_revision=a[1]),(a=n.match(/client_revision":(\d+)/))&&a[1]&&(r.ctx.client_revision=a[1]),(a=n.match(/initSyncSequenceID":(\d+)/))&&a[1]&&(r.ctx.sync_sequence_id=a[1]),(a=n.match(/sequenceId":(\d+)/))&&a[1]&&(r.ctx.sequence_id=a[1]),r.reset(),r.listen();case 19:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"graphqlbatch",value:function(e,t,r){var n,a={o0:{doc_id:t,query_params:r}};return se("https://www.facebook.com/api/graphqlbatch/",{av:this.page_id,__user:this.ctx.userID,__a:1,fb_dtsg:this.ctx.dtsg,batch_name:e,__req:1,__be:1,__pc:"PHASED:DEFAULT",__rev:this.ctx.client_revision,jazoest:this.ctx.ttstamp?this.ctx.ttstamp:"",__spin_r:this.ctx.client_revision,__spin_b:"trunk",__spin_t:"1514187418",queries:JSON.stringify(a)},{},{parseResponse:(n=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})})}},{key:"listen",value:function(e){var t=this;if(!this.shouldStop&&ctx.loggedIn){e?this.page++:this.page=0;var r=this;this.graphqlbatch("MessengerGraphQLThreadlistFetcher","1890618264322526",{limit:10,before:null,tags:["INBOX"],isWorkUser:!1,includeDeliveryReceipts:!0,includeSeqID:!0}).always((function(e,n){if("success"==n){var a=JSON.parse(e.split("\n",2)[0]).o0.data.viewer.message_threads.nodes;t.handle_list_threads(a),r.currentlyRunning=setTimeout(r.listen.bind(r),200*Math.random()+18e4)}else r.currentlyRunning=setTimeout(r.listen.bind(r),200*Math.random()+50)}))}}},{key:"handle_list_threads",value:function(e){var t=this;e.forEach((function(e){t.load_list_messages(e.thread_key.other_user_id)}))}},{key:"load_list_messages",value:function(e){var t=this,r={id:e,message_limit:20,load_messages:!0,load_read_receipts:!1,before:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null};this.graphqlbatch("MessengerGraphQLThreadFetcher","1391523494281650",r).always((function(r,n){if(console.log(n),"success"==n){var a=JSON.parse(r.split("\n",2)[0]);console.log(a);var s=a.o0.data.message_thread.messages;t.handle_list_messages(e,s)}}))}},{key:"handle_list_messages",value:(t=d(l.a.mark((function e(t,r){var n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.nodes.map((function(e){return e.message_id})),e.next=3,this.trigger_to_pancake(n);case 3:(a=e.sent).success&&a.continue&&r.page_info&&r.page_info.has_previous_page&&(s=r.nodes[0].timestamp_precise,this.load_list_messages(t,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}();self.TRIED_LOAD_INBOX_COMMENT_THREAD_LIST_WRAPPER_QUERY=!1;var qt=function(){function e(t,r){h(this,e),this.accessToken=t,this.pageId=r,this.page=0;var n="CommentFb";this.cachePostsKey="".concat(n,"_").concat(r,"_posts"),this.cacheTargetPostsKey="".concat(n,"_").concat(r,"_target_posts"),this.cacheLastModifiedAt="".concat(n,"_").concat(r,"_LastModifiedAt"),this.cacheLastModifiedPostId="".concat(n,"_").concat(r,"_LastModifiedPostId"),this.targetPostList=new Map,this.lastModifiedAt=null,this.lastModifiedPostId=null}var t,r,n,a,s,o,i,c;return _(e,[{key:"prepareCache",value:(c=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadCached(this.cacheTargetPostsKey);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=new Map;case 5:return this.targetPostList=e.t0,e.next=8,this.loadCached(this.cacheLastModifiedAt);case 8:return this.lastModifiedAt=e.sent,e.next=11,this.loadCached(this.cacheLastModifiedPostId);case 11:this.lastModifiedPostId=e.sent;case 12:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"stop",value:function(){this.shouldStop=!0,this.currentlyRunning&&(clearTimeout(this.currentlyRunning),this.currentlyRunning=null)}},{key:"loadCached",value:(i=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem(t);case 2:if(!(r=e.sent)){e.next=16;break}if(e.prev=4,n=JSON.parse(r),t!=this.cachePostsKey&&t!=this.cacheTargetPostsKey){e.next=10;break}return e.abrupt("return",new Map(U(n)));case 10:return e.abrupt("return",n);case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(4),e.abrupt("return",null);case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[4,13]])}))),function(e){return i.apply(this,arguments)})},{key:"saveCache",value:function(e,t){var r=t;e!=this.cachePostsKey&&e!=this.cacheTargetPostsKey||(r=B(t)),X.setItem(e,JSON.stringify(r))}},{key:"saveCaches",value:function(){this.saveCache(this.cacheTargetPostsKey,this.targetPostList),this.saveCache(this.cacheLastModifiedAt,this.lastModifiedAt)}},{key:"init",value:(o=d(l.a.mark((function t(){var r=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.prepareCache();case 2:return t.abrupt("return",new Promise(function(){var t=d(l.a.mark((function t(n,a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(At.isFeatureReady("listenFbComment")){t.next=3;break}return t.next=3,e.preloadDocIds({pageId:r.pageId,isBusiness:r.isBusiness});case 3:return t.next=5,CCake.getInboxNormal(r.pageId);case 5:r.inboxNormalInstance=t.sent,r.graphQLInstance=new Rt({pageId:r.pageId,base:r.inboxNormalInstance.base,isBussiness:!0}),n();case 8:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"loadPosts",value:(s=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p=this,f=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:null,!this.shouldStop){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.init();case 5:return e.prev=5,r={filterStatus:"TODO",platformFilter:"FACEBOOK",filterIsReadStatus:null,filterOwnerID:null,isStarsComment:!1,isHighlightedComment:!1,count:20,filterType:null},r=t?Object.assign(r,{id:this.pageId,cursor:t}):Object.assign(r,{pageID:this.pageId,cursor:null}),e.next=10,this.graphQLInstance.graphql(t?"BizInboxCommentThreadListQuery":pt,r);case 10:if(!(n=e.sent).error){e.next=15;break}return this.currentlyRunning&&clearTimeout(this.currentlyRunning),this.currentlyRunning=setTimeout(this.loadPosts.bind(this),18e5),e.abrupt("return");case 15:if(a=n.data.page?n.data.page.business_comm_items:n.data.node.business_comm_items,0!=(s=a.edges).length){e.next=19;break}return e.abrupt("return");case 19:return t||(this.nextLastModifiedAt=s[0].node.last_modified_at,this.nextLastModifiedPostID=s[0].node.id),o=this.hasUpdatePosts(s),i=this,c=o.map(function(){var e=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getTargetPostId(t.node.id);case 2:r=e.sent,i.trigger_post_to_pancake(r,t.node.last_modified_at);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=25,Promise.all(c);case 25:if(u=!1,!this.lastModifiedAt&&this.page<=5&&(u=!0),!u&&this.lastModifiedAt&&s.length==o.length&&a.page_info&&a.page_info.has_next_page&&(u=!0),!u){e.next=34;break}return this.page++,e.next=32,this.loadPosts(a.page_info.end_cursor);case 32:e.next=38;break;case 34:this.nextLastModifiedAt&&(this.lastModifiedAt=this.nextLastModifiedAt,this.lastModifiedPostId=this.nextLastModifiedPostID,this.nextLastModifiedAt=null,this.nextLastModifiedPostID=null),this.saveCaches(),this.currentlyRunning&&clearTimeout(this.currentlyRunning),this.currentlyRunning=setTimeout(this.loadPosts.bind(this),3e5);case 38:e.next=46;break;case 40:e.prev=40,e.t0=e.catch(5),console.error(e.t0),this.currentlyRunning&&clearTimeout(this.currentlyRunning),this.currentlyRunning=setTimeout(this.loadPosts.bind(this),3e5),this.saveCaches();case 46:case"end":return e.stop()}}),e,this,[[5,40]])}))),function(){return s.apply(this,arguments)})},{key:"hasUpdatePosts",value:function(e){var t=this;return this.lastModifiedAt&&(e=e.filter((function(e){return e.node.last_modified_at>=t.lastModifiedAt&&e.node.id!=t.lastModifiedPostId}))),e.length>0&&(!this.lastModifiedAt||(this.lastModifiedAt,e[0].node.last_modified_at)),e}},{key:"getTargetPostId",value:(a=d(l.a.mark((function e(t){var r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.targetPostList.get(t))){e.next=3;break}return e.abrupt("return",this.decode_post_id(r));case 3:return n={commItemID:t},e.next=6,this.graphQLInstance.graphql(dt,n);case 6:return a=e.sent,this.targetPostList.set(t,a.data.commItem.target_id),s=a.data.commItem.target_id,e.abrupt("return",this.decode_post_id(s));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"decode_post_id",value:function(e){return atob(e).match(/:(?:VK:)?(\d+)/)[1]}},{key:"trigger_post_to_pancake",value:(n=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://pages.fm/api/v1/pages/".concat(this.pageId,"/rescue_mode?access_token=").concat(this.accessToken),e.next=3,se(n,{type:"COMMENT",post_id:t,updated_at:r});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.pageId,r.isBusiness,!(At.has(pt)&&At.has(dt)&&self.TRIED_LOAD_INBOX_COMMENT_THREAD_LIST_WRAPPER_QUERY)){t.next=3;break}return t.abrupt("return");case 3:return self.TRIED_LOAD_INBOX_COMMENT_THREAD_LIST_WRAPPER_QUERY=!0,a="https://business.facebook.com/latest/inbox/facebook?asset_id=".concat(n,"&mailbox_id=&selected_item_id=&thread_type=FB_PAGE_POST"),self.externalGraphLog&&externalGraphLog.log(n,"preloadDocIds_listen"),t.next=8,re(a);case 8:if(!(s=t.sent)){t.next=26;break}if(s.match(/"selectedItem":{"id":"(\d+)"/)){t.next=17;break}if(!(o=s.match(/"compat_iframe_token":"([^"]+)"/))){t.next=17;break}return t.next=16,Bt.loadCompatView(a,o[1]);case 16:s=t.sent;case 17:return t.t0=At,t.t1=s,t.t2=[pt,"BizInboxCommentThreadListQuery",dt],t.next=22,e.getExtraJsFilesToLoad(s);case 22:return t.t3=t.sent,t.t4={html:t.t1,docNames:t.t2,extraResource:t.t3},t.next=26,t.t0.loadDocIdsFromView.call(t.t0,t.t4);case 26:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"BizInboxSettingsLayout.react":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n.r);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Ht=function(){function e(t){h(this,e),this.pageId=t,this.base=new me}var t;return _(e,[{key:"needsReStartup",value:function(){var e=this.base.m_request_config;return!e||!e.dtsg||1e3*e.dtsg.expire<(new Date).getTime()}},{key:"startup",value:function(){var e=this;return new Promise(function(){var t=d(l.a.mark((function t(r,n){var a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a="https://m.facebook.com/messages/?pageID=".concat(e.pageId,"&ref=bookmarks"),t.prev=1,t.next=4,re(a);case 4:return s=t.sent,t.next=7,e.base.ctxFromHtml(s);case 7:r(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("InboxMobile: Encounter error while processing startup",t.t0),n(t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(e,r){return t.apply(this,arguments)}}())}},{key:"buildUrl",value:function(){return"https://m.facebook.com/messages/send/?icm=1&pageID="+this.pageId+"&entrypoint=web%3Atrigger%3Athread_list_thread"}},{key:"buildAttachment",value:function(e,t){var r={};if("PHOTO"==e)t&&t.length>0&&t.forEach((function(e){r["photo_ids["+e+"]"]=e}));else{if("SEND_TEXT_ONLY"==e)return{};r.sticker_id=t[0]}return r}},{key:"buildParams",value:function(e,t,r,n){var a=this.base.buildMParams(),s={tids:"cid.c.".concat(e,":").concat(this.pageId),wwwupp:"C3"};return s["tids["+e+"]"]=e,Object.assign(s,{body:t,waterfall_source:"message"},this.buildAttachment(r,n),{action_time:(new Date).getTime(),m_sess:""},a)}},{key:"send",value:(t=d(l.a.mark((function e(t,r,n,a,s,o){var i,c,u,p,f,h,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n.replace(/^t_/,""),this.message=a,this.files=o,i=this.buildUrl(),c=this.buildParams(n,a,s,o),u=this,e.next=8,CCake.validateConnect();case 8:if(e.prev=8,p=se(i,c,{},{headers:Object.assign({"x-requested-with":"XMLHttpRequest","x-response-format":"JSONStream","x-msgr-region":"ATN"},this.base.buildHeaders()),parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),u.base.ctxFromHtml(p),e.prev=11,f=u.base.parseFbRes(p),!u.returnIsSuccess(f)){e.next=16;break}return r.port.postMessage({type:"REPLY_INBOX_PHOTO_SUCCESS",taskId:t,pageId:u.pageId,convId:n,messageId:t}),e.abrupt("return");case 16:e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(11),console.error(e.t0),!(h=p.match(/MTouchChannelPayloadRouter.+\\"mid\\":\\"([^\\"]+)\\"/i))){e.next=26;break}return v=h[1].replace("mid","m_mid"),r.port.postMessage({type:"REPLY_INBOX_PHOTO_SUCCESS",taskId:t,pageId:u.pageId,convId:n,messageId:v}),e.abrupt("return");case 26:r.port.postMessage({type:"REPLY_INBOX_PHOTO_FAILURE",taskId:t}),e.next=33;break;case 29:e.prev=29,e.t1=e.catch(8),console.log("REPLY_INBOX_PHOTO_FAILURE"),r.port.postMessage({type:"REPLY_INBOX_PHOTO_FAILURE",taskId:t});case 33:case"end":return e.stop()}}),e,this,[[8,29],[11,18]])}))),function(e,r,n,a,s,o){return t.apply(this,arguments)})},{key:"returnIsSuccess",value:function(e){if(!e)return!1;if(!e.payload)return!1;if(!e.payload.actions)return!1;for(var t=0;t<e.payload.actions.length;t++){var r=e.payload.actions[t];if(r.target="messaging_compose_error")return'<div id="messaging_compose_error"></div>'==r.html}return!1}}]),e}(),jt=function(){function e(t){h(this,e),this.pageId=t}var t,r,n,a,s;return _(e,[{key:"init",value:(s=d(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(At.isFeatureReady("sticker")){t.next=3;break}return t.next=3,e.preloadDocIds();case 3:return t.next=5,CCake.getInboxNormal(this.pageId);case 5:this.inboxNormalInstance=t.sent,this.graphQLInstance=new Rt({pageId:this.pageId,base:this.inboxNormalInstance.base});case 7:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"getListStickers",value:(a=d(l.a.mark((function e(){var t,r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={scale:1.5,stickerInterface:"COMMENTS"},e.next=3,this.graphQLInstance.graphql("CometStickerPickerCardQuery",t);case 3:return r=e.sent,e.prev=4,n=r.data.picker_plugins.sticker_picker.sticker_store.tray_packs.edges.map((function(e){return e.node})),e.abrupt("return",n);case 9:return e.prev=9,e.t0=e.catch(4),C.error("FAIL TO GET STICKER PACK LIST",e.t0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(){return a.apply(this,arguments)})},{key:"getPackStickers",value:(n=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={packID:t,stickerWidth:68,stickerHeight:68,scale:1.5},e.next=3,this.graphQLInstance.graphql("CometStickerPickerPackContentRootQuery",r);case 3:return n=e.sent,e.prev=4,a=n.data.sticker_pack.stickers.edges.map((function(e){return e.node})),e.abrupt("return",a);case 9:return e.prev=9,e.t0=e.catch(4),C.error("FAIL TO GET STICKER PACK CONTENT",e.t0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(e){return n.apply(this,arguments)})}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(){var r,n,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=["278992552121199","349211235171565","545385972154478","275648462478015"][Math.floor(4*Math.random())],n="https://www.facebook.com/".concat(r),t.next=5,re(n);case 5:if(!(a=t.sent)){t.next=12;break}return t.next=9,e.getExtraJsFilesToLoad(a);case 9:return s=t.sent,t.next=12,At.loadDocIdsFromView({html:a,docNames:["CometStickerPickerCardQuery","CometStickerPickerPackContentRootQuery"],extraResource:s});case 12:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"CometStickerPickerCard.react":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n.r);case 10:return e.prev=10,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}();self.Stickers=jt;var zt=function(){function e(t,r,n,a,s){h(this,e),this.pageId=r,this.worker=t,this.convId=n,this.accessToken=a,this.taskId=s}return _(e,[{key:"get",value:function(){var e=d(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,CCake.validateConnect();case 2:chrome.tabs.query({currentWindow:!0,active:!0},function(){var e=d(l.a.mark((function e(r){var n,a,s,o,i,c,u,p,f,h,v,_,m,g;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r[0].url,a=-1==n.indexOf("localhost")?"https://pages.fm/api":"http://localhost:4000/api",e.next=4,ne(a,{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 4:if(!(s=e.sent).success){e.next=25;break}return o=s.conversation.post_id,e.next=9,re("https://facebook.com/".concat(o));case 9:if(i=e.sent,c=/<meta property=\"og:description\" content=\"([^"]+)\"/,u=/<meta property=\"og:title\" content=\"(.*?)\"/.exec(i),p=c.exec(i),f=!!u[1]&&t.he.decode(u[1]),h=!!p[1]&&t.he.decode(p[1]),!f||!h){e.next=25;break}return v=/\[\"CommerceProductItemImageBrowser.react\".*\"images\":(\[[^\]]+\])/.exec(i),_=(_=v[1])?(_=JSON.parse(v[1])).map((function(e){return{url:e.uri,image_data:{width:e.width,height:e.height}}})):[],m="".concat(a,"/v1/pages/").concat(t.pageId,"/posts/").concat(o,"/fetch?access_token=").concat(t.accessToken),g={product_id:productId,title:f,description:h,images:_},e.next=25,ae(m,g);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Vt=function(){function e(t,r,n,a,s,o,i){h(this,e),this.worker=t,this.pageId=r,this.postId=n,this.commentId=a,this.stickerId=s,this.message=o,this.taskId=i,this.base=CCake.base}var t;return _(e,[{key:"send",value:(t=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,f,h,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,CCake.validateConnect();case 3:return e.next=5,re("https://m.facebook.com/story.php?",{story_fbid:t.postId,id:t.pageId,fs:5});case 5:return r=e.sent,t.base.ctxFromHtml(r),n=r.match(/gfid=(.{16})/g),a=n[n.length-1].substring(5),s=t.commentId,o=s.split("_")[1],i=s.split("_")[0],c="https://m.facebook.com/a/comment.php?parent_comment_id="+o+"&parent_redirect_comment_token="+s+"&fs=0&comment_logging&reply_permalink=1&ft_ent_identifier="+i+"&gfid="+a+"&av="+t.pageId,u={sticker_id:t.stickerId,comment_text:t.message,m_sess:"",fb_dtsg:t.base.ctx.dtsg,__req:"b",__ajax__:"true",__user:t.base.ctx.userID},e.prev=14,e.next=17,ae(c,u,{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 17:p=e.sent,t.base.ctxFromHtml(p),f=p.match(/data-commentid=\\"([0-9]*)_([0-9]*)/g)||p.match(/data-commentid=\\\\\\"([0-9]*)_([0-9]*)/g),h=p.match(/data-commentid=\\"([0-9]*)_([0-9]*)/g)?"LESS_SLASH":"MORE_SLASH",f?(v="MORE_SLASH"==h?f[0].substring(21):f[0].substring(17),t.worker.port.postMessage({type:"SEND_STICKER_COMMENT_SUCCESS",taskId:t.taskId,messageId:v})):(console.log("Not found message_id"),t.worker.port.postMessage({type:"SEND_STICKER_COMMENT_FAILURE",taskId:t.taskId})),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(14),t.worker.port.postMessage({type:"SEND_STICKER_COMMENT_FAILURE",taskId:t.taskId});case 27:case"end":return e.stop()}}),e,this,[[14,24]])}))),function(){return t.apply(this,arguments)})}]),e}();function Wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Kt={vi:["Độc thân","Hẹn hò","Đã đính hôn","Đã kết hôn","Kết hôn đồng giới","Chung sống","Tìm hiểu","Có mối quan hệ phức tạp","Đã ly thân","Đã ly hôn","Góa"],en:["Single","In a relationship","Engaged","Married","In a civil union","In a domestic partnership","In an open relationship","It's complicated","Seperated","Divorced","Widow"]},Qt={customerPlaces:"current_city",customerGender:"gender",customerJob:"work",customerRelationship:"relationship"},Yt=function(){function e(t){var r=this,n=t.globalId,a=t.pageId,s=t.convId,i=t.convType,c=t.postId,u=t.threadId,p=t.isBusiness,f=t.conversationUpdatedTime;h(this,e),o(this,"get",d(l.a.mark((function e(){var t,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.log("BEGIN GET PROFILE INFO"),e.next=3,M({min:3e3,max:6e3});case 3:return e.next=5,r.graphql.graphql("ProfileCometAboutAppSectionQuery",{appSectionFeedKey:"",collectionToken:null,pageID:r.pageId,rawSectionToken:"",scale:1,sectionToken:"",showReactions:!0,userID:r.globalId,__relay_internal__pv__CometUFIReactionsEnableShortNamerelayprovider:!1},{__aaid:0,__comet_req:15,server_timestamps:!0},!1,function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:return t=e.sent,e.next=8,r.fetchOverviewInfo(t);case 8:return n=e.sent,e.next=11,M({min:3e3,max:6e3});case 11:return e.next=13,r.fetchGenderInfo(t);case 13:return a=e.sent,s=Object.assign({globalId:r.globalId},n,a),C.log("FINISH GET PROFILE INFO:",s),e.abrupt("return",s);case 17:case"end":return e.stop()}}),e)})))),this.globalId=n,this.pageId=a,this.convId=s,this.convType=i,this.postId=c,this.threadId=u,this.isBusiness=p,this.conversationUpdatedTime=f,this.base=new me,this.graphql=new Rt({pageId:this.pageId,base:this.base})}var t,r,n,a,i,c,u,p;return _(e,[{key:"init",value:(p=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeProfileInfoLink();case 2:return t=e.sent,e.next=5,this.fetchHtml(t);case 5:return r=e.sent,e.next=8,this.base.ctxFromHtml(r);case 8:if(At.isFeatureReady("personalInfo")){e.next=11;break}return e.next=11,At.loadDocIdsFromView({html:r,docNames:["ProfileCometAboutAppSectionQuery"]});case 11:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"fetchHtml",value:(u=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"extractOverviewInfo",value:(c=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=A(t,'"profile_fields":'),e.next=3,L(r[0]);case 3:return r=e.sent,e.abrupt("return",this.getFieldsInfoFromNodes(r.nodes));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchOverviewInfo",value:(i=d(l.a.mark((function e(t){var r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.extractOverviewInfo(t);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),C.log("Encounter error while fetchOverviewInfo plan A");case 9:if(e.prev=9,a=A(t,'"nav_collections":'),s=JSON.parse(a[0]),!(o=null===(r=s.nodes)||void 0===r||null===(n=r.find((function(e){var t;return null==e||null===(t=e.url)||void 0===t?void 0:t.endsWith("/about_overview")})))||void 0===n?void 0:n.url)){e.next=20;break}return e.next=16,re(o);case 16:return i=e.sent,e.next=19,this.extractOverviewInfo(i);case 19:return e.abrupt("return",e.sent);case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(9),C.log("Encounter error while fetchOverviewInfo plan B",e.t1);case 25:return e.abrupt("return",{});case 26:case"end":return e.stop()}}),e,this,[[0,6],[9,22]])}))),function(e){return i.apply(this,arguments)})},{key:"getFieldsInfoFromNodes",value:function(e){var t,r=this,n={},a=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Wt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Wt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}(U(Qt));try{var o=function(){var a=s(t.value,2),o=a[0],i=a[1],c=e.find((function(e){return e.field_type===i}));if(!c)return"continue";var u=r.getFieldContent(c,i);if(!u)return"continue";n[o]=u};for(a.s();!(t=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return n}},{key:"getFieldContent",value:function(e,t){try{switch(t){case"work":return e.title.text;case"gender":return function(e){switch(e){case"Male":case"male":case"Nam":case"nam":return"male";case"Female":case"female":case"Nữ":case"nữ":return"female";default:return e}}(e.title.text);case"relationship":return function(e){for(var t=0,r=Object.values(Kt);t<r.length;t++){var n=r[t].findIndex((function(t){return e.includes(t)}));if(-1!==n)return Kt.en[n]}}(e.renderer.field.text_content.text);case"current_city":return e.title.text.replace(/Sống tại|Lives in/i,"").trim()}}catch(e){return C.log(e),null}}},{key:"extractGenderInfo",value:(a=d(l.a.mark((function e(t){var r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=A(t,'"about_app_sections":'),e.next=3,L(r[0]);case 3:return r=e.sent,n=r.nodes.find((function(e){var t=e.name;return["About","Giới thiệu"].includes(t)})).all_collections.nodes.find((function(e){var t=e.name;return["Contact and basic info","Thông tin liên hệ và cơ bản"].includes(t)})).url,e.next=7,this.fetchHtml(n);case 7:return a=e.sent,s=A(a,'"field_section_type":"basic_info","profile_fields":'),e.next=11,L(s[0]);case 11:return s=e.sent,e.abrupt("return",this.getFieldsInfoFromNodes(s.nodes));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"fetchGenderInfo",value:(n=d(l.a.mark((function e(t){var r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.extractGenderInfo(t);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),C.log(e.t0);case 9:if(e.prev=9,a=A(t,'"nav_collections":'),s=JSON.parse(a[0]),!(o=null===(r=s.nodes)||void 0===r||null===(n=r.find((function(e){var t;return null==e||null===(t=e.url)||void 0===t?void 0:t.endsWith("/about_contact_and_basic_info")})))||void 0===n?void 0:n.url)){e.next=20;break}return e.next=16,re(o);case 16:return i=e.sent,e.next=19,this.extractGenderInfo(i);case 19:return e.abrupt("return",e.sent);case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(9),C.log("Encounter error while fetchGenderInfo plan B",e.t1);case 25:return e.abrupt("return",{});case 26:case"end":return e.stop()}}),e,this,[[0,6],[9,22]])}))),function(e){return n.apply(this,arguments)})},{key:"makeProfileInfoLink",value:(r=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.globalId){e.next=3;break}return e.next=3,this.getGlobalId();case 3:return e.abrupt("return","https://facebook.com/".concat(this.globalId,"/about"));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getGlobalId",value:(t=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Fe({pageId:this.pageId,postId:this.postId,convId:this.convId,convType:this.convType,threadId:this.threadId,isBusiness:this.isBusiness,conversationUpdatedTime:this.conversationUpdatedTime}),e.next=3,t.init();case 3:r=e.sent,this.globalId=r;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();self.GetProfileInfo=Yt;var Jt={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"},Xt=function(){function e(t){var r=t.globalId,n=t.pageId,a=t.convId,s=t.convType,o=t.postId,i=t.threadId,c=t.isBusiness,u=t.conversationUpdatedTime;h(this,e),this.globalId=r,this.pageId=n,this.convId=a,this.convType=s,this.postId=o,this.threadId=i,this.isBusiness=c,this.conversationUpdatedTime=u}var t,r,n;return _(e,[{key:"init",value:(n=d(l.a.mark((function e(){var t,r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.makeBirthdayInfoLink();case 2:return t=e.sent,C.log("BIRTHDAY INFO LINK: ",t),e.next=6,re(t);case 6:if(r=e.sent,n=/"field_section_type":"basic_info","profile_fields":{(.+)}}],/,!(a=(a=r.match(n))&&a[1])){e.next=19;break}return s=A(a,'"nodes":'),e.next=14,L(s[0]);case 14:return s=e.sent,C.log("FIND BIRTHDAY OBJ DATA: ",s),e.abrupt("return",this.handleBirthdayData(s));case 19:return e.abrupt("return",{});case 20:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleBirthdayData",value:function(e){var t={},r=e.filter((function(e){return"birthday"==e.field_type}));return r.length<2?(C.error("FULL USER BIRTHDAY IS NOT PUBLIC"),{}):(r.map((function(e){if("Birth date"===e.list_item_groups[0].list_items[0].text.text){var r=e.title.text.split(" ");t.date=r[0],t.month=Jt[r[1]]}else t.year=e.title.text})),C.log("USER BIRTHDAY: ",t),t)}},{key:"makeBirthdayInfoLink",value:(r=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.globalId){e.next=3;break}return e.next=3,this.getGlobalId();case 3:return e.abrupt("return","https://www.facebook.com/profile.php?id=".concat(this.globalId,"&sk=about_contact_and_basic_info"));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getGlobalId",value:(t=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Fe({pageId:this.pageId,postId:this.postId,convId:this.convId,convType:this.convType,threadId:this.threadId,isBusiness:this.isBusiness,conversationUpdatedTime:this.conversationUpdatedTime}),e.next=3,t.init();case 3:r=e.sent,this.globalId=r;case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function $t(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Zt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var er=function(){function e(t,r,n,a,s){h(this,e),this.pageId=r,this.postIds=t,this.maxInvite=n,this.worker=a,this.taskId=s,this.totalInvited=0,this.reactionCount={}}var t,r,n,a,o,i,c,u,p,f;return _(e,[{key:"init",value:(f=d(l.a.mark((function t(){var r,n,a,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.postIds.length){t.next=2;break}return t.abrupt("return");case 2:return this.worker.port.postMessage({type:"INVITE_LIKE_PAGE_START",taskId:this.taskId}),t.next=5,ee.set("https://business.facebook.com/api/graphql/","https://business.facebook.com/latest/inbox/facebook?asset_id=".concat(this.pageId));case 5:return t.next=7,re("https://www.facebook.com/".concat(this.pageId),{headers:{"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"same-origin"}});case 7:return r=t.sent,n=new me,t.next=11,n.ctxFromHtml(r);case 11:if(this.graphql=new Rt({pageId:this.pageId,base:n}),At.isFeatureReady("inviteLikePage")){t.next=15;break}return t.next=15,e.preloadDocIds({pageId:this.pageId,postId:this.postIds[0],base:n});case 15:a=$t(this.postIds),t.prev=16,a.s();case 18:if((s=a.n()).done){t.next=33;break}return o=s.value,t.prev=20,t.next=23,this.inviteOnOnePost(o);case 23:t.next=31;break;case 25:if(t.prev=25,t.t0=t.catch(20),C.error("FAIL TO INVITE POST ".concat(o),t.t0),this.notifyActionOnPost("endPost",{postId:o,error:t.t0}),"Exceed invite limit"!==t.t0){t.next=31;break}return t.abrupt("break",33);case 31:t.next=18;break;case 33:t.next=38;break;case 35:t.prev=35,t.t1=t.catch(16),a.e(t.t1);case 38:return t.prev=38,a.f(),t.finish(38);case 41:this.worker.port.postMessage({type:"INVITE_LIKE_PAGE_END",taskId:this.taskId,isExceedLimit:this.isExceedInviteLimit()});case 42:case"end":return t.stop()}}),t,this,[[16,35,38,41],[20,25]])}))),function(){return f.apply(this,arguments)})},{key:"inviteOnOnePost",value:(p=d(l.a.mark((function e(t){var r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.notifyActionOnPost("startPost",{postId:t}),e.next=3,this.extractDataFromHtml(t);case 3:r=this.reactionCount[t],this.notifyActionOnPost("startPost",{postId:t,total:r}),C.log("START POST ".concat(t)),C.log("TOTAL REACTIONS ".concat(r)),n=null;case 8:return e.next=10,this.loadCustomerReactions(n);case 10:return a=e.sent,s=a.uninvitable,o=a.current,i=a.nextCursor,this.notifyActionOnPost("submitUninvitableCount",{uninvitable:s,postId:t}),C.log("UNINVITABLE ".concat(s)),e.next=18,this.inviteEachLink(o,t);case 18:if(i&&n!=i){e.next=22;break}return e.abrupt("break",24);case 22:n=i;case 23:e.next=8;break;case 24:this.notifyActionOnPost("endPost",{postId:t});case 25:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"extractDataFromHtml",value:(u=d(l.a.mark((function e(t){var r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://www.facebook.com/".concat(t.split("_")[1]),e.next=3,re(r,{headers:{Accept:"text/html"}});case 3:return n=e.sent,e.next=6,this.getFbToken(n);case 6:return(a=e.sent)||this.throwError("MISSING fbDtsgToken"),e.next=10,this.getFeedbackTargetId(n,t);case 10:return(s=e.sent)||this.throwError("MISSING feedbackTargetId"),e.next=14,this.getReactionCount(s);case 14:"number"!=typeof(o=e.sent)&&this.throwError("reactionCount is not a number"),this.fbDtsgToken=a,this.feedbackTargetId=s,this.reactionCount[t]=o;case 19:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getFbToken",value:(c=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=A(t,'["DTSGInitData",[],')[0]){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,L(r);case 5:return n=e.sent,e.abrupt("return",n.token);case 7:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"getFeedbackTargetId",value:(i=d(l.a.mark((function e(t,r){var n,a,s,o,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=/feedbackTargetID:\"(.+?)\"/,!(a=t.match(n))){e.next=4;break}return e.abrupt("return",a[1]);case 4:if(!(s=A(t,'"comment_list_renderer":')[0])){e.next=11;break}return e.next=8,L(s);case 8:if(i=e.sent,!(null===(o=i.feedback)||void 0===o?void 0:o.id)){e.next=11;break}return e.abrupt("return",i.feedback.id);case 11:return e.next=13,O(t,r);case 13:return c=e.sent,u=c.feedback_data,p=u&&u.id,e.abrupt("return",p);case 17:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"getReactionCount",value:(o=d(l.a.mark((function e(t){var r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={feedbackTargetID:t,reactionType:"NONE",scale:1},e.next=3,this.graphql.graphql("CometUFIReactionsDialogQuery",r,{__comet_req:15,__user:this.graphql.base.ctx.userID,__csr:"gpg_4MRbeQ_eJEDEG4qOFnFh3tZ6Z4qOFaDnRKLmGiHdjBAXiCXiiZplH-qOkUWiAiuGmExaZBhGzWKqRBACVENoxeFoz9y9oy4USbhVoO7mjGny8-48ryp8GEmGHDzEKFEkm3i2OU8VGKcwJx2awhUrxm2q68GexicxC8xCawvogyo4C5898uKq2-16xa8w4FUe9E9UvwHxSdxW1FxO1Hy8owEwyCwCDg8E6m1dw_wqE9Ec86eq02oO0na02Hq05gE02wOgyEKuF_G-7GAGp2Ki1eG-LQ2HGqq4p5FAqI8mK222aUK6FpVpay8mHw7wwgU1jrwWw9q4o8o5CfGmtaiKbwzUG4o6Cbwj9UO4U1LE0Jp01Eq1sw8echahEkwuE0s3w2B81tU33wrQdzA0nm0jW0c1w0ivU1iE2Bg5q0pK0d9xG0gu0r2"});case 3:return n=e.sent,a=n.data.node.top_reactions.summary,s={},o=n.extensions.sr_payload.ddd.hsrp.hblp.rsrcMap,(i=n.extensions.sr_payload.ddd.allResources).map((function(e){"js"===o[e].type&&(s[e]=o[e])})),e.next=11,At.loadDocIdsFromView({html:"",docNames:Ct.inviteLikePage,extraResource:i,extraResourceMap:s});case 11:return e.abrupt("return",a.reduce((function(e,t){return e+t.reaction_count}),0));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"throwError",value:function(e){throw C.error(e),e}},{key:"getHTMLMarkups",value:function(e){return e.jsmods.markup.slice(0,2).sort((function(e,t){return t[2]-e[2]}))}},{key:"notifyActionOnPost",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){case"startPost":t="START_PROCESSING_POST";break;case"endPost":t="END_PROCESSING_POST";break;case"submitUninvitableCount":t="SUBMIT_UNINVITABLE_COUNT"}var n=Object.assign({type:"INVITE_LIKE_PAGE_PROGRESS",subtype:t,taskId:this.taskId},r);this.worker.port.postMessage(n)}},{key:"inviteEachLink",value:(a=d(l.a.mark((function e(t,r){var n,a,s,o,i,c,u,p,d,f,h,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.isProfilePage(this.pageId);case 2:n=e.sent,a=$t(t),e.prev=4,a.s();case 6:if((s=a.n()).done){e.next=32;break}if(o=s.value.node,i=o.id,c=o.name,!this.isExceedInviteLimit()){e.next=10;break}throw"Exceed invite limit";case 10:return e.next=12,this.waitBetweenRequest();case 12:return u={input:{feedback_id:this.feedbackTargetId,reactor_id:i,actor_id:n?this.graphql.base.ctx.userID:this.pageId,client_mutation_id:"1"},feedbackID:this.feedbackTargetId},p=void 0,e.prev=14,e.next=17,this.graphBusinessQLInstance.graphql(ot,u,{av:this.pageId,__comet_req:11});case 17:if("NOT_INVITABLE"!=(null==(v=e.sent)||null===(d=v.data)||void 0===d||null===(f=d.profile_plus_send_post_liker_follower_invite)||void 0===f||null===(h=f.reactor)||void 0===h?void 0:h.follower_invite_status_in_feedback)){e.next=20;break}throw"graphql fail: NOT_INVITABLE";case 20:C.log("INVITE SUCCESS ".concat(c," - ").concat(i)),p=!0,e.next=28;break;case 24:e.prev=24,e.t0=e.catch(14),C.error("FAIL TO INVITE CUSTOMER ".concat(i),e.t0),p=!1;case 28:this.totalInvited++,this.notifyInviteResult(p,r,c);case 30:e.next=6;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(4),a.e(e.t1);case 37:return e.prev=37,a.f(),e.finish(37);case 40:case"end":return e.stop()}}),e,this,[[4,34,37,40],[14,24]])}))),function(e,t){return a.apply(this,arguments)})},{key:"waitBetweenRequest",value:function(){var e=this.totalInvited/150+1,t=500*Math.random()*e;return new Promise((function(e){return setTimeout(e,t)}))}},{key:"produceInviteRequestUrl",value:function(e,t){var r=this.decodeHtmlEntities(e);return"https://www.facebook.com"+(r+Object.entries(t).map((function(e){var t=s(e,2),r=t[0],n=t[1];return"&".concat(r,"=").concat(encodeURIComponent(n))})))}},{key:"decodeHtmlEntities",value:function(e){}},{key:"notifyInviteResult",value:function(e,t,r){this.worker.port.postMessage({type:"INVITE_LIKE_PAGE_PROGRESS",subtype:e?"INVITE_SUCCESS":"INVITE_FAIL",taskId:this.taskId,postId:t,customerName:r})}},{key:"getInvitableList",value:function(e){var t=this.parseStringToDOM(e),r=t.getElementsByClassName("_5i_t"),n=S(r).reduce((function(e,t){var r=t.querySelector("._5j0d a[ajaxify]");if(!r)return e;var n=t.querySelector("._5j0c a[title]"),a=r.getAttribute("ajaxify");return e.concat({name:n&&n.innerText,link:a})}),[]);return{uninvitable:r.length-n.length,current:n,next:this.getLoadMoreLink(t)}}},{key:"parseStringToDOM",value:function(e){return(new DOMParser).parseFromString(e,"text/html")}},{key:"getLoadMoreLink",value:function(e){var t=e.querySelector("#reaction_profile_pager a");return t&&t.getAttribute("href")}},{key:"isExceedInviteLimit",value:function(){return this.totalInvited>=this.maxInvite}},{key:"loadCustomerReactions",value:(n=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:this.feedbackTargetId,feedbackTargetID:this.feedbackTargetId,reactionType:"NONE",scale:1,count:10},n="CometUFIReactionsDialogQuery",t&&(r.cursor=t,n="CometUFIReactionsDialogTabContentRefetchQuery"),e.next=5,CCake.getInboxNormal(this.pageId);case 5:return a=e.sent,this.graphBusinessQLInstance=new Rt({pageId:this.pageId,base:a.base,isBussiness:!0}),e.t0=this.graphBusinessQLInstance,e.t1=n,e.t2=r,e.next=12,Ee.isProfilePage(this.pageId);case 12:if(!e.sent){e.next=16;break}e.t3=this.graphql.base.ctx.userID,e.next=17;break;case 16:e.t3=this.pageId;case 17:return e.t4=e.t3,e.t5={__comet_req:11,av:e.t4},e.next=21,e.t0.graphql.call(e.t0,e.t1,e.t2,e.t5);case 21:if(!(s=e.sent).errors){e.next=29;break}if("Rate limit exceeded"!=(o=s.errors[0].message)){e.next=28;break}throw"Exceed invite limit";case 28:throw o;case 29:return i=s.data.node.reactors.page_info,c=i.end_cursor,u=i.has_next_page,p=s.data.node.reactors.edges,d=p.filter((function(e){var t=e.node;return t&&"INVITED"!==t.invite_status_in_feedback&&"INVITED"!==t.follower_invite_status_in_feedback&&("INVITABLE"===t.invite_status_in_feedback||"INVITABLE"===t.follower_invite_status_in_feedback)})),e.abrupt("return",{uninvitable:p.length-d.length,current:d,nextCursor:u?c:null});case 33:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a,o,i,c,u,p,f,h,v,_,m,g,b;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.html,a=r.pageId,o=r.postId,i=r.base,t.t0=n,t.t0){t.next=6;break}return t.next=5,re("https://www.facebook.com/".concat(o.split("_")[1]));case 5:t.t0=t.sent;case 6:for(v in c=t.t0,u=[],p={},t.prev=9,f=Object.assign(i.buildParams(),{av:a,"queries[0]":"CometUFIReactionsDialogQuery",__comet_req:15}),h=[],f)_=encodeURIComponent(v),m=encodeURIComponent(f[v]),h.push(_+"="+m);return h=h.join("&"),t.next=16,ae("https://www.facebook.com/ajax/relay-ef/",h,{},{headers:{"Content-Type":"application/x-www-form-urlencoded"},parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 16:g=t.sent,g=CCake.base.parseFbRes(g),b=Object.entries(g.payload.predictions.CometUFIReactionsDialogQuery).filter((function(e){var t=s(e,2);return t[0],"js"===t[1].type})),u=b.map((function(e){var t=s(e,2),r=t[0];return t[1],r})),p=Object.fromEntries(b),C.log("Fetch extra resource from ajax/relay-ef",p),t.next=27;break;case 24:t.prev=24,t.t1=t.catch(9),C.error("Fail to fetch extra resource from ajax/relay-ef",t.t1);case 27:return t.t2=At,t.t3=c,t.t4=Ct.inviteLikePage,t.next=32,e.getExtraJsFilesToLoad(c);case 32:return t.t5=t.sent.concat(u),t.t6=p,t.t7={html:t.t3,docNames:t.t4,extraResource:t.t5,extraResourceMap:t.t6},t.abrupt("return",t.t2.loadDocIdsFromView.call(t.t2,t.t7));case 36:case"end":return t.stop()}}),t,null,[[9,24]])}))),function(e){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"CometUFIReactionsDialog.react":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n.r);case 10:return e.prev=10,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}(),tr=function(){function e(t){var r=t.pageId,n=t.threadId,a=t.threadKey,s=t.isBusiness,o=t.uiVersion,i=t.globalId,c=t.conversationUpdatedTime,u=t.customerName,l=t.platform,p=t.convId;h(this,e),this.pageId=r,this.threadId=n,this.threadKey=a,this.isBusiness=s,this.globalId=i,this.uiVersion=o,this.conversationUpdatedTime=c,this.customerName=u,this.platform=l,this.convId=p}var t,r;return _(e,[{key:"init",value:(r=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.platform,e.next="facebook"===e.t0?3:"instagram_official"===e.t0?4:5;break;case 3:return e.abrupt("return",this.handleFacebook());case 4:return e.abrupt("return",this.handleInstagram());case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleFacebook",value:(t=d(l.a.mark((function e(){var t,r,n,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.uiVersion,e.t0){e.next=5;break}return e.next=4,Re.get(this.pageId);case 4:e.t0=e.sent;case 5:t=e.t0,e.t1=t,e.next=1===e.t1||2===e.t1||5===e.t1?9:3===e.t1||4===e.t1||6===e.t1||7===e.t1?12:13;break;case 9:return r=5===t?"web.facebook.com":this.isBusiness?"business.facebook.com":"facebook.com",n=this.threadId?"https://".concat(r,"/").concat(this.pageId,"/inbox/").concat(this.threadId):"https://".concat(r,"/").concat(this.pageId,"/inbox"),e.abrupt("return",{link:n});case 12:return e.abrupt("return",this.getGlobalId().then((function(e){return{link:"https://business.facebook.com/latest/inbox/all?asset_id=".concat(a.pageId,"&nav_ref=diode_page_inbox&mailbox_id=").concat(a.pageId,"&selected_item_id=").concat(e),globalId:e}})));case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleInstagram",value:function(){var e=this,t=new Pt({pageId:this.pageId,isBusiness:this.isBusiness});return t.init().then((function(){return t.findUserThread(e.customerName)})).then((function(t){return t?{link:"https://business.facebook.com/latest/inbox/instagram_direct?asset_id=".concat(e.pageId,"&nav_ref=diode_page_inbox&selected_item_id=").concat(t.thread_id,"&mailbox_id=").concat(e.pageId),globalId:t.id}:Promise.reject("findIgThreadFail")}))}},{key:"getGlobalId",value:function(){return this.globalId?Promise.resolve(this.globalId):new Fe({pageId:this.pageId,postId:null,convId:this.convId,convType:"INBOX",threadId:this.threadId,threadKey:this.threadKey,isBusiness:this.isBusiness,conversationUpdatedTime:this.conversationUpdatedTime,customerName:this.customerName}).init()}}]),e}(),rr=function(){function e(t){var r=t.link;t.postType,h(this,e),this.link=r}var t,r;return _(e,[{key:"extractPostId",value:(r=d(l.a.mark((function e(t,r){var n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,a=null,e.t0=r,e.next="post"===e.t0?5:"video"===e.t0?10:12;break;case 5:return a=A(t,'"feedback_context":')[2],e.next=8,L(a);case 8:return n=e.sent,e.abrupt("return",n.feedback_target_with_context.ufi_renderer.feedback.subscription_target_id);case 10:return s=t.match(/"subscription_target_id":"(\d+)"/),e.abrupt("return",s[1]);case 12:return e.abrupt("break",13);case 13:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"init",value:(t=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.categorizePost(this.link),e.t0=t,e.next="post"===e.t0?4:"photo"===e.t0||"video"===e.t0?20:"live"===e.t0?33:36;break;case 4:return e.next=6,re(this.link);case 6:return n=e.sent,a=A(n,'"comet_ufi_summary_and_actions_renderer":')[0],e.next=10,L(a);case 10:if(s=e.sent,!(o=null==s||null===(r=s.feedback)||void 0===r?void 0:r.subscription_target_id)){e.next=16;break}e.t1=o,e.next=19;break;case 16:return e.next=18,this.extractPostId(n,t);case 18:e.t1=e.sent;case 19:return e.abrupt("return",e.t1);case 20:return e.next=22,re(this.link);case 22:if(i=e.sent,c=this.getRegexBasedOn(t),!(u=i.match(c))){e.next=29;break}e.t2=u[1],e.next=32;break;case 29:return e.next=31,this.extractPostId(i,t);case 31:e.t2=e.sent;case 32:return e.abrupt("return",e.t2);case 33:return p=/watch\/live\/\?.*v=(\d+)/,d=this.link.match(p),e.abrupt("return",d[1]);case 36:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"categorizePost",value:function(e){return e.includes("/posts/")?"post":e.includes("/photos/")||e.includes("/photo/")||e.includes("/photo?")?"photo":e.includes("/watch/live/")?"live":e.includes("/videos/")||e.includes("/watch/")?"video":void 0}},{key:"getRegexBasedOn",value:function(e){switch(e){case"photo":return/"legacy_story_hideable_id":"(\d+)"/;case"video":return/\\"post_fbid\\":(\d+)}/}}}]),e}(),nr=function(){function e(t){var r=t.link;h(this,e),this.link=r}var t;return _(e,[{key:"init",value:(t=d(l.a.mark((function e(){var t,r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(this.link);case 2:if(t=e.sent,r=/\["adp_CometPagePostsRootHoistedStoryQueryRelayPreloader_\w+",(.+})\]/,!(n=(n=t.match(r))&&n[1])){e.next=16;break}return a=A(n,'"__bbox":'),e.next=10,L(a[0]);case 10:if(a=e.sent,!("nodes"in(s=a.result.data))){e.next=16;break}return o=s.nodes[0].comet_sections.content.story.attachments,i=o[0].styles.attachment.media.flexible_height_share_image.uri,e.abrupt("return",i);case 16:return e.abrupt("return","");case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ar=r(7),sr=function(){function e(t){var r=t.action,n=t.shouldRecheck,a=t.globalId,s=t.pageId,o=t.postId,i=t.convId,c=t.threadId,u=t.convType,l=t.conversationUpdatedTime;h(this,e),this.initialized=!1,this.base=new me,this.action=r,this.shouldRecheck=n,this.globalId=a,this.pageId=s,this.postId=o,this.convId=i,this.threadId=c,this.convType=u,this.conversationUpdatedTime=l,this.shouldRetryGetGlobalId=!1}var t,r,n,a,s,o,i,c;return _(e,[{key:"init",value:(c=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re("https://www.facebook.com/".concat(this.pageId));case 2:return t=e.sent,e.next=5,this.base.ctxFromHtml(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"handle",value:(i=d(l.a.mark((function t(){var r,n=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.initialized){t.next=3;break}return t.next=3,this.init();case 3:if(At.isFeatureReady("blockUser")){t.next=6;break}return t.next=6,e.preloadDocIds();case 6:return t.prev=6,t.next=9,this.getGlobalId();case 9:this.globalId=t.sent,C.log("BLOCKED/UNBLOCKED GLOBAL ID",this.globalId),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(6),C.warning("NEED TO RETRY getGlobalId"),this.shouldRetryGetGlobalId=!0;case 17:if(!this.shouldRecheck){t.next=21;break}return t.abrupt("return",this.checkUserBlocked());case 21:if("ban"!=this.action){t.next=25;break}return t.abrupt("return",this.blockWithBussinessView());case 25:return r=new je(this.pageId,!1),t.abrupt("return",r.init().then(d(l.a.mark((function e(){var t,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.shouldRetryGetGlobalId){e.next=5;break}return e.next=3,n.getGlobalId();case 3:n.globalId=e.sent,C.log("BLOCKED/UNBLOCKED GLOBAL ID",n.globalId);case 5:return e.next=7,je.getHtmlFbMainPage();case 7:t=e.sent,a=t.html,s=r.getProfileSetting(a),o=s.currentProfile,n.unblock(o.id);case 11:case"end":return e.stop()}}),e)})))));case 27:case"end":return t.stop()}}),t,this,[[6,13]])}))),function(){return i.apply(this,arguments)})},{key:"block",value:(o=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.graphqlInstance=new Rt({pageId:this.pageId,base:this.base}),t={collectionID:null,hasCollectionAndSectionID:!1,input:{blocksource:"PROFILE",should_apply_to_later_created_profiles:!1,user_id:this.globalId,actor_id:this.pageId,client_mutation_id:"1"},scale:2,sectionID:null,isPrivacyCheckupContext:!1,__relay_internal__pv__VideoPlayerRelayReplaceDashManifestWithPlaylistrelayprovider:!1},e.next=4,this.graphqlInstance.graphql("ProfileCometActionBlockUserMutation",t);case 4:if(!((r=e.sent).data&&r.data.user_block&&Object(ar.isEqual)(r.data.user_block.viewer,{}))){e.next=9;break}return e.abrupt("return",{success:!0});case 9:if(!(r.errors&&r.errors[0]&&r.errors[0].description)){e.next=13;break}return e.abrupt("return",Promise.reject({errorCode:r.errors[0].code,errorDescription:r.errors[0].description}));case 13:return e.abrupt("return",Promise.reject({errorDescription:"graphqlFailed"}));case 14:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"blockWithBussinessView",value:(s=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.graphqlInstance=new Rt({pageId:this.pageId,base:this.base,isBussiness:!0}),t=new je(this.pageId,!1),e.next=4,je.getHtmlFbMainPage();case 4:return r=e.sent,n=r.html,e.next=8,t.getProfileSetting(n);case 8:return a=e.sent,s=a.profiles,o=a.currentProfile,i=s&&s.length>0&&s.find((function(e){var t,r;return!(null==e||null===(t=e.node)||void 0===t||null===(r=t.profile)||void 0===r?void 0:r.delegate_page_id)})),c=i?i.node.profile.id:o.id,u={input:{client_mutation_id:"3",actor_id:this.pageId,user_id:this.globalId}},e.next=16,this.graphqlInstance.graphql("BizKitContextCardBlockMutation",u,{__comet_req:11,__user:c},!1,function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 16:if(!((p=e.sent).data&&p.data.user_block&&p.data.user_block.user&&p.data.user_block.user.id==this.globalId)){e.next=21;break}return e.abrupt("return",{success:!0});case 21:if(!(p.errors&&p.errors[0]&&p.errors[0].description)){e.next=25;break}return e.abrupt("return",Promise.reject({errorCode:p.errors[0].code,errorDescription:p.errors[0].description}));case 25:return e.abrupt("return",Promise.reject({errorDescription:"graphqlFailed"}));case 26:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"unblock",value:(a=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p=this,d=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=d.length>1&&void 0!==d[1]?d[1]:0,c={input:{block_action:"UNBLOCK",setting:"PAGE",target_id:this.globalId,actor_id:this.pageId,client_mutation_id:"1"},profile_picture_size:36},e.next=4,this.graphqlInstance.graphql("BlockingSettingsBlockMutation",c,{av:t,__user:t});case 4:if("UNBLOCK"!=(null==(u=e.sent)||null===(r=u.data)||void 0===r||null===(n=r.xfb_privacy_block_settings_update)||void 0===n?void 0:n.block_status)||!(null==u||null===(a=u.data)||void 0===a||null===(s=a.xfb_privacy_block_settings_update)||void 0===s?void 0:s.setting)||1!=(null==u||null===(o=u.extensions)||void 0===o?void 0:o.is_final)){e.next=14;break}if(!(u.data.xfb_privacy_block_settings_update.setting.blockees.edges.find((function(e){return e.node.id==p.globalId}))&&i<2)){e.next=11;break}this.unblock(t,1),e.next=12;break;case 11:return e.abrupt("return",{success:!0});case 12:e.next=15;break;case 14:return e.abrupt("return",Promise.reject({errorDescription:"graphqlFailed"}));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"checkUserBlocked",value:(n=d(l.a.mark((function e(){var t,r,n,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={profile_picture_size:36,settingType:"USER"},e.next=3,this.graphqlInstance.graphql("BlockingSettingsDialogQuery",t);case 3:if(!((r=e.sent).data&&r.data.viewer&&r.data.viewer.privacy_block_settings)){e.next=9;break}if(!(n=r.data.viewer.privacy_block_settings.setting.blockees.edges.find((function(e){return e.node.id==a.globalId})))){e.next=9;break}return C.log("FIND BLOCKED USER",n),e.abrupt("return",{success:!0});case 9:if("ban"!=this.action){e.next=12;break}return e.abrupt("return",this.blockWithBussinessView());case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getGlobalId",value:(r=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.globalId){e.next=2;break}return e.abrupt("return",this.globalId);case 2:return t=new Fe({pageId:this.pageId,postId:this.postId,convId:this.convId,threadId:this.threadId,convType:this.convType,conversationUpdatedTime:this.conversationUpdatedTime}),e.abrupt("return",t.init());case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}],[{key:"preloadDocIds",value:(t=d(l.a.mark((function e(){var t,r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re("https://www.facebook.com/settings?tab=blocking");case 2:return t=e.sent,e.next=5,re("https://www.facebook.com/ajax/bootloader-endpoint/?modules=BlockingSettingsDialog.react&__a=1&__hs=19802.HYP%3Acomet_plat_default_pkg.2.1..2.1");case 5:return r=e.sent,e.next=8,re("https://business.facebook.com/latest/inbox/facebook?asset_id=".concat(this.pageId));case 8:return n=e.sent,e.next=11,At.loadDocIdsFromView({html:t,docNames:["BlockingSettingsDialogQuery"]});case 11:return e.next=13,At.loadDocIdsFromView({html:r,docNames:["ProfileCometActionBlockUserMutation","BlockingSettingsBlockMutation"]});case 13:return e.next=15,At.loadDocIdsFromView({html:n,docNames:["BizKitContextCardBlockMutation"]});case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),or=function(){function e(t){var r=this,n=t.pageId,a=t.videoId,s=t.taskId,i=t.endCursor;h(this,e),o(this,"preloadDocIds",function(){var t=d(l.a.mark((function t(n){var a,s,o,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.pageId,s=n.videoId,o="https://www.facebook.com/".concat(a,"/videos/").concat(s),t.next=5,re("https://www.facebook.com/ajax/bootloader-endpoint/?modules=CometResharesDialog.react");case 5:return i=t.sent,t.next=8,re(o);case 8:return c=t.sent,t.t0=At,t.t1=c,t.t2=[lt,ut],t.next=14,e.getExtraJsFilesToLoad(i);case 14:return t.t3=t.sent,t.next=17,e.getExtraJsFilesToLoadFirst(i,'"rsrcMap":');case 17:return t.t4=t.sent,t.t5={html:t.t1,docNames:t.t2,extraResource:t.t3,extraResourceMap:t.t4},t.next=21,t.t0.loadDocIdsFromView.call(t.t0,t.t5);case 21:return t.next=23,r.preloadViewRootDoc(c);case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),o(this,"preloadViewRootDoc",function(){var t=d(l.a.mark((function t(n){var a,s,o,i,c,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o in a=Object.assign(r.base.buildParams(),{"route_urls[0]":"/",__comet_req:15}),s=[],a)i=encodeURIComponent(o),c=encodeURIComponent(a[o]),s.push(i+"="+c);return s=s.join("&"),t.next=7,ae("https://www.facebook.com/ajax/bulk-route-definitions/",s,{},{headers:{"Content-Type":"application/x-www-form-urlencoded","Sec-Ch-Prefers-Color-Scheme":"dark","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Full-Version-List":'"Chromium";v="122.0.6261.112", "Not(A:Brand";v="24.0.0.0", "Google Chrome";v="122.0.6261.112"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Model":"","Sec-Ch-Ua-Platform":"macOS","Sec-Ch-Ua-Platform-Version":"13.4.1","Viewport-Width":1115},parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 7:return u=t.sent,t.t0=At,t.t1=n,t.t2=["CometTahoeRootQuery"],t.next=13,e.getExtraJsFilesToLoad(u);case 13:return t.t3=t.sent,t.next=16,e.getExtraJsFilesToLoadFirst(u,'"rsrcMap":');case 16:return t.t4=t.sent,t.t5={html:t.t1,docNames:t.t2,extraResource:t.t3,extraResourceMap:t.t4},t.next=20,t.t0.loadDocIdsFromView.call(t.t0,t.t5);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),o(this,"makeBase",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://www.facebook.com/".concat(r.pageId),e.next=3,re(t);case 3:return n=e.sent,e.next=6,r.base.ctxFromHtml(n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))),o(this,"preloadFeedbackId",d(l.a.mark((function t(){var n,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Rt({pageId:r.pageId,base:r.base}),t.next=3,n.graphql("CometTahoeRootQuery",{UFI2CommentsProvider_commentsKey:"CometTahoeSidePaneQuery",caller:"TAHOE",chainingCursor:null,chainingSeedVideoId:null,channelEntryPoint:"TAHOE",channelID:"",displayCommentsContextEnableComment:null,displayCommentsContextIsAdPreview:null,displayCommentsContextIsAggregatedShare:null,displayCommentsContextIsStorySet:null,displayCommentsFeedbackContext:null,feedLocation:"TAHOE",feedbackSource:41,focusCommentID:null,privacySelectorRenderLocation:"COMET_STREAM",renderLocation:"video_channel",scale:1,streamChainingSection:!1,isCrawler:!1,useDefaultActor:!1,videoChainingContext:null,videoID:r.videoId,__relay_internal__pv__CometUFIReactionsEnableShortNamerelayprovider:!1,__relay_internal__pv__CometUFIIsRTAEnabledrelayprovider:!1,__relay_internal__pv__StoriesLWRVariantrelayprovider:"www_new_reactions"},{__ccg:"EXCELLENT",server_timestamps:!0,av:n.base.ctx.userID,__comet_req:15},!1,(function(e){return e.text()}));case 3:return a=t.sent,t.next=6,e.getExtraJsFilesToLoadFirst(a,'"feedback":');case 6:return s=t.sent,r.feedbackId=s.id,t.next=10,r.cachefeedbackId();case 10:case"end":return t.stop()}}),t)})))),o(this,"init",d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.feedbackFromCache(r.videoId);case 2:return t=e.sent,e.next=5,r.makeBase();case 5:if(At.isFeatureReady("crawlLivestreamData")){e.next=8;break}return e.next=8,r.preloadDocIds({pageId:r.pageId,videoId:r.videoId});case 8:if(!t){e.next=12;break}r.feedbackId=t,e.next=14;break;case 12:return e.next=14,r.preloadFeedbackId();case 14:return e.next=16,r.handleCrawLivestream();case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})))),o(this,"handleCrawLivestream",(function(){return new Promise(function(){var e=d(l.a.mark((function e(t,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.makeBase();case 2:return e.next=4,r.doCrawlData();case 4:a=e.sent,t(a.filter((function(e){return"User"==e.__typename})));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())})),o(this,"doCrawlData",d(l.a.mark((function e(){var t,n,a,s,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Rt({pageId:r.pageId,base:r.base}),e.next=3,t.graphql(ut,{UFI2CommentsProvider_commentsKey:"CometResharesDialogQuery",feedLocation:"SHARE_OVERLAY",feedbackID:r.feedbackId,feedbackSource:1,privacySelectorRenderLocation:"COMET_STREAM",renderLocation:"reshares_dialog",scale:1,__relay_internal__pv__IsWorkUserrelayprovider:!1,__relay_internal__pv__IsMergQAPollsrelayprovider:!1,__relay_internal__pv__CometUFIReactionsEnableShortNamerelayprovider:!1,__relay_internal__pv__CometUFIIsRTAEnabledrelayprovider:!1,__relay_internal__pv__StoriesArmadilloReplyEnabledrelayprovider:!0},{__ccg:"EXCELLENT",server_timestamps:!0,av:t.base.ctx.userID,__comet_req:15});case 3:if(n=e.sent,a=r.parseResponse(n),s=a.edges,o=a.endCursor,i=a.hasNextPage,r.setLoadedCursor(o),r.endCursor!==r.loadedCursor){e.next=8;break}return e.abrupt("return",[]);case 8:if(c=r.sharedUserFromNodes(s),!i){e.next=15;break}return e.next=12,r.doScrollCrawlData(o,c);case 12:return e.abrupt("return",e.sent);case 15:return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e)})))),o(this,"doScrollCrawlData",function(){var e=d(l.a.mark((function e(t,n){var a,s,o,i,c,u,p,f,h,v=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>2&&void 0!==v[2]?v[2]:0,s=new Rt({pageId:r.pageId,base:r.base}),o=8*Math.random(),e.next=5,new Promise((function(e){setTimeout(d(l.a.mark((function n(){var a;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.graphql(lt,{UFI2CommentsProvider_commentsKey:"CometResharesDialogQuery",count:1,cursor:t,displayCommentsContextEnableComment:null,displayCommentsContextIsAdPreview:null,displayCommentsContextIsAggregatedShare:null,displayCommentsContextIsStorySet:null,displayCommentsFeedbackContext:null,feedLocation:"SHARE_OVERLAY",feedbackSource:1,focusCommentID:null,privacySelectorRenderLocation:"COMET_STREAM",renderLocation:"reshares_dialog",scale:1,useDefaultActor:!1,id:r.feedbackId},{__ccg:"EXCELLENT",server_timestamps:!0,__hs:""});case 2:a=n.sent,e(a);case 4:case"end":return n.stop()}}),n)}))),o)}));case 5:if(!(i=e.sent).data){e.next=19;break}if(c=r.parseResponse(i),u=c.edges,p=c.endCursor,f=c.hasNextPage,h=r.sharedUserFromNodes(u),n=[].concat(S(n),S(h)),!f){e.next=16;break}return e.next=13,r.doScrollCrawlData(p,n);case 13:return e.abrupt("return",e.sent);case 16:return e.abrupt("return",n);case 17:e.next=26;break;case 19:if(!(a<3)){e.next=25;break}return console.log("retry get CRAWL LIVESTREAM DATA",t),console.log("attempt",a),e.abrupt("return",r.doScrollCrawlData(t,n,a+1));case 25:throw"Let's it crash!!!";case 26:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),o(this,"sharedUserFromNodes",(function(e){return e.map((function(e){var t,n,a,s,o,i,u,l,p,d,f,h,v,_=null==e||null===(t=e.node)||void 0===t||null===(n=t.comet_sections)||void 0===n||null===(a=n.feedback)||void 0===a||null===(s=a.story)||void 0===s||null===(o=s.feedback_context)||void 0===o||null===(i=o.feedback_target)||void 0===i?void 0:i.owning_profile;return _||(_=null==e||null===(u=e.node)||void 0===u||null===(l=u.comet_sections)||void 0===l||null===(p=l.context_layout)||void 0===p||null===(d=p.story)||void 0===d||null===(f=d.comet_sections)||void 0===f||null===(h=f.actor_photo)||void 0===h||null===(v=h.story)||void 0===v?void 0:v.actors[0]),c(c({},_),{},{creation_time:r.findCreationTime(e.node.comet_sections.context_layout.story.comet_sections.metadata)})}))})),o(this,"parseResponse",(function(e){var t=(e.data.node?e.data.node:e.data.feedback).reshares,r=t.edges,n=t.page_info;return{edges:r,endCursor:n.end_cursor,hasNextPage:n.has_next_page}})),o(this,"findCreationTime",(function(e){var t=null;if(e&&e.length>0)for(var r=0;r<e.length;r++){var n=e[r];if(n.story&&n.story.creation_time){t=n.story.creation_time;break}}return t})),o(this,"crawlSuccess",(function(e,t,n,a){e.port.postMessage({type:"CRAWL_LIVESTREAM_DATA_SUCCESS",taskId:t,pageId:n,sharedUsers:a,endCursor:r.loadedCursor,success:!0})})),o(this,"crawlFail",(function(e,t,r){return function(n){console.log(n),e.port.postMessage({type:"CRAWL_LIVESTREAM_DATA_FAILURE",taskId:t,pageId:r,success:!1})}})),o(this,"cachefeedbackId",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("liveStreamFeedback");case 2:t=e.sent,(n=t?JSON.parse(t):{})[r.videoId]=r.feedbackId,X.setItem("liveStreamFeedback",JSON.stringify(n));case 6:case"end":return e.stop()}}),e)})))),o(this,"feedbackFromCache",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("liveStreamFeedback");case 2:if(!(t=e.sent)){e.next=8;break}return n=JSON.parse(t),e.abrupt("return",n[r.videoId]||null);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))),o(this,"setLoadedCursor",(function(e){e&&(r.loadedCursor=e)})),o(this,"onlyUnique",(function(e,t,r){return r.findIndex((function(t){return t.id==e.id}))===t})),this.pageId=n,this.videoId=a,this.feedbackId=null,this.base=new me,this.taskId=s,this.endCursor=i,this.loadedCursor=null}var t,r;return _(e,null,[{key:"getExtraJsFilesToLoadFirst",value:(r=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=A(t,r)[0]){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,L(n);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"allResources":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}();self.LiveViewShare=or;var ir=function(){function e(t){var r=t.accessToken,n=t.pageId,a=t.fbPageId;h(this,e),this.accessToken=r,this.pageId=n,this.fbPageId=a,this.igPageId=n.replace(/^igo_/,""),this.cachePostsKey="CommentInstagram_".concat(n,"_posts"),this.cacheTargetPostsKey="CommentInstagram_".concat(n,"_target_posts"),this.cacheNormalPostsKey="CommentInstagram_".concat(n,"_normal_posts"),this.cacheLastModifiedAt="CommentInstagram_".concat(n,"_LastModifiedAt"),this.targetPostList=new Map,this.normalPostList=[],this.lastModifiedAt=null}var t,r,n,a,s,o,i,u,p,f,v,m,g,b,I;return _(e,[{key:"prepareCache",value:(I=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadCached(this.cacheTargetPostsKey);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=new Map;case 5:return this.targetPostList=e.t0,e.next=8,this.loadCached(this.cacheNormalPostsKey);case 8:if(e.t1=e.sent,e.t1){e.next=11;break}e.t1=[];case 11:return this.normalPostList=e.t1,e.next=14,this.loadCached(this.cacheLastModifiedAt);case 14:this.lastModifiedAt=e.sent;case 15:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"stop",value:function(){this.shouldStop=!0,this.currentlyRunning&&(clearTimeout(this.currentlyRunning),this.currentlyRunning=null)}},{key:"start",value:function(){this.currentlyRunning||(this.shouldStop=!1,this.startup())}},{key:"loadCached",value:(b=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem(t);case 2:if(!(r=e.sent)){e.next=16;break}if(e.prev=4,n=JSON.parse(r),t!=this.cachePostsKey&&t!=this.cacheTargetPostsKey){e.next=10;break}return e.abrupt("return",new Map(U(n)));case 10:return e.abrupt("return",n);case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(4),e.abrupt("return",null);case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[4,13]])}))),function(e){return b.apply(this,arguments)})},{key:"saveCache",value:function(e,t){var r=t;e!=this.cachePostsKey&&e!=this.cacheTargetPostsKey||(r=B(t)),X.setItem(e,JSON.stringify(r))}},{key:"saveCaches",value:function(){this.saveCache(this.cacheTargetPostsKey,this.targetPostList),this.saveCache(this.cacheNormalPostsKey,this.normalPostList),this.saveCache(this.cacheLastModifiedAt,this.lastModifiedAt)}},{key:"init",value:(g=d(l.a.mark((function t(){var r,n=this,a=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.length>0&&void 0!==a[0]&&a[0],t.next=3,this.prepareCache();case 3:return t.abrupt("return",new Promise(function(){var t=d(l.a.mark((function t(a,s){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r?!n.checkLoadPostDocIds():!At.isFeatureReady("instagramComment"))){t.next=3;break}return t.next=3,e.preloadDocIds({pageId:n.fbPageId,isBusiness:n.isBusiness,forLoadPost:r});case 3:return t.next=5,CCake.getInboxNormal(n.fbPageId);case 5:n.inboxNormalInstance=t.sent,n.graphQLInstance=new Rt({pageId:n.fbPageId,base:n.inboxNormalInstance.base}),a();case 8:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 4:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"checkLoadPostDocIds",value:function(){return At.has(pt)&&At.has("BizInboxIGPostDetailViewContainerQuery")&&At.has("BizInboxIGCommentListContainerQuery")&&At.has(dt)&&At.has("BizInboxIGCommentRepliesContainerQuery")&&At.has("BizInboxIGCommentReplyCreateMutation")&&At.has("BizInboxCommentThreadListQuery")}},{key:"trigger2pancake",value:(m=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://pages.fm/api/v1/pages/".concat(this.pageId,"/igo_ads_post_comments?access_token=").concat(this.accessToken),e.abrupt("return",se(n,c({can_gql:r},t)));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"isAdsPosts",value:(v=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://pages.fm/api/v1/pages/".concat(this.pageId,"/is_igo_ads_posts?access_token=").concat(this.accessToken),e.abrupt("return",se(r,{post_ids:t}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"hasUpdatePosts",value:function(e){var t=this;return this.lastModifiedAt&&(e=e.filter((function(e){return e.node.last_modified_at>=t.lastModifiedAt}))),e.length>0&&(!this.lastModifiedAt||(this.lastModifiedAt,e[0].node.last_modified_at)),e}},{key:"handlePost",value:(f=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadPostDetail(t);case 2:return n=e.sent,e.next=5,this.trigger2pancake(n,r);case 5:return a=e.sent,e.next=8,this.handlePostResponse(n,a);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"handlePostResponse",value:(p=d(l.a.mark((function e(t,r){var n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.new_comment_count,null,a=t.igPost?t.igPost:t.node,s=a.ig_comments,o=a.id,n>0&&s.page_info.has_previous_page&&this.loadComments(o,s.page_info.start_cursor);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"loadPosts",value:(u=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,d,f,h=this,v=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.length>0&&void 0!==v[0]?v[0]:null,!this.shouldStop){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.init(!0);case 5:return e.prev=5,r={filterStatus:"TODO",platformFilter:"INSTAGRAM",filterIsReadStatus:null,filterOwnerID:null,isStarsComment:!1,isHighlightedComment:!1,count:20,filterType:null},r=t?Object.assign(r,{id:this.fbPageId,cursor:t}):Object.assign(r,{pageID:this.fbPageId,cursor:null}),e.next=10,this.graphQLInstance.graphql(t?"BizInboxCommentThreadListQuery":pt,r);case 10:if(!(n=e.sent).error){e.next=15;break}return this.currentlyRunning&&clearTimeout(this.currentlyRunning),his.currentlyRunning=setTimeout(this.loadPosts.bind(this),18e5),e.abrupt("return");case 15:if(a=n.data.page?n.data.page.business_comm_items:n.data.node.business_comm_items,0!=(s=a.edges).length){e.next=19;break}return e.abrupt("return");case 19:return t||(this.nextLastModifiedAt=s[0].node.last_modified_at),o=this.hasUpdatePosts(s),i=o.map((function(e){return h.getTargetPostId(e.node.id)})),e.next=24,Promise.all(i);case 24:if(c=(c=e.sent).filter((function(e){return-1==h.normalPostList.findIndex((function(t){return t==e}))})),this.hasAds=this.hasAds||!1,!(c.length>0)){e.next=41;break}return e.next=30,this.isAdsPosts(c);case 30:return u=e.sent,p=u.ads_post_ids_can_gql,d=u.ads_post_ids_cant_gql,this.hasAds=this.hasAds||p.length>0||d.length>0,f=c.filter((function(e){return-1==p.findIndex((function(t){return t==e}))&&-1==d.findIndex((function(t){return t==e}))})),f=(this.normalPostList||[]).concat(f),this.normalPostList=S(new Set(f)),e.next=39,Promise.all(p.map((function(e){return h.handlePost(e,!0)})));case 39:return e.next=41,Promise.all(d.map((function(e){return h.handlePost(e,!1)})));case 41:this.lastModifiedAt&&s.length==o.length&&a.page_info&&a.page_info.has_next_page||(this.lastModifiedAt=this.nextLastModifiedAt),this.saveCaches(),this.currentlyRunning&&clearTimeout(this.currentlyRunning),this.currentlyRunning=setTimeout(this.loadPosts.bind(this),this.hasAds?3e5:18e5),e.next=53;break;case 47:e.prev=47,e.t0=e.catch(5),console.error(e.t0),this.currentlyRunning&&clearTimeout(this.currentlyRunning),this.currentlyRunning=setTimeout(this.loadPosts.bind(this),3e5),this.saveCaches();case 53:case"end":return e.stop()}}),e,this,[[5,47]])}))),function(){return u.apply(this,arguments)})},{key:"getTargetPostId",value:(i=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.targetPostList.get(t))){e.next=3;break}return e.abrupt("return",r);case 3:return n={commItemID:t},e.next=6,this.graphQLInstance.graphql(dt,n);case 6:return a=e.sent,this.targetPostList.set(t,a.data.commItem.target_id),e.abrupt("return",a.data.commItem.target_id);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadComments",value:(o=d(l.a.mark((function e(t,r){var n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={count:10,cursor:r,id:t},e.next=3,this.graphQLInstance.graphql("BizInboxIGCommentListContainerQuery",n);case 3:return a=e.sent,s=a.data,e.next=7,this.trigger2pancake(s,null);case 7:return o=e.sent,e.next=10,this.handlePostResponse(s,o);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"loadPostDetail",value:(s=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={igPostID:t},e.next=3,this.graphQLInstance.graphql("BizInboxIGPostDetailViewContainerQuery",r);case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"loadChildComments",value:(a=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={count:3,cursor:null,igCommentID:t},e.next=3,this.graphQLInstance.graphql("BizInboxIGCommentRepliesContainerQuery",r);case 3:e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"replyComment",value:(n=d(l.a.mark((function e(t,r,n){var a,s,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={input:{client_mutation_id:"4",actor_id:this.fbPageId,instagram_media_id:t,text:n,parent_comment_id:r}},e.next=3,this.graphQLInstance.graphql("BizInboxIGCommentReplyCreateMutation",o);case 3:if(i=e.sent,c=i.data.instagram_reply_create,!(null===(a=c)||void 0===a?void 0:a.id)&&(null===(s=c)||void 0===s?void 0:s.instagram_reply)&&(c=c.instagram_reply),!c){e.next=10;break}return e.abrupt("return",{success:!0,message_id:c.id,timestamp:c.creation_time});case 10:return e.abrupt("return",{success:!1});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a,s,o,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.pageId,r.isBusiness,a=r.forLoadPost,s="https://business.facebook.com/latest/inbox/instagram?asset_id=".concat(n,"&nav_ref=pages_classic_isolated_section_inbox_diode&mailbox_id=").concat(n),t.next=4,re(s);case 4:if(o=t.sent,self.externalGraphLog&&externalGraphLog.log(n,"preloadDocIds_comment_instagram"),!o){t.next=24;break}if(o.match(/"selectedItem":{"id":"(\d+)"/)){t.next=14;break}if(!(i=o.match(/"compat_iframe_token":"([^"]+)"/))){t.next=14;break}return t.next=13,Bt.loadCompatView(s,i[1]);case 13:o=t.sent;case 14:return c=a?[pt,"BizInboxIGPostDetailViewContainerQuery","BizInboxIGCommentListContainerQuery",dt,"BizInboxIGCommentRepliesContainerQuery","BizInboxIGCommentReplyCreateMutation","BizInboxCommentThreadListQuery"]:[pt,"BizInboxCommentThreadListWrapperQuery","BizInboxIGPostDetailViewContainerQuery","BizInboxIGCommentListContainerQuery",dt,"BizInboxIGCommentRepliesContainerQuery","BizInboxIGCommentReplyCreateMutation"],t.t0=At,t.t1=o,t.t2=c,t.next=20,e.getExtraJsFilesToLoad(o);case 20:return t.t3=t.sent,t.t4={html:t.t1,docNames:t.t2,extraResource:t.t3},t.next=24,t.t0.loadDocIdsFromView.call(t.t0,t.t4);case 24:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"BizInboxSettingsLayout.react":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n.r);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}();self.CommentInstagram=ir;var cr=function(){function e(t){var r=t.pageId,n=t.threadId,a=t.conversationUpdatedTime,s=t.messageTimestamp,o=t.emoji,i=t.globalId;h(this,e),this.pageId=r,this.threadId=n,this.conversationUpdatedTime=a,this.messageTimestamp=s,this.emoji=o,this.graphql=null,this.globalUserId=i}var t,r,n,a;return _(e,[{key:"initBase",value:(a=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,CCake.getInboxNormal(this.pageId);case 2:t=e.sent,this.graphql=new Rt({pageId:this.pageId,base:t.base,isBussiness:!0});case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"init",value:(n=d(l.a.mark((function t(){var r,n,a,s,o,i,c=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(At.isFeatureReady("reactMessage")){t.next=3;break}return t.next=3,e.preloadDocIds({pageId:this.pageId});case 3:return t.next=5,this.initBase();case 5:return r=new Dt({pageId:this.pageId,threadId:this.threadId,platform:"facebook",conversationUpdatedTime:this.conversationUpdatedTime,globalUserId:this.globalUserId}),t.next=8,r.init();case 8:if(n=t.sent,a=n.messages,!(s=a.find((function(e){var t=e.timestamp_precise,r=e.message_sender,n=t-c.messageTimestamp;return n>0&&n<1e3&&r.id!==c.pageId})))){t.next=24;break}return C.log("FOUND MESSAGE TO REACT",s),o={input:{client_mutation_id:"3",actor_id:this.pageId,action:"ADD_REACTION",message_id:s.message_id,reaction:this.emoji}},t.next=16,this.graphql.graphql("BizInboxMessengerReactionMutation",o);case 16:if(!(i=t.sent).data||!i.data.message_reaction||"3"!==i.data.message_reaction.client_mutation_id){t.next=21;break}return t.abrupt("return",{success:!0});case 21:return t.abrupt("return",Promise.reject("graphqlFailed"));case 22:t.next=25;break;case 24:return t.abrupt("return",Promise.reject("messageNotFound"));case 25:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],[{key:"preloadDocIds",value:(r=d(l.a.mark((function t(r){var n,a,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.pageId,t.next=3,Bt.makeInboxViewUrl(n,!0);case 3:return a=t.sent,self.externalGraphLog&&externalGraphLog.log(n,"preloadDocIds_react_message"),t.next=7,re(a);case 7:if(!(s=t.sent)){t.next=16;break}if(s.match(/"selectedItem":{"id":"(\d+)"/)){t.next=16;break}if(!(o=s.match(/"compat_iframe_token":"([^"]+)"/))){t.next=16;break}return t.next=15,Bt.loadCompatView(a,o[1]);case 15:s=t.sent;case 16:return t.t0=At,t.t1=s,t.t2=Ct.reactMessage,t.next=21,e.getExtraJsFilesToLoad(s);case 21:return t.t3=t.sent,t.t4={html:t.t1,docNames:t.t2,extraResource:t.t3},t.abrupt("return",t.t0.loadDocIdsFromView.call(t.t0,t.t4));case 24:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,"InitialJSLoader.loadOnDOMContentReady(")[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",L(r));case 7:return e.prev=7,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(e){return t.apply(this,arguments)})}]),e}();function ur(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return lr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?lr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function lr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}self.ReactMessage=cr,cr.preloadDocIds=F(cr.preloadDocIds);var pr=function(){function e(t){h(this,e),this.accountId=t.accountId,this.channelId=t.channelId,this.initialized=!1,this.channel=null}var t,r,n,a,s,o,i,u,p,f,v,m,g,b,I,y,x,k;return _(e,[{key:"init",value:(k=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.accountId){e.next=5;break}return e.next=3,this.initByAccountId();case 3:e.next=7;break;case 5:return e.next=7,this.initByChannelId();case 7:this.initialized=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"initByAccountId",value:(x=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.log("LINE: GET INSTANCE BY ACCOUNT ID"),e.next=3,this.setResponseMode("CHAT");case 3:return e.next=5,this.getChannel();case 5:return this.channel=e.sent,e.next=8,this.loadChannelInfo();case 8:return t=e.sent,e.t0=c,e.t1=c({},this.channel),e.t2={},e.t3=t.basicSearchId,e.t4=t.iconUrl,e.t5=t.name,e.next=17,this.chatUserId;case 17:e.t6=e.sent,e.t7={searchId:e.t3,avatarUrl:e.t4,name:e.t5,userId:e.t6},this.channel=(0,e.t0)(e.t1,e.t2,e.t7);case 20:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"initByChannelId",value:(y=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.log("LINE: GET INSTANCE BY CHANNEL ID"),e.next=3,this.getChannel();case 3:return t=e.sent,r=t.botConfiguration.basicId,this.accountId=r.replace("@",""),e.t0=t.name,e.t1=t.id,e.t2=t.secret,e.t3=t.botConfiguration.iconUrl,e.t4=this.accountId,e.next=13,this.chatUserId;case 13:e.t5=e.sent,this.channel={name:e.t0,channelId:e.t1,channelSecret:e.t2,avatarUrl:e.t3,searchId:e.t4,userId:e.t5};case 15:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"loadChannelInfo",value:(I=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.chatUserId;case 2:return t=e.sent,e.next=5,fetch("https://chat.line.biz/api/v1/bots/".concat(t));case 5:return r=e.sent,e.abrupt("return",r.json());case 7:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"getChannel",value:(b=d(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=d(l.a.mark((function e(r,n){var a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.accountId?"https://manager.line.biz"+"/api/bots/@".concat(t.accountId,"/primaryChannel"):"https://developers.line.biz"+"/api/v1/channel/".concat(t.channelId),e.next=3,fetch(a);case 3:403==(s=e.sent).status?n("noAdminRole"):r(s.json());case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"setResponseMode",value:(g=d(l.a.mark((function e(t){var r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="CHAT"==t,n="https://manager.line.biz"+"/api/v1/bots/@".concat(this.accountId,"/responseSettings/enabledChat"),a={enabled:r},e.prev=3,e.next=6,fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 6:return s=e.sent,e.next=9,s.json();case 9:return o=e.sent,e.abrupt("return",{success:0===Object.keys(o).length});case 13:return e.prev=13,e.t0=e.catch(3),C.error("LINE: FAIL TO SET RESPONSE MODE",e.t0),e.abrupt("return",{success:!1});case 17:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(e){return g.apply(this,arguments)})},{key:"enableWebhook",value:(m=d(l.a.mark((function e(){var t,r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://manager.line.biz"+"/api/bots/@".concat(this.accountId,"/responseSettings/enabledWebhook"),r={enabled:!0},e.prev=2,e.next=5,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 5:return n=e.sent,e.next=8,n.json();case 8:return a=e.sent,e.abrupt("return",{success:0===Object.keys(a).length});case 12:return e.prev=12,e.t0=e.catch(2),C.error("LINE: FAIL TO SET RESPONSE MODE",e.t0),e.abrupt("return",{success:!1});case 16:case"end":return e.stop()}}),e,this,[[2,12]])}))),function(){return m.apply(this,arguments)})},{key:"enableDeveloperViewWh",value:(v=d(l.a.mark((function e(){var t,r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://developers.line.biz"+"/api/v1/channel/".concat(this.channel.channelId,"/botConfiguration/features/webhook"),r={value:1},e.next=4,fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 4:return n=e.sent,e.next=7,n.json();case 7:a=e.sent,Object(ar.isEmpty)(a)||C.log("TURN ON WH VIEW DEVELOPERS FAILED");case 9:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"enableRetryWebhook",value:(f=d(l.a.mark((function e(){var t,r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://developers.line.biz"+"/api/v1/channel/".concat(this.channel.channelId,"/botConfiguration/features/webhook/redelivery"),r={value:!0},e.prev=2,e.next=5,fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 5:return n=e.sent,e.next=8,n.json();case 8:return a=e.sent,e.next=11,this.enableDeveloperViewWh();case 11:return e.abrupt("return",{success:Object(ar.isEmpty)(a)});case 14:return e.prev=14,e.t0=e.catch(2),C.error("LINE: FAIL TO ENABLE RETRY WEBHOOK",e.t0),e.abrupt("return",{success:!1});case 18:case"end":return e.stop()}}),e,this,[[2,14]])}))),function(){return f.apply(this,arguments)})},{key:"enableErrorAggregation",value:(p=d(l.a.mark((function e(){var t,r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://developers.line.biz"+"/api/v1/channel/".concat(this.channel.channelId,"/botConfiguration/features/webhook/errorAggregation"),r={value:!0},e.prev=2,e.next=5,fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 5:return n=e.sent,e.next=8,n.json();case 8:return a=e.sent,e.abrupt("return",{success:Object(ar.isEmpty)(a)});case 12:return e.prev=12,e.t0=e.catch(2),C.error("LINE: FAIL TO ENABLE ERROR AGGREGATION",e.t0),e.abrupt("return",{success:!1});case 16:case"end":return e.stop()}}),e,this,[[2,12]])}))),function(){return p.apply(this,arguments)})},{key:"getAllMessagesOfCustomer",value:(u=d(l.a.mark((function e(t){var r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=null,n=[],a={};case 3:return e.next=5,this.getMessages(t,r);case 5:if(!(s=e.sent).success){e.next=12;break}n=n.concat(s.messages),Object.assign(a,s.files),r=s.next,e.next=13;break;case 12:return e.abrupt("return",{success:!1});case 13:if(r){e.next=3;break}case 14:return e.abrupt("return",{success:!0,messages:n,mediaFiles:a});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getConversations",value:(i=d(l.a.mark((function e(t){var r,n,a,s,o,i,u,p,d,f,h,v,_;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={folderType:"ALL",tagIds:"",limit:1},t&&(r.next=t),n=Object.getOwnPropertyNames(r).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(r[e]))})).join("&"),e.prev=3,e.next=6,this.chatUserId;case 6:return a=e.sent,s="https://chat.line.biz/api/v2/bots/".concat(a,"/chats?").concat(n),e.next=10,fetch(s);case 10:return o=e.sent,e.next=13,o.json();case 13:i=e.sent,u=[],p=ur(i.list),e.prev=16,p.s();case 18:if((d=p.n()).done){e.next=34;break}return f=d.value,C.log("LINE: GETTING MESSAGES OF CUSTOMER ".concat(f.profile.name)),e.next=23,this.getAllMessagesOfCustomer(f.chatId);case 23:if(h=e.sent,v=h.messages,_=h.mediaFiles,!h.success){e.next=31;break}u.push(c(c({},f),{},{messages:v,mediaFiles:_})),e.next=32;break;case 31:throw new Error("Get messages failed");case 32:e.next=18;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(16),p.e(e.t0);case 39:return e.prev=39,p.f(),e.finish(39);case 42:return e.abrupt("return",{success:!0,data:u,next:i.next||null});case 45:return e.prev=45,e.t1=e.catch(3),C.error("LINE: FAIL TO GET CONVERSATION",e.t1),e.abrupt("return",{success:!1});case 49:case"end":return e.stop()}}),e,this,[[3,45],[16,36,39,42]])}))),function(e){return i.apply(this,arguments)})},{key:"getMessages",value:(o=d(l.a.mark((function e(t,r){var n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.chatUserId;case 3:return n=e.sent,a="https://chat.line.biz/api/v2/bots/".concat(n,"/messages/").concat(t),r&&(a+="?backward=".concat(r)),e.next=8,fetch(a);case 8:return s=e.sent,e.next=11,s.json();case 11:return o=e.sent,e.next=14,this.fetchMediaContents(o.list);case 14:return i=e.sent,e.abrupt("return",{success:!0,messages:o.list,files:i,next:o.backward||null});case 18:return e.prev=18,e.t0=e.catch(0),C.error("LINE: FAIL TO GET MESSAGES OF CUSTOMER ".concat(t),e.t0),e.abrupt("return",{success:!1});case 22:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e,t){return o.apply(this,arguments)})},{key:"fetchMediaContents",value:(s=d(l.a.mark((function e(t){var r,n,a,s,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={},n=ur(t),e.prev=2,s=l.a.mark((function e(){var t,n,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=a.value.message)||!t.contentProvider||"line"!==t.contentProvider.type){e.next=7;break}return n=t.contentProvider.contentHash,e.next=5,o.getMedia(n,t.type).catch((function(e){return C.warning("CANNOT GET MEDIA CONTENT. REASON: ".concat(e),t.contentProvider),null}));case 5:s=e.sent,r[n]=s;case 7:case"end":return e.stop()}}),e)})),n.s();case 5:if((a=n.n()).done){e.next=9;break}return e.delegateYield(s(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),n.e(e.t1);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e,null,[[2,11,14,17]])}))),function(e){return s.apply(this,arguments)})},{key:"getAccessToken",value:(a=d(l.a.mark((function e(){var t,r,n,a,s,o,i,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.channel){e.next=3;break}throw new Error("missingChannel");case 3:if(this.channel.channelId){e.next=5;break}throw new Error("missingChannelId");case 5:return t="https://developers.line.biz"+"/api/v1/channel/".concat(this.channel.channelId),e.next=8,fetch(t);case 8:return r=e.sent,e.next=11,r.json();case 11:if(n=e.sent,a=n.issuedToken,s=n.iconUrl,o=n.name,i=n.botConfiguration,u=a&&a.accessToken,o&&!this.channel.name&&(this.channel=c(c({},this.channel),{},{name:o,avatarUrl:s,searchId:null==i?void 0:i.basicId})),u){e.next=24;break}return e.next=18,this.issueAccessToken();case 18:if(!(p=e.sent).success){e.next=23;break}u=p.accessToken,e.next=24;break;case 23:throw new Error("Issue token failed");case 24:return e.abrupt("return",{success:!0,accessToken:u});case 27:return e.prev=27,e.t0=e.catch(0),C.error("LINE: FAIL TO GET ACCESS TOKEN",e.t0),e.abrupt("return",{success:!1,err:e.t0.message});case 31:case"end":return e.stop()}}),e,this,[[0,27]])}))),function(){return a.apply(this,arguments)})},{key:"issueAccessToken",value:(n=d(l.a.mark((function e(){var t,r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C.log("LINE: ISSUING NEW ACCESS TOKEN"),e.prev=1,this.channel){e.next=4;break}throw new Error("Missing channel");case 4:if(this.channel.channelId){e.next=6;break}throw new Error("Missing channel id");case 6:return t="https://developers.line.biz"+"/api/v1/channel/".concat(this.channel.channelId,"/issueLongtermToken"),r={revokesIn:0},e.next=10,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 10:return n=e.sent,e.next=13,n.json();case 13:return a=e.sent,e.abrupt("return",{success:!0,accessToken:a.accessToken});case 17:return e.prev=17,e.t0=e.catch(1),C.error("LINE: FAIL TO ISSUE ACCESS TOKEN",e.t0),e.abrupt("return",{success:!1});case 21:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(){return n.apply(this,arguments)})},{key:"getMedia",value:(r=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r,e.next="image"===e.t0?3:12;break;case 3:return e.t1="https://chat-content.line.biz/bot/",e.next=6,this.chatUserId;case 6:return e.t2=e.sent,n=e.t1.concat.call(e.t1,e.t2,"/").concat(t),e.next=10,fetch(n);case 10:return a=e.sent,e.abrupt("return",a.blob());case 12:return e.abrupt("return",Promise.reject("Unsupported media type"));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"chatUserId",get:function(){var e=this;return new Promise((function(t,r){e.__cache_chatUserId__?t(e.__cache_chatUserId__):fetch("https://chat.line.biz/account/@".concat(e.accountId)).then((function(n){var a=n.url,s=new RegExp("https://chat.line.biz/(\\w+)$"),o=a.match(s);o[1]?(e.__cache_chatUserId__=o[1],t(e.__cache_chatUserId__)):r()}))}))}}],[{key:"getLineInstance",value:(t=d(l.a.mark((function t(r){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r.accountId in e.__instantiatedInstances__)){t.next=2;break}return t.abrupt("return",e.__instantiatedInstances__[r.accountId]);case 2:if(!(r.channelId in e.__instantiatedInstances__)){t.next=4;break}return t.abrupt("return",e.__instantiatedInstances__[r.channelId]);case 4:if(C.log("LINE: LINE INSTANCE NOT FOUND"),!r.accountId&&!r.channelId){t.next=15;break}return C.log("LINE: BEGIN INSTANTIATE LINE INSTANCE"),n=new e(r),t.next=10,n.init();case 10:return e.__instantiatedInstances__[n.accountId]=n,e.__instantiatedInstances__[n.channel.channelId]=n,t.abrupt("return",n);case 15:return C.log("LINE: CANNOT INSTANTIATE LINE INSTANCE BECAUSE accountId or channelId NOT FOUND"),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]),e}();pr.__instantiatedInstances__={},self.Line=pr;var dr=function(){function e(t){h(this,e),this.postId=t.postId}var t;return _(e,[{key:"getData",value:(t=d(l.a.mark((function e(){var t,r,n,a,s,o,i,c,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S,E,C,T,R,N,O,P,D,U,B,F,M;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://www.facebook.com/".concat(this.postId),e.next=3,re(t);case 3:if(r=e.sent,s=/\["adp_CometSinglePostContentQueryRelayPreloader_\w+",(.+})\]/,!(o=(o=r.match(s))&&o[1])){e.next=15;break}return n=A(o,'"__bbox":'),e.next=11,L(n[0]);case 11:return a=e.sent,console.log("parsedObject_normal_post_",a),p=null===(i=a)||void 0===i||null===(c=i.result)||void 0===c||null===(u=c.data)||void 0===u?void 0:u.node,e.abrupt("return",p?{type:"normal",post:p}:null);case 15:if(o){e.next=26;break}if(s=/\["adp_FBReelsRootWithEntrypointQueryRelayPreloader_\w+",(.+})\]/,!(o=(o=r.match(s))&&o[1])){e.next=26;break}return n=A(o,'"__bbox":'),e.next=23,L(n[0]);case 23:return a=e.sent,v=null===(d=a)||void 0===d||null===(f=d.result)||void 0===f||null===(h=f.data)||void 0===h?void 0:h.video,e.abrupt("return",v?{type:"reel",post:v}:null);case 26:if(o){e.next=44;break}if(s=/\["adp_CometVideoHomeNewPermalinkHeroUnitQueryRelayPreloader_\w+",(.+})\]/,o=r.match(s),console.log("match__",o),!(o=o&&o[1])){e.next=44;break}return n=A(o,'"__bbox":'),e.next=35,L(n[0]);case 35:return a=e.sent,console.log("parsedObject_video_",a),k=null===(_=a)||void 0===_||null===(m=_.result)||void 0===m||null===(g=m.data)||void 0===g?void 0:g.video,w=A(r,'"creation_story":'),e.next=41,L(w[0]);case 41:return S=e.sent,E=null==S||null===(b=S.comet_sections)||void 0===b||null===(I=b.message)||void 0===I||null===(y=I.story)||void 0===y||null===(x=y.message)||void 0===x?void 0:x.text,e.abrupt("return",k?{type:"video",post:k,message:E}:null);case 44:if(o){e.next=56;break}if(s=/\["adp_CometVideoHomeInjectedLiveVideoQueryRelayPreloader_\w+",(.+})\]/,!(o=(o=r.match(s))&&o[1])){e.next=56;break}return n=A(o,'"__bbox":'),e.next=52,L(n[0]);case 52:return a=e.sent,console.log("parsedObject_live_post_",a),N=null===(C=a)||void 0===C||null===(T=C.result)||void 0===T||null===(R=T.data)||void 0===R?void 0:R.video,e.abrupt("return",N?{type:"live",post:N}:null);case 56:if(o){e.next=67;break}if(s=/\["adp_CometSinglePostDialogContentQueryRelayPreloader_\w+",(.+})\]/,!(o=(o=r.match(s))&&o[1])){e.next=67;break}return n=A(o,'"__bbox":'),e.next=64,L(n[0]);case 64:return a=e.sent,M=null===(O=a)||void 0===O||null===(P=O.result)||void 0===P||null===(D=P.data)||void 0===D||null===(U=D.node)||void 0===U||null===(B=U.comet_sections)||void 0===B||null===(F=B.content)||void 0===F?void 0:F.story,e.abrupt("return",M?{type:"single_post_dialog",post:M}:null);case 67:return e.abrupt("return",null);case 68:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),fr=r(9),hr=r.n(fr);function vr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _r=[me,Rt,Bt,Ht,Fe,ze,Ve,Ne,sr,Ce,ir,Mt,ye,Ee,Ye,zt,Xt,Dt,nr,rr,Pt,er,pr,Gt,qt,or,tr,Yt,je,cr,Me,Vt,jt,Ft,function e(t){var r=this,n=t.pageId,a=t.businessManagerUserAccessToken,s=t.catalogId,i=t.worker,c=t.selectedProducts,u=t.locale,p=t.currency,v=t.batchAppId,_=t.urlInsertProduct;h(this,e),o(this,"init",d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.catalogId&&r.businessManagerUserAccessToken){e.next=3;break}return e.next=3,r.getParams();case 3:case"end":return e.stop()}}),e)})))),o(this,"syncProductsFromPosToFBShop",d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r.selectedProducts.map((function(e){t.push(new Promise((function(){r.generrateProductGroup().then((function(t){var n=t.retailer_id;r.insertFirstProduct(n,e.variations[0],(function(t){t.success?e.variations.length>1?r.insertProducts(e.variations.splice(1),t,n,(function(n){n.success?r.postMessageSyncSuccess(e):r.postMessageSyncError(t.error)})):r.postMessageSyncSuccess(e):r.postMessageSyncError(t.error.message)}))})).catch((function(e){r.postMessageSyncError(e)}))})))})),Promise.all(t).then((function(){r.postMessageSyncFinish()})).catch((function(e){"object"==f(e)?190!=e.code||skip?r.postMessageSyncError(e.message):r.getParams().then((function(){r.syncProductsFromPosToFBShop(!0)})):r.postMessageSyncError(e.message)}));case 3:case"end":return e.stop()}}),e)})))),o(this,"syncProductsFromFBShopToPos",(function(e){r.getVariations(null,[]).then((function(e){r.insertProductToPos(e).then((function(){r.postMessageSyncSuccess()}))})).catch((function(t){190!=t.code||e?r.postMessageSyncError(t):r.getParams().then((function(){r.syncProductsFromFBShopToPos(!0)}))}))})),o(this,"insertProductToPos",function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se(r.urlInsertProduct,{variations:JSON.stringify(t),page_id:r.pageId,type:"fbshop_to_pos"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o(this,"generrateProductGroup",d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://graph.facebook.com/".concat(r.version,"/").concat(r.catalogId,"/product_groups?access_token=").concat(r.businessManagerUserAccessToken),e.abrupt("return",ae(t,{_reqName:"object:product_catalog/product_groups",_reqSrc:"ProductCatalogAPIClient",fields:'["retailer_id"]',locale:r.locale,method:"post",pretty:0,retailer_id_mode:"ALLOW_AUTO_GENERATE",suppress_http_code:1},{},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}));case 2:case"end":return e.stop()}}),e)})))),o(this,"uploadCatalogImage",function(){var e=d(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.base.ctx.fb_dtsg&&r.base.ctx.userID){e.next=5;break}return e.next=3,re(r.makeShopViewUrl());case 3:n=e.sent,r.base.ctxFromHtml(n);case 5:return e.abrupt("return",r.handleUploadCatalog(t));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o(this,"handleUploadCatalog",function(){var e=d(l.a.mark((function e(t){var n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.base.buildParams(r.base.ctx),a=Object.entries(n).map((function(e){return e.join("=")})).join("&"),s="https://business.facebook.com/products/catalog/image_upload/async/?catalog_id=".concat(r.catalogId,"&").concat(a),(o=new FormData).append("image_file",t),e.next=7,ae(s,o,{});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o(this,"makeShopViewUrl",(function(){return"https://www.facebook.com/".concat(r.pageId,"/shop/?referral_code=page_shop_tab&preview=1&ref=page_internal")})),o(this,"extractImageIdFromResponse",(function(e){var t=e.lastIndexOf('"payload":'),r=e.indexOf("}",t),n=e.substring(t+10,r+1);return JSON.parse(n).imageID})),o(this,"insertFirstProduct",(function(e,t,n){var a=t.images,s=[];a.map((function(e){s.push(new Promise((function(t){!function(e,t){var r=new XMLHttpRequest;r.onload=function(){t(r.response)},r.responseType="blob",r.open("GET",e),r.send()}(e,(function(e){t(e)}))})))})),Promise.all(s).then((function(s){var o=[];s.forEach((function(e){o.push(new Promise((function(t){r.uploadCatalogImage(e).then((function(e){t(r.extractImageIdFromResponse(e))}))})))})),Promise.all(o).then((function(o){var i="https://graph.facebook.com/".concat(r.version,"/").concat(r.catalogId,"/products?access_token=").concat(r.businessManagerUserAccessToken,"&suppress_http_code=1"),c=new FormData,u={retailer_id_mode:"ALLOW_AUTO_GENERATE",image_file:s[0],price:t.price,retailer_id:t.retailer_id,name:t.name,currency:r.currency,sale_price:t.price,visibility:"published",condition:"new",availability:"in stock",inventory:t.inventory,description:t.description||"",fields:"image_url,additional_image_urls",retailer_product_group_id:e,locale:r.locale,url:"https://www.facebook.com/".concat(r.pageId,"/shop"),video_file:"null",uploaded_image_id:o[0]};Object.keys(u).map((function(e){c.append(e,u[e])})),t.custom_data&&c.append("custom_data",JSON.stringify(t.custom_data));var p,f,h=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return vr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}(o);try{for(h.s();!(p=h.n()).done;){var v=p.value;c.append("additional_uploaded_image_ids[]",v)}}catch(e){h.e(e)}finally{h.f()}try{var _=ae(i,c,{},{parseResponse:(f=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})});n({resInsertFirstProduct:_,imageUploaded:a[0],success:!_.error,error:_.error})}catch(e){n({success:!1,error:e})}}))}))})),o(this,"handleCaseResponInsertProduct",(function(e){})),o(this,"insertProducts",(function(e,t,n,a){var s=t.resInsertFirstProduct,o=[],i=s.image_url;e.map((function(e){o.push(new Promise((function(t){var a=encodeURIComponent("https://www.facebook.com/".concat(r.pageId,"/shop")),s=encodeURIComponent(JSON.stringify(e.custom_data)),o="_reqName=".concat(encodeURIComponent("object:product_catalog"),"/products&_reqSrc=").concat(encodeURIComponent("ProductCatalogAPIClient"),"&          availability=").concat(encodeURIComponent("in stock"),"&condition=new&currency=").concat(r.currency,"&          description=").concat(encodeURIComponent(e.description||""),"&image_url=").concat(encodeURIComponent(i),"&inventory=").concat(e.inventory,"&          price=").concat(e.price,"&retailer_id=").concat(e.retailer_id,"&retailer_id_mode=ALLOW_AUTO_GENERATE&retailer_product_group_id=").concat(n,"&          visibility=published&name=").concat(encodeURIComponent(e.name),"&url=").concat(a);e.custom_data&&(o+="&custom_data=".concat(s)),t({relative_url:"/".concat(r.version,"/").concat(r.catalogId,"/products"),method:"post",body:o})})))})),Promise.all(o).then((function(e){var t,n="https://graph.facebook.com/?access_token=".concat(r.businessManagerUserAccessToken),s={batch_app_id:r.batchAppId,include_headers:!1,method:"post",pretty:0,suppress_http_code:1,batch:JSON.stringify(e)};try{ae(n,s,{},{parseResponse:(t=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).map((function(e){if(200!=e.code)throw e.body})),a({success:!0})}catch(e){a({success:!1,error:e})}}))})),o(this,"getVariations",function(){var e=d(l.a.mark((function e(t,n){var a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,s=t||"https://graph.facebook.com/".concat(r.version,"/").concat(r.catalogId,"/products?fields=currency,custom_data,price,product_feed,url,color,category,sale_price_end_date,sale_price,inventory,brand,description,image_url,    image_cdn_urls,product_group,product_catalog,product_type,name,id,gender,condition,commerce_insights,review_status,start_date,visibility,size,short_description,shipping_weight_value,shipping_weight_unit,review_rejection_reasons,    retailer_product_group_id,sale_price_start_date,retailer_id,ordering_index,pattern,mobile_link,material,manufacturer_part_number,gtin,fb_product_category,expiration_date,custom_label_4,custom_label_3,custom_label_2,custom_label_1,    custom_label_0,capability_to_review_status,availability,applinks,age_group,additional_variant_attributes,additional_image_urls,additional_image_cdn_urls&limit=").concat(r.limit,"&access_token=").concat(r.businessManagerUserAccessToken),e.next=4,ne(s,{headers:{"Content-Type":"application/json; charset=UTF-8"},parseResponse:function(e){return e}});case 4:if(400!=(a=e.sent).status){e.next=10;break}return e.next=8,a.text();case 8:e.t0=e.sent,a={code:190,message:e.t0};case 10:if(!a.data){e.next=21;break}if(n=[].concat(S(n),S(a.data)),a.data.length!=r.limit){e.next=18;break}return e.next=15,r.getVariations(a.paging.next,n);case 15:return e.abrupt("return",e.sent);case 18:return e.abrupt("return",n);case 19:e.next=22;break;case 21:throw a;case 22:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),o(this,"deleteProduct",function(){var e=d(l.a.mark((function e(t){var n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t.map((function(e){var t={relative_url:"/".concat(r.version,"/").concat(e,"?_reqName=").concat(encodeURIComponent("object:catalog_item"),"&_reqSrc=ProductCatalogAPIClient&locale=").concat(r.locale),method:"delete"};n=[].concat(S(n),[t])})),n=JSON.stringify(n),a="https://graph.facebook.com/?access_token=".concat(r.businessManagerUserAccessToken),e.next=6,ae(a,{batch_app_id:r.batchAppId,include_headers:!1,method:"post",pretty:0,suppress_http_code:1},{},{headers:{"Content-Type":"application/json; charset=UTF-8"}});case 6:s=e.sent,o=!0,i=null,s.map((function(e){o=200==e.code&&o,i=e.body})),o?r.postMessageSyncSuccess():his.postMessageSyncError(i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o(this,"postMessageSyncError",(function(e){r.worker.port.postMessage({type:"POS_SYNC_PRODUCT_ERROR",error:e})})),o(this,"postMessageSyncSuccess",(function(e){r.worker.port.postMessage({type:"POS_SYNC_PRODUCT_SUCCESS",data:e})})),o(this,"postMessageSyncFinish",(function(){r.worker.port.postMessage({type:"POS_SYNC_PRODUCT_FINISH"})})),o(this,"getParams",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://www.facebook.com/".concat(r.pageId,"/admin/shop/"),e.next=3,re(t);case 3:return n=e.sent,r.base.ctxFromHtml(n),r.catalogId=r.extractCatalogId(n),r.locale=r.extractLocale(n),e.next=9,r.getCatalogManagerAccessToken().then((function(e){r.businessManagerUserAccessToken=r.extractBusinessManagerUserAccessToken(e),r.batchAppId=r.extractBatchAppId(e,r.businessManagerUserAccessToken),r.worker.port.postMessage({type:"SYNC_PRODUCT_FBSHOP_CACHE_PARAMS",catalogId:r.catalogId,businessManagerUserAccessToken:r.businessManagerUserAccessToken,locale:r.locale,batchAppId:parseInt(r.batchAppId)})}));case 9:case"end":return e.stop()}}),e)})))),o(this,"getCatalogManagerAccessToken",d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://business.facebook.com/products/catalogs/".concat(r.catalogId,"/products"),e.next=3,re(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))),o(this,"extractBusinessManagerUserAccessToken",(function(e){var t=e.lastIndexOf('"accessToken":"'),r=e.indexOf('",',t);return e.substring(t+15,r)})),o(this,"extractCatalogId",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"catalog_id=",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"&amp;",n=e.indexOf(t),a=e.indexOf(r,n);return e.substring(n+t.length,a)})),o(this,"extractLocale",(function(e){var t=e.indexOf('"LocaleInitialData"'),r=e.indexOf('"locale":"',t)+10,n=e.indexOf('"',r);return e.substring(r,n)})),o(this,"extractBatchAppId",(function(e,t){var r=e.indexOf(t),n=e.indexOf('"appID":"',r)+9,a=e.indexOf('"',n);return e.substring(n,a)})),this.catalogId=s,this.selectedProducts=c,this.businessManagerUserAccessToken=a,this.pageId=n,this.locale=u,this.currency=p,this.batchAppId=v,this.base=new me,this.limit=200,this.version="v7.0",this.worker=i,this.urlInsertProduct=_},function(){function e(t,r,n,a,s,o,i){h(this,e),this.worker=t,this.pageId=r,this.convId=n.replace("t_mid","mid"),this.taskId=a,this.uploadId=s,this.photoUrl=o,this.name=i,this.reqs=new Map}var t;return _(e,[{key:"init",value:(t=d(l.a.mark((function e(){var t,r,n,a,s,o,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"message",this.type=t,r=this,n="","message"==t?(n="https://m.facebook.com/messages/read/?tid=cid.c.",n+=this.convId,n+=":",n+=this.pageId,n+="&pageID=",n+=this.pageId,n+="&ref=bookmarks&__m_async_page__=&m_sess=&__req=g&__ajax__=true&__user="):(a=this.convId.split("_")[0],n="https://m.facebook.com/comment/replies/?ctoken="+this.convId,n+="&actor_id="+this.pageId+"&ft_ent_identifier="+a,n+="__m_async_page__=&m_sess=&__ajax__=true&__user="+ctx.userID),e.next=7,re(n);case 7:if(s=e.sent){e.next=10;break}return e.abrupt("return");case 10:(o=s.match(/waterfallID\\":\\"([^"\\]+)/i))&&(r.waterfallID=o[1]);case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"uploadPhoto",value:function(){var e=this,t=this;getBlob(this.photoUrl,(function(r){e.upload(r).then((function(e){t.worker.port.postMessage({type:"UPLOAD_INBOX_PHOTO_SUCCESS",from:"EXTENSION",taskId:t.taskId,uploadId:t.uploadId,fbId:e.fbid,previewUri:e.previewUri})})).catch((function(){t.worker.port.postMessage({type:"UPLOAD_INBOX_PHOTO_FAILURE",from:"EXTENSION",taskId:t.taskId,uploadId:t.uploadId})}))}))}},{key:"upload",value:function(e){CCake.validateConnect();var t=this,r="https://p-upload.facebook.com/_mupload_/photo/x/saveunpublished/?thumbnail_width=80&thumbnail_height=80&";r+="waterfall_id="+this.waterfallID,r+="&waterfall_app_name=web_m_touch&waterfall_source="+this.type+"&",r+="target_id="+this.pageId+"&av="+this.pageId,r+="&fb_dtsg="+dtsg,r+="&m_sess=&__ajax__=true&__user="+ctx.userID;var n=new FormData;return n.append("photo",e,this.name),new Promise(function(){var a=d(l.a.mark((function a(s,o){var i,c,u;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,ae(r,n,{},{parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:i=a.sent,c=i.match(/"fbid":"(\d+)"/i),u=i.match(/"preview_uri":"([^"]+)"/i),c&&u?s({fbid:c[1],previewUri:u[1].replace(/\\/g,"")}):t.failbackToNormal(e).then(s).catch(o),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(0),o();case 12:case"end":return a.stop()}}),a,null,[[0,9]])})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"failbackToNormal",value:function(e,t){var r=this;return new Promise((function(t,n){CCake.getInboxNormal(r.pageId).then((function(a){a.uploadBlob(e,r.pageId,r.name).then(t).catch(n)})).catch(n)}))}},{key:"abort",value:function(e){this.reqs.has(e)&&(this.reqs.get(e).abort(),this.reqs.delete(e))}},{key:"aborts",value:function(){this.reqs.forEach((function(e){e.abort()}))}}]),e}(),w];hr.a.registerClasses(_r);var mr=[{id:1,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://www.facebook.com"},{header:"Accept",operation:"set",value:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"}]},condition:{requestDomains:["facebook.com","upload.facebook.com"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:2,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://business.facebook.com"}]},condition:{requestDomains:["business.facebook.com","upload-business.facebook.com"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:3,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"http://raw.pages.fm"}]},condition:{requestDomains:["raw.pages.fm"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:4,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://business.facebook.com"}]},condition:{requestDomains:["graph.facebook.com"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:5,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://pages.fm"}]},condition:{requestDomains:["statics.pancake.vn"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:6,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://manager.line.biz"}]},condition:{requestDomains:["manager.line.biz"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:7,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://developers.line.biz"}]},condition:{requestDomains:["developers.line.biz"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:8,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://chat.line.biz"}]},condition:{requestDomains:["chat.line.biz"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:9,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Sec-Fetch-Site",operation:"set",value:"same-origin"}]},condition:{urlFilter:"*",resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:10,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://business.facebook.com"}]},condition:{urlFilter:"wss://edge-chat.facebook.com",resourceTypes:["websocket"]}},{id:11,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://adsmanager.facebook.com"}]},condition:{urlFilter:"adsmanager*facebook.com",resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:12,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"x-requested-with",operation:"set",value:"XMLHttpRequest"}]},condition:{urlFilter:"line.biz",resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:13,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://www.instagram.com"}]},condition:{urlFilter:"wss://edge-chat.instagram.com",resourceTypes:["websocket"]}},{id:14,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://www.instagram.com"}]},condition:{requestDomains:["instagram.com"],resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}},{id:15,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Origin",operation:"set",value:"https://oa.zalo.me"}]},condition:{requestDomains:["oa.zalo.me"]}},{id:16,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"Authority",operation:"set",value:"business.facebook.com"}]},condition:{urlFilter:"https://business.facebook.com/latest/inbox/all",resourceTypes:["script","main_frame","sub_frame","xmlhttprequest"]}}];function gr(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}function br(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ir=function(){function e(t){h(this,e),this.url=t}var t;return _(e,[{key:"download",value:(t=d(l.a.mark((function e(t){var r,n,a,s,o,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=-1,e.next=4,fetch(this.url);case 4:if((n=e.sent).ok&&404!==n.status){e.next=7;break}return e.abrupt("return",t({type:"DOWNLOAD_FILE_FAILURE",keepHandleTask:!1}));case 7:a=this.processContentLength(n.headers.entries()),s=!0,o=!1,e.prev=10,c=gr(n.body);case 12:return e.next=14,c.next();case 14:return u=e.sent,s=u.done,e.next=18,u.value;case 18:if(p=e.sent,s){e.next=25;break}t({chunk:p,index:++r,type:"DOWNLOAD_FILE_SUCCESS",keepHandleTask:!0,contentLength:a});case 22:s=!0,e.next=12;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(10),o=!0,i=e.t0;case 31:if(e.prev=31,e.prev=32,s||null==c.return){e.next=36;break}return e.next=36,c.return();case 36:if(e.prev=36,!o){e.next=39;break}throw i;case 39:return e.finish(36);case 40:return e.finish(31);case 41:t({type:"DOWNLOAD_FILE_SUCCESS",keepHandleTask:!1}),e.next=48;break;case 44:return e.prev=44,e.t1=e.catch(0),console.error("FileDownloader: Encounter error while download file",e.t1),e.abrupt("return",t({type:"DOWNLOAD_FILE_FAILURE",keepHandleTask:!1}));case 48:case"end":return e.stop()}}),e,this,[[0,44],[10,27,31,41],[32,,36,40]])}))),function(e){return t.apply(this,arguments)})},{key:"processContentLength",value:function(e){var t=0;try{var r,n=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return br(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?br(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}(e);try{for(n.s();!(r=n.n()).done;){var a=s(r.value,2),o=a[0],i=a[1];"content-length"===o&&(t=parseInt(i))}}catch(e){n.e(e)}finally{n.f()}}catch(e){}finally{return t}}}]),e}();self.FileDownloader=Ir;var yr=Ir,xr=new(function(){function e(){h(this,e)}var t,r;return _(e,[{key:"log",value:(r=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("log_",t,r),e.prev=1,e.next=4,X.getItem("CACHE_REQUEST_FREQUENCY");case 4:if(!(n=e.sent)){e.next=20;break}if((n=JSON.parse(n))[t]?n[t][r]||0===n[t][r]?n[t][r]=n[t][r]+1:n[t][r]=1:n[t]=o({},r,1),!(n[t][r]>30)){e.next=16;break}return n[t][r]=0,e.next=12,X.setItem("CACHE_REQUEST_FREQUENCY",JSON.stringify(n));case 12:return e.next=14,this.sendLog(t,r);case 14:e.next=18;break;case 16:return e.next=18,X.setItem("CACHE_REQUEST_FREQUENCY",JSON.stringify(n));case 18:e.next=23;break;case 20:return a=o({},t,o({},r,1)),e.next=23,X.setItem("CACHE_REQUEST_FREQUENCY",JSON.stringify(a));case 23:e.next=27;break;case 25:e.prev=25,e.t0=e.catch(1);case 27:case"end":return e.stop()}}),e,this,[[1,25]])}))),function(e,t){return r.apply(this,arguments)})},{key:"sendLog",value:(t=d(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,se("https://pancake.vn/api/v1/pages/extension_log",{page_id:r,type:t,count:31});case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}());function kr(e){return new Promise(function(){var t=d(l.a.mark((function t(r){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,re("https://".concat(e));case 2:n=t.sent,r(n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}self.externalGraphLog=xr;var wr={},Sr=new(function(){function e(){h(this,e)}var t,r,n,a;return _(e,[{key:"get",value:function(){var e=d(l.a.mark((function e(){var t,r,n,a,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o.length>0&&void 0!==o[0]&&o[0])){e.next=5;break}return e.abrupt("return",this.makeIGDBase());case 5:return e.prev=5,e.next=8,this.restoreBase();case 8:if(1!=(null==(t=e.sent)?void 0:t.length)){e.next=14;break}return r=s(t,1),n=r[0],e.abrupt("return",null==n?void 0:n.ctx);case 14:return e.next=16,this.makeBase();case 16:return a=e.sent,e.next=19,this.persistBase(a);case 19:return e.abrupt("return",null==a?void 0:a.ctx);case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e.catch(5),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this,[[5,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"makeIGDBase",value:(a=d(l.a.mark((function e(){var t,r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re("https://www.instagram.com/");case 2:return t=e.sent,(r=t.match(/\\?"appId\\?":\\?"(\d+)\\?"/i))&&r[0]&&(wr.appId=r[1]),(n=t.match(/\\?"clientID\\?":\\?"([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\\?"\}/i))&&n[1]&&(wr.clientID=n[1]),e.abrupt("return",wr);case 8:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"makeBase",value:(n=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new me,e.next=3,kr("business.facebook.com");case 3:return r=e.sent,e.next=6,t.ctxFromHtml(r);case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"restoreBase",value:(r=d(l.a.mark((function e(){var t,r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new me,r="base_business",e.prev=2,C.log("restoreBase_key:",r),e.next=6,X.getItem(r);case 6:if(!(n=e.sent)){e.next=19;break}if(a=JSON.parse(n),!((null==(s=a.base)?void 0:s.lastLoadHtmlAt)>=(new Date).getTime()/1e3-3600)){e.next=14;break}return(null==s?void 0:s.webSession)&&(s.webSession=Object.assign(new w,s.webSession)),e.abrupt("return",[Object.assign(t,s)]);case 14:return e.next=16,X.removeItems([r]);case 16:case 19:return e.abrupt("return",!1);case 17:e.next=20;break;case 20:e.next=28;break;case 22:return e.prev=22,e.t0=e.catch(2),e.next=26,X.removeItems([r]);case 26:return console.error("Encounter error while restore base: ".concat(r),e.t0),e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,null,[[2,22]])}))),function(){return r.apply(this,arguments)})},{key:"persistBase",value:(t=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="base_business",e.prev=1,C.log("persisBase_key:",r),e.next=5,X.setItem(r,JSON.stringify({base:t}));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("Encounter error while persistBase key: ".concat(r),e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])}))),function(e){return t.apply(this,arguments)})}]),e}());function Er(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Cr=function(){function e(t){var r=t.videoId,n=t.pageId;h(this,e),this.pageId=n,this.videoId=r,this.base=null,this.graphql=null,this.html="",this.initialized=!1,this.actorID=null}var t,r,n,a,s,o,i,u,p,f;return _(e,[{key:"init",value:(f=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.html,e.t0){e.next=5;break}return e.next=4,re("https://www.facebook.com/");case 4:e.t0=e.sent;case 5:return t=e.t0,this.html=t,this.base=new me,e.next=10,this.base.ctxFromHtml(t);case 10:return this.graphql=new Rt({base:this.base,pageId:this.pageId,isBussiness:!1}),e.next=13,this.loadDoc();case 13:this.initialized=!0;case 14:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getLiveDashboardHtml",value:(p=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="https://www.facebook.com/live/producer/v2/".concat(this.videoId,"/dashboard?_ps=1"),e.next=4,re(t);case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error in getLiveDashboardHtml:",e.t0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return p.apply(this,arguments)})},{key:"loadDoc",value:(u=d(l.a.mark((function e(){var t,r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],At.has("usePinnedProductMutationMutation")||t.push("usePinnedProductMutationMutation"),0!==(null==t?void 0:t.length)){e.next=4;break}return e.abrupt("return");case 4:if(C.log("Need load doc for livestream:",t),this.allDocReady(t)){e.next=13;break}return C.warning("Plan A: Load doc from bootloader-endpoint"),e.next=9,this.getBootloaderEndpoint();case 9:if(!(r=e.sent)){e.next=13;break}return e.next=13,At.loadDocIdsFromView({html:r,docNames:t});case 13:if(this.allDocReady(t)){e.next=21;break}return C.warning("Plan B: Load doc from live dashboard (not reliable)"),e.next=17,this.getLiveDashboardHtml();case 17:if(!(n=e.sent)){e.next=21;break}return e.next=21,At.loadDocIdsFromView({html:n,docNames:t});case 21:if(this.allDocReady(t)){e.next=29;break}return C.warning("Plan C: Fallback to route-definition"),e.next=25,this.getRouteDefinition();case 25:if(!(a=e.sent)){e.next=29;break}return e.next=29,At.loadDocIdsFromView({html:a,docNames:t.concat(["LiveProducerLP2BroadcastContainerQuery"])});case 29:if(this.allDocReady(t)){e.next=37;break}return C.warning("Plan D: Fallback to graphql - LiveProducerLP2BroadcastContainerQuery"),e.next=33,this.getLiveProducerLP2BroadcastContainerQuery();case 33:if(!(s=e.sent)){e.next=37;break}return e.next=37,At.loadDocIdsFromView({html:s,docNames:t});case 37:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"getRouteDefinition",value:(i=d(l.a.mark((function e(){var t,r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getActorId();case 3:for(s in t=e.sent,r=this.base.buildParams(),delete(n=c(c({},r),{},{client_previous_actor_id:t,route_url:"/live/producer/".concat(this.videoId,"/?entry_point=edit_dialog"),routing_namespace:"fb_comet",trace_policy:"comet.profile.timeline.list",__crn:"comet.fbweb.CometProfileTimelineListViewRoute",__aaid:0,__comet_req:15})).__pc,delete n.__beoa,delete n.__csr,a=[],n)o=encodeURIComponent(s),i=encodeURIComponent(n[s]),a.push(o+"="+i);return a=a.join("&"),e.next=15,ae("https://www.facebook.com/ajax/route-definition/",a,{},{headers:{"Content-Type":"application/x-www-form-urlencoded"},parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 15:return e.abrupt("return",e.sent);case 18:return e.prev=18,e.t0=e.catch(0),console.error("Error in getRouteDefinition:",e.t0),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(){return i.apply(this,arguments)})},{key:"getBootloaderEndpoint",value:(o=d(l.a.mark((function e(){var t,r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s in e.prev=0,t="https://www.facebook.com/ajax/bootloader-endpoint/",r=this.base.buildParams(),n=c(c({},r),{},{modules:"LiveProducerLoomBroadcastRoot.react,LiveProducerLP2StreamSetupTabRoot.react",__aaid:0,__comet_req:15,__crn:"comet.fbweb.CometProfileTimelineListViewRoute"}),a=[],n)o=encodeURIComponent(s),i=encodeURIComponent(n[s]),a.push(o+"="+i);return a=a.join("&"),t=t+"?"+a,e.next=10,re(t);case 10:return e.abrupt("return",e.sent);case 13:return e.prev=13,e.t0=e.catch(0),console.error("Error in getBootloaderEndpoint:",e.t0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return o.apply(this,arguments)})},{key:"getLiveProducerLP2BroadcastContainerQuery",value:(s=d(l.a.mark((function e(){var t,r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!At.has("LiveProducerLP2BroadcastContainerQuery")){e.next=10;break}return t=Math.floor((new Date).valueOf()/1e3),r={event_starts_after:t-2592e3,event_starts_before:t,isWorkplace:!1,pageID:this.pageId,scale:2,shouldSkipWorkbenchTabViewQuery:!0,videoID:this.videoId,__relay_internal__pv__GHLShouldChangeSponsoredDataFieldNamerelayprovider:!0,__relay_internal__pv__IsFBAdsExperiencerelayprovider:!0,__relay_internal__pv__IsWorkUserrelayprovider:!1},e.next=6,this.graphql.graphql("LiveProducerLP2BroadcastContainerQuery",r,{__comet_req:15,__aaid:0},!1,function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:return n=e.sent,e.abrupt("return",n);case 10:return e.abrupt("return",null);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error("Error in getLiveProducerLP2BroadcastContainerQuery:",e.t0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return s.apply(this,arguments)})},{key:"allDocReady",value:function(e){var t,r=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Er(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Er(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(!At.has(n))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"listAllProductItems",value:(a=d(l.a.mark((function e(){var t,r,n,a=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:null,this.initialized){e.next=4;break}return e.next=4,this.init();case 4:return r={cursor:t,itemsCount:100,searchKeyword:"",id:this.videoId},e.next=7,this.graphql.graphql("LiveProducerFeaturedProductAllProductsItemListPaginationQuery",r);case 7:return n=e.sent,e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"pinProduct",value:(n=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=3;break}return e.next=3,this.init();case 3:return e.next=5,this.getActorId();case 5:return r=e.sent,n={input:{actor_id:r,client_mutation_id:"2",is_unfeature:!1,playback_time_s:null,product_item_id:t,product_set_id:null,video_id:this.videoId}},e.next=9,this.graphql.graphql("usePinnedProductMutationMutation",n);case 9:return a=e.sent,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unpinProduct",value:(r=d(l.a.mark((function e(t){var r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=3;break}return e.next=3,this.init();case 3:return e.next=5,this.getActorId();case 5:return r=e.sent,n={input:{actor_id:r,client_mutation_id:"1",is_unfeature:!0,playback_time_s:null,product_item_id:t,product_set_id:null,video_id:this.videoId}},e.next=9,this.graphql.graphql("usePinnedProductMutationMutation",n);case 9:return a=e.sent,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getActorId",value:(t=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.actorID){e.next=2;break}return e.abrupt("return",this.actorID);case 2:if(this.html){e.next=4;break}return e.abrupt("return",null);case 4:return t=extractObjectFromString(this.html,'["RelayAPIConfigDefaults",[],'),e.next=7,convertStringToObject(t[0]);case 7:return r=e.sent,C.log("GOT video_target_entity",r),this.actorID=null==r?void 0:r.actorID,e.abrupt("return",this.actorID);case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();self.Livestream=Cr;var Tr=Cr,Ar=function(){function e(t){var r=this,n=t.pageId,a=t.postId,s=t.taskId,i=t.endCursor;h(this,e),o(this,"preloadDocIds",function(){var t=d(l.a.mark((function t(n){var a,s,o,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.postId,s="https://www.facebook.com/".concat(a),t.next=5,re("https://www.facebook.com/ajax/bootloader-endpoint/?modules=CometResharesDialog.react");case 5:return o=t.sent,t.next=8,re(s);case 8:return i=t.sent,t.t0=At,t.t1=i,t.t2=[lt,ut],t.next=14,e.getExtraJsFilesToLoad(o);case 14:return t.t3=t.sent,t.next=17,e.getExtraJsFilesToLoadFirst(o,'"rsrcMap":');case 17:return t.t4=t.sent,t.t5={html:t.t1,docNames:t.t2,extraResource:t.t3,extraResourceMap:t.t4},t.next=21,t.t0.loadDocIdsFromView.call(t.t0,t.t5);case 21:return t.next=23,r.preloadViewRootDoc(i);case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),o(this,"preloadViewRootDoc",function(){var t=d(l.a.mark((function t(n){var a,s,o,i,c,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o in a=Object.assign(r.base.buildParams(),{"route_urls[0]":"/",__comet_req:15}),s=[],a)i=encodeURIComponent(o),c=encodeURIComponent(a[o]),s.push(i+"="+c);return s=s.join("&"),t.next=7,ae("https://www.facebook.com/ajax/bulk-route-definitions/",s,{},{headers:{"Content-Type":"application/x-www-form-urlencoded","Sec-Ch-Prefers-Color-Scheme":"dark","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Full-Version-List":'"Chromium";v="122.0.6261.112", "Not(A:Brand";v="24.0.0.0", "Google Chrome";v="122.0.6261.112"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Model":"","Sec-Ch-Ua-Platform":"macOS","Sec-Ch-Ua-Platform-Version":"13.4.1","Viewport-Width":1115},parseResponse:function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.text();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 7:return u=t.sent,t.t0=At,t.t1=n,t.t2=["CometTahoeRootQuery"],t.next=13,e.getExtraJsFilesToLoad(u);case 13:return t.t3=t.sent,t.next=16,e.getExtraJsFilesToLoadFirst(u,'"rsrcMap":');case 16:return t.t4=t.sent,t.t5={html:t.t1,docNames:t.t2,extraResource:t.t3,extraResourceMap:t.t4},t.next=20,t.t0.loadDocIdsFromView.call(t.t0,t.t5);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),o(this,"makeBase",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://www.facebook.com/".concat(r.pageId),e.next=3,re(t);case 3:return n=e.sent,e.next=6,r.base.ctxFromHtml(n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))),o(this,"preloadFeedbackId",d(l.a.mark((function t(){var n,a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="https://www.facebook.com/".concat(r.postId),t.next=3,re(n);case 3:return a=t.sent,t.next=6,e.getExtraJsFilesToLoadFirst(a,'"parent_feedback":');case 6:if(!(s=t.sent)!=[]){t.next=11;break}return t.next=10,e.getExtraJsFilesToLoadFirst(a,'"feedback":');case 10:s=t.sent;case 11:return r.feedbackId=s.id,t.next=14,r.cachefeedbackId();case 14:case"end":return t.stop()}}),t)})))),o(this,"init",d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.feedbackFromCache(r.postId);case 2:return t=e.sent,e.next=5,r.makeBase();case 5:if(At.isFeatureReady("crawlLivestreamData")){e.next=8;break}return e.next=8,r.preloadDocIds({pageId:r.pageId,postId:r.postId});case 8:if(!t){e.next=12;break}r.feedbackId=t,e.next=14;break;case 12:return e.next=14,r.preloadFeedbackId();case 14:if(!r.feedbackId){e.next=20;break}return e.next=17,r.handlePostShare();case 17:return e.abrupt("return",e.sent);case 20:throw"CRAW POST SHARE FAILED, CANT FIND POST ID";case 21:case"end":return e.stop()}}),e)})))),o(this,"handlePostShare",(function(){return new Promise(function(){var e=d(l.a.mark((function e(t,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.makeBase();case 2:return e.next=4,r.doCrawlData();case 4:a=e.sent,t(a.filter((function(e){return"User"==e.__typename})));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())})),o(this,"doCrawlData",d(l.a.mark((function e(){var t,n,a,s,o,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Rt({pageId:r.pageId,base:r.base}),e.next=3,t.graphql(ut,{UFI2CommentsProvider_commentsKey:"CometResharesDialogQuery",feedLocation:"SHARE_OVERLAY",feedbackID:r.feedbackId,feedbackSource:1,privacySelectorRenderLocation:"COMET_STREAM",renderLocation:"reshares_dialog",scale:1,__relay_internal__pv__IsWorkUserrelayprovider:!1,__relay_internal__pv__IsMergQAPollsrelayprovider:!1,__relay_internal__pv__CometUFIReactionsEnableShortNamerelayprovider:!1,__relay_internal__pv__CometUFIIsRTAEnabledrelayprovider:!1,__relay_internal__pv__StoriesArmadilloReplyEnabledrelayprovider:!0},{__ccg:"EXCELLENT",server_timestamps:!0,av:t.base.ctx.userID,__comet_req:15});case 3:if(n=e.sent,a=r.parseResponse(n),s=a.edges,o=a.endCursor,i=a.hasNextPage,r.setLoadedCursor(o),r.endCursor!==r.loadedCursor){e.next=8;break}return e.abrupt("return",[]);case 8:if(c=r.sharedUserFromNodes(s),!i){e.next=15;break}return e.next=12,r.doScrollCrawlData(o,c);case 12:return e.abrupt("return",e.sent);case 15:return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e)})))),o(this,"doScrollCrawlData",function(){var e=d(l.a.mark((function e(t,n){var a,s,o,i,c,u,p,h,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Rt({pageId:r.pageId,base:r.base}),s=8*Math.random(),e.next=4,new Promise((function(e){setTimeout(d(l.a.mark((function n(){var s;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.graphql(lt,{UFI2CommentsProvider_commentsKey:"CometResharesDialogQuery",count:1,cursor:t,displayCommentsContextEnableComment:null,displayCommentsContextIsAdPreview:null,displayCommentsContextIsAggregatedShare:null,displayCommentsContextIsStorySet:null,displayCommentsFeedbackContext:null,feedLocation:"SHARE_OVERLAY",feedbackSource:1,focusCommentID:null,privacySelectorRenderLocation:"COMET_STREAM",renderLocation:"reshares_dialog",scale:1,useDefaultActor:!1,id:r.feedbackId},{__ccg:"EXCELLENT",server_timestamps:!0,__hs:""},!1);case 2:s=n.sent,e(s);case 4:case"end":return n.stop()}}),n)}))),s)}));case 4:if("object"!==f(o=e.sent)&&((i=A(o,'{"data"')[0])?o={data:L(i)}:Logger.log("POST_VIEW_SHARE - GET SHARED DATA FAIL: ",o)),c=r.parseResponse(o),u=c.edges,p=c.endCursor,h=c.hasNextPage,v=r.sharedUserFromNodes(u),n=[].concat(S(n),S(v)),!h){e.next=15;break}return e.next=12,r.doScrollCrawlData(p,n);case 12:return e.abrupt("return",e.sent);case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),o(this,"sharedUserFromNodes",(function(e){return e.map((function(e){var t,n,a,s,o,i,u,l,p,d,f,h,v,_=null==e||null===(t=e.node)||void 0===t||null===(n=t.comet_sections)||void 0===n||null===(a=n.feedback)||void 0===a||null===(s=a.story)||void 0===s||null===(o=s.feedback_context)||void 0===o||null===(i=o.feedback_target)||void 0===i?void 0:i.owning_profile;return _||(_=null==e||null===(u=e.node)||void 0===u||null===(l=u.comet_sections)||void 0===l||null===(p=l.context_layout)||void 0===p||null===(d=p.story)||void 0===d||null===(f=d.comet_sections)||void 0===f||null===(h=f.actor_photo)||void 0===h||null===(v=h.story)||void 0===v?void 0:v.actors[0]),c(c({},_),{},{creation_time:r.findCreationTime(e.node.comet_sections.context_layout.story.comet_sections.metadata)})}))})),o(this,"parseResponse",(function(e){var t=(e.data.node?e.data.node:e.data.feedback).reshares,r=t.edges,n=t.page_info;return{edges:r,endCursor:n.end_cursor,hasNextPage:n.has_next_page}})),o(this,"findCreationTime",(function(e){var t=null;if(e&&e.length>0)for(var r=0;r<e.length;r++){var n=e[r];if(n.story&&n.story.creation_time){t=n.story.creation_time;break}}return t})),o(this,"crawlSuccess",(function(e,t,n,a){e.port.postMessage({type:"CRAWL_POST_SHARE_DATA_SUCCESS",taskId:t,pageId:n,sharedUsers:a,endCursor:r.loadedCursor,success:!0})})),o(this,"crawlFail",(function(e,t,r){e.port.postMessage({type:"CRAWL_POST_SHARE_DATA_FAILURE",taskId:t,pageId:r,success:!1})})),o(this,"cachefeedbackId",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("postViewShare");case 2:t=e.sent,(n=t?JSON.parse(t):{})[r.postId]=r.feedbackId,X.setItem("postViewShare",JSON.stringify(n));case 6:case"end":return e.stop()}}),e)})))),o(this,"feedbackFromCache",d(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("postViewShare");case 2:if(!(t=e.sent)){e.next=8;break}return n=JSON.parse(t),e.abrupt("return",n[r.postId]||null);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))),o(this,"setLoadedCursor",(function(e){e&&(r.loadedCursor=e)})),o(this,"onlyUnique",(function(e,t,r){return r.findIndex((function(t){return t.id==e.id}))===t})),this.pageId=n,this.postId=a,this.feedbackId=null,this.base=new me,this.taskId=s,this.endCursor=i,this.loadedCursor=null}var t,r;return _(e,null,[{key:"getExtraJsFilesToLoadFirst",value:(r=d(l.a.mark((function e(t,r){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=A(t,r)[0]){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,L(n);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"getExtraJsFilesToLoad",value:(t=d(l.a.mark((function e(t){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=A(t,'"allResources":')[0]){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,L(r);case 6:return n=e.sent,e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(0),console.log("error",e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e){return t.apply(this,arguments)})}]),e}();self.PostViewShare=Ar;var Rr={};self.igdInboxNormals=Rr;var Lr=function(){function e(t){h(this,e),this.base=new me,this.pageId=t}return _(e,[{key:"init",value:function(){var e=this,t=this.pageId;return new Promise(function(){var r=d(l.a.mark((function r(n,a){var o,i,c,u,p,d,f,h;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.base.restoreBase(e.base,t);case 2:if(3!=(null==(o=r.sent)?void 0:o.length)){r.next=12;break}C.log("fallback_stored_igd_base_data",o),i=s(o,3),c=i[0],u=i[1],p=i[2],e.base=c,e.cquick_token=u,e.refererUrl=p,n(),r.next=41;break;case 12:return d="https://www.instagram.com/",r.prev=13,r.next=16,re(d);case 16:return f=r.sent,r.next=19,e.base.ctxFromHtml(f);case 19:if(e.getCQuickToken(f),!e.base.Env||!e.base.Env.compat_iframe_token){r.next=25;break}d=e.base.getCompatIframeSource(d),e.base.load_html(d).then((function(){e.base.persistBase(t,e.cquick_token,d),n()})).catch(a),r.next=34;break;case 25:if(!e.cquick_token){r.next=32;break}return r.next=28,Bt.loadCompatView(d,e.cquick_token);case 28:h=r.sent,e.base.ctxFromHtml(h).then((function(){e.base.persistBase(t,e.cquick_token,d),n()})).catch(a),r.next=34;break;case 32:e.base.persistBase(t,e.cquick_token,d),n();case 34:e.refererUrl=d,r.next=41;break;case 37:r.prev=37,r.t0=r.catch(13),console.error(r.t0),a();case 41:case"end":return r.stop()}}),r,null,[[13,37]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"getCQuickToken",value:function(e){var t=e.match(/"compat_iframe_token":"([^"]+)"/);t&&(this.cquick_token=t[1]),C.log("cquick_token",this.cquick_token)}},{key:"upload",value:function(e,t,r,n){var a=new Bt({pageId:this.pageId});return a.base=this.base,a.upload(e,this.pageId,r,"instagram_direct")}}],[{key:"getInboxInstance",value:function(t){return new Promise(function(){var r=d(l.a.mark((function r(n,a){var s,o;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:C.log("IN GET CACHE IGD INBOX NORMAL"),Rr[t]?!(s=Rr[t]).base.lastLoadHtmlAt||s.base.lastLoadHtmlAt<(new Date).getTime()/1e3-3600?s.init().then((function(){n(s)})).catch(a):n(s):(o=new e(t),Rr[t]=o,o.init().then((function(){n(o)})).catch(a));case 2:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}}]),e}();self.InstagramDirectNormal=Lr;var Nr=Lr,Or=r(3),Pr=r.n(Or),Dr=function(e){return"https://oa.zalo.me/manage/choose?pageid=".concat(e)},Ur=function(){function e(t){var r=this,n=t.accessToken,a=t.pageId;h(this,e),o(this,"extractCustomerZaloId",function(){var t=d(l.a.mark((function t(n,a,s){var o,i,c,u,p,d;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new FormData,i={customerId:n,src:""},c=r.encryptParams(a,JSON.stringify(i)),o.append("params",c),t.next=6,e.getCustomerZaloId(o,s,n);case 6:return u=t.sent,t.next=9,u.json();case 9:return p=t.sent,d=JSON.parse(r.decryptResponse(a,p.data)),t.abrupt("return",null==d?void 0:d.customerId);case 12:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()),this.accessToken=n,this.pageId=a}var t,r,n,a,i,c;return _(e,[{key:"stop",value:(c=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.shouldStop=!0,e.next=3,X.removeItems(["zalo_oa_".concat(t,"_oaId"),"zalo_oa_".concat(t,"_ek"),"lastest_zalo_oa_page_id"]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"init",value:(i=d(l.a.mark((function t(r){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X.getItem("lastest_zalo_oa_page_id");case 2:if(t.sent!==r){t.next=5;break}return t.abrupt("return");case 5:return t.abrupt("return",new Promise(function(){var t=d(l.a.mark((function t(n){var a,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.selectPageOA(r.split("_").pop());case 2:return t.next=4,e.preloadUserInfo();case 4:if(a=t.sent,0!==(o=JSON.parse(a)).error_code){t.next=10;break}return t.next=9,X.setItem("lastest_zalo_oa_page_id",r);case 9:Object.entries(o.data).forEach(function(){var e=d(l.a.mark((function e(t){var n,a,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s(t,2),a=n[0],o=n[1],!["oaId","ek"].includes(a)){e.next=4;break}return e.next=4,X.setItem("zalo_oa_".concat(r,"_").concat(a),o);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:n();case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 6:case"end":return t.stop()}}),t)}))),function(e){return i.apply(this,arguments)})},{key:"sendFileReply",value:(a=d(l.a.mark((function e(t,r,n,a){var s,o,i,c,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("zalo_oa_".concat(n,"_ek"));case 2:return s=e.sent,e.next=5,X.getItem("zalo_oa_".concat(n,"_oaId"));case 5:return o=e.sent,i=a.split("_").pop(),e.next=9,this.extractCustomerZaloId(i,s,o);case 9:if(c=e.sent,u="co.".concat(o,".").concat(c),o&&c&&u&&s){e.next=13;break}return e.abrupt("return",{success:!1,data:"Missing required data"});case 13:return p={oaId:o,convId:u,anonymous:!1,customerId:i},"VIDEO"===t&&delete p.anonymous,d=new FormData,f=this.encryptParams(s,JSON.stringify(p)),d.append("params",f),e.next=20,fetch(null==r?void 0:r.fileUrl);case 20:return h=e.sent,v=h.headers.get("content-length"),e.next=24,h.blob();case 24:if(_=e.sent,d.append("file",_,null==r?void 0:r.fileName),"VIDEO"!==t){e.next=35;break}return m=(null==r?void 0:r.fileUrl.split("/").slice(0,4).join("/"))+"/fvideothumb/"+(null==r?void 0:r.fileUrl.split("/").slice(4).join("/")),e.next=30,fetch(m);case 30:return g=e.sent,e.next=33,g.blob();case 33:b=e.sent,d.append("file_thumb",b,null==r?void 0:r.fileName.replace(/\.[^/.]+$/,".jpeg"));case 35:e.prev=35,e.t0=t,e.next="VIDEO"===e.t0?39:41;break;case 39:return I="https://oa.zalo.me/chatv2/message/send-video?platform=web",e.abrupt("break",43);case 41:return I="https://oa.zalo.me/chatv2/message/send-file?platform=web",e.abrupt("break",43);case 43:return e.next=45,ae(I,d,void 0,{headers:{Referer:"https://oa.zalo.me/chatv2?uid=".concat(i,"&oaid=").concat(o),Withcredentials:"true"}});case 45:return y=e.sent,e.next=48,y.json();case 48:return x=e.sent,k=this.decryptResponse(s,x.data),w=JSON.parse(k),Object.assign(w,{fileSize:v}),e.abrupt("return",{success:!0,data:w});case 55:return e.prev=55,e.t1=e.catch(35),e.abrupt("return",{success:!1,data:e.t1});case 58:case"end":return e.stop()}}),e,this,[[35,55]])}))),function(e,t,r,n){return a.apply(this,arguments)})},{key:"encryptParams",value:function(e,t){var r=Pr.a.enc.Utf8.parse(e),n=Pr.a.enc.Hex.parse(this.toHexString([11,22,33,44,99,88,77,66,11,22,33,44,99,88,77,66]));return Pr.a.AES.encrypt(t,r,{iv:n,mode:Pr.a.mode.CBC,padding:Pr.a.pad.Pkcs7}).toString()}},{key:"decryptResponse",value:function(e,t){var r=Pr.a.enc.Utf8.parse(e),n=Pr.a.enc.Hex.parse(this.toHexString([11,22,33,44,99,88,77,66,11,22,33,44,99,88,77,66]));return Pr.a.AES.decrypt(t,r,{iv:n,mode:Pr.a.mode.CBC,padding:Pr.a.pad.Pkcs7}).toString(Pr.a.enc.Utf8)}},{key:"toHexString",value:function(e){return Array.from(e,(function(e){return("0"+(255&e).toString(16)).slice(-2)})).join("")}}],[{key:"preloadUserInfo",value:(n=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re("https://oa.zalo.me/chatv2/user/login-info?platform=web",{headers:{Referer:"https://oa.zalo.me/manage/oa"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"selectPageOA",value:(r=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(Dr(t),{headers:{Referer:"https://oa.zalo.me/manage/oa"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"getCustomerZaloId",value:(t=d(l.a.mark((function e(t,r,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae("https://oa.zalo.me/chatv2/customer/decode-uid?platform=web",t,void 0,{headers:{Referer:"https://oa.zalo.me/chatv2?uid=".concat(n,"&oaid=").concat(r)}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}();function Br(e,t){try{if(!Array.isArray(e))return[];if(e.some((function(e){return e===t})))return[e];for(var r=[],n=0;n<(null==e?void 0:e.length);n++)r=r.concat(Br(e[n],t));return r}catch(e){return logger.ferror("Encounter error while findAllBlockActions",e),[]}}self.ReplyFileZaloOA=Ur;var Fr=function(){function e(){h(this,e),this.pageData=new Map}var t,r,n;return _(e,[{key:"formatKey",value:function(e,t){return e}},{key:"getContext",value:(n=d(l.a.mark((function e(t,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&""!==t){e.next=2;break}throw"Invalid pageId value type";case 2:if("string"==typeof r){e.next=4;break}throw"Invalid deviceId value type";case 4:if(""!==r){e.next=8;break}return e.next=7,this.createPageContext(t);case 7:return e.abrupt("return",e.sent);case 8:return n=this.formatKey(t,r),e.abrupt("return",this.pageData.has(n)?this.pageData.get(n).toObject():null);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"createPageContext",value:(r=d(l.a.mark((function e(t){var r,n,a,s,o,i,u,p,d,f,h,v,_,m,g,b,I,y,x,k,w,S;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchBusinessPage(t);case 2:if(n=e.sent,this.validatePageIdWithLoadedContext(t,n),a=this.extractDeviceId(n),s=this.extractCurrentUserInitialData(n),o=this.extractBlocksForTrans(n),i=this.extractDataBlock(n),u=this.extractThreadMapping(i),p=this.extractThreadMapingStore2(i),0!=(null===(r=o)||void 0===r?void 0:r.length)){e.next=29;break}if((d=new me).ctxFromHtml(n),f=new GraphQL({base:d,pageId:t,isBussiness:!0}),h=0,At.has("LSBizInboxGraphQLLightspeedRequestQuery")){e.next=15;break}return e.next=15,At.loadDocIdsFromView({html:n,docNames:["LSBizInboxGraphQLLightspeedRequestQuery"]});case 15:v=this.getContact(n),_=[],m=0,g=[2,205];case 18:if(!(m<g.length)){e.next=28;break}return y=g[m],x={deviceId:a,igdAssetId:null,pageAssetId:t,requestId:++h,requestPayload:JSON.stringify({database:y,epoch_id:0,last_applied_cursor:null,sync_params:JSON.stringify(c({locale:v.locale,bloks_version:v.bloks_version},205==y?{selected_thread_id:"",selected_thread_type:"FB_MESSAGE"}:{})),version:"24051549331103763"}),requestType:1,waAssetId:null},e.next=23,f.graphql("LSBizInboxGraphQLLightspeedRequestQuery",x,{__aaid:"0",__comet_req:"11",__crn:"comet.bizweb.BusinessCometBizSuiteInboxAllMessagesRoute"});case 23:(null==(k=e.sent)||null===(b=k.data)||void 0===b||null===(I=b.viewer)||void 0===I?void 0:I.unified_inbox_lightspeed_web_request)&&_.push(k);case 25:m++,e.next=18;break;case 28:(null==_?void 0:_.length)>0&&(o=_.map((function(e){var t,r,n,a=JSON.parse(null==e||null===(t=e.data)||void 0===t||null===(r=t.viewer)||void 0===r||null===(n=r.unified_inbox_lightspeed_web_request)||void 0===n?void 0:n.payload);return{database:a.step[1][1][3][2][1],cursor:a.step[1][1][3][5]}})),i=_.map((function(e){var t,r;return null==e||null===(t=e.data)||void 0===t||null===(r=t.viewer)||void 0===r?void 0:r.unified_inbox_lightspeed_web_request})),u=this.extractThreadMapping(i),p=this.extractThreadMapingStore2(i));case 29:return w=this.formatKey(t,a),S=new Mr(t,a,{deviceId:a,pageId:t,accountId:s.ACCOUNT_ID,appId:s.APP_ID,currentFbUserData:s,blocksTrans:o},{datas:i,threadMapping:u,threadMappingStoreV2:p}),this.pageData.set(w,S),e.abrupt("return",S.toObject());case 33:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getContact",value:function(e){var t=A(e,'["LSPlatformBizInboxSyncParams",[],'),r=JSON.parse(t[0]);return JSON.parse(r.contact)}},{key:"validatePageIdWithLoadedContext",value:function(e,t){var r,n=A(t,'"meta_business_scoping":'),a=JSON.parse(n[0]);if(e!==(null==a||null===(r=a.current_scope)||void 0===r?void 0:r.scope_id))throw"Found invalid scope"}},{key:"fetchBusinessPage",value:(t=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://business.facebook.com/latest/inbox/all?page_id=".concat(t,"&asset_id=").concat(t),e.next=3,re(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"extractDeviceId",value:function(e){var t=A(e,'["MqttWebDeviceID",[],'),r=JSON.parse(t[0]).clientID;if(!r||"string"!=typeof r)throw"Invalid MqttWebDeviceID";return r}},{key:"extractBlocksForTrans",value:function(e){return A(e,'{"unified_inbox_lightspeed_web_request":').map((function(e){var t=JSON.parse(e),r=JSON.parse(t.payload);return r&&r.step?{database:r.step[1][1][3][2][1],cursor:r.step[1][1][3][5]}:null})).filter((function(e){return!!e}))}},{key:"extractCurrentUserInitialData",value:function(e){try{var t=A(e,'"CurrentUserInitialData":');return C.log("matched_CurrentUserInitialData",t),JSON.parse(t[0])}catch(t){console.log("error_extractCurrentUserInitialData",t);var r=A(e,'"CurrentUserInitialData",[],');return JSON.parse(r[0])}}},{key:"extractDataBlock",value:function(e){return A(e,'"unified_inbox_lightspeed_web_request":').map((function(e){return JSON.parse(e)}))}},{key:"extractThreadMapping",value:function(e){var t=e.map((function(e){return e.payload||""})).join("_______________"),r='"setBusinessThreadInfo",',n=A(t,r).map((function(e){var n=A(t,r+e);return{globalId:JSON.parse(e)[1],threadId:JSON.parse(n[0])[1]}}));return(n=n.filter((function(e){var t=e.globalId,r=e.threadId;return t&&r}))).reduce((function(e,t){var r=t.globalId,n=t.threadId;return c(c({},e),{},o({},n,r))}),{})}},{key:"extractThreadMapingStore2",value:function(e){try{for(var t=e.map((function(e){return JSON.parse(e.payload)})),r=[],n=0;n<(null==t?void 0:t.length);n++){var a=t[n],s=Br((null==a?void 0:a.step)||[],"deleteThenInsertThread");r=r.concat(s)}return r.map((function(e){var t,r;return{threadId:null==e||null===(t=e[65])||void 0===t?void 0:t[1],globalId:null==e||null===(r=e[9])||void 0===r?void 0:r[1]}})).filter((function(e){var t=e.threadId,r=e.globalId;return t&&r})).reduce((function(e,t){var r=t.globalId,n=t.threadId;return c(c({},e),{},o({},n,r))}),{})}catch(e){return{}}}}]),e}(),Mr=function(){function e(t,r,n,a){h(this,e),this.pageId=t,this.deviceId=r,this.context=n||null,this.initPageData=a||null}return _(e,[{key:"toObject",value:function(){return{pageId:this.pageId,deviceId:this.deviceId,context:this.context,initPageData:this.initPageData}}}]),e}(),Gr=new Fr;self.globalBusinessWSContext=Gr;var qr,Hr,jr,zr,Vr,Wr,Kr=Gr;function Qr(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Yr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Yr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw s}}}}function Yr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}self.pancake_ext_version=267;var Jr=function(){var e=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,chrome.declarativeNetRequest.getDynamicRules();case 2:return t=e.sent,r=t.map((function(e){return e.id})),e.next=6,chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:r,addRules:mr});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Xr=function(){var e=d(l.a.mark((function e(t,r,n){var a,s,o,i,c,u,p,d=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>3&&void 0!==d[3]&&d[3],e.prev=1,C.warning("UPDATE DYNAMIC RULES FOR URL ".concat(t,", HEADER: ").concat(r)),e.next=5,chrome.declarativeNetRequest.getDynamicRules();case 5:return i=e.sent,c=[],a?(u=(null==i?void 0:i.filter((function(e){var n;return(e.action.requestHeaders||[]).some((function(e){return e.header===r&&"set"===e.operation}))&&(null===(n=e.condition)||void 0===n?void 0:n.urlFilter)===t})))||[],c=null==u?void 0:u.map((function(e){return e.id}))):(p=i.find((function(e){return(e.action.requestHeaders||[]).some((function(e){return e.header===r&&"set"===e.operation}))})),c=p?[p.id]:[]),e.next=10,chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:c,addRules:[{id:1===(null===(s=c)||void 0===s?void 0:s.length)?null===(o=c)||void 0===o?void 0:o[0]:i.length+1,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:r,operation:"set",value:n}]},condition:{urlFilter:t,resourceTypes:["script","main_frame","sub_frame","xmlhttprequest","websocket"]}}]});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("UPDATE DYNAMIC RULE ERROR",e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),$r={};function Zr(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(){var r=d(l.a.mark((function r(n,a){var s,o,i;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:C.log("IN GET CACHE INBOX NORMAL"),s=$r,!t&&s[e]?!(o=s[e]).base.lastLoadHtmlAt||o.base.lastLoadHtmlAt<(new Date).getTime()/1e3-3600?o.init(e).then((function(){n(o)})).catch(a):n(o):(i=new Bt({pageId:e}),$r[e]=i,i.init(e,t).then((function(){n(i)})).catch(a));case 3:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}self.inboxNormals=$r,self.resetInboxNormals=function(){$r={}};var en={};function tn(e){return new Promise(function(){var t=d(l.a.mark((function t(r,n){var a,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(a=en)[e]?(s=a[e]).needsReStartup()?s.startup().then((function(){r(s)})).catch(n):r(en[e]):(o=new Ht(e),en[e]=o,o.startup().then((function(){r(o)})).catch(n));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}var rn=new me;Vr=function(){var e=d(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("requestCount");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=0;case 5:if(!((t=e.t0)>10)){e.next=13;break}return e.next=9,X.setItem("requestCount",0);case 9:return e.next=11,Hr();case 11:e.next=15;break;case 13:return e.next=15,X.setItem("requestCount",++t);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var nn={},an={},sn={},on={},cn={},un={},ln={},pn={};function dn(e,t){if(!un[e]){var r=setTimeout((function(){cn[e].stop(),delete cn[e],delete un[e]}),300);un[e]=r,null==t||t.port.postMessage({type:"I_WANT_STOP_LISTEN_IG_COMMENT",pageId:e})}}self.pancakeListens=nn,chrome.runtime.onConnect.addListener((function(e){var t={};t.port=e,self.pancGlobalWorker=t,e.onMessage.addListener(function(){var e=d(l.a.mark((function e(r){var n,a,o,i,u,p,f,h,v,_,m,g,b,I,y,x,k,w,S,E,T,A,R,L,N,O,P,D,U,B,F,M,q,H,j,V,K,Q,Y,J,$,Z,ee,te,re,ne,ae,se,oe,ie,ce,ue,le,pe,de,fe,he,ve,_e,me,ge,be,Ie,ye,xe,ke,we,Se,Ce,Te,Ae,Re,Le,Oe,Pe,De,Ue,Be,Ge,qe,He,We,Ke,Qe,Je,Xe,$e,Ze,et,tt,rt,nt,at,st,ot,it,ct,ut,lt,pt,dt,ft,ht,vt,_t,mt,gt,bt,It,yt,xt,kt,wt,St,Et,Ct,Tt,Rt,Lt,Nt,Ot,Ut,Bt,Ft,Mt,Ht,Wt,Kt,Qt,Jt,$t,Zt,ar,ur,lr,fr,hr,vr,_r,mr,gr,br,Ir,xr,kr,wr,Er,Cr,Rr,Lr,Or,Pr,Dr,Br,Fr,Mr,Gr,qr,zr,Wr,Yr,Jr,$r,en,rn,fn,hn,vn,_n,mn,gn,bn,In,yn,xn,kn,wn,Sn,En,Cn,Tn,An,Rn,Ln,Nn,On,Pn,Dn,Un,Bn,Fn,Mn,Gn,qn,Hn,jn,zn,Vn,Wn,Kn,Qn,Yn,Jn,Xn,$n,Zn,ea,ta,ra,na,aa,sa,oa;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("WAKE_UP"!=(null===(n=(o={data:r}).data)||void 0===n?void 0:n.type)&&C.log("%c==> RECV_EVENT:","color: #0F9960; font-weight: bold;",null===(a=o.data)||void 0===a?void 0:a.type,r),"EXTENSION"!=o.data.from){e.next=4;break}return e.abrupt("return");case 4:i=o.data.type,e.t0=i,e.next="SEND_COMMENT"===e.t0?8:"EDIT_COMMENT"===e.t0?13:"LISTEN_IG_COMMENT"===e.t0?19:"STOP_LISTEN_IG_COMMENT"===e.t0?21:"PLZ_DONT_STOP_LISTEN_IG_COMMENT_THIS_PAGE"===e.t0?23:"LISTEN_INBOX"===e.t0?25:"STOP_LISTEN_INBOX"===e.t0?28:"PLZ_DONT_STOP_LISTEN_INBOX_THIS_PAGE"===e.t0?30:"LISTEN_WS"===e.t0?32:"STOP_LISTEN_WS"===e.t0?34:"PLZ_DONT_STOP_LISTEN_THIS_PAGE"===e.t0?36:"CHECK_EXTENSION_VERSION"===e.t0?38:"CHECK_EXTENSION"===e.t0?40:"REPORT_EXTENSION_STATUS"===e.t0?45:"UPLOAD_INBOX_PHOTO"===e.t0?47:"REPLY_INBOX_PRODUCT"===e.t0?53:"REPLY_INBOX_PHOTO"===e.t0?59:"SEND_PRIVATE_REPLY"===e.t0?64:"GET_STICKERS"===e.t0?71:"GET_PACK_STICKERS"===e.t0?77:"LOAD_ECOMMERCE_PRODUCT"===e.t0?83:"SEND_STICKER_COMMENT"===e.t0?90:"GET_PROFILE_INFO"===e.t0?96:"GET_PROFILE_LINK"===e.t0?102:"GET_BIRTHDAY_INFO"===e.t0?107:"INVITE_LIKE_PAGE"===e.t0?113:"MAKE_MESSENGER_LINK"===e.t0?119:"GET_IG_CONTACT_ID"===e.t0?125:"PREINITIALIZE_PAGES"===e.t0?131:"PRELOAD_DOC_IDS"===e.t0?137:"LOAD_FACEBOOK_MESSAGES"===e.t0?143:"GET_POST_ID_FROM_LINK"===e.t0?152:"GET_IMG_FROM_SHARED_ATTACHMENT"===e.t0?158:"BLOCK_FACEBOOK_USER"===e.t0?164:"CRAWL_LIVESTREAM_DATA"===e.t0?170:"CRAWL_POST_SHARE_DATA"===e.t0?176:"REACT_MESSAGE"===e.t0?182:"BATCH_GET_GLOBAL_ID"===e.t0?186:"LINE:INITIALIZE_PAGE"===e.t0?190:"LINE:TURN_ON_RETRY_WEBHOOK"===e.t0?194:"LINE:GET_CONVERSATIONS"===e.t0?198:"REMOVE_COMMENT"===e.t0?201:"UPLOAD_MEDIA_TO_PANCAKE"===e.t0?208:"APPROVE_APPOINTMENT"===e.t0?211:"DENY_APPOINTMENT"===e.t0?215:"CONFIG_ROUTING_APP"===e.t0?219:"CACHE_PAGES_ROUTING_APP"===e.t0?223:"CHANGE_CONV_STATUS_TO_ARCHIVED"===e.t0?228:"ENABLE_FIND_THREAD_BY_USERNAME"===e.t0?233:"CREATE_APPOINTMENT"===e.t0?239:"DOWNLOAD_FILE"===e.t0?243:"WAKE_UP"===e.t0?247:"LOAD_FB_POST"===e.t0?250:"GET_BUSINESS_CONTEXT"===e.t0?257:"GET_PINABLE_PRODUCTS"===e.t0?271:"TOGGLE_PIN_PRODUCT"===e.t0?276:"CRAWL_LEAD_FORM_MSG_DETAIL"===e.t0?281:"LISTEN_WS_ZALO_OA"===e.t0?284:"STOP_LISTEN_WS_ZALO_OA"===e.t0?286:"REPLY_INBOX_FILE_ZALO_OA"===e.t0?288:"VALIDATE_SEND_IGD_INBOX"===e.t0?300:"GET_FB_MSG"===e.t0?307:"GET_BUSINESS_WS_CONTEXT"===e.t0?310:"GET_GLOBAL_ID_FOR_CONV"===e.t0?322:327;break;case 8:return e.next=10,Vr();case 10:return u=function(e){var r,n=o.data.taskId;if("instagram_official"===o.data.platform){var a=new ir(o.data);r=a.init().then((function(){return a.replyComment(o.data.postId,o.data.commentId,o.data.message)}))}else r=new Ee(o.data).send();r.then((function(e){e.success?t.port.postMessage({type:"SEND_COMMENT_SUCCESS",taskId:n,messageId:e.message_id,timestamp:e.timestamp}):t.port.postMessage({type:"SEND_COMMENT_FAILURE",taskId:n,message:e.message})})).catch((function(r){console.log("error",r),e?e():t.port.postMessage({type:"SEND_COMMENT_FAILURE",taskId:n})}))},je.startCheck(o.data.pageId,u,!0,!0),e.abrupt("break",328);case 13:return p=o.data.taskId,e.next=16,Vr();case 16:return new Ee(o.data).edit((function(e){t.port.postMessage({type:"EDIT_COMMENT_SUCCESS",result:e,taskId:p})}),(function(){t.port.postMessage({type:"EDIT_COMMENT_FAILURE",result:null,taskId:p})})),e.abrupt("break",328);case 19:return cn[o.data.pageId]||(f=new ir(o.data),cn[o.data.pageId]=f,cn[o.data.pageId].init(!0).then((function(){f.loadPosts()})),dn(o.data.pageId,t)),e.abrupt("break",328);case 21:return cn[o.data.pageId]&&(un[o.data.pageId]||cn[o.data.pageId].stop()),e.abrupt("break",328);case 23:return un[o.data.pageId]&&(clearTimeout(un[o.data.pageId]),delete un[o.data.pageId],setTimeout((function(){dn(o.data.pageId,t)}),18e5)),e.abrupt("break",328);case 25:return sn[o.data.page_id]||(h=new Gt(o.data.accessToken,o.data.page_id),sn[o.data.page_id]=h),sn[o.data.page_id].start(),e.abrupt("break",328);case 28:return sn[o.data.page_id]&&(on[o.data.page_id]||(v=setTimeout((function(){sn[o.data.page_id].stop(),delete sn[o.data.page_id],delete on[o.data.page_id]}),300),on[o.data.page_id]=v,t.port.postMessage({type:"I_WANT_STOP_LISTEN_INBOX",page_id:o.data.page_id}))),e.abrupt("break",328);case 30:return on[o.data.page_id]&&(clearTimeout(on[o.data.page_id]),delete on[o.data.page_id]),e.abrupt("break",328);case 32:return nn[o.data.page_id]||(_=new qt(o.data.accessToken,o.data.page_id),nn[o.data.page_id]=_,_.init().then((function(){return _.loadPosts()}))),e.abrupt("break",328);case 34:return nn[o.data.page_id]&&(an[o.data.page_id]||(m=setTimeout((function(){nn[o.data.page_id].stop(),delete nn[o.data.page_id],delete an[o.data.page_id]}),300),an[o.data.page_id]=m,t.port.postMessage({type:"I_WANT_STOP_LISTEN",page_id:o.data.page_id}))),e.abrupt("break",328);case 36:return an[o.data.page_id]&&(clearTimeout(an[o.data.page_id]),delete an[o.data.page_id]),e.abrupt("break",328);case 38:return t.port.postMessage({type:"EXTENSION_VERSION",version:self.pancake_ext_version}),e.abrupt("break",328);case 40:return e.next=42,Hr();case 42:return e.next=44,jr(t);case 44:return e.abrupt("break",328);case 45:return t.port.postMessage(o.data),e.abrupt("break",328);case 47:return e.next=49,Vr();case 49:return g=o.data,b=g.pageId,g.convId,I=g.taskId,y=g.uploadId,x=g.photoUrl,k=g.name,w=g.platform,S=function(e){("instagram_direct"===w?Nr.getInboxInstance:Zr)(b).then((function(r){r.upload(x,b,k,w).then((function(e){t.port.postMessage({type:"UPLOAD_INBOX_PHOTO_SUCCESS",from:"EXTENSION",taskId:I,uploadId:y,fbId:e.fbid,previewUri:e.previewUri})})).catch((function(r){e?e():t.port.postMessage({type:"UPLOAD_INBOX_PHOTO_FAILURE",from:"EXTENSION",taskId:I,uploadId:y})}))})).catch((function(){e?e():t.port.postMessage({type:"UPLOAD_INBOX_PHOTO_FAILURE",from:"EXTENSION",taskId:I,uploadId:y})}))},"instagram_direct"===w?S():je.startCheck(b,S),e.abrupt("break",328);case 53:return e.next=55,Vr();case 55:return E=o.data,T=E.pageId,A=E.convId,R=E.message,L=E.files,E.attachmentType,N=E.taskId,O=E.threadId,P=E.threadKey,D=E.globalUserId,E.product_ids,U=function(e){var r=new Me({pageId:T,isBusiness:!0,convId:A,message:R,files:L,taskId:N,threadId:O,threadKey:P,globalUserId:D,product_ids:L});r.init().then((function(){r.send().then((function(e){r.sendSuccess(e,t,N,T,A)})).catch((function(n){e?e():r.sendFail(n,t,N,T,A)}))}))},je.startCheck(T,U),e.abrupt("break",328);case 59:return e.next=61,Vr();case 61:return z((function(e){var r=o.data,n=r.pageId,a=r.convId,s=r.message,i=r.files,u=r.attachmentType,l=r.taskId,p=r.threadId,d=r.threadKey,f=r.globalUserId,h=r.platform,v=r.isBusiness,_=r.photoUrl,m=r.photoUrls,g=r.conversationUpdatedTime,b=r.customerName,I=r.from,y=r.replyMessage,x=r.accessToken,k=r.tryResizeImage,w=r.contentIds,S=r.igPageId;!function(r){if("instagram_official"===h){var E=new Pt({pageId:n,isBusiness:v});return E.init().then((function(){return E.sendInbox({customerUsername:b||I.name,igThreadId:f,text:s,photoUrl:_,accessToken:x,tryResizeImage:k,contentIds:w,igPageId:S,attachmentType:u,timeoutKey:e})})).then((function(e){var r=c(c({},e),{},{timestamp:(new Date).getTime(),unreliableTimestamp:!0});E.sendInboxSuccess(t,l,n,a)(r)})).catch((function(e){E.sendInboxFail(t,l,n,a)(e)}))}["VIDEO","PHOTO","STICKER","SEND_TEXT_ONLY","REPLY_MESSAGE","FILE","AUDIO"].includes(u)?Zr(n).then((function(r){r.sendInbox({pageId:n,threadId:p,threadKey:d,globalUserId:f,files:i,text:s,isBusiness:o.data.isBusiness,platform:"facebook",photoUrls:m,conversationUpdatedTime:g,customerName:b,attachmentType:u,replyMessage:y,accessToken:x,tryResizeImage:k,contentIds:w,timeoutKey:e}).then((function(e){r.sendInboxSuccess(t,l,n,a)(e)})).catch((function(e){r.sendInboxFail(t,l,n,a)(e)}))})):tn(n).then((function(e){e.send(l,t,a,s,u,i)})).catch((function(e){console.log(e),t.port.postMessage({type:"REPLY_INBOX_PHOTO_FAILURE",taskId:l})}))}()})),e.abrupt("break",328);case 64:return e.next=66,Vr();case 66:return B=o.data.commentId.split("_"),F=s(B,2),M=F[0],q=F[1],H=Object.assign({},o.data,{worker:t,postId:M,commentId:q}),new Ee(H).privateReply().then((function(e){e.success?t.port.postMessage({type:"SEND_PRIVATE_REPLY_SUCCESS",taskId:H.taskId,messageCreatedRange:e.messageCreatedRange}):t.port.postMessage({type:"SEND_PRIVATE_REPLY_FAILURE",taskId:H.taskId,message:e.message})})).catch((function(e){console.log("error",e),t.port.postMessage({type:"SEND_PRIVATE_REPLY_FAILURE",taskId:H.taskId})})),e.abrupt("break",328);case 71:return e.next=73,Vr();case 73:return j=o.data,V=j.pageId,K=j.taskId,Q=function(e){var r=new jt(V);r.init().then((function(){return r.getListStickers()})).then((function(e){return t.port.postMessage({type:"GET_STICKERS_SUCCESS",taskId:K,data:e})})).catch((function(r){console.log("error",r),e?e():t.port.postMessage({type:"GET_STICKERS_FAILURE",taskId:K})}))},je.startCheck(V,Q),e.abrupt("break",328);case 77:return e.next=79,Vr();case 79:return Y=o.data,J=Y.pageId,$=Y.packId,Z=Y.taskId,ee=function(e){var r=new jt(J);r.init().then((function(){return r.getPackStickers($)})).then((function(e){return t.port.postMessage({type:"GET_PACK_STICKERS_SUCCESS",taskId:Z,data:e})})).catch((function(){e?e():t.port.postMessage({type:"GET_PACK_STICKERS_FAILURE",taskId:Z})}))},je.startCheck(J,ee),e.abrupt("break",328);case 83:return e.next=85,Vr();case 85:return te=o.data,re=te.pageId,ne=te.convId,ae=te.accessToken,se=te.taskId,oe=new zt(t,re,ne,ae,se),e.next=89,oe.get();case 89:return e.abrupt("break",328);case 90:return e.next=92,Vr();case 92:return ie=o.data,ce=ie.pageId,ue=ie.postId,le=ie.commentId,pe=ie.stickerId,de=ie.message,fe=ie.taskId,he=function(){new Vt(t,ce,ue,le,pe,de,fe).send()},je.startCheck(ce,he),e.abrupt("break",328);case 96:return e.next=98,Vr();case 98:return ve=o.data.taskId,(_e=new Yt(o.data)).init().then(_e.get).then((function(e){var r=Object.assign({type:"GET_PROFILE_INFO_SUCCESS",taskId:ve},e);t.port.postMessage(r)})).catch((function(e){C.log(e),t.port.postMessage({type:"GET_PROFILE_INFO_FAILURE",taskId:ve})})),e.abrupt("break",328);case 102:return e.next=104,Vr();case 104:return me=function(e){var r=o.data.taskId;new Fe(o.data).init().then((function(e){var n="https://facebook.com/"+e;t.port.postMessage({type:"GET_PROFILE_LINK_SUCCESS",linkProfile:n,taskId:r})})).catch((function(){e?e():t.port.postMessage({type:"GET_PROFILE_LINK_FAILURE",taskId:r})}))},je.startCheck(o.data.pageId,me,!0,!0),e.abrupt("break",328);case 107:return e.next=109,Vr();case 109:return ge=o.data.taskId,new Xt(o.data).init().then((function(e){t.port.postMessage({type:"GET_BIRTHDAY_INFO_SUCCESS",taskId:ge,birthday:e})})).catch((function(){C.error("FAIL TO GET BIRTHDAY INFO"),t.port.postMessage({type:"GET_BIRTHDAY_INFO_FAILURE",taskId:ge})})),e.abrupt("break",328);case 113:return e.next=115,Vr();case 115:return be=o.data,Ie=be.postIds,ye=be.pageId,xe=be.maxInvite,ke=be.taskId,we=function(){new er(Ie,ye,xe,t,ke).init()},je.startCheck(ye,we),e.abrupt("break",328);case 119:return e.next=121,Vr();case 121:return Se=o.data,Ce=Se.pageId,Te=Se.threadId,Ae=Se.threadKey,Re=Se.isBusiness,Le=Se.uiVersion,Oe=Se.globalId,Pe=Se.conversationUpdatedTime,De=Se.customerName,Ue=Se.platform,Be=Se.taskId,Ge=Se.convId,qe=function(e){new tr({pageId:Ce,threadId:Te,threadKey:Ae,isBusiness:Re,globalId:Oe,uiVersion:Le,conversationUpdatedTime:Pe,customerName:De,platform:Ue,convId:Ge}).init().then((function(e){var r=e.link,n=e.globalId;t.port.postMessage({type:"MAKE_MESSENGER_LINK_SUCCESS",taskId:Be,link:r,globalId:n})})).catch((function(r){C.log("CAN NOT MAKE MESSENGER LINK",r),e?e():t.port.postMessage({type:"MAKE_MESSENGER_LINK_FAILURE",taskId:Be})}))},je.startCheck(Ce,qe),e.abrupt("break",328);case 125:return e.next=127,Vr();case 127:return He=o.data,We=He.pageId,Ke=He.customerName,Qe=He.taskId,Je=He.isIGD,new Pt({pageId:We,isBusiness:!0,isIGD:void 0!==Je&&Je}).findContactId(Ke).then((function(e){t.port.postMessage({type:"GET_IG_CONTACT_ID_SUCCESS",taskId:Qe,contactId:e})})).catch((function(e){t.port.postMessage({type:"GET_IG_CONTACT_ID_FAILURE",taskId:Qe,contactId:null})})),e.abrupt("break",328);case 131:return e.next=133,Vr();case 133:return Xe=o.data.pageIds,function(){var e=d(l.a.mark((function e(){var t,r,n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=(null==Xe?void 0:Xe.length)>=50?5e3:2e3,r=Qr(Xe),e.prev=3,r.s();case 5:if((n=r.n()).done){e.next=14;break}return a=n.value,e.next=9,Zr(a);case 9:return C.log("FINISH INITIALIZE PAGE ".concat(a)),e.next=12,W(t);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(0),C.error(e.t1);case 27:case"end":return e.stop()}}),e,null,[[0,24],[3,16,19,22]])})));return function(){return e.apply(this,arguments)}}()(),e.abrupt("break",328);case 137:return e.next=139,Vr();case 139:return $e=o.data,Ze=$e.pageId,et=$e.isBusiness,At.preloadDocIds({pageId:Ze,isBusiness:et}),X.setItem("country",o.data.country),e.abrupt("break",328);case 143:return o.data.platformExtraInfo&&o.data.platformExtraInfo.linked_fb_page&&(o.data.pageId=o.data.platformExtraInfo.linked_fb_page),"instagram_official"!=o.data.platform&&(o.data.customerName=void 0),C.log("event data: ",o.data),e.next=148,Vr();case 148:return tt=o.data.taskId,new Dt(o.data).init().then((function(e){var r=e.messages,n=e.globalId;t.port.postMessage({type:"LOAD_FACEBOOK_MESSAGES_SUCCESS",taskId:tt,messages:r,globalId:n})})).catch((function(e){C.error("LOAD_FACEBOOK_MESSAGES ERROR:",e),t.port.postMessage({type:"LOAD_FACEBOOK_MESSAGES_FAILURE",taskId:tt})})),e.abrupt("break",328);case 152:return e.next=154,Vr();case 154:return rt=o.data.taskId,new rr(o.data).init().then((function(e){return t.port.postMessage({type:"GET_POST_ID_FROM_LINK_SUCCESS",taskId:rt,postId:e})})).catch((function(){C.error("FAIL TO GET POST ID FROM LINK"),t.port.postMessage({type:"GET_POST_ID_FROM_LINK_FAILURE",taskId:rt})})),e.abrupt("break",328);case 158:return e.next=160,Vr();case 160:return nt=o.data.taskId,new nr(o.data).init().then((function(e){return t.port.postMessage({type:"GET_IMG_FROM_SHARED_ATTACHMENT_SUCCESS",taskId:nt,url:e})})).catch((function(){C.error("FAIL TO GET IMG FROM SHARED ATTACHMENT"),t.port.postMessage({type:"GET_IMG_FROM_SHARED_ATTACHMENT_FAILURE",taskId:nt})})),e.abrupt("break",328);case 164:return e.next=166,Vr();case 166:return at=o.data.taskId,new sr(o.data).handle().then((function(){return t.port.postMessage({type:"BLOCK_FACEBOOK_USER_SUCCESS",taskId:at})})).catch((function(e){var r=e.errorCode,n=e.errorDescription;C.error("FAIL TO BLOCK USER. REASON: ".concat(n)),t.port.postMessage({type:"BLOCK_FACEBOOK_USER_FAILURE",errorCode:r,errorDescription:n,taskId:at})})),e.abrupt("break",328);case 170:return e.next=172,Vr();case 172:return st=o.data,ot=st.taskId,it=st.pageId,ct=st.videoId,ut=st.endCursor,(lt=new or({pageId:it,videoId:ct,taskId:ot,endCursor:ut})).init().then((function(e){lt.crawlSuccess(t,ot,it,e)})).catch((function(e){C.error("FAIL TO CRAWL DATA LIVE",e),lt.crawlFail(t,ot,it)})),e.abrupt("break",328);case 176:return e.next=178,Vr();case 178:return pt=o.data,dt=pt.taskId,ft=pt.pageId,ht=pt.postId,vt=pt.endCursor,(_t=new Ar({pageId:ft,postId:ht,taskId:dt,endCursor:vt})).init().then((function(e){_t.crawlSuccess(t,dt,ft,e)})).catch((function(e){C.error("FAIL TO CRAWL POST SHARE",e),_t.crawlFail(t,dt,ft)})),e.abrupt("break",328);case 182:return mt=o.data.taskId,new cr(o.data).init().then((function(){return t.port.postMessage({type:"REACT_MESSAGE_SUCCESS",taskId:mt})})).catch((function(e){C.error("FAIL TO REACT TO MESSAGE. REASON: ".concat(e)),t.port.postMessage({type:"REACT_MESSAGE_FAILURE",taskId:mt})})),e.abrupt("break",328);case 186:return gt=o.data.taskId,new Ne(o.data).init().then((function(e){return t.port.postMessage({type:"BATCH_GET_GLOBAL_ID_SUCCESS",threadsWithGlobalId:e,taskId:gt})})).catch((function(e){C.error("FAIL TO BATCH GET GLOBAL ID. REASON: ".concat(e)),t.port.postMessage({type:"BATCH_GET_GLOBAL_ID_FAILURE",taskId:gt})})),e.abrupt("break",328);case 190:return bt=o.data,It=bt.taskId,yt=bt.accountId,e.next=193,chrome.cookies.get({url:"https://manager.line.biz",name:"XSRF-TOKEN"},function(){var e=d(l.a.mark((function e(r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=6;break}return e.next=3,Xr("line.biz","x-xsrf-token",r.value);case 3:pr.getLineInstance({accountId:yt}).then(function(){var e=d(l.a.mark((function e(r){var n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getAccessToken();case 2:return n=e.sent,a=n.accessToken,s=n.success,o=n.err,e.next=8,r.setResponseMode("BOT");case 8:return e.next=10,r.enableWebhook();case 10:if(!s){e.next=14;break}t.port.postMessage({type:"LINE:INITIALIZE_PAGE_SUCCESS",channel:c(c({},r.channel),{},{accessToken:a}),taskId:It}),e.next=15;break;case 14:return e.abrupt("return",Promise.reject(o||"failToGetAccessToken"));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.port.postMessage({type:"LINE:INITIALIZE_PAGE_FAILURE",taskId:It,err:e})})),e.next=8;break;case 6:return C.error("CANT FIND XSRF-TOKEN FOR LINE"),e.abrupt("return",Promise.reject("failToGetAccessToken"));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 193:return e.abrupt("break",328);case 194:return xt=o.data.taskId,pr.getLineInstance(o.data).then(function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.enableRetryWebhook();case 2:return e.next=4,t.enableErrorAggregation();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.port.postMessage({type:"LINE:TURN_ON_RETRY_WEBHOOK_SUCCESS",taskId:xt}),e.abrupt("break",328);case 198:return kt=o.data,wt=kt.taskId,St=kt.timeRangeMin,pr.getLineInstance(o.data).then(function(){var e=d(l.a.mark((function e(t){var r,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setResponseMode("CHAT");case 2:r=[],n=null;case 4:return e.next=6,t.getConversations(n);case 6:if(!(a=e.sent).success){e.next=15;break}if(r=r.concat(a.data),n=a.next,s=a.data[a.data.length-1],!(St&&s&&s.updatedAt<St)){e.next=13;break}return e.abrupt("break",17);case 13:e.next=16;break;case 15:return e.abrupt("return",Promise.reject());case 16:if(n){e.next=4;break}case 17:return e.next=19,t.setResponseMode("BOT");case 19:return e.next=21,t.enableWebhook();case 21:return e.abrupt("return",r);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){t.port.postMessage({type:"LINE:GET_CONVERSATIONS_SUCCESS",conversations:e,taskId:wt})})).catch((function(e){C.error(e),t.port.postMessage({type:"LINE:GET_CONVERSATIONS_FAILURE",taskId:wt})})),e.abrupt("break",328);case 201:return e.next=203,Vr();case 203:return Et=o.data.commentId.split("_"),Ct=s(Et,2),Tt=Ct[0],Rt=Ct[1],Lt=Object.assign({},o.data,{worker:t,postId:Tt,commentId:Rt}),new Ee(Lt).removeComment().then((function(e){e.success?t.port.postMessage({type:"REMOVE_COMMENT_SUCCESS",taskId:Lt.taskId}):t.port.postMessage({type:"REMOVE_COMMENT_FAILURE",taskId:Lt.taskId,message:e.message})})),e.abrupt("break",328);case 208:return Nt=o.data,Ot=Nt.taskId,Ut=Nt.messages,Bt=Nt.accessToken,Ft=Nt.pageId,G(Ut,Ft,Bt).then((function(e){t.port.postMessage({type:"UPLOAD_MEDIA_TO_PANCAKE_SUCCESS",messages:e,taskId:Ot})})),e.abrupt("break",328);case 211:return Mt=o.data,Ht=Mt.taskId,Wt=Mt.pageId,Kt=Mt.appointmentMessage,new ze(Wt,Kt).approveAppointment().then((function(e){var r,n,a;(null==e||null===(r=e.data)||void 0===r||null===(n=r.instant_booking_confirm_appointment)||void 0===n||null===(a=n.request)||void 0===a?void 0:a.id)?t.port.postMessage({type:"APPROVE_APPOINTMENT_SUCCESS",data:e,success:!0,taskId:Ht}):t.port.postMessage({type:"APPROVE_APPOINTMENT_FAILURE",success:!1,taskId:Ht})})).catch((function(e){C.error(e),t.port.postMessage({type:"APPROVE_APPOINTMENT_FAILURE",success:!1,taskId:Ht})})),e.abrupt("break",328);case 215:return Qt=o.data,Jt=Qt.taskId,$t=Qt.pageId,Zt=Qt.appointmentMessage,ar=Qt.denyText,new ze($t,Zt).denyAppointment(ar).then((function(e){var r,n,a;(null==e||null===(r=e.data)||void 0===r||null===(n=r.native_booking_request_status_update)||void 0===n||null===(a=n.request)||void 0===a?void 0:a.id)?t.port.postMessage({type:"DENY_APPOINTMENT_SUCCESS",data:e,success:!0,taskId:Jt}):t.port.postMessage({type:"DENY_APPOINTMENT_FAILURE",success:!1,taskId:Jt})})).catch((function(e){C.error(e),t.port.postMessage({type:"DENY_APPOINTMENT_FAILURE",success:!1,taskId:Jt})})),e.abrupt("break",328);case 219:return ur=o.data,lr=ur.taskId,fr=ur.pageId,new Ye(fr).init((function(e){t.port.postMessage({type:"CONFIG_ROUTING_APP_SUCCESS",responses:e,taskId:lr})})),e.abrupt("break",328);case 223:return hr=o.data,vr=hr.taskId,_r=hr.pageId,(mr=new Ye(_r)).cacheCurrentConfigs(mr.makePancakeTakeControl.bind(mr)),t.port.postMessage({type:"CACHE_PAGES_ROUTING_APP_SUCCESS",taskId:vr,response:null}),e.abrupt("break",328);case 228:return gr=o.data,br=gr.taskId,Ir=gr.pageId,xr=gr.convId,kr=gr.threadId,wr=gr.globalUserId,Er=gr.threadKey,C.log("CHANGE_CONV_STATUS_TO_ARCHIVED, globalUserId:",wr),new Ve(Ir,xr,kr,Er,wr).init((function(e){t.port.postMessage({type:"CHANGE_CONV_STATUS_TO_ARCHIVED_SUCCESS",response:e,taskId:br})}),(function(){return t.port.postMessage({type:"CHANGE_CONV_STATUS_TO_ARCHIVED_FAILURE"})})),e.abrupt("break",328);case 233:return Cr=o.data,Rr=Cr.pageId,Lr=Cr.isEnabled,C.log("ENABLE_FIND_THREAD_BY_USERNAME",o.data),Or="findThreadByUsername_".concat(Rr),self[Or]=Lr,t.port.postMessage({type:"ENABLE_FIND_THREAD_BY_USERNAME_DONE",isEnabled:Lr}),e.abrupt("break",328);case 239:return Pr=o.data,Dr=Pr.pageId,Br=Pr.taskId,new ze(Dr,null,o.data).createAppointment(t,Br),e.abrupt("break",328);case 243:return Fr=o.data,Mr=Fr.taskId,Gr=Fr.fileUrl,new yr(Gr).download((function(e){t.port.postMessage(c(c({},e),{},{taskId:Mr}))})),e.abrupt("break",328);case 247:return e.next=249,chrome.storage.local.set({"pancx-last-heartbeat":(new Date).getTime()});case 249:return e.abrupt("break",328);case 250:return qr=o.data.taskId,zr=new dr({postId:o.data.postId}),e.next=254,zr.getData();case 254:return(Wr=e.sent)?t.port.postMessage({type:"LOAD_FB_POST_SUCCESS",post:Wr,success:!0,taskId:qr}):t.port.postMessage({type:"LOAD_FB_POST_FAILURE",post:null,success:!1,taskId:qr}),e.abrupt("break",328);case 257:return Yr=o.data,Jr=Yr.taskId,$r=Yr.isIGD,en=void 0!==$r&&$r,e.next=260,Sr.get(en);case 260:if(rn=e.sent,!en){e.next=269;break}return e.next=264,chrome.cookies.getAll({domain:"instagram.com",path:"/"});case 264:return fn=e.sent,hn=fn.map((function(e){return"".concat((null==e?void 0:e.name)||"","=").concat((null==e?void 0:e.value)||"")})).join(";"),C.log("igd_cookie",hn),e.next=269,Xr("wss://edge-chat.instagram.com","Cookie",hn,!0);case 269:return t.port.postMessage({type:"GET_BUSINESS_CONTEXT_SUCCESS",context:rn,taskId:Jr}),e.abrupt("break",328);case 271:return vn=o.data,_n=vn.taskId,mn=vn.videoId,gn=vn.pageId,bn=vn.cursor,In=void 0===bn?null:bn,yn=function(){var e=d(l.a.mark((function e(){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Tr({videoId:mn,pageId:gn}),e.next=4,r.listAllProductItems(In);case 4:n=e.sent,t.port.postMessage({type:"GET_PINABLE_PRODUCTS_SUCCESS",response:{success:!0,fbResponse:n},taskId:_n}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),C.error(e.t0),t.port.postMessage({type:"GET_PINABLE_PRODUCTS_FAILURE",response:{success:!1,message:"Extension error",error:e.t0,fbResponse:null},taskId:_n});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),new je(gn,!1).init().then((function(){C.log("SWITCH PROFILE SUCCESS")})).catch((function(e){C.log("SWITCH PROFILE ERROR: ",e)})).finally(yn),e.abrupt("break",328);case 276:return xn=o.data,kn=xn.taskId,wn=xn.videoId,Sn=xn.productId,En=xn.isUnpin,Cn=void 0!==En&&En,Tn=xn.pageId,An=function(){var e=d(l.a.mark((function e(){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=new Tr({videoId:wn,pageId:Tn}),!Cn){e.next=8;break}return e.next=5,r.unpinProduct(Sn);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,r.pinProduct(Sn);case 10:e.t0=e.sent;case 11:n=e.t0,C.log("response_pin_product",n),t.port.postMessage({type:"TOGGLE_PIN_PRODUCT_SUCCESS",response:{success:!0,fbResponse:n},taskId:kn}),e.next=20;break;case 16:e.prev=16,e.t1=e.catch(0),C.error(e.t1),t.port.postMessage({type:"TOGGLE_PIN_PRODUCT_FAILURE",response:{success:!1,message:"Extension error",error:e.t1,fbResponse:null},taskId:kn});case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),new je(Tn,!1).init().then((function(){C.log("SWITCH PROFILE SUCCESS")})).catch((function(e){C.log("SWITCH PROFILE ERROR: ",e)})).finally(An),e.abrupt("break",328);case 281:return Rn=o.data,Ln=Rn.pageId,Nn=Rn.taskId,On=Rn.link,Zr(Ln).then((function(e){e.crawlLeadFormMsgDetail(On).then((function(e){t.port.postMessage({type:"CRAWL_LEAD_FORM_MSG_DETAIL_SUCCESS",taskId:Nn,response:{success:!0,fbResponse:e}})})).catch((function(e){C.error(e),t.port.postMessage({type:"CRAWL_LEAD_FORM_MSG_DETAIL_FAILURE",taskId:Nn})}))})),e.abrupt("break",328);case 284:return ln[o.data.pageId]||(Pn=new Ur(o.data),ln[o.data.pageId]=Pn),e.abrupt("break",328);case 286:return ln[o.data.pageId]&&(pn[o.data.pageId]||ln[o.data.pageId].stop(o.data.pageId)),e.abrupt("break",328);case 288:return Dn=o.data,Un=Dn.taskId,Bn=Dn.fileUrl,Fn=Dn.pageId,Mn=Dn.convId,Gn=Dn.attachmentType,qn=Dn.fileName,e.next=291,Vr();case 291:return Hn=new Ur(o.data),e.next=294,Hn.init(o.data.pageId);case 294:return jn={fileUrl:Bn,fileName:qn},e.next=297,Hn.sendFileReply(Gn,jn,Fn,Mn);case 297:return(zn=e.sent).success?t.port.postMessage({type:"REPLY_INBOX_FILE_ZALO_OA_SUCCESS",response:{success:!0,data:zn.data},taskId:Un}):t.port.postMessage({type:"REPLY_INBOX_FILE_ZALO_OA_FAILURE",response:{success:!1,message:"Extension error",error:zn.data},taskId:Un}),e.abrupt("break",328);case 300:return Vn=o.data,Wn=Vn.taskId,Kn=Vn.pageId,Qn=new Pt({pageId:Kn,isIGD:!0}),e.next=304,Qn.validSendIGDInbox();case 304:return Yn=e.sent,t.port.postMessage({type:"VALIDATE_SEND_IGD_INBOX_SUCCESS",response:{success:!0,valid:Yn},taskId:Wn}),e.abrupt("break",328);case 307:return Jn=o.data,Xn=Jn.taskId,Zr(($n=Jn.sendParams).pageId).then(function(){var e=d(l.a.mark((function e(r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.findInternalMessage($n,$n.replyMessage);case 2:(n=e.sent)?t.port.postMessage({type:"GET_FB_MSG_SUCCESS",response:{success:!0,fbMessage:n},taskId:Xn}):t.port.postMessage({type:"GET_FB_MSG_FAILURE",response:{success:!1,fbMessage:null},taskId:Xn});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("break",328);case 310:return Zn=o.data,ea=Zn.pageId,ta=Zn.deviceId,ra=Zn.taskId,e.prev=311,e.next=314,Kr.getContext(ea,ta||"");case 314:(na=e.sent)?t.port.postMessage({type:"GET_BUSINESS_WS_CONTEXT_SUCCESS",response:{success:!0,wsContext:na},taskId:ra}):t.port.postMessage({type:"GET_BUSINESS_WS_CONTEXT_FAILURE",response:{success:!1},taskId:ra}),e.next=321;break;case 318:e.prev=318,e.t1=e.catch(311),t.port.postMessage({type:"GET_BUSINESS_WS_CONTEXT_FAILURE",response:{success:!1},taskId:ra});case 321:return e.abrupt("break",328);case 322:return aa=o.data.taskId,sa=new Fe(o.data),oa=function(){return t.port.postMessage({type:"GET_GLOBAL_ID_FOR_CONV_FAILURE",taskId:aa})},sa.init().then((function(e){e?t.port.postMessage({type:"GET_GLOBAL_ID_FOR_CONV_SUCCESS",success:!0,globalId:e,taskId:aa}):oa()})).catch((function(){oa()})),e.abrupt("break",328);case 327:return e.abrupt("break",328);case 328:case"end":return e.stop()}}),e,null,[[311,318]])})));return function(t){return e.apply(this,arguments)}}())})),qr=function(){var e=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.setItem("requestCount",0);case 2:return e.next=4,Hr();case 4:return e.next=6,jr(self.pancGlobalWorker);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var fn=function(){var e=d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("connectionStatus");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={"www.facebook.com":null};case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),hn=function(){var e=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.setItem("connectionStatus",t||{"www.facebook.com":null});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function vn(e){return _n.apply(this,arguments)}function _n(){return(_n=d(l.a.mark((function e(t){var r,n,a,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=createImageBitmap,e.next=3,fetch(t);case 3:return e.next=5,e.sent.blob();case 5:return e.t1=e.sent,e.next=8,(0,e.t0)(e.t1);case 8:return r=e.sent,n=r.width,a=r.height,s=new OffscreenCanvas(n,a),(o=s.getContext("2d")).drawImage(r,0,0,n,a),e.abrupt("return",o.getImageData(0,0,n,a));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Hr=function(){var e=d(l.a.mark((function e(){var t,r,n,a,s,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return(r=d(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re("https://".concat(t),{headers:{"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"same-origin"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},t=function(e){return r.apply(this,arguments)},e.next=4,fn();case 4:n=e.sent,a=0,s=Object.keys(n);case 6:if(!(a<s.length)){e.next=28;break}return o=s[a],e.next=10,t(o);case 10:if((i=e.sent)||"m.facebook.com"!==o){e.next=15;break}return e.next=14,t("facebook.com");case 14:i=e.sent;case 15:if(!i){e.next=22;break}return"www.facebook.com"===o&&rn.ctxFromHtml(i),n[o]=!0,e.next=20,hn(n);case 20:e.next=25;break;case 22:return n[o]=!1,e.next=25,hn(n);case 25:a++,e.next=6;break;case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),jr=function(){var e=d(l.a.mark((function e(t){var r,n,a,s,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:0,n=!0,e.next=4,fn();case 4:a=e.sent,e.t0=l.a.keys(a);case 6:if((e.t1=e.t0()).done){e.next=13;break}if(s=e.t1.value,null!=a[s]){e.next=11;break}return n=!1,e.abrupt("break",13);case 11:e.next=6;break;case 13:n?(null==t?void 0:t.port)&&t.port.postMessage({type:"REPORT_EXTENSION_STATUS",connectionStatus:a,extVersion:self.pancake_ext_version}):setTimeout((function(){jr(t,r)}),r+5e3);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Wr=function(){var e=d(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.getItem("country");case 2:t=e.sent,e.t0=t,e.next="VN"===e.t0?6:"PH"===e.t0?8:"ID"===e.t0?10:"IN"===e.t0?12:"TH"===e.t0||"KH"===e.t0||"BR"===e.t0||"CO"===e.t0?14:16;break;case 6:return r="pages.fm",e.abrupt("break",17);case 8:return r="pancake.ph",e.abrupt("break",17);case 10:return r="pancake.id",e.abrupt("break",17);case 12:return r="pancake.in",e.abrupt("break",17);case 14:return r="pancake.biz",e.abrupt("break",17);case 16:r="pages.fm";case 17:return e.abrupt("return",new Promise((function(e){var t="https://".concat(r,"/check_origin"),n=function(t){t.origin&&!t.origin.match(/^chrome-extension:\/\//i)||zr(),e()};fetch(t,{method:"POST",redirect:"follow"}).then(function(){var e=d(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.redirected){e.next=4;break}fetch(t.url,{method:"POST"}).then((function(e){return e.json()})).then((function(e){n(e)})),e.next=8;break;case 4:return e.next=6,t.json();case 6:r=e.sent,n(r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})));case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),zr=function(){Jr()},chrome.runtime.onInstalled.addListener((function(e){qr(),zr()})),chrome.runtime.onStartup.addListener((function(){try{le("offscreen.html")}catch(e){}qr(),zr()})),le("offscreen.html"),chrome.declarativeContent.onPageChanged.removeRules(d(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=chrome.declarativeContent.onPageChanged,e.t1=[new chrome.declarativeContent.PageStateMatcher({pageUrl:{hostPrefix:"pancake."}})],e.t2=chrome.declarativeContent.SetIcon,e.next=5,vn(chrome.runtime.getURL("images/icon-128.png"));case 5:return e.t3=e.sent,e.t4={128:e.t3},e.t5={imageData:e.t4},e.t6=new e.t2(e.t5),e.t7=chrome.declarativeContent.ShowAction?new chrome.declarativeContent.ShowAction:new chrome.declarativeContent.ShowPageAction,e.t8=[e.t6,e.t7],e.t9={conditions:e.t1,actions:e.t8},e.t10=[new chrome.declarativeContent.PageStateMatcher({pageUrl:{hostPrefix:"extensions"}})],e.t11=chrome.declarativeContent.SetIcon,e.next=16,vn(chrome.runtime.getURL("images/icon-128.png"));case 16:e.t12=e.sent,e.t13={128:e.t12},e.t14={imageData:e.t13},e.t15=new e.t11(e.t14),e.t16=chrome.declarativeContent.ShowAction?new chrome.declarativeContent.ShowAction:new chrome.declarativeContent.ShowPageAction,e.t17=[e.t15,e.t16],e.t18={conditions:e.t10,actions:e.t17},e.t19=[e.t9,e.t18],e.t0.addRules.call(e.t0,e.t19);case 25:case"end":return e.stop()}}),e)}))))}]);
//# sourceMappingURL=background.js.map

<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Facebook Live Video - TPOS API</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #1877f2 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                overflow: hidden;
            }

            .header {
                background: linear-gradient(135deg, #1877f2 0%, #764ba2 100%);
                color: white;
                padding: 30px;
                text-align: center;
            }

            .header h1 {
                font-size: 28px;
                margin-bottom: 10px;
            }

            .content {
                padding: 30px;
            }

            .controls {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }

            .controls input,
            .controls select {
                flex: 1;
                min-width: 150px;
                padding: 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
            }

            button {
                padding: 12px 24px;
                font-size: 16px;
                font-weight: 600;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .btn-primary {
                background: linear-gradient(135deg, #1877f2 0%, #764ba2 100%);
                color: white;
                flex: 1;
                min-width: 150px;
                justify-content: center;
            }

            .btn-primary:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 5px 20px rgba(24, 119, 242, 0.4);
            }

            .btn-primary:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            .status {
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
                display: none;
            }

            .status.show {
                display: block;
            }

            .status.loading {
                background: #fff3cd;
                color: #856404;
                border-left: 4px solid #ffc107;
            }

            .status.success {
                background: #d4edda;
                color: #155724;
                border-left: 4px solid #28a745;
            }

            .status.error {
                background: #f8d7da;
                color: #721c24;
                border-left: 4px solid #dc3545;
            }

            .spinner {
                width: 20px;
                height: 20px;
                border: 3px solid #f3f3f3;
                border-top: 3px solid #1877f2;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .video-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }

            .video-card {
                background: #f9fafb;
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                overflow: hidden;
                transition: all 0.3s;
            }

            .video-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            }

            .video-thumbnail {
                width: 100%;
                height: 180px;
                object-fit: cover;
                background: #e5e7eb;
            }

            .video-info {
                padding: 15px;
            }

            .video-title {
                font-weight: 600;
                color: #333;
                margin-bottom: 8px;
                font-size: 15px;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .video-meta {
                font-size: 13px;
                color: #6b7280;
                margin-bottom: 5px;
            }

            .video-status {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 600;
                margin-top: 8px;
            }

            .status-live {
                background: #fee2e2;
                color: #991b1b;
            }

            .status-ended {
                background: #e5e7eb;
                color: #4b5563;
            }

            .empty-state {
                text-align: center;
                padding: 60px 20px;
                color: #6c757d;
            }

            .empty-state svg {
                width: 80px;
                height: 80px;
                margin-bottom: 20px;
                opacity: 0.5;
            }

            .stats {
                display: flex;
                gap: 20px;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }

            .stat-card {
                flex: 1;
                min-width: 150px;
                background: #f0f9ff;
                border: 2px solid #3b82f6;
                border-radius: 8px;
                padding: 15px;
                text-align: center;
            }

            .stat-number {
                font-size: 32px;
                font-weight: 700;
                color: #1e40af;
                margin-bottom: 5px;
            }

            .stat-label {
                font-size: 13px;
                color: #6b7280;
            }

            @media (max-width: 768px) {
                .video-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üé• Facebook Live Video</h1>
                <p>Xem danh s√°ch live video t·ª´ Facebook Page</p>
            </div>

            <div class="content">
                <div class="controls">
                    <input
                        type="text"
                        id="pageId"
                        placeholder="Facebook Page ID"
                        value="117267091364524"
                    />
                    <input
                        type="number"
                        id="limit"
                        placeholder="Limit"
                        value="10"
                        min="1"
                        max="50"
                    />
                    <button class="btn-primary" onclick="loadVideos()">
                        <span id="btnText">üîÑ T·∫£i Video</span>
                        <div
                            class="spinner"
                            id="spinner"
                            style="display: none"
                        ></div>
                    </button>
                </div>

                <div id="status" class="status"></div>

                <div id="stats" class="stats" style="display: none"></div>

                <div id="videoContainer">
                    <div class="empty-state">
                        <svg
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
                            ></path>
                        </svg>
                        <p>Nh·∫•n "T·∫£i Video" ƒë·ªÉ xem danh s√°ch</p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            async function loadVideos() {
                const pageId =
                    document.getElementById("pageId").value ||
                    "117267091364524";
                const limit = document.getElementById("limit").value || 10;

                const btnText = document.getElementById("btnText");
                const spinner = document.getElementById("spinner");
                const status = document.getElementById("status");
                const videoContainer =
                    document.getElementById("videoContainer");
                const statsContainer = document.getElementById("stats");

                // Show loading
                btnText.textContent = "ƒêang t·∫£i...";
                spinner.style.display = "block";
                status.className = "status loading show";
                status.textContent = "‚è≥ ƒêang l·∫•y d·ªØ li·ªáu t·ª´ Facebook...";

                try {
                    const response = await fetch(
                        `/facebook/livevideo?pageid=${pageId}&limit=${limit}`,
                    );
                    const result = await response.json();

                    if (result.success && result.data) {
                        const videos = result.data.data || [];

                        // Show success status
                        status.className = "status success show";
                        status.textContent = `‚úÖ T·∫£i th√†nh c√¥ng ${videos.length} video`;

                        // Show stats
                        statsContainer.style.display = "flex";
                        statsContainer.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${videos.length}</div>
                            <div class="stat-label">T·ªïng Video</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${videos.filter((v) => v.status === "LIVE").length}</div>
                            <div class="stat-label">ƒêang Live</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${videos.reduce((sum, v) => sum + (v.live_views || 0), 0)}</div>
                            <div class="stat-label">T·ªïng Views</div>
                        </div>
                    `;

                        // Display videos
                        if (videos.length > 0) {
                            displayVideos(videos);
                        } else {
                            videoContainer.innerHTML = `
                            <div class="empty-state">
                                <p>Kh√¥ng t√¨m th·∫•y video n√†o</p>
                            </div>
                        `;
                        }
                    } else {
                        status.className = "status error show";
                        status.textContent =
                            "‚ùå L·ªói: " +
                            (result.error || "Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu");
                    }
                } catch (error) {
                    status.className = "status error show";
                    status.textContent = "‚ùå L·ªói k·∫øt n·ªëi: " + error.message;
                    videoContainer.innerHTML = `
                    <div class="empty-state">
                        <p>‚ùå L·ªói: ${error.message}</p>
                    </div>
                `;
                } finally {
                    btnText.textContent = "üîÑ T·∫£i Video";
                    spinner.style.display = "none";
                }
            }

            function displayVideos(videos) {
                const container = document.getElementById("videoContainer");

                const html = `
                <div class="video-grid">
                    ${videos
                        .map(
                            (video) => `
                        <div class="video-card">
                            <img 
                                src="${video.picture || "https://via.placeholder.com/300x180?text=No+Image"}" 
                                alt="${video.title || "No title"}"
                                class="video-thumbnail"
                                onerror="this.src='https://via.placeholder.com/300x180?text=No+Image'"
                            />
                            <div class="video-info">
                                <div class="video-title">${video.title || video.description || "Kh√¥ng c√≥ ti√™u ƒë·ªÅ"}</div>
                                <div class="video-meta">
                                    üëÅÔ∏è ${(video.live_views || 0).toLocaleString()} views
                                </div>
                                <div class="video-meta">
                                    üìÖ ${video.created_time ? new Date(video.created_time).toLocaleString("vi-VN") : "N/A"}
                                </div>
                                ${
                                    video.video
                                        ? `
                                    <div class="video-meta">
                                        <a href="${video.video.source}" target="_blank" style="color: #1877f2; text-decoration: none;">
                                            üé¨ Xem video
                                        </a>
                                    </div>
                                `
                                        : ""
                                }
                                <span class="video-status ${video.status === "LIVE" ? "status-live" : "status-ended"}">
                                    ${video.status === "LIVE" ? "üî¥ LIVE" : "‚ö´ ƒê√£ k·∫øt th√∫c"}
                                </span>
                            </div>
                        </div>
                    `,
                        )
                        .join("")}
                </div>
            `;

                container.innerHTML = html;
            }

            // Auto load on page load
            window.onload = () => {
                loadVideos();
            };
        </script>
    </body>
</html>
